/*! For license information please see wizardRiesgos.bundle.js.LICENSE.txt */
(()=>{var e,t,n={4633:(e,t,n)=>{var a=n(3738).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},r=Object.prototype,o=r.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function p(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(t){p=function(e,t,n){return e[t]=n}}function f(e,t,n,a){var i=t&&t.prototype instanceof x?t:x,r=Object.create(i.prototype),o=new z(a||[]);return s(r,"_invoke",{value:T(e,n,o)}),r}function v(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var g="suspendedStart",h="suspendedYield",m="executing",b="completed",y={};function x(){}function w(){}function C(){}var E={};p(E,l,(function(){return this}));var k=Object.getPrototypeOf,S=k&&k(k(P([])));S&&S!==r&&o.call(S,l)&&(E=S);var _=C.prototype=x.prototype=Object.create(E);function A(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function N(e,t){function n(i,r,s,c){var l=v(e[i],e,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==a(u)&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return n("throw",e,s,c)}))}c(l.arg)}var i;s(this,"_invoke",{value:function(e,a){function r(){return new t((function(t,i){n(e,a,t,i)}))}return i=i?i.then(r,r):r()}})}function T(e,n,a){var i=g;return function(r,o){if(i===m)throw Error("Generator is already running");if(i===b){if("throw"===r)throw o;return{value:t,done:!0}}for(a.method=r,a.arg=o;;){var s=a.delegate;if(s){var c=L(s,a);if(c){if(c===y)continue;return c}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(i===g)throw i=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);i=m;var l=v(e,n,a);if("normal"===l.type){if(i=a.done?b:h,l.arg===y)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(i=b,a.method="throw",a.arg=l.arg)}}}function L(e,n){var a=n.method,i=e.iterator[a];if(i===t)return n.delegate=null,"throw"===a&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),y;var r=v(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,y;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(a(e)+" is not iterable")}return w.prototype=C,s(_,"constructor",{value:C,configurable:!0}),s(C,"constructor",{value:w,configurable:!0}),w.displayName=p(C,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,p(e,u,"GeneratorFunction")),e.prototype=Object.create(_),e},n.awrap=function(e){return{__await:e}},A(N.prototype),p(N.prototype,d,(function(){return this})),n.AsyncIterator=N,n.async=function(e,t,a,i,r){void 0===r&&(r=Promise);var o=new N(f(e,t,a,i),r);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},A(_),p(_,u,"Generator"),p(_,l,(function(){return this})),p(_,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},n.values=P,z.prototype={constructor:z,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(a,i){return s.type="throw",s.arg=e,n.next=a,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],s=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var c=o.call(r,"catchLoc"),l=o.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var i=a.arg;D(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,a){return this.delegate={iterator:P(e),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=t),y}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4756:(e,t,n)=>{var a=n(4633)();e.exports=a;try{regeneratorRuntime=a}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}},5361:(e,t,n)=>{"use strict";n.d(t,{BN:()=>m,ER:()=>b,Ej:()=>y,RK:()=>c,UE:()=>s,UU:()=>l,__:()=>o,cY:()=>h,jD:()=>p,mG:()=>v,rD:()=>r});var a=n(7193);function i(e,t,n){let{reference:i,floating:r}=e;const o=(0,a.TV)(t),s=(0,a.Dz)(t),c=(0,a.sq)(s),l=(0,a.C0)(t),d="y"===o,u=i.x+i.width/2-r.width/2,p=i.y+i.height/2-r.height/2,f=i[c]/2-r[c]/2;let v;switch(l){case"top":v={x:u,y:i.y-r.height};break;case"bottom":v={x:u,y:i.y+i.height};break;case"right":v={x:i.x+i.width,y:p};break;case"left":v={x:i.x-r.width,y:p};break;default:v={x:i.x,y:i.y}}switch((0,a.Sg)(t)){case"start":v[s]-=f*(n&&d?-1:1);break;case"end":v[s]+=f*(n&&d?-1:1)}return v}const r=async(e,t,n)=>{const{placement:a="bottom",strategy:r="absolute",middleware:o=[],platform:s}=n,c=o.filter(Boolean),l=await(null==s.isRTL?void 0:s.isRTL(t));let d=await s.getElementRects({reference:e,floating:t,strategy:r}),{x:u,y:p}=i(d,a,l),f=a,v={},g=0;for(let n=0;n<c.length;n++){const{name:o,fn:h}=c[n],{x:m,y:b,data:y,reset:x}=await h({x:u,y:p,initialPlacement:a,placement:f,strategy:r,middlewareData:v,rects:d,platform:s,elements:{reference:e,floating:t}});u=null!=m?m:u,p=null!=b?b:p,v={...v,[o]:{...v[o],...y}},x&&g<=50&&(g++,"object"==typeof x&&(x.placement&&(f=x.placement),x.rects&&(d=!0===x.rects?await s.getElementRects({reference:e,floating:t,strategy:r}):x.rects),({x:u,y:p}=i(d,f,l))),n=-1)}return{x:u,y:p,placement:f,strategy:r,middlewareData:v}};async function o(e,t){var n;void 0===t&&(t={});const{x:i,y:r,platform:o,rects:s,elements:c,strategy:l}=e,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:p="floating",altBoundary:f=!1,padding:v=0}=(0,a._3)(t,e),g=(0,a.nI)(v),h=c[f?"floating"===p?"reference":"floating":p],m=(0,a.B1)(await o.getClippingRect({element:null==(n=await(null==o.isElement?void 0:o.isElement(h)))||n?h:h.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(c.floating)),boundary:d,rootBoundary:u,strategy:l})),b="floating"===p?{x:i,y:r,width:s.floating.width,height:s.floating.height}:s.reference,y=await(null==o.getOffsetParent?void 0:o.getOffsetParent(c.floating)),x=await(null==o.isElement?void 0:o.isElement(y))&&await(null==o.getScale?void 0:o.getScale(y))||{x:1,y:1},w=(0,a.B1)(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:b,offsetParent:y,strategy:l}):b);return{top:(m.top-w.top+g.top)/x.y,bottom:(w.bottom-m.bottom+g.bottom)/x.y,left:(m.left-w.left+g.left)/x.x,right:(w.right-m.right+g.right)/x.x}}const s=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:i,placement:r,rects:o,platform:s,elements:c,middlewareData:l}=t,{element:d,padding:u=0}=(0,a._3)(e,t)||{};if(null==d)return{};const p=(0,a.nI)(u),f={x:n,y:i},v=(0,a.Dz)(r),g=(0,a.sq)(v),h=await s.getDimensions(d),m="y"===v,b=m?"top":"left",y=m?"bottom":"right",x=m?"clientHeight":"clientWidth",w=o.reference[g]+o.reference[v]-f[v]-o.floating[g],C=f[v]-o.reference[v],E=await(null==s.getOffsetParent?void 0:s.getOffsetParent(d));let k=E?E[x]:0;k&&await(null==s.isElement?void 0:s.isElement(E))||(k=c.floating[x]||o.floating[g]);const S=w/2-C/2,_=k/2-h[g]/2-1,A=(0,a.jk)(p[b],_),N=(0,a.jk)(p[y],_),T=A,L=k-h[g]-N,I=k/2-h[g]/2+S,D=(0,a.qE)(T,I,L),z=!l.arrow&&null!=(0,a.Sg)(r)&&I!==D&&o.reference[g]/2-(I<T?A:N)-h[g]/2<0,P=z?I<T?I-T:I-L:0;return{[v]:f[v]+P,data:{[v]:D,centerOffset:I-D-P,...z&&{alignmentOffset:P}},reset:z}}});const c=function(e){return void 0===e&&(e={}),{name:"autoPlacement",options:e,async fn(t){var n,i,r;const{rects:s,middlewareData:c,placement:l,platform:d,elements:u}=t,{crossAxis:p=!1,alignment:f,allowedPlacements:v=a.DD,autoAlignment:g=!0,...h}=(0,a._3)(e,t),m=void 0!==f||v===a.DD?function(e,t,n){return(e?[...n.filter((t=>(0,a.Sg)(t)===e)),...n.filter((t=>(0,a.Sg)(t)!==e))]:n.filter((e=>(0,a.C0)(e)===e))).filter((n=>!e||(0,a.Sg)(n)===e||!!t&&(0,a.aD)(n)!==n))}(f||null,g,v):v,b=await o(t,h),y=(null==(n=c.autoPlacement)?void 0:n.index)||0,x=m[y];if(null==x)return{};const w=(0,a.w7)(x,s,await(null==d.isRTL?void 0:d.isRTL(u.floating)));if(l!==x)return{reset:{placement:m[0]}};const C=[b[(0,a.C0)(x)],b[w[0]],b[w[1]]],E=[...(null==(i=c.autoPlacement)?void 0:i.overflows)||[],{placement:x,overflows:C}],k=m[y+1];if(k)return{data:{index:y+1,overflows:E},reset:{placement:k}};const S=E.map((e=>{const t=(0,a.Sg)(e.placement);return[e.placement,t&&p?e.overflows.slice(0,2).reduce(((e,t)=>e+t),0):e.overflows[0],e.overflows]})).sort(((e,t)=>e[1]-t[1])),_=(null==(r=S.filter((e=>e[2].slice(0,(0,a.Sg)(e[0])?2:3).every((e=>e<=0))))[0])?void 0:r[0])||S[0][0];return _!==l?{data:{index:y+1,overflows:E},reset:{placement:_}}:{}}}},l=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,i;const{placement:r,middlewareData:s,rects:c,initialPlacement:l,platform:d,elements:u}=t,{mainAxis:p=!0,crossAxis:f=!0,fallbackPlacements:v,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:h="none",flipAlignment:m=!0,...b}=(0,a._3)(e,t);if(null!=(n=s.arrow)&&n.alignmentOffset)return{};const y=(0,a.C0)(r),x=(0,a.TV)(l),w=(0,a.C0)(l)===l,C=await(null==d.isRTL?void 0:d.isRTL(u.floating)),E=v||(w||!m?[(0,a.bV)(l)]:(0,a.WJ)(l)),k="none"!==h;!v&&k&&E.push(...(0,a.lP)(l,m,h,C));const S=[l,...E],_=await o(t,b),A=[];let N=(null==(i=s.flip)?void 0:i.overflows)||[];if(p&&A.push(_[y]),f){const e=(0,a.w7)(r,c,C);A.push(_[e[0]],_[e[1]])}if(N=[...N,{placement:r,overflows:A}],!A.every((e=>e<=0))){var T,L;const e=((null==(T=s.flip)?void 0:T.index)||0)+1,t=S[e];if(t){if(!("alignment"===f&&x!==(0,a.TV)(t))||N.every((e=>(0,a.TV)(e.placement)!==x||e.overflows[0]>0)))return{data:{index:e,overflows:N},reset:{placement:t}}}let n=null==(L=N.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:L.placement;if(!n)switch(g){case"bestFit":{var I;const e=null==(I=N.filter((e=>{if(k){const t=(0,a.TV)(e.placement);return t===x||"y"===t}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:I[0];e&&(n=e);break}case"initialPlacement":n=l}if(r!==n)return{reset:{placement:n}}}return{}}}};function d(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function u(e){return a.r_.some((t=>e[t]>=0))}const p=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:i="referenceHidden",...r}=(0,a._3)(e,t);switch(i){case"referenceHidden":{const e=d(await o(t,{...r,elementContext:"reference"}),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:u(e)}}}case"escaped":{const e=d(await o(t,{...r,altBoundary:!0}),n.floating);return{data:{escapedOffsets:e,escaped:u(e)}}}default:return{}}}}};function f(e){const t=(0,a.jk)(...e.map((e=>e.left))),n=(0,a.jk)(...e.map((e=>e.top)));return{x:t,y:n,width:(0,a.T9)(...e.map((e=>e.right)))-t,height:(0,a.T9)(...e.map((e=>e.bottom)))-n}}const v=function(e){return void 0===e&&(e={}),{name:"inline",options:e,async fn(t){const{placement:n,elements:i,rects:r,platform:o,strategy:s}=t,{padding:c=2,x:l,y:d}=(0,a._3)(e,t),u=Array.from(await(null==o.getClientRects?void 0:o.getClientRects(i.reference))||[]),p=function(e){const t=e.slice().sort(((e,t)=>e.y-t.y)),n=[];let i=null;for(let e=0;e<t.length;e++){const a=t[e];!i||a.y-i.y>i.height/2?n.push([a]):n[n.length-1].push(a),i=a}return n.map((e=>(0,a.B1)(f(e))))}(u),v=(0,a.B1)(f(u)),g=(0,a.nI)(c);const h=await o.getElementRects({reference:{getBoundingClientRect:function(){if(2===p.length&&p[0].left>p[1].right&&null!=l&&null!=d)return p.find((e=>l>e.left-g.left&&l<e.right+g.right&&d>e.top-g.top&&d<e.bottom+g.bottom))||v;if(p.length>=2){if("y"===(0,a.TV)(n)){const e=p[0],t=p[p.length-1],i="top"===(0,a.C0)(n),r=e.top,o=t.bottom,s=i?e.left:t.left,c=i?e.right:t.right;return{top:r,bottom:o,left:s,right:c,width:c-s,height:o-r,x:s,y:r}}const e="left"===(0,a.C0)(n),t=(0,a.T9)(...p.map((e=>e.right))),i=(0,a.jk)(...p.map((e=>e.left))),r=p.filter((n=>e?n.left===i:n.right===t)),o=r[0].top,s=r[r.length-1].bottom;return{top:o,bottom:s,left:i,right:t,width:t-i,height:s-o,x:i,y:o}}return v}},floating:i.floating,strategy:s});return r.reference.x!==h.reference.x||r.reference.y!==h.reference.y||r.reference.width!==h.reference.width||r.reference.height!==h.reference.height?{reset:{rects:h}}:{}}}},g=new Set(["left","top"]);const h=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var n,i;const{x:r,y:o,placement:s,middlewareData:c}=t,l=await async function(e,t){const{placement:n,platform:i,elements:r}=e,o=await(null==i.isRTL?void 0:i.isRTL(r.floating)),s=(0,a.C0)(n),c=(0,a.Sg)(n),l="y"===(0,a.TV)(n),d=g.has(s)?-1:1,u=o&&l?-1:1,p=(0,a._3)(t,e);let{mainAxis:f,crossAxis:v,alignmentAxis:h}="number"==typeof p?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return c&&"number"==typeof h&&(v="end"===c?-1*h:h),l?{x:v*u,y:f*d}:{x:f*d,y:v*u}}(t,e);return s===(null==(n=c.offset)?void 0:n.placement)&&null!=(i=c.arrow)&&i.alignmentOffset?{}:{x:r+l.x,y:o+l.y,data:{...l,placement:s}}}}},m=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:i,placement:r}=t,{mainAxis:s=!0,crossAxis:c=!1,limiter:l={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...d}=(0,a._3)(e,t),u={x:n,y:i},p=await o(t,d),f=(0,a.TV)((0,a.C0)(r)),v=(0,a.PG)(f);let g=u[v],h=u[f];if(s){const e="y"===v?"bottom":"right",t=g+p["y"===v?"top":"left"],n=g-p[e];g=(0,a.qE)(t,g,n)}if(c){const e="y"===f?"bottom":"right",t=h+p["y"===f?"top":"left"],n=h-p[e];h=(0,a.qE)(t,h,n)}const m=l.fn({...t,[v]:g,[f]:h});return{...m,data:{x:m.x-n,y:m.y-i,enabled:{[v]:s,[f]:c}}}}}},b=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:i,placement:r,rects:o,middlewareData:s}=t,{offset:c=0,mainAxis:l=!0,crossAxis:d=!0}=(0,a._3)(e,t),u={x:n,y:i},p=(0,a.TV)(r),f=(0,a.PG)(p);let v=u[f],h=u[p];const m=(0,a._3)(c,t),b="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const e="y"===f?"height":"width",t=o.reference[f]-o.floating[e]+b.mainAxis,n=o.reference[f]+o.reference[e]-b.mainAxis;v<t?v=t:v>n&&(v=n)}if(d){var y,x;const e="y"===f?"width":"height",t=g.has((0,a.C0)(r)),n=o.reference[p]-o.floating[e]+(t&&(null==(y=s.offset)?void 0:y[p])||0)+(t?0:b.crossAxis),i=o.reference[p]+o.reference[e]+(t?0:(null==(x=s.offset)?void 0:x[p])||0)-(t?b.crossAxis:0);h<n?h=n:h>i&&(h=i)}return{[f]:v,[p]:h}}}},y=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var n,i;const{placement:r,rects:s,platform:c,elements:l}=t,{apply:d=()=>{},...u}=(0,a._3)(e,t),p=await o(t,u),f=(0,a.C0)(r),v=(0,a.Sg)(r),g="y"===(0,a.TV)(r),{width:h,height:m}=s.floating;let b,y;"top"===f||"bottom"===f?(b=f,y=v===(await(null==c.isRTL?void 0:c.isRTL(l.floating))?"start":"end")?"left":"right"):(y=f,b="end"===v?"top":"bottom");const x=m-p.top-p.bottom,w=h-p.left-p.right,C=(0,a.jk)(m-p[b],x),E=(0,a.jk)(h-p[y],w),k=!t.middlewareData.shift;let S=C,_=E;if(null!=(n=t.middlewareData.shift)&&n.enabled.x&&(_=w),null!=(i=t.middlewareData.shift)&&i.enabled.y&&(S=x),k&&!v){const e=(0,a.T9)(p.left,0),t=(0,a.T9)(p.right,0),n=(0,a.T9)(p.top,0),i=(0,a.T9)(p.bottom,0);g?_=h-2*(0!==e||0!==t?e+t:(0,a.T9)(p.left,p.right)):S=m-2*(0!==n||0!==i?n+i:(0,a.T9)(p.top,p.bottom))}await d({...t,availableWidth:_,availableHeight:S});const A=await c.getDimensions(l.floating);return h!==A.width||m!==A.height?{reset:{rects:!0}}:{}}}}},8491:(e,t,n)=>{"use strict";n.r(t),n.d(t,{arrow:()=>I,autoPlacement:()=>_,autoUpdate:()=>E,computePosition:()=>P,detectOverflow:()=>k,flip:()=>N,getOverflowAncestors:()=>r.v9,hide:()=>L,inline:()=>D,limitShift:()=>z,offset:()=>S,platform:()=>w,shift:()=>A,size:()=>T});var a=n(7193),i=n(5361),r=n(6635);function o(e){const t=(0,r.L9)(e);let n=parseFloat(t.width)||0,i=parseFloat(t.height)||0;const o=(0,r.sb)(e),s=o?e.offsetWidth:n,c=o?e.offsetHeight:i,l=(0,a.LI)(n)!==s||(0,a.LI)(i)!==c;return l&&(n=s,i=c),{width:n,height:i,$:l}}function s(e){return(0,r.vq)(e)?e:e.contextElement}function c(e){const t=s(e);if(!(0,r.sb)(t))return(0,a.Jx)(1);const n=t.getBoundingClientRect(),{width:i,height:c,$:l}=o(t);let d=(l?(0,a.LI)(n.width):n.width)/i,u=(l?(0,a.LI)(n.height):n.height)/c;return d&&Number.isFinite(d)||(d=1),u&&Number.isFinite(u)||(u=1),{x:d,y:u}}const l=(0,a.Jx)(0);function d(e){const t=(0,r.zk)(e);return(0,r.Tc)()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:l}function u(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=!1);const o=e.getBoundingClientRect(),l=s(e);let u=(0,a.Jx)(1);t&&(i?(0,r.vq)(i)&&(u=c(i)):u=c(e));const p=function(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==(0,r.zk)(e))&&t}(l,n,i)?d(l):(0,a.Jx)(0);let f=(o.left+p.x)/u.x,v=(o.top+p.y)/u.y,g=o.width/u.x,h=o.height/u.y;if(l){const e=(0,r.zk)(l),t=i&&(0,r.vq)(i)?(0,r.zk)(i):i;let n=e,a=(0,r._m)(n);for(;a&&i&&t!==n;){const e=c(a),t=a.getBoundingClientRect(),i=(0,r.L9)(a),o=t.left+(a.clientLeft+parseFloat(i.paddingLeft))*e.x,s=t.top+(a.clientTop+parseFloat(i.paddingTop))*e.y;f*=e.x,v*=e.y,g*=e.x,h*=e.y,f+=o,v+=s,n=(0,r.zk)(a),a=(0,r._m)(n)}}return(0,a.B1)({width:g,height:h,x:f,y:v})}function p(e,t){const n=(0,r.CP)(e).scrollLeft;return t?t.left+n:u((0,r.ep)(e)).left+n}function f(e,t){const n=e.getBoundingClientRect();return{x:n.left+t.scrollLeft-p(e,n),y:n.top+t.scrollTop}}const v=new Set(["absolute","fixed"]);function g(e,t,n){let i;if("viewport"===t)i=function(e,t){const n=(0,r.zk)(e),a=(0,r.ep)(e),i=n.visualViewport;let o=a.clientWidth,s=a.clientHeight,c=0,l=0;if(i){o=i.width,s=i.height;const e=(0,r.Tc)();(!e||e&&"fixed"===t)&&(c=i.offsetLeft,l=i.offsetTop)}const d=p(a);if(d<=0){const e=a.ownerDocument,t=e.body,n=getComputedStyle(t),i="CSS1Compat"===e.compatMode&&parseFloat(n.marginLeft)+parseFloat(n.marginRight)||0,r=Math.abs(a.clientWidth-t.clientWidth-i);r<=25&&(o-=r)}else d<=25&&(o+=d);return{width:o,height:s,x:c,y:l}}(e,n);else if("document"===t)i=function(e){const t=(0,r.ep)(e),n=(0,r.CP)(e),i=e.ownerDocument.body,o=(0,a.T9)(t.scrollWidth,t.clientWidth,i.scrollWidth,i.clientWidth),s=(0,a.T9)(t.scrollHeight,t.clientHeight,i.scrollHeight,i.clientHeight);let c=-n.scrollLeft+p(e);const l=-n.scrollTop;return"rtl"===(0,r.L9)(i).direction&&(c+=(0,a.T9)(t.clientWidth,i.clientWidth)-o),{width:o,height:s,x:c,y:l}}((0,r.ep)(e));else if((0,r.vq)(t))i=function(e,t){const n=u(e,!0,"fixed"===t),i=n.top+e.clientTop,o=n.left+e.clientLeft,s=(0,r.sb)(e)?c(e):(0,a.Jx)(1);return{width:e.clientWidth*s.x,height:e.clientHeight*s.y,x:o*s.x,y:i*s.y}}(t,n);else{const n=d(e);i={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return(0,a.B1)(i)}function h(e,t){const n=(0,r.$4)(e);return!(n===t||!(0,r.vq)(n)||(0,r.eu)(n))&&("fixed"===(0,r.L9)(n).position||h(n,t))}function m(e,t,n){const i=(0,r.sb)(t),o=(0,r.ep)(t),s="fixed"===n,c=u(e,!0,s,t);let l={scrollLeft:0,scrollTop:0};const d=(0,a.Jx)(0);function v(){d.x=p(o)}if(i||!i&&!s)if(("body"!==(0,r.mq)(t)||(0,r.ZU)(o))&&(l=(0,r.CP)(t)),i){const e=u(t,!0,s,t);d.x=e.x+t.clientLeft,d.y=e.y+t.clientTop}else o&&v();s&&!i&&o&&v();const g=!o||i||s?(0,a.Jx)(0):f(o,l);return{x:c.left+l.scrollLeft-d.x-g.x,y:c.top+l.scrollTop-d.y-g.y,width:c.width,height:c.height}}function b(e){return"static"===(0,r.L9)(e).position}function y(e,t){if(!(0,r.sb)(e)||"fixed"===(0,r.L9)(e).position)return null;if(t)return t(e);let n=e.offsetParent;return(0,r.ep)(e)===n&&(n=n.ownerDocument.body),n}function x(e,t){const n=(0,r.zk)(e);if((0,r.Tf)(e))return n;if(!(0,r.sb)(e)){let t=(0,r.$4)(e);for(;t&&!(0,r.eu)(t);){if((0,r.vq)(t)&&!b(t))return t;t=(0,r.$4)(t)}return n}let a=y(e,t);for(;a&&(0,r.Lv)(a)&&b(a);)a=y(a,t);return a&&(0,r.eu)(a)&&b(a)&&!(0,r.sQ)(a)?n:a||(0,r.gJ)(e)||n}const w={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:n,offsetParent:i,strategy:o}=e;const s="fixed"===o,l=(0,r.ep)(i),d=!!t&&(0,r.Tf)(t.floating);if(i===l||d&&s)return n;let p={scrollLeft:0,scrollTop:0},v=(0,a.Jx)(1);const g=(0,a.Jx)(0),h=(0,r.sb)(i);if((h||!h&&!s)&&(("body"!==(0,r.mq)(i)||(0,r.ZU)(l))&&(p=(0,r.CP)(i)),(0,r.sb)(i))){const e=u(i);v=c(i),g.x=e.x+i.clientLeft,g.y=e.y+i.clientTop}const m=!l||h||s?(0,a.Jx)(0):f(l,p);return{width:n.width*v.x,height:n.height*v.y,x:n.x*v.x-p.scrollLeft*v.x+g.x+m.x,y:n.y*v.y-p.scrollTop*v.y+g.y+m.y}},getDocumentElement:r.ep,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:i,strategy:o}=e;const s=[..."clippingAncestors"===n?(0,r.Tf)(t)?[]:function(e,t){const n=t.get(e);if(n)return n;let a=(0,r.v9)(e,[],!1).filter((e=>(0,r.vq)(e)&&"body"!==(0,r.mq)(e))),i=null;const o="fixed"===(0,r.L9)(e).position;let s=o?(0,r.$4)(e):e;for(;(0,r.vq)(s)&&!(0,r.eu)(s);){const t=(0,r.L9)(s),n=(0,r.sQ)(s);n||"fixed"!==t.position||(i=null),(o?!n&&!i:!n&&"static"===t.position&&i&&v.has(i.position)||(0,r.ZU)(s)&&!n&&h(e,s))?a=a.filter((e=>e!==s)):i=t,s=(0,r.$4)(s)}return t.set(e,a),a}(t,this._c):[].concat(n),i],c=s[0],l=s.reduce(((e,n)=>{const i=g(t,n,o);return e.top=(0,a.T9)(i.top,e.top),e.right=(0,a.jk)(i.right,e.right),e.bottom=(0,a.jk)(i.bottom,e.bottom),e.left=(0,a.T9)(i.left,e.left),e}),g(t,c,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}},getOffsetParent:x,getElementRects:async function(e){const t=this.getOffsetParent||x,n=this.getDimensions,a=await n(e.floating);return{reference:m(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:n}=o(e);return{width:t,height:n}},getScale:c,isElement:r.vq,isRTL:function(e){return"rtl"===(0,r.L9)(e).direction}};function C(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function E(e,t,n,i){void 0===i&&(i={});const{ancestorScroll:o=!0,ancestorResize:c=!0,elementResize:l="function"==typeof ResizeObserver,layoutShift:d="function"==typeof IntersectionObserver,animationFrame:p=!1}=i,f=s(e),v=o||c?[...f?(0,r.v9)(f):[],...(0,r.v9)(t)]:[];v.forEach((e=>{o&&e.addEventListener("scroll",n,{passive:!0}),c&&e.addEventListener("resize",n)}));const g=f&&d?function(e,t){let n,i=null;const o=(0,r.ep)(e);function s(){var e;clearTimeout(n),null==(e=i)||e.disconnect(),i=null}return function r(c,l){void 0===c&&(c=!1),void 0===l&&(l=1),s();const d=e.getBoundingClientRect(),{left:u,top:p,width:f,height:v}=d;if(c||t(),!f||!v)return;const g={rootMargin:-(0,a.RI)(p)+"px "+-(0,a.RI)(o.clientWidth-(u+f))+"px "+-(0,a.RI)(o.clientHeight-(p+v))+"px "+-(0,a.RI)(u)+"px",threshold:(0,a.T9)(0,(0,a.jk)(1,l))||1};let h=!0;function m(t){const a=t[0].intersectionRatio;if(a!==l){if(!h)return r();a?r(!1,a):n=setTimeout((()=>{r(!1,1e-7)}),1e3)}1!==a||C(d,e.getBoundingClientRect())||r(),h=!1}try{i=new IntersectionObserver(m,{...g,root:o.ownerDocument})}catch(e){i=new IntersectionObserver(m,g)}i.observe(e)}(!0),s}(f,n):null;let h,m=-1,b=null;l&&(b=new ResizeObserver((e=>{let[a]=e;a&&a.target===f&&b&&(b.unobserve(t),cancelAnimationFrame(m),m=requestAnimationFrame((()=>{var e;null==(e=b)||e.observe(t)}))),n()})),f&&!p&&b.observe(f),b.observe(t));let y=p?u(e):null;return p&&function t(){const a=u(e);y&&!C(y,a)&&n();y=a,h=requestAnimationFrame(t)}(),n(),()=>{var e;v.forEach((e=>{o&&e.removeEventListener("scroll",n),c&&e.removeEventListener("resize",n)})),null==g||g(),null==(e=b)||e.disconnect(),b=null,p&&cancelAnimationFrame(h)}}const k=i.__,S=i.cY,_=i.RK,A=i.BN,N=i.UU,T=i.Ej,L=i.jD,I=i.UE,D=i.mG,z=i.ER,P=(e,t,n)=>{const a=new Map,r={platform:w,...n},o={...r.platform,_c:a};return(0,i.rD)(e,t,{...r,platform:o})}},6635:(e,t,n)=>{"use strict";function a(){return"undefined"!=typeof window}function i(e){return s(e)?(e.nodeName||"").toLowerCase():"#document"}function r(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function o(e){var t;return null==(t=(s(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function s(e){return!!a()&&(e instanceof Node||e instanceof r(e).Node)}function c(e){return!!a()&&(e instanceof Element||e instanceof r(e).Element)}function l(e){return!!a()&&(e instanceof HTMLElement||e instanceof r(e).HTMLElement)}function d(e){return!(!a()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof r(e).ShadowRoot)}n.d(t,{$4:()=>A,CP:()=>_,L9:()=>S,Lv:()=>v,Tc:()=>C,Tf:()=>h,ZU:()=>p,_m:()=>L,ep:()=>o,eu:()=>k,gJ:()=>w,mq:()=>i,sQ:()=>x,sb:()=>l,v9:()=>T,vq:()=>c,zk:()=>r});const u=new Set(["inline","contents"]);function p(e){const{overflow:t,overflowX:n,overflowY:a,display:i}=S(e);return/auto|scroll|overlay|hidden|clip/.test(t+a+n)&&!u.has(i)}const f=new Set(["table","td","th"]);function v(e){return f.has(i(e))}const g=[":popover-open",":modal"];function h(e){return g.some((t=>{try{return e.matches(t)}catch(e){return!1}}))}const m=["transform","translate","scale","rotate","perspective"],b=["transform","translate","scale","rotate","perspective","filter"],y=["paint","layout","strict","content"];function x(e){const t=C(),n=c(e)?S(e):e;return m.some((e=>!!n[e]&&"none"!==n[e]))||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||b.some((e=>(n.willChange||"").includes(e)))||y.some((e=>(n.contain||"").includes(e)))}function w(e){let t=A(e);for(;l(t)&&!k(t);){if(x(t))return t;if(h(t))return null;t=A(t)}return null}function C(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const E=new Set(["html","body","#document"]);function k(e){return E.has(i(e))}function S(e){return r(e).getComputedStyle(e)}function _(e){return c(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function A(e){if("html"===i(e))return e;const t=e.assignedSlot||e.parentNode||d(e)&&e.host||o(e);return d(t)?t.host:t}function N(e){const t=A(e);return k(t)?e.ownerDocument?e.ownerDocument.body:e.body:l(t)&&p(t)?t:N(t)}function T(e,t,n){var a;void 0===t&&(t=[]),void 0===n&&(n=!0);const i=N(e),o=i===(null==(a=e.ownerDocument)?void 0:a.body),s=r(i);if(o){const e=L(s);return t.concat(s,s.visualViewport||[],p(i)?i:[],e&&n?T(e):[])}return t.concat(i,T(i,[],n))}function L(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}},7193:(e,t,n)=>{"use strict";n.d(t,{B1:()=>D,C0:()=>g,DD:()=>r,Dz:()=>w,Jx:()=>d,LI:()=>c,PG:()=>m,RI:()=>l,Sg:()=>h,T9:()=>s,TV:()=>x,WJ:()=>E,_3:()=>v,aD:()=>k,bV:()=>L,jk:()=>o,lP:()=>T,nI:()=>I,qE:()=>f,r_:()=>a,sq:()=>b,w7:()=>C});const a=["top","right","bottom","left"],i=["start","end"],r=a.reduce(((e,t)=>e.concat(t,t+"-"+i[0],t+"-"+i[1])),[]),o=Math.min,s=Math.max,c=Math.round,l=Math.floor,d=e=>({x:e,y:e}),u={left:"right",right:"left",bottom:"top",top:"bottom"},p={start:"end",end:"start"};function f(e,t,n){return s(e,o(t,n))}function v(e,t){return"function"==typeof e?e(t):e}function g(e){return e.split("-")[0]}function h(e){return e.split("-")[1]}function m(e){return"x"===e?"y":"x"}function b(e){return"y"===e?"height":"width"}const y=new Set(["top","bottom"]);function x(e){return y.has(g(e))?"y":"x"}function w(e){return m(x(e))}function C(e,t,n){void 0===n&&(n=!1);const a=h(e),i=w(e),r=b(i);let o="x"===i?a===(n?"end":"start")?"right":"left":"start"===a?"bottom":"top";return t.reference[r]>t.floating[r]&&(o=L(o)),[o,L(o)]}function E(e){const t=L(e);return[k(e),t,k(t)]}function k(e){return e.replace(/start|end/g,(e=>p[e]))}const S=["left","right"],_=["right","left"],A=["top","bottom"],N=["bottom","top"];function T(e,t,n,a){const i=h(e);let r=function(e,t,n){switch(e){case"top":case"bottom":return n?t?_:S:t?S:_;case"left":case"right":return t?A:N;default:return[]}}(g(e),"start"===n,a);return i&&(r=r.map((e=>e+"-"+i)),t&&(r=r.concat(r.map(k)))),r}function L(e){return e.replace(/left|right|bottom|top/g,(e=>u[e]))}function I(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function D(e){const{x:t,y:n,width:a,height:i}=e;return{width:a,height:i,top:n,left:t,right:t+a,bottom:n+i,x:t,y:n}}}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={exports:{}};return n[e](r,r.exports,i),r.exports}i.m=n,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>e+".bundle.js",i.miniCssF=e=>{},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="genesys-client:",i.l=(n,a,r,o)=>{if(e[n])e[n].push(a);else{var s,c;if(void 0!==r)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+r){s=u;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.setAttribute("data-webpack",t+r),s.src=n),e[n]=[a];var p=(t,a)=>{s.onerror=s.onload=null,clearTimeout(f);var i=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(a))),t)return t(a)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),c&&document.head.appendChild(s)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/",(()=>{var e={730:0};i.f.j=(t,n)=>{var a=i.o(e,t)?e[t]:void 0;if(0!==a)if(a)n.push(a[2]);else{var r=new Promise(((n,i)=>a=e[t]=[n,i]));n.push(a[2]=r);var o=i.p+i.u(t),s=new Error;i.l(o,(n=>{if(i.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var r=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",s.name="ChunkLoadError",s.type=r,s.request=o,a[1](s)}}),"chunk-"+t,t)}};var t=(t,n)=>{var a,r,[o,s,c]=n,l=0;if(o.some((t=>0!==e[t]))){for(a in s)i.o(s,a)&&(i.m[a]=s[a]);if(c)c(i)}for(t&&t(n);l<o.length;l++)r=o[l],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunkgenesys_client=self.webpackChunkgenesys_client||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function t(t,n){if(t){if("string"==typeof t)return e(t,n);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(t,n):void 0}}function n(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r,o,s=[],c=!0,l=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=r.call(n)).done)&&(s.push(a.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,n)||t(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t,n,a,i,r,o){try{var s=e[r](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,i)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){a(o,i,r,s,c,"next",e)}function c(e){a(o,i,r,s,c,"throw",e)}s(void 0)}))}}var o=i(4756),s=i.n(o);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==c(t)?t:t+""}function d(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,l(a.key),a)}}function f(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=function(){return f((function e(){u(this,e),this.storageKey="genesys_wizard_state",this.sessionKey="genesys_wizard_session",this.data=this.loadFromStorage()||this.getInitialState(),this.listeners=[],this.lastToastTime=0,this.data.analytics.sessionStartTime||(this.data.analytics.sessionStartTime=Date.now())}),[{key:"getInitialState",value:function(){return{currentStep:"info-basica",formData:{nombreEmpresa:"",nit:"",email:"",sector:"",ciiuSeccion:"",ciiuDivision:"",ciudad:"",cargos:[]},catalogos:{riesgos:[],gesComunes:[],sectores:[]},validation:{errors:{},touched:{},isValid:!1},analytics:{sessionStartTime:null,timeSpentPerStep:{},stepStartTime:Date.now(),errorCount:0,cargoCount:0,gesCount:0}}}},{key:"loadFromStorage",value:function(){try{var e=localStorage.getItem(this.storageKey);if(e){var t=JSON.parse(e),n=Date.now()-(t.analytics.sessionStartTime||0);if(n<864e5)return t;localStorage.removeItem(this.storageKey)}}catch(e){localStorage.removeItem(this.storageKey)}return null}},{key:"saveToStorage",value:function(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.data)),this.showToast("Guardado automáticamente","success")}catch(e){this.showToast("Error al guardar","error")}}},{key:"clearStorage",value:function(){localStorage.removeItem(this.storageKey),this.data=this.getInitialState(),this.notify()}},{key:"showToast",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=Date.now();if(!("error"!==t&&n-this.lastToastTime<5e3)){this.lastToastTime=n,document.querySelectorAll(".wizard-toast").forEach((function(e){return e.remove()}));var a=document.createElement("div");a.className="wizard-toast wizard-toast--".concat(t),a.setAttribute("role","alert"),a.setAttribute("aria-live","polite");var i="success"===t?"fa-check-circle":"error"===t?"fa-exclamation-circle":"fa-info-circle";a.innerHTML='\n      <i class="fas '.concat(i,'"></i>\n      <span>').concat(e,"</span>\n    "),document.body.appendChild(a),requestAnimationFrame((function(){a.classList.add("wizard-toast--visible")})),setTimeout((function(){a.classList.remove("wizard-toast--visible"),setTimeout((function(){a.remove()}),300)}),3e3)}}},{key:"subscribe",value:function(e){var t=this;return this.listeners.push(e),function(){t.listeners=t.listeners.filter((function(t){return t!==e}))}}},{key:"notify",value:function(){var e=this;this.listeners.forEach((function(t){try{t(e.data)}catch(e){}})),this.saveToStorage()}},{key:"getCurrentStep",value:function(){return this.data.currentStep}},{key:"setCurrentStep",value:function(e){var t=this.data.currentStep,n=Date.now()-this.data.analytics.stepStartTime;this.data.analytics.timeSpentPerStep[t]||(this.data.analytics.timeSpentPerStep[t]=0),this.data.analytics.timeSpentPerStep[t]+=n,this.data.currentStep=e,this.data.analytics.stepStartTime=Date.now(),this.notify()}},{key:"validateStep",value:function(e){var t=this,n={};switch(e||this.data.currentStep){case"info-basica":(!this.data.formData.nombreEmpresa||this.data.formData.nombreEmpresa.trim().length<3)&&(n.nombreEmpresa="El nombre de la empresa debe tener al menos 3 caracteres"),this.data.formData.nit&&/^\d{9,10}$/.test(this.data.formData.nit)||(n.nit="El NIT debe tener 9 o 10 dígitos"),this.data.formData.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.data.formData.email)||(n.email="Email inválido"),this.data.formData.ciiuSeccion||(n.ciiuSeccion="Debe seleccionar una sección económica"),this.data.formData.ciiuDivision||(n.ciiuDivision="Debe seleccionar una actividad económica"),(!this.data.formData.ciudad||this.data.formData.ciudad.trim().length<2)&&(n.ciudad="Debe ingresar una ciudad");break;case"cargos":this.data.formData.cargos&&0!==this.data.formData.cargos.length||(n.cargos="Debe agregar al menos un cargo"),this.data.formData.cargos.forEach((function(e,t){(!e.nombre||e.nombre.trim().length<3)&&(n["cargo_".concat(t,"_nombre")]="El nombre del cargo debe tener al menos 3 caracteres"),(!e.numPersonas||e.numPersonas<1)&&(n["cargo_".concat(t,"_numPersonas")]="Debe haber al menos 1 persona en el cargo"),(!e.area||e.area.trim().length<2)&&(n["cargo_".concat(t,"_area")]="El área debe tener al menos 2 caracteres"),(!e.zona||e.zona.trim().length<2)&&(n["cargo_".concat(t,"_zona")]="La zona debe tener al menos 2 caracteres")}));break;case"riesgos":this.data.formData.cargos.forEach((function(e,t){e.ges&&0!==e.ges.length||(n["cargo_".concat(t,"_ges")]='El cargo "'.concat(e.nombre,'" debe tener al menos un riesgo/GES asignado'))}));break;case"niveles":this.data.formData.cargos.forEach((function(e,t){e.ges.forEach((function(e,a){var i,r,o,s,c,l,d=e.niveles;void 0!==(null===(i=d.deficiencia)||void 0===i?void 0:i.value)&&null!==(null===(r=d.deficiencia)||void 0===r?void 0:r.value)&&void 0!==(null===(o=d.exposicion)||void 0===o?void 0:o.value)&&null!==(null===(s=d.exposicion)||void 0===s?void 0:s.value)&&void 0!==(null===(c=d.consecuencia)||void 0===c?void 0:c.value)&&null!==(null===(l=d.consecuencia)||void 0===l?void 0:l.value)||(n["cargo_".concat(t,"_ges_").concat(a,"_niveles")]='Debe completar los niveles de riesgo para "'.concat(e.nombre,'"'))}))}));break;case"controles":break;case"resumen":["info-basica","cargos","riesgos","niveles"].forEach((function(e){var a=t.validateStep(e);Object.assign(n,a)}))}return this.data.validation.errors=n,this.data.validation.isValid=0===Object.keys(n).length,Object.keys(n).length>0&&this.data.analytics.errorCount++,n}},{key:"validateSingleField",value:function(e,t){switch(e){case"nombreEmpresa":if(!t||t.trim().length<3)return"El nombre de la empresa debe tener al menos 3 caracteres";if(t.trim().length>100)return"El nombre de la empresa no puede exceder 100 caracteres";break;case"nit":if(!t)return"El NIT es requerido";var n=t.replace(/[^0-9]/g,"");if(n.length<9||n.length>10)return"El NIT debe tener 9 o 10 dígitos";break;case"email":if(!t)return"El email es requerido";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return"Por favor ingresa un email válido (ejemplo: usuario@empresa.com)";break;case"sector":break;case"ciiuSeccion":if(!t||""===t)return"Debe seleccionar una sección económica";break;case"ciiuDivision":if(!t||""===t)return"Debe seleccionar una actividad económica";break;case"telefono":if(t&&t.length>0){var a=t.replace(/[^0-9]/g,"");if(a.length<7)return"El teléfono debe tener al menos 7 dígitos";if(a.length>15)return"El teléfono no puede exceder 15 dígitos"}break;case"direccion":if(t&&t.length>0&&t.trim().length<5)return"La dirección debe tener al menos 5 caracteres";break;case"ciudad":if(t&&t.length>0&&t.trim().length<3)return"La ciudad debe tener al menos 3 caracteres";break;default:return null}return null}},{key:"updateBasicInfo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.data.formData[e]=t,this.data.validation.touched[e]=!0,this.saveToStorage(),n||this.notify()}},{key:"setCatalogos",value:function(e){this.data.catalogos=g(g({},this.data.catalogos),e),this.notify()}},{key:"addCargo",value:function(e){if(!this.isCargoNameUnique(e.nombre||""))return{success:!1,error:"Ya existe un cargo con ese nombre"};if(!e.nombre||e.nombre.trim().length<3)return{success:!1,error:"El nombre del cargo debe tener al menos 3 caracteres"};if(e.numPersonas<1)return{success:!1,error:"Debe haber al menos 1 persona en el cargo"};if(!e.area||e.area.trim().length<2)return{success:!1,error:"El área debe tener al menos 2 caracteres"};if(!e.zona||e.zona.trim().length<2)return{success:!1,error:"La zona debe tener al menos 2 caracteres"};var t={nombre:e.nombre,descripcion:e.descripcion||"",numPersonas:e.numPersonas||1,area:e.area||"",zona:e.zona||"",tareasRutinarias:e.tareasRutinarias||!1,manipulaAlimentos:e.manipulaAlimentos||!1,trabajaAlturas:e.trabajaAlturas||!1,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados||!1,conduceVehiculo:e.conduceVehiculo||!1,ges:[],gesSeleccionados:[]};return this.data.formData.cargos.push(t),this.data.analytics.cargoCount++,this.notify(),{success:!0,index:this.data.formData.cargos.length-1}}},{key:"isCargoNameUnique",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return!this.data.formData.cargos.some((function(n,a){return a!==t&&n.nombre.toLowerCase().trim()===e.toLowerCase().trim()}))}},{key:"updateCargo",value:function(e,t){if(e<0||e>=this.data.formData.cargos.length)return{success:!1,error:"Índice de cargo inválido"};if(t.nombre){if(!this.isCargoNameUnique(t.nombre,e))return{success:!1,error:"Ya existe un cargo con ese nombre"};if(t.nombre.trim().length<3)return{success:!1,error:"El nombre del cargo debe tener al menos 3 caracteres"}}return void 0!==t.numPersonas&&t.numPersonas<1?{success:!1,error:"Debe haber al menos 1 persona en el cargo"}:void 0!==t.area&&t.area.trim().length<2?{success:!1,error:"El área debe tener al menos 2 caracteres"}:void 0!==t.zona&&t.zona.trim().length<2?{success:!1,error:"La zona debe tener al menos 2 caracteres"}:(this.data.formData.cargos[e]=g(g({},this.data.formData.cargos[e]),t),this.notify(),{success:!0})}},{key:"removeCargo",value:function(e){e<0||e>=this.data.formData.cargos.length||(this.data.formData.cargos.splice(e,1),this.notify())}},{key:"getCargo",value:function(e){return this.data.formData.cargos[e]}},{key:"getCargos",value:function(){return this.data.formData.cargos}},{key:"addGESToCargo",value:function(e,t){if(!(e<0||e>=this.data.formData.cargos.length)){var n=this.data.formData.cargos[e],a=n.ges.some((function(e){return e.idGes===t.idGes}));if(!a){var i={idGes:t.idGes,nombre:t.nombre,categoria:t.categoria||"",niveles:{deficiencia:{value:null,label:"",color:"",description:""},exposicion:{value:null,label:"",color:"",description:""},consecuencia:{value:null,label:"",color:"",description:""},nivelProbabilidad:null,nivelRiesgo:null},controles:{eliminacion:"",sustitucion:"",ingenieria:"",administrativos:"",epp:""}};n.ges.push(i),this.data.analytics.gesCount++,this.notify()}}}},{key:"removeGESFromCargo",value:function(e,t){if(!(e<0||e>=this.data.formData.cargos.length)){var n=this.data.formData.cargos[e];t<0||t>=n.ges.length||(n.ges.splice(t,1),this.notify())}}},{key:"updateGESNiveles",value:function(e,t,n){var a,i,r,o,s,c;if(!(e<0||e>=this.data.formData.cargos.length)){var l=this.data.formData.cargos[e];if(!(t<0||t>=l.ges.length)){var d=l.ges[t];d.niveles=g(g({},d.niveles),n),null!==(null===(a=d.niveles.deficiencia)||void 0===a?void 0:a.value)&&void 0!==(null===(i=d.niveles.deficiencia)||void 0===i?void 0:i.value)&&null!==(null===(r=d.niveles.exposicion)||void 0===r?void 0:r.value)&&void 0!==(null===(o=d.niveles.exposicion)||void 0===o?void 0:o.value)&&(d.niveles.nivelProbabilidad=d.niveles.deficiencia.value*d.niveles.exposicion.value),null!==d.niveles.nivelProbabilidad&&void 0!==d.niveles.nivelProbabilidad&&null!==(null===(s=d.niveles.consecuencia)||void 0===s?void 0:s.value)&&void 0!==(null===(c=d.niveles.consecuencia)||void 0===c?void 0:c.value)&&(d.niveles.nivelRiesgo=d.niveles.nivelProbabilidad*d.niveles.consecuencia.value),this.notify()}}}},{key:"updateGESControles",value:function(e,t,n){if(!(e<0||e>=this.data.formData.cargos.length)){var a=this.data.formData.cargos[e];if(!(t<0||t>=a.ges.length)){var i=a.ges[t];i.controles=g(g({},i.controles),n),this.notify()}}}},{key:"getControles",value:function(e,t){var n=this.data.formData.cargos.findIndex((function(t){return t.id===e}));if(-1===n)return null;var a=this.data.formData.cargos[n],i=a.ges.findIndex((function(e){return e.id===t}));return-1===i?null:a.ges[i].controles||{}}},{key:"setControles",value:function(e,t,n){var a=this.data.formData.cargos.findIndex((function(t){return t.id===e}));if(-1!==a){var i=this.data.formData.cargos[a].ges.findIndex((function(e){return e.id===t}));-1!==i&&this.updateGESControles(a,i,n)}}},{key:"importFromJSON",value:function(e){var t=this,n=[];try{if(!e)return{success:!1,message:"El archivo JSON está vacío"};var a=e.userData||e,i=(e.formData||e).cargos||[];if(a.nombreEmpresa&&a.nombreEmpresa.length>=3?this.data.formData.nombreEmpresa=a.nombreEmpresa:a.nombreEmpresa&&n.push("Nombre de empresa muy corto (mínimo 3 caracteres)"),a.nit){var r=a.nit.replace(/[^0-9]/g,"");/^\d{9,10}$/.test(r)?this.data.formData.nit=r:n.push("NIT inválido (debe tener 9-10 dígitos)")}a.email&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)?this.data.formData.email=a.email:n.push("Email inválido")),a.ciiuSeccion&&(this.data.formData.ciiuSeccion=a.ciiuSeccion),a.ciiuDivision&&(this.data.formData.ciiuDivision=a.ciiuDivision),a.ciudad&&(this.data.formData.ciudad=a.ciudad),i&&0!==i.length?(this.data.formData.cargos=[],this.data.analytics.cargoCount=0,this.data.analytics.gesCount=0,i.forEach((function(e,a){var i=e.cargoName||e.nombre||"Cargo ".concat(a+1);if(i.length<3)n.push("Cargo ".concat(a+1,": nombre muy corto"));else{var r={nombre:i,descripcion:e.descripcionTareas||e.descripcion||"",numPersonas:e.numTrabajadores||e.numPersonas||1,area:e.area||"General",zona:e.zona||"Principal",tareasRutinarias:e.tareasRutinarias||!1,manipulaAlimentos:e.manipulaAlimentos||!1,trabajaAlturas:e.trabajaAlturas||!1,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados||!1,conduceVehiculo:e.conduceVehiculo||!1,ges:[],gesSeleccionados:[]},o=e.gesSeleccionados||e.ges||[];0===o.length&&n.push('Cargo "'.concat(i,'": no tiene riesgos asignados')),o.forEach((function(e,n){var i=e.ges||e.nombre||"Riesgo ".concat(n+1),o=e.riesgo||e.categoria||"Otros Riesgos",s={Físico:"Riesgo Físico",Químico:"Riesgo Químico",Biológico:"Riesgo Biológico",Biomecánico:"Riesgo Biomecánico",Psicosocial:"Riesgo Psicosocial",Mecánico:"Condiciones de Seguridad",Eléctrico:"Condiciones de Seguridad",Locativo:"Condiciones de Seguridad",Seguridad:"Condiciones de Seguridad",Natural:"Fenómenos Naturales",Tecnológico:"Riesgo Tecnológico","Riesgo Físico":"Riesgo Físico","Riesgo Químico":"Riesgo Químico","Riesgo Biológico":"Riesgo Biológico","Riesgo Biomecánico":"Riesgo Biomecánico","Riesgo Psicosocial":"Riesgo Psicosocial","Condiciones de Seguridad":"Condiciones de Seguridad","Fenómenos Naturales":"Fenómenos Naturales","Riesgo Tecnológico":"Riesgo Tecnológico"}[o]||o,l=e.niveles||{},d=function(e){return e?"number"==typeof e?e:"object"===c(e)&&void 0!==e.value?e.value:parseInt(e)||null:null},u=d(l.deficiencia)||2,p=d(l.exposicion)||2,f=d(l.consecuencia)||25,v=u*p,g={idGes:n+1e3+100*a,nombre:i,categoria:s,niveles:{ND:u,NE:p,NC:f,NP:v,NR:v*f,deficiencia:{value:u},exposicion:{value:p},consecuencia:{value:f}},controles:t._parseControlesImport(e.controles)};r.ges.push(g),r.gesSeleccionados.push(g),t.data.analytics.gesCount++})),t.data.formData.cargos.push(r),t.data.analytics.cargoCount++}}))):n.push("No se encontraron cargos en el JSON"),this.saveToStorage(),this.notify();var o=this.data.formData.cargos.length,s=this.data.formData.cargos.reduce((function(e,t){return e+t.ges.length}),0);return n.length>0?{success:!0,message:"Importación completada con ".concat(n.length," advertencia(s)"),warnings:n,cargosImportados:o,gesImportados:s}:{success:!0,message:"Importación exitosa",cargosImportados:o,gesImportados:s}}catch(e){return{success:!1,message:"Error al procesar el archivo JSON: "+e.message}}}},{key:"_parseControlesImport",value:function(e){return e?void 0!==e.fuente||void 0!==e.medio||void 0!==e.individuo?{fuente:e.fuente||"",medio:e.medio||"",individuo:e.individuo||""}:void 0!==e.eliminacion?{fuente:[e.eliminacion,e.sustitucion].filter(Boolean).join(" | ")||"",medio:e.ingenieria||"",individuo:[e.administrativos,e.epp].filter(Boolean).join(" | ")||""}:{fuente:"",medio:"",individuo:""}:{fuente:"",medio:"",individuo:""}}},{key:"_convertirControlesAGTC45",value:function(e){return e?void 0!==e.fuente?e:{fuente:[e.eliminacion,e.sustitucion].filter(Boolean).join(" | "),medio:e.ingenieria||"",individuo:[e.administrativos,e.epp].filter(Boolean).join(" | ")}:{fuente:"",medio:"",individuo:""}}},{key:"_calcularNivelProbabilidad",value:function(e,t){return("object"===c(e)?e.value:e)*("object"===c(t)?t.value:t)}},{key:"_calcularNivelRiesgo",value:function(e,t){return e*("object"===c(t)?t.value:t)}},{key:"_interpretarNivelRiesgo",value:function(e){return e>=600?{nivel:"I",significado:"No Aceptable",accion:"Intervención inmediata",color:"red"}:e>=150?{nivel:"II",significado:"No Aceptable o Aceptable con control",accion:"Corregir urgente",color:"orange"}:e>=40?{nivel:"III",significado:"Mejorable",accion:"Mejorar control",color:"yellow"}:{nivel:"IV",significado:"Aceptable",accion:"Mantener control",color:"green"}}},{key:"exportForSubmission",value:function(){var e=this;return{formData:{cargos:this.data.formData.cargos.map((function(t){return{cargoName:t.nombre,area:t.area,zona:t.zona,numTrabajadores:t.numPersonas,descripcionTareas:t.descripcion,tareasRutinarias:t.tareasRutinarias,manipulaAlimentos:t.manipulaAlimentos,trabajaAlturas:t.trabajaAlturas,trabajaEspaciosConfinados:t.trabajaEspaciosConfinados,conduceVehiculo:t.conduceVehiculo,gesSeleccionados:t.ges.map((function(t){var n=t.niveles.deficiencia,a=t.niveles.exposicion,i=t.niveles.consecuencia,r=e._calcularNivelProbabilidad(n,a),o=e._calcularNivelRiesgo(r,i),s=e._interpretarNivelRiesgo(o);return{riesgo:t.categoria,ges:t.nombre,controles:e._convertirControlesAGTC45(t.controles),niveles:{deficiencia:n,exposicion:a,consecuencia:i,nivelProbabilidad:r,nivelRiesgo:o,interpretacion:s}}}))}}))},userData:{nombreEmpresa:this.data.formData.nombreEmpresa,nit:this.data.formData.nit,email:this.data.formData.email,sector:this.data.formData.ciiuDivision||this.data.formData.sector,ciiuSeccion:this.data.formData.ciiuSeccion,ciiuDivision:this.data.formData.ciiuDivision,ciudad:this.data.formData.ciudad,nombreContacto:this.data.formData.nombreContacto||this.data.formData.email},analytics:{totalTimeSeconds:Math.floor((Date.now()-this.data.analytics.sessionStartTime)/1e3),timePerStep:this.data.analytics.timeSpentPerStep,errorCount:this.data.analytics.errorCount,cargoCount:this.data.analytics.cargoCount,gesCount:this.data.analytics.gesCount}}}},{key:"getAnalytics",value:function(){return g(g({},this.data.analytics),{},{totalTime:Date.now()-this.data.analytics.sessionStartTime,currentStepTime:Date.now()-this.data.analytics.stepStartTime})}}])}(),m=null;function b(){return m||(m=new h),m}function y(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function x(n){return function(t){if(Array.isArray(t))return e(t)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||t(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const w=globalThis,C=w.trustedTypes,E=C?C.createPolicy("lit-html",{createHTML:e=>e}):void 0,k="$lit$",S=`lit$${Math.random().toFixed(9).slice(2)}$`,_="?"+S,A=`<${_}>`,N=document,T=()=>N.createComment(""),L=e=>null===e||"object"!=typeof e&&"function"!=typeof e,I=Array.isArray,D=e=>I(e)||"function"==typeof e?.[Symbol.iterator],z="[ \t\n\f\r]",P=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,j=/-->/g,q=/>/g,R=RegExp(`>|${z}(?:([^\\s"'>=/]+)(${z}*=${z}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),O=/'/g,G=/"/g,M=/^(?:script|style|textarea|title)$/i,F=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),B=F(1),H=(F(2),F(3),Symbol.for("lit-noChange")),$=Symbol.for("lit-nothing"),V=new WeakMap,U=N.createTreeWalker(N,129);function J(e,t){if(!I(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==E?E.createHTML(t):t}const W=(e,t)=>{const n=e.length-1,a=[];let i,r=2===t?"<svg>":3===t?"<math>":"",o=P;for(let t=0;t<n;t++){const n=e[t];let s,c,l=-1,d=0;for(;d<n.length&&(o.lastIndex=d,c=o.exec(n),null!==c);)d=o.lastIndex,o===P?"!--"===c[1]?o=j:void 0!==c[1]?o=q:void 0!==c[2]?(M.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=R):void 0!==c[3]&&(o=R):o===R?">"===c[0]?(o=i??P,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,s=c[1],o=void 0===c[3]?R:'"'===c[3]?G:O):o===G||o===O?o=R:o===j||o===q?o=P:(o=R,i=void 0);const u=o===R&&e[t+1].startsWith("/>")?" ":"";r+=o===P?n+A:l>=0?(a.push(s),n.slice(0,l)+k+n.slice(l)+S+u):n+S+(-2===l?t:u)}return[J(e,r+(e[n]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),a]};class Y{constructor({strings:e,_$litType$:t},n){let a;this.parts=[];let i=0,r=0;const o=e.length-1,s=this.parts,[c,l]=W(e,t);if(this.el=Y.createElement(c,n),U.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(a=U.nextNode())&&s.length<o;){if(1===a.nodeType){if(a.hasAttributes())for(const e of a.getAttributeNames())if(e.endsWith(k)){const t=l[r++],n=a.getAttribute(e).split(S),o=/([.?@])?(.*)/.exec(t);s.push({type:1,index:i,name:o[2],strings:n,ctor:"."===o[1]?ee:"?"===o[1]?te:"@"===o[1]?ne:Z}),a.removeAttribute(e)}else e.startsWith(S)&&(s.push({type:6,index:i}),a.removeAttribute(e));if(M.test(a.tagName)){const e=a.textContent.split(S),t=e.length-1;if(t>0){a.textContent=C?C.emptyScript:"";for(let n=0;n<t;n++)a.append(e[n],T()),U.nextNode(),s.push({type:2,index:++i});a.append(e[t],T())}}}else if(8===a.nodeType)if(a.data===_)s.push({type:2,index:i});else{let e=-1;for(;-1!==(e=a.data.indexOf(S,e+1));)s.push({type:7,index:i}),e+=S.length-1}i++}}static createElement(e,t){const n=N.createElement("template");return n.innerHTML=e,n}}function K(e,t,n=e,a){if(t===H)return t;let i=void 0!==a?n._$Co?.[a]:n._$Cl;const r=L(t)?void 0:t._$litDirective$;return i?.constructor!==r&&(i?._$AO?.(!1),void 0===r?i=void 0:(i=new r(e),i._$AT(e,n,a)),void 0!==a?(n._$Co??=[])[a]=i:n._$Cl=i),void 0!==i&&(t=K(e,i._$AS(e,t.values),i,a)),t}class Q{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,a=(e?.creationScope??N).importNode(t,!0);U.currentNode=a;let i=U.nextNode(),r=0,o=0,s=n[0];for(;void 0!==s;){if(r===s.index){let t;2===s.type?t=new X(i,i.nextSibling,this,e):1===s.type?t=new s.ctor(i,s.name,s.strings,this,e):6===s.type&&(t=new ae(i,this,e)),this._$AV.push(t),s=n[++o]}r!==s?.index&&(i=U.nextNode(),r++)}return U.currentNode=N,a}p(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class X{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,n,a){this.type=2,this._$AH=$,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=a,this._$Cv=a?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=K(this,e,t),L(e)?e===$||null==e||""===e?(this._$AH!==$&&this._$AR(),this._$AH=$):e!==this._$AH&&e!==H&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):D(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==$&&L(this._$AH)?this._$AA.nextSibling.data=e:this.T(N.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:n}=e,a="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=Y.createElement(J(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===a)this._$AH.p(t);else{const e=new Q(a,this),n=e.u(this.options);e.p(t),this.T(n),this._$AH=e}}_$AC(e){let t=V.get(e.strings);return void 0===t&&V.set(e.strings,t=new Y(e)),t}k(e){I(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,a=0;for(const i of e)a===t.length?t.push(n=new X(this.O(T()),this.O(T()),this,this.options)):n=t[a],n._$AI(i),a++;a<t.length&&(this._$AR(n&&n._$AB.nextSibling,a),t.length=a)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Z{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,a,i){this.type=1,this._$AH=$,this._$AN=void 0,this.element=e,this.name=t,this._$AM=a,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=$}_$AI(e,t=this,n,a){const i=this.strings;let r=!1;if(void 0===i)e=K(this,e,t,0),r=!L(e)||e!==this._$AH&&e!==H,r&&(this._$AH=e);else{const a=e;let o,s;for(e=i[0],o=0;o<i.length-1;o++)s=K(this,a[n+o],t,o),s===H&&(s=this._$AH[o]),r||=!L(s)||s!==this._$AH[o],s===$?e=$:e!==$&&(e+=(s??"")+i[o+1]),this._$AH[o]=s}r&&!a&&this.j(e)}j(e){e===$?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ee extends Z{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===$?void 0:e}}class te extends Z{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==$)}}class ne extends Z{constructor(e,t,n,a,i){super(e,t,n,a,i),this.type=5}_$AI(e,t=this){if((e=K(this,e,t,0)??$)===H)return;const n=this._$AH,a=e===$&&n!==$||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,i=e!==$&&(n===$||a);a&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class ae{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){K(this,e)}}const ie={M:k,P:S,A:_,C:1,L:W,R:Q,D,V:K,I:X,H:Z,N:te,U:ne,B:ee,F:ae},re=w.litHtmlPolyfillSupport;re?.(Y,X),(w.litHtmlVersions??=[]).push("3.3.1");const oe=(e,t,n)=>{const a=n?.renderBefore??t;let i=a._$litPart$;if(void 0===i){const e=n?.renderBefore??null;a._$litPart$=i=new X(t.insertBefore(T(),e),e,void 0,n??{})}return i._$AI(e),i},se=2;class ce{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}const{I:le}=ie,de=()=>document.createComment(""),ue=(e,t,n)=>{const a=e._$AA.parentNode,i=void 0===t?e._$AB:t._$AA;if(void 0===n){const t=a.insertBefore(de(),i),r=a.insertBefore(de(),i);n=new le(t,r,e,e.options)}else{const t=n._$AB.nextSibling,r=n._$AM,o=r!==e;if(o){let t;n._$AQ?.(e),n._$AM=e,void 0!==n._$AP&&(t=e._$AU)!==r._$AU&&n._$AP(t)}if(t!==i||o){let e=n._$AA;for(;e!==t;){const t=e.nextSibling;a.insertBefore(e,i),e=t}}}return n},pe=(e,t,n=e)=>(e._$AI(t,n),e),fe={},ve=e=>{e._$AR(),e._$AA.remove()},ge=(e,t,n)=>{const a=new Map;for(let i=t;i<=n;i++)a.set(e[i],i);return a},he=(e=>(...t)=>({_$litDirective$:e,values:t}))(class extends ce{constructor(e){if(super(e),e.type!==se)throw Error("repeat() can only be used in text expressions")}dt(e,t,n){let a;void 0===n?n=t:void 0!==t&&(a=t);const i=[],r=[];let o=0;for(const t of e)i[o]=a?a(t,o):o,r[o]=n(t,o),o++;return{values:r,keys:i}}render(e,t,n){return this.dt(e,t,n).values}update(e,[t,n,a]){const i=(e=>e._$AH)(e),{values:r,keys:o}=this.dt(t,n,a);if(!Array.isArray(i))return this.ut=o,r;const s=this.ut??=[],c=[];let l,d,u=0,p=i.length-1,f=0,v=r.length-1;for(;u<=p&&f<=v;)if(null===i[u])u++;else if(null===i[p])p--;else if(s[u]===o[f])c[f]=pe(i[u],r[f]),u++,f++;else if(s[p]===o[v])c[v]=pe(i[p],r[v]),p--,v--;else if(s[u]===o[v])c[v]=pe(i[u],r[v]),ue(e,c[v+1],i[u]),u++,v--;else if(s[p]===o[f])c[f]=pe(i[p],r[f]),ue(e,i[u],i[p]),p--,f++;else if(void 0===l&&(l=ge(o,f,v),d=ge(s,u,p)),l.has(s[u]))if(l.has(s[p])){const t=d.get(o[f]),n=void 0!==t?i[t]:null;if(null===n){const t=ue(e,i[u]);pe(t,r[f]),c[f]=t}else c[f]=pe(n,r[f]),ue(e,i[u],n),i[t]=null;f++}else ve(i[p]),p--;else ve(i[u]),u++;for(;f<=v;){const t=ue(e,c[v+1]);pe(t,r[f]),c[f++]=t}for(;u<=p;){const e=i[u++];null!==e&&ve(e)}return this.ut=o,((e,t=fe)=>{e._$AH=t})(e,c),H}});var me,be,ye,xe,we,Ce,Ee,ke,Se,_e,Ae,Ne,Te,Le,Ie,De,ze,Pe,je,qe,Re,Oe,Ge,Me,Fe,Be,He;function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ue,Je,We,Ye,Ke,Qe,Xe,Ze,et,tt,nt,at,it,rt,ot,st,ct,lt,dt,ut,pt,ft,vt,gt,ht,mt,bt,yt,xt,wt,Ct,Et={Mecánico:"#cbe3f3",Eléctrico:"#fee6fc",Físico:"#fdf8cd",Químico:"#c7f9ff",Biológico:"#d8fff1",Biomecánico:"#d8fff1","Factores Humanos":"#ffefd2",Psicosocial:"#e6e6e6",Locativo:"#fee6fc",Natural:"#fee6fc",Seguridad:"#fee6fc","Otros Riesgos":"#fee6fc","Saneamiento Básico":"#fee6fc","Salud Pública":"#fee6fc"},kt=function(){return f((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(this,e),this.container="string"==typeof t?document.querySelector(t):t,!this.container)throw new Error("RiesgoSelector: Container not found");this.options=Ve({cargoIndex:n.cargoIndex||0,cargoNombre:n.cargoNombre||"",sector:n.sector||null,seleccionados:n.seleccionados||[],onChange:n.onChange||function(){},onDetailsLoaded:n.onDetailsLoaded||function(){}},n),this.state={vistaComunes:!0,categoriaActiva:null,busqueda:"",filtrosColapsados:!1,catalogoGES:[],catalogoRiesgos:[],gesVisible:[],seleccionados:x(this.options.seleccionados),gesDetallesCache:new Map,loadingDetalles:new Set,catalogoIncompleto:!1,categoriasFaltantes:[],gruposColapsados:new Set,carouselIndex:0,aiSuggestions:[],aiSuggestionsCache:new Map,loadingAI:!1,showAISuggestions:!0,gesRanking:new Map,loading:!1,error:null},this.debounceTimer=null,this.init()}),[{key:"init",value:(o=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.loading=!0,this.renderComponent(),e.prev=2,e.next=5,this.loadCatalogos();case 5:return e.next=7,this.validateCatalogo();case 7:return this.updateGESVisible(),e.next=10,Promise.all([this.fetchAISuggestions(),this.fetchGESRanking()]);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),this.state.error=e.t0.message;case 16:return e.prev=16,this.state.loading=!1,this.renderComponent(),e.finish(16);case 20:case"end":return e.stop()}}),e,this,[[2,12,16,20]])}))),function(){return o.apply(this,arguments)})},{key:"validateCatalogo",value:(i=r(s().mark((function e(){var t,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/catalogo/validate-categories");case 3:if((t=e.sent).ok){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t.json();case 9:n=e.sent,(a=n.data).ok||(this.state.catalogoIncompleto=!0,this.state.categoriasFaltantes=a.missing),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0);case 17:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(){return i.apply(this,arguments)})},{key:"loadCatalogos",value:function(){var e=r(s().mark((function e(){var t,n,a,i,r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=performance.now(),e.prev=2,e.next=5,fetch("/api/catalogo/riesgos");case 5:if((n=e.sent).ok){e.next=8;break}throw new Error("Error ".concat(n.status,": ").concat(n.statusText));case 8:return e.next=10,n.json();case 10:return a=e.sent,this.state.catalogoRiesgos=a.data,e.next=14,fetch("/api/catalogo/ges?fields=light&limit=200");case 14:if((i=e.sent).ok){e.next=17;break}throw new Error("Error ".concat(i.status,": ").concat(i.statusText));case 17:return e.next=19,i.json();case 19:r=e.sent,this.state.catalogoGES=r.data,o=performance.now(),(o-t).toFixed(2),e.next=33;break;case 29:throw e.prev=29,e.t0=e.catch(2),e.t0;case 33:case"end":return e.stop()}}),e,this,[[2,29]])})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAISuggestions",value:(a=r(s().mark((function e(){var t,n,a,i,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.options.cargoNombre,n=this.options.sector,t&&""!==t.trim()){e.next=5;break}return e.abrupt("return");case 5:if(a="".concat(t.toLowerCase(),"-").concat(n||"general"),!this.state.aiSuggestionsCache.has(a)){e.next=10;break}return this.state.aiSuggestions=this.state.aiSuggestionsCache.get(a),e.abrupt("return");case 10:return e.prev=10,this.state.loadingAI=!0,e.next=15,fetch("/api/ia/suggest-ges",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cargoName:t,sector:n||null,limit:5})});case 15:if((i=e.sent).ok){e.next=18;break}throw new Error("Error ".concat(i.status,": ").concat(i.statusText));case 18:return e.next=20,i.json();case 20:(r=e.sent).success&&r.data?(this.state.aiSuggestions=r.data,this.state.aiSuggestionsCache.set(a,r.data)):this.state.aiSuggestions=[],e.next=28;break;case 24:e.prev=24,e.t0=e.catch(10),this.state.aiSuggestions=[];case 28:return e.prev=28,this.state.loadingAI=!1,e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[10,24,28,31]])}))),function(){return a.apply(this,arguments)})},{key:"fetchGESRanking",value:(n=r(s().mark((function e(){var t,n,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,fetch("/api/catalogo/ges?fields=ranking&limit=100");case 4:if((t=e.sent).ok){e.next=7;break}throw new Error("Error ".concat(t.status,": ").concat(t.statusText));case 7:return e.next=9,t.json();case 9:(n=e.sent).success&&n.data&&n.data.forEach((function(e){if(e.es_comun||e.relevancia_por_sector){var t,n=(null===(t=e.relevancia_por_sector)||void 0===t?void 0:t[a.options.sector])||(e.es_comun?3:1),i=Math.min(5,Math.max(1,Math.round(n/2))),r=e.es_comun?.5*Math.random()+.5:.3*Math.random();a.state.gesRanking.set(e.id,{stars:i,frequency:Math.round(100*r),sector:a.options.sector,isCommon:e.es_comun,relevancia:e.relevancia_por_sector})}})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0);case 16:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return n.apply(this,arguments)})},{key:"loadGESDetails",value:(t=r(s().mark((function e(t){var n,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==t||"number"!=typeof t||t<1)){e.next=3;break}return e.abrupt("return",null);case 3:if(!this.state.gesDetallesCache.has(t)){e.next=6;break}return e.abrupt("return",this.state.gesDetallesCache.get(t));case 6:if(!this.state.loadingDetalles.has(t)){e.next=9;break}return e.abrupt("return",null);case 9:return e.prev=9,this.state.loadingDetalles.add(t),e.next=14,fetch("/api/catalogo/ges/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ges_ids:[t]})});case 14:if((n=e.sent).ok){e.next=17;break}throw new Error("Error ".concat(n.status,": ").concat(n.statusText));case 17:return e.next=19,n.json();case 19:if(!((a=e.sent).success&&a.data.length>0)){e.next=26;break}return i=a.data[0],this.state.gesDetallesCache.set(t,i),this.options.onDetailsLoaded(i),e.abrupt("return",i);case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(9);case 31:return e.prev=31,this.state.loadingDetalles.delete(t),e.finish(31);case 34:return e.abrupt("return",null);case 35:case"end":return e.stop()}}),e,this,[[9,28,31,34]])}))),function(e){return t.apply(this,arguments)})},{key:"preloadSelectedDetails",value:(e=r(s().mark((function e(){var t,n,a,i,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.seleccionados.map((function(e){return e.id})).filter((function(e){return null!=e&&"number"==typeof e&&e>0})).filter((function(e){return!r.state.gesDetallesCache.has(e)})),0!==t.length){e.next=4;break}return e.abrupt("return",this.state.gesDetallesCache);case 4:return n=performance.now(),e.prev=6,e.next=9,fetch("/api/catalogo/ges/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ges_ids:t})});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error ".concat(a.status,": ").concat(a.statusText));case 12:return e.next=14,a.json();case 14:(i=e.sent).success&&(i.data.forEach((function(e){r.state.gesDetallesCache.set(e.id,e)})),(performance.now()-n).toFixed(2)),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6);case 21:return e.abrupt("return",this.state.gesDetallesCache);case 22:case"end":return e.stop()}}),e,this,[[6,18]])}))),function(){return e.apply(this,arguments)})},{key:"updateGESVisible",value:function(){var e=this,t=x(this.state.catalogoGES);if(this.state.vistaComunes&&(t=t.filter((function(e){return!0===e.es_comun}))),null!==this.state.categoriaActiva&&(t=t.filter((function(t){return t.riesgo_id===e.state.categoriaActiva}))),this.state.busqueda){var n=this.state.busqueda.toLowerCase();t=t.filter((function(e){var t;return e.nombre.toLowerCase().includes(n)||(null===(t=e.descripcion)||void 0===t?void 0:t.toLowerCase().includes(n))}))}this.state.gesVisible=t}},{key:"renderComponent",value:function(){var e=B(me||(me=y(['\n      <div class="riesgo-selector">\n        ',"\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n    "])),this.renderHeader(),this.renderWarningBanner(),this.renderSearch(),this.renderFilters(),this.renderAISuggestions(),this.state.loading?this.renderLoading():this.state.error?this.renderError():this.renderGESList(),this.renderFooter());oe(e,this.container)}},{key:"renderWarningBanner",value:function(){return this.state.catalogoIncompleto?B(be||(be=y(['\n      <div class="riesgo-selector__warning-banner">\n        <i class="fas fa-exclamation-triangle"></i>\n        <div class="riesgo-selector__warning-content">\n          <strong>Advertencia:</strong> El catálogo de riesgos está incompleto.\n          <br>\n          <small>\n            Categorías no disponibles: <strong>',"</strong>\n            <br>\n            Esto puede afectar el cumplimiento de la Resolución 0312 de 2019 (SST Colombia).\n            Por favor, contacte al administrador del sistema.\n          </small>\n        </div>\n      </div>\n    "])),this.state.categoriasFaltantes.join(", ")):""}},{key:"renderLoading",value:function(){var e=Array.from({length:6},(function(e,t){return t}));return B(ye||(ye=y(['\n      <div class="riesgo-selector__list">\n        ',"\n      </div>\n    "])),e.map((function(e){return B(xe||(xe=y(['\n          <div class="ges-item skeleton">\n            <div class="ges-item__content">\n              <div class="ges-item__header">\n                <span class="skeleton-text skeleton-text--title"></span>\n                <span class="skeleton-badge"></span>\n              </div>\n\n              <p class="skeleton-text skeleton-text--description"></p>\n              <p class="skeleton-text skeleton-text--description short"></p>\n\n              <div class="ges-item__meta">\n                <span class="skeleton-text skeleton-text--category"></span>\n              </div>\n            </div>\n          </div>\n        '])))})))}},{key:"renderError",value:function(){var e=this;return B(we||(we=y(['\n      <div class="riesgo-selector__error">\n        <i class="fas fa-exclamation-triangle"></i>\n        <p>Error cargando catálogo: ','</p>\n        <button class="wizard-btn wizard-btn-secondary" @click=','>\n          <i class="fas fa-redo"></i>\n          Reintentar\n        </button>\n      </div>\n    '])),this.state.error,(function(){return e.init()}))}},{key:"renderHeader",value:function(){return B(Ce||(Ce=y(['\n      <div class="riesgo-selector__header">\n        <h2>Selecciona los riesgos</h2>\n        <p class="riesgo-selector__cargo-info">\n          <i class="fas fa-briefcase"></i>\n          Cargo: <strong>',"</strong>\n        </p>\n      </div>\n    "])),this.options.cargoNombre)}},{key:"renderSearch",value:function(){var e=this;return B(Ee||(Ee=y(['\n      <div class="riesgo-selector__search">\n        <div class="search-input-wrapper">\n          <i class="fas fa-search search-icon"></i>\n          <input\n            type="text"\n            class="search-input"\n            placeholder="Buscar riesgo... (ej: ruido, posturas, caídas)"\n            .value=',"\n            @input=","\n          />\n          ","\n        </div>\n      </div>\n    "])),this.state.busqueda,(function(t){return e.handleSearch(t)}),this.state.busqueda?B(ke||(ke=y(['\n            <button class="search-clear" @click=','>\n              <i class="fas fa-times"></i>\n            </button>\n          '])),(function(){return e.handleClearSearch()})):"")}},{key:"renderFilters",value:function(){var e=this,t=this.state.catalogoRiesgos;return B(Se||(Se=y(['\n      <div class="riesgo-selector__filters-compact">\n        \x3c!-- View Toggle Switch (left) --\x3e\n        <div class="filters-view-toggle">\n          <button\n            class="view-toggle-btn ','"\n            @click=','\n            title="Mostrar riesgos comunes"\n          >\n            <i class="fas fa-star"></i>\n            <span>Comunes</span>\n          </button>\n          <button\n            class="view-toggle-btn ','"\n            @click=','\n            title="Mostrar todos los riesgos"\n          >\n            <i class="fas fa-list"></i>\n            <span>Todos (',')</span>\n          </button>\n        </div>\n\n        \x3c!-- Category Dropdown (right) --\x3e\n        <div class="filters-category-dropdown">\n          <label for="category-select">\n            <i class="fas fa-filter"></i>\n            Categoría:\n          </label>\n          <select\n            id="category-select"\n            .value=',"\n            @change=",'\n          >\n            <option value="">Todas las categorías</option>\n            ',"\n          </select>\n        </div>\n      </div>\n    "])),this.state.vistaComunes?"active":"",(function(){return e.handleToggleView("comunes")}),this.state.vistaComunes?"":"active",(function(){return e.handleToggleView("todos")}),this.state.catalogoGES.length,this.state.categoriaActiva||"",(function(t){return e.handleFilterCategory(""===t.target.value?null:parseInt(t.target.value))}),t.map((function(e){return B(_e||(_e=y(['\n              <option value="','">\n                ',"\n              </option>\n            "])),e.id,e.nombre)})))}},{key:"renderAISuggestions",value:function(){var e=this;if(0===this.state.aiSuggestions.length)return"";var t=this.options.cargoNombre||"este cargo",n=this.state.showAISuggestions;return B(Ae||(Ae=y(['\n      <div class="ai-suggestions-panel">\n        \x3c!-- Badge trigger button --\x3e\n        <button\n          class="ai-trigger-badge ','"\n          @click=','\n          title="Ver sugerencias inteligentes de IA"\n        >\n          <i class="fas fa-brain"></i>\n          <span>Sugerencias IA</span>\n          <span class="ai-badge-count">','</span>\n        </button>\n\n        \x3c!-- Overlay invisible (cierra popover al hacer clic fuera) --\x3e\n        <div\n          class="ai-popover-overlay ','"\n          @click=','\n        ></div>\n\n        \x3c!-- Popover content --\x3e\n        <div\n          class="ai-popover ','"\n          data-popover-placement="bottom"\n        >\n          \x3c!-- Arrow (decorativo) --\x3e\n          <div class="ai-popover-arrow"></div>\n\n          \x3c!-- Header --\x3e\n          <div class="ai-popover-header">\n            <h3>\n              <i class="fas fa-sparkles"></i>\n              Sugerencias para "','"\n            </h3>\n            <p class="ai-subtitle">\n              ','\n            </p>\n          </div>\n\n          \x3c!-- Body (scrollable) --\x3e\n          <div class="ai-popover-body">\n            <div class="ai-chips-container">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- Footer --\x3e\n          <div class="ai-popover-footer">\n            <p class="ai-info-text">\n              <i class="fas fa-info-circle"></i>\n              Haz clic en "Ver riesgos" para filtrar el catálogo según la sugerencia.\n            </p>\n          </div>\n        </div>\n      </div>\n    '])),n?"active":"",(function(){return e.handleToggleAISuggestions()}),this.state.aiSuggestions.length,n?"active":"",(function(){return e.handleToggleAISuggestions()}),n?"active":"",t,this.state.loadingAI?"Cargando sugerencias...":"".concat(this.state.aiSuggestions.length," riesgos recomendados"),this.state.aiSuggestions.map((function(t,n){var a=e.state.gesVisible.filter((function(e){return e.riesgo&&e.riesgo.includes(t.riesgo.replace("Riesgo ",""))})),i=a.filter((function(t){return e.state.seleccionados.some((function(e){return e.id===t.id}))})),r=a.length>0&&i.length===a.length,o=i.length>0&&!r;return B(Ne||(Ne=y(['\n                  <div\n                    class="ai-chip '," ",'"\n                  >\n                    \x3c!-- Header del chip --\x3e\n                    <div class="ai-chip-header">\n                      \x3c!-- Icon --\x3e\n                      <span class="ai-chip-icon">\n                        ','\n                      </span>\n\n                      \x3c!-- Info --\x3e\n                      <div class="ai-chip-info">\n                        <div class="ai-chip-name">','</div>\n                        <div class="ai-chip-meta">\n                          ',"\n                          ",'\n                        </div>\n                      </div>\n\n                      \x3c!-- Badge (index) --\x3e\n                      <div class="ai-chip-badge">','</div>\n                    </div>\n\n                    \x3c!-- Action button --\x3e\n                    <button\n                      class="ai-chip-action"\n                      @click=','\n                      title="Filtrar y ver riesgos de este tipo"\n                    >\n                      <i class="fas fa-filter"></i>\n                      <span>Ver riesgos</span>\n                    </button>\n                  </div>\n                '])),r?"all-selected":"",o?"partial-selected":"",e.getRiesgoIcon(t.riesgo),t.riesgo,a.length>0?B(Te||(Te=y(['\n                            <span class="ai-chip-count">'," GES disponibles</span>\n                          "])),a.length):"",t.confidence>=70?B(Le||(Le=y(['\n                            <span class="ai-confidence">\n                              <i class="fas fa-check-circle"></i>\n                              ',"% confianza\n                            </span>\n                          "])),t.confidence):"",n+1,(function(){e.handleFilterByRiesgo(t.riesgo),e.handleToggleAISuggestions()}))})))}},{key:"getRiesgoIcon",value:function(e){return{Mecánico:"⚙️",Eléctrico:"⚡",Físico:"📡",Químico:"🧪",Biológico:"🦠",Biomecánico:"🦴",Psicosocial:"🧠",Locativo:"🏢",Natural:"🌪️","Factores Humanos":"👤",Seguridad:"🛡️","Saneamiento Básico":"💧","Salud Pública":"🏥"}[e]||"📋"}},{key:"renderGESList",value:function(){var e=this;if(0===this.state.gesVisible.length)return B(Ie||(Ie=y(['\n        <div class="riesgo-selector__empty">\n          <i class="fas fa-search" style="font-size: 4rem; color: #ccc; margin-bottom: 1rem;"></i>\n          <p>No se encontraron riesgos con los filtros seleccionados</p>\n          <button class="wizard-btn wizard-btn-secondary" @click=','>\n            <i class="fas fa-times"></i>\n            Limpiar filtros\n          </button>\n        </div>\n      '])),(function(){return e.handleClearFilters()}));var t=this.groupGESByRiesgo(),n=this.state.carouselIndex,a=t.length;return n>=a&&(this.state.carouselIndex=0),B(De||(De=y(['\n      <div class="ges-groups-carousel-wrapper">\n        \x3c!-- Carousel container --\x3e\n        <div class="ges-groups-carousel">\n          \x3c!-- Track con transform para slide --\x3e\n          <div class="carousel-track" style="transform: translateX(-','%)">\n            ','\n          </div>\n        </div>\n\n        \x3c!-- Botones de navegación --\x3e\n        <button\n          class="carousel-nav carousel-nav-prev"\n          @click=',"\n          ?disabled=",'\n          aria-label="Riesgo anterior"\n        >\n          <i class="fas fa-chevron-left"></i>\n        </button>\n\n        <button\n          class="carousel-nav carousel-nav-next"\n          @click=',"\n          ?disabled=",'\n          aria-label="Siguiente riesgo"\n        >\n          <i class="fas fa-chevron-right"></i>\n        </button>\n\n        \x3c!-- Indicadores de progreso --\x3e\n        <div class="carousel-indicators">\n          \x3c!-- Contador numérico --\x3e\n          <div class="carousel-counter">\n            <span class="current">','</span>\n            <span class="separator"> / </span>\n            <span class="total">','</span>\n          </div>\n\n          \x3c!-- Dots indicators --\x3e\n          <div class="carousel-dots">\n            ','\n          </div>\n\n          \x3c!-- Quick jump dropdown --\x3e\n          <div class="carousel-quick-jump">\n            <label for="carousel-select">Ir a:</label>\n            <select\n              id="carousel-select"\n              .value=',"\n              @change=","\n            >\n              ","\n            </select>\n          </div>\n        </div>\n      </div>\n    "])),100*n,t.map((function(t){return e.renderGESGroup(t)})),(function(){return e.handleCarouselPrev()}),0===n,(function(){return e.handleCarouselNext()}),n>=a-1,n+1,a,t.map((function(t,a){return B(ze||(ze=y(['\n              <button\n                class="carousel-dot ','"\n                @click=','\n                aria-label="Ir a riesgo ','"\n              ></button>\n            '])),a===n?"active":"",(function(){return e.handleCarouselGoTo(a)}),a+1)})),n,(function(t){return e.handleCarouselGoTo(parseInt(t.target.value))}),t.map((function(e,t){return B(Pe||(Pe=y(['\n                <option value="','">\n                  ',"\n                </option>\n              "])),t,e.riesgo.nombre)})))}},{key:"renderGESGroup",value:function(e){var t=this,n=e.riesgo.nombre,a=Et[n]||"#f0f0f0",i=this.state.gruposColapsados.has(n),r=e.ges,o=r.length,s=r.filter((function(e){return t.state.seleccionados.some((function(t){return t.id===e.id}))})).length,c=o>0&&s===o;return B(je||(je=y(['\n      <div class="ges-group" data-riesgo="','">\n        \x3c!-- Header del grupo --\x3e\n        <div class="ges-group__header" style="background-color: ','">\n          <div class="ges-group__header-left">\n            <button\n              class="ges-group__toggle"\n              @click=','\n              aria-label="'," grupo ",'"\n            >\n              <i class="fas fa-chevron-','"></i>\n            </button>\n\n            <h3 class="ges-group__title">\n              ','\n              <span class="ges-group__count">\n                (',"/",')\n              </span>\n            </h3>\n          </div>\n\n          <button\n            class="ges-group__select-all ','"\n            @click=','\n            title="','"\n          >\n            <i class="fas fa-','-circle"></i>\n            ',"\n          </button>\n        </div>\n\n        \x3c!-- Lista de GES del grupo --\x3e\n        ","\n      </div>\n    "])),n,a,(function(){return t.handleToggleGroup(n)}),i?"Expandir":"Colapsar",n,i?"right":"down",n,s,o,c?"active":"",(function(){return t.handleSelectAllInGroup(n,r)}),c?"Deseleccionar todos":"Seleccionar todos",c?"minus":"plus",c?"Deseleccionar todos":"Seleccionar todos",i?"":B(qe||(qe=y(['\n          <div class="ges-group__items">\n            ',"\n          </div>\n        "])),he(r,(function(e){return e.id}),(function(e){return t.renderGESItem(e,a)}))))}},{key:"renderGESItem",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#f0f0f0",a=this.state.seleccionados.some((function(t){return t.id===e.id})),i=this.state.catalogoRiesgos.find((function(t){return t.id===e.riesgo_id}));return B(Re||(Re=y(['\n      <label class="ges-item ','">\n        \x3c!-- 🎨 H2: Barra de color lateral (6px expandible a 8px en hover) --\x3e\n        <div class="ges-item__color-bar" style="background-color: ','"></div>\n\n        <input\n          type="checkbox"\n          class="ges-item__checkbox"\n          .checked=',"\n          @change=",'\n        />\n\n        <div class="ges-item__content">\n          <div class="ges-item__header">\n            <span class="ges-item__name">',"</span>\n            ","\n          </div>\n\n          ",'\n\n          <div class="ges-item__meta">\n            <span class="ges-item__category">\n              <i class="fas fa-tag"></i>\n              ',"\n            </span>\n          </div>\n        </div>\n\n        ","\n      </label>\n    "])),a?"selected":"",n,a,(function(n){return t.handleToggleGES(e,n)}),e.nombre,e.es_comun?B(Oe||(Oe=y(['\n              <span class="ges-item__badge">\n                <i class="fas fa-star"></i>\n                Común\n              </span>\n            ']))):"",e.descripcion?B(Ge||(Ge=y(['\n            <p class="ges-item__description">',"</p>\n          "])),e.descripcion):"",i?i.nombre:"Sin categoría",a?B(Me||(Me=y(['\n          <div class="ges-item__checkmark">\n            <i class="fas fa-check"></i>\n          </div>\n        ']))):"")}},{key:"renderFooter",value:function(){var e=this,t=this.state.seleccionados.length,n=this.state.gesDetallesCache.size;return B(Fe||(Fe=y(['\n      <div class="riesgo-selector__footer">\n        <div class="riesgo-selector__counter">\n          <i class="fas fa-check-circle"></i>\n          <span>\n            <strong>',"</strong> "," ","\n          </span>\n          ","\n        </div>\n\n        ","\n      </div>\n    "])),t,1===t?"riesgo":"riesgos",1===t?"seleccionado":"seleccionados",n>0?B(Be||(Be=y(['\n            <span class="cache-info" title="Detalles cargados en cache">\n              ('," con detalles)\n            </span>\n          "])),n):"",t>0?B(He||(He=y(['\n          <button class="wizard-btn wizard-btn-secondary" @click=','>\n            <i class="fas fa-times"></i>\n            Limpiar selección\n          </button>\n        '])),(function(){return e.handleClearSelection()})):"")}},{key:"handleToggleView",value:function(e){this.state.vistaComunes="comunes"===e,this.updateGESVisible(),this.renderComponent()}},{key:"handleFilterCategory",value:function(e){this.state.categoriaActiva=e,this.updateGESVisible(),this.renderComponent()}},{key:"handleToggleFiltros",value:function(){this.state.filtrosColapsados=!this.state.filtrosColapsados,this.renderComponent()}},{key:"handleSearch",value:function(e){var t=this,n=e.target.value;this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((function(){t.state.busqueda=n,t.updateGESVisible(),t.renderComponent()}),300)}},{key:"handleClearSearch",value:function(){this.state.busqueda="",this.updateGESVisible(),this.renderComponent()}},{key:"handleClearFilters",value:function(){this.state.categoriaActiva=null,this.state.busqueda="",this.state.vistaComunes=!0,this.updateGESVisible(),this.renderComponent()}},{key:"handleToggleAISuggestions",value:function(){this.state.showAISuggestions=!this.state.showAISuggestions,this.renderComponent()}},{key:"handleFilterByRiesgo",value:function(e){var t=this,n=this.state.catalogoRiesgos.find((function(t){return t.nombre===e||t.nombre.includes(e)}));n&&(this.state.categoriaActiva=n.id,this.updateGESVisible(),this.renderComponent(),setTimeout((function(){var e=t.container.querySelector(".ges-groups-carousel-wrapper");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}),100))}},{key:"handleToggleGES",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.state.seleccionados.some((function(t){return t.id===e.id}));if(n)this.state.seleccionados=this.state.seleccionados.filter((function(t){return t.id!==e.id}));else{var a=this.state.catalogoRiesgos.find((function(t){return t.id===e.riesgo_id})),i=Ve(Ve({},e),{},{categoria:a?a.nombre:""});this.state.seleccionados.push(i),this.loadGESDetails(e.id).catch((function(e){})),this.dispatchGESSelectedEvent(e,t)}this.options.onChange(this.state.seleccionados),this.renderComponent()}},{key:"dispatchGESSelectedEvent",value:function(e,t){var n,a,i=null==t||null===(n=t.target)||void 0===n||null===(a=n.closest)||void 0===a?void 0:a.call(n,".ges-item"),r=new CustomEvent("ges-selected",{bubbles:!0,detail:{ges:e,cargoIndex:this.options.cargoIndex,sourceElement:i}});this.container.dispatchEvent(r)}},{key:"handleClearSelection",value:function(){confirm("¿Estás seguro de limpiar toda la selección?")&&(this.state.seleccionados=[],this.options.onChange(this.state.seleccionados),this.renderComponent())}},{key:"getSelection",value:function(){return x(this.state.seleccionados)}},{key:"setSelection",value:function(e){this.state.seleccionados=x(e),this.renderComponent()}},{key:"getDetailsCache",value:function(){return this.state.gesDetallesCache}},{key:"groupGESByRiesgo",value:function(){var e=this,t=new Map;return this.state.gesVisible.forEach((function(n){var a=e.state.catalogoRiesgos.find((function(e){return e.id===n.riesgo_id})),i=a?a.nombre:"Sin categoría";t.has(i)||t.set(i,{riesgo:a||{nombre:"Sin categoría",id:null},ges:[]}),t.get(i).ges.push(n)})),Array.from(t.values()).sort((function(e,t){return e.riesgo.nombre.localeCompare(t.riesgo.nombre)}))}},{key:"handleToggleGroup",value:function(e){this.state.gruposColapsados.has(e)?this.state.gruposColapsados.delete(e):this.state.gruposColapsados.add(e),this.renderComponent()}},{key:"handleCarouselPrev",value:function(){this.state.carouselIndex>0&&(this.state.carouselIndex--,this.renderComponent())}},{key:"handleCarouselNext",value:function(){var e=this.groupGESByRiesgo();this.state.carouselIndex<e.length-1&&(this.state.carouselIndex++,this.renderComponent())}},{key:"handleCarouselGoTo",value:function(e){var t=this.groupGESByRiesgo();e>=0&&e<t.length&&(this.state.carouselIndex=e,this.renderComponent())}},{key:"handleSelectAllInGroup",value:function(e,t){var n=this,a=t.every((function(e){return n.state.seleccionados.some((function(t){return t.id===e.id}))}));if(a){var i=t.map((function(e){return e.id}));this.state.seleccionados=this.state.seleccionados.filter((function(e){return!i.includes(e.id)}))}else t.forEach((function(e){n.state.seleccionados.some((function(t){return t.id===e.id}))||(n.state.seleccionados.push(e),n.loadGESDetails(e.id).catch((function(e){})))}));this.options.onChange(this.state.seleccionados),this.renderComponent()}},{key:"destroy",value:function(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.container.innerHTML=""}}]);var e,t,n,a,i,o}();function St(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return _t(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_t(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Tt=function(){return f((function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(this,e),d(this,"handleCambiarFiltro",(function(e){n.isDestroyed||(n.filtroActivo=e,n.renderVistaHibrida())})),d(this,"handleCambiarAManual",(function(){n.isDestroyed||(n.modoVista="step-by-step",n.renderComponent())})),d(this,"handleValidarTodo",r(s().mark((function e(){var t,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})),!(t.length>0)){e.next=4;break}return alert("Debes revisar ".concat(t.length," riesgos antes de continuar.")),e.abrupt("return");case 4:a=s().mark((function e(){var t,a,r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=n.sugerencias[i]).plantillaId||!t.nivelesSugeridos){e.next=12;break}if(a=n.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===t.gesId})),-1===a){e.next=12;break}return r=n.options.gesArray[a],(o=Nt({},t.nivelesSugeridos)).NP=o.ND*o.NE,o.NR=o.NP*o.NC,n.options.state&&n.options.state.updateGESNiveles(n.options.cargoIndex,a,o),r.niveles=o,e.next=12,n.registrarAplicacion(t,o,o,!0);case 12:case"end":return e.stop()}}),e)})),i=0;case 7:if(!(i<n.sugerencias.length)){e.next=12;break}return e.delegateYield(a(),"t0",9);case 9:i++,e.next=7;break;case 12:n.options.onComplete();case 13:case"end":return e.stop()}}),e)})))),d(this,"handleEditarSugerencia",(function(e){var t=n.sugerencias[e],a=n.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===t.gesId}));if(-1!==a){if(t.nivelesSugeridos)n.options.gesArray[a].niveles=Nt({},t.nivelesSugeridos);if(n.isDestroyed)return;n.currentGESIndex=a,n.modoVista="step-by-step",n.renderComponent(),n.scrollToTop()}})),d(this,"handleValidarSugerencia",function(){var e=r(s().mark((function e(t){var a,i,r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=n.sugerencias[t]).validada=!a.validada,!(a.validada&&a.plantillaId&&a.nivelesSugeridos)){e.next=13;break}if(i=n.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===a.gesId})),-1===i){e.next=13;break}return r=n.options.gesArray[i],(o=Nt({},a.nivelesSugeridos)).NP=o.ND*o.NE,o.NR=o.NP*o.NC,n.options.state&&n.options.state.updateGESNiveles(n.options.cargoIndex,i,o),r.niveles=o,e.next=13,n.registrarAplicacion(a,o,o,!0);case 13:n.renderVistaHibrida();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),d(this,"handleSelectNivel",(function(e,t){if(!n.isDestroyed){var a=n.options.gesArray[n.currentGESIndex];a.niveles||(a.niveles={ND:null,NE:null,NC:null,NP:null,NR:null,deficiencia:null,exposicion:null,consecuencia:null}),a.controles||(a.controles={fuente:"",medio:"",individuo:""});var i=Nt(Nt({},a.niveles),{},d({},e,t));null!==i.ND&&void 0!==i.ND&&null!==i.NE&&void 0!==i.NE&&(i.NP=i.ND*i.NE),null!==i.NP&&void 0!==i.NP&&null!==i.NC&&void 0!==i.NC&&(i.NR=i.NP*i.NC),"ND"===e?i.deficiencia={value:t}:"NE"===e?i.exposicion={value:t}:"NC"===e&&(i.consecuencia={value:t}),n.options.state&&n.options.state.updateGESNiveles(n.options.cargoIndex,n.currentGESIndex,i),a.niveles=i,n.options.onChange({action:"update-niveles",gesIndex:n.currentGESIndex,niveles:i}),n.renderComponent()}})),d(this,"handleControlChange",(function(e,t){if(!n.isDestroyed){var a=n.options.gesArray[n.currentGESIndex];a.controles||(a.controles={fuente:"",medio:"",individuo:""}),a.controles[e]=t,n.controlChangeDebounceTimer&&clearTimeout(n.controlChangeDebounceTimer),n.controlChangeDebounceTimer=setTimeout((function(){n.options.state&&n.options.state.updateGESControles(n.options.cargoIndex,n.currentGESIndex,a.controles),n.options.onChange({action:"update-controles",gesIndex:n.currentGESIndex,controles:a.controles})}),n.controlChangeDebounceDelay)}})),d(this,"handleShowControlesHelp",(function(){alert("📋 MEDIDAS DE CONTROL - Jerarquía de Control según GTC-45\n\n✅ CONTROL EN LA FUENTE:\nActúa sobre el origen del peligro para eliminarlo o reducirlo.\nEjemplos:\n• Mantenimiento preventivo de maquinaria\n• Sustitución de materiales peligrosos por otros más seguros\n• Rediseño de procesos para eliminar riesgos\n• Instalación de guardas en equipos\n\n🏭 CONTROL EN EL MEDIO:\nActúa en el ambiente entre la fuente y el trabajador.\nEjemplos:\n• Ventilación adecuada y extracción de gases\n• Señalización de seguridad\n• Aislamiento acústico o térmico\n• Orden y aseo en áreas de trabajo\n\n👷 CONTROL EN EL INDIVIDUO:\nÚltima barrera de protección, actúa sobre el trabajador.\nEjemplos:\n• Uso de EPP (casco, guantes, tapones auditivos, gafas)\n• Capacitación y entrenamiento en seguridad\n• Rotación de personal\n• Pausas activas y exámenes médicos periódicos\n\n💡 Recuerda: La mejor estrategia es controlar en la FUENTE, luego en el MEDIO, y finalmente en el INDIVIDUO.")})),d(this,"handleLoadSugerenciasControles",function(){var e=r(s().mark((function e(t){var a,i,r,o,c,l,d,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,fetch("/api/catalogo/ges?search=".concat(encodeURIComponent(t.nombre),"&limit=5"));case 4:return a=e.sent,e.next=7,a.json();case 7:if((i=e.sent).success&&i.data&&0!==i.data.length){e.next=11;break}return alert('No se encontraron sugerencias predefinidas para "'.concat(t.nombre,'" en la base de datos. Puedes ingresarlas manualmente.')),e.abrupt("return");case 11:if(r=i.data.find((function(e){return e.nombre.toLowerCase().trim()===t.nombre.toLowerCase().trim()})),r){e.next=15;break}return alert('No se encontró coincidencia exacta para "'.concat(t.nombre,'". Resultados similares: ').concat(i.data.map((function(e){return e.nombre})).join(", "))),e.abrupt("return");case 15:return e.next=17,fetch("/api/catalogo/ges/".concat(r.id));case 17:return o=e.sent,e.next=20,o.json();case 20:if((c=e.sent).success&&c.data){e.next=24;break}return alert('No se pudieron cargar los detalles para "'.concat(t.nombre,'".')),e.abrupt("return");case 24:if(l=c.data,d=l.medidas_intervencion){e.next=29;break}return alert('El GES "'.concat(t.nombre,'" no tiene medidas de intervención predefinidas.')),e.abrupt("return");case 29:u={fuente:d.eliminacion||"",medio:d.controles_ingenieria||"",individuo:d.controles_administrativos||""},n.options.gesArray[n.currentGESIndex].controles=u,n.options.state&&n.options.state.updateGESControles(n.options.cargoIndex,n.currentGESIndex,u),n.options.onChange({action:"update-controles",gesIndex:n.currentGESIndex,controles:u}),n.isDestroyed||n.renderComponent(),e.next=42;break;case 38:e.prev=38,e.t0=e.catch(0),n.isDestroyed||alert("Error al cargar sugerencias. Por favor, intenta nuevamente.");case 42:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(t){return e.apply(this,arguments)}}()),d(this,"handlePreviousGES",(function(){n.isDestroyed||n.isNavigating||n.currentGESIndex>0&&(n.isNavigating=!0,n.currentGESIndex--,n.renderComponent(),n.scrollToTop(),setTimeout((function(){n.isNavigating=!1}),100))})),d(this,"handleNextGES",(function(){if(!n.isDestroyed&&!n.isNavigating){var e=n.options.gesArray[n.currentGESIndex];n.isGESComplete(e)?n.currentGESIndex<n.options.gesArray.length-1&&(n.isNavigating=!0,n.currentGESIndex++,n.renderComponent(),n.scrollToTop(),setTimeout((function(){n.isNavigating=!1}),100)):alert('Por favor completa todos los niveles de riesgo (ND, NE, NC) para "'.concat(e.nombre,'" antes de continuar.'))}})),d(this,"handleComplete",(function(){if(!n.isDestroyed){var e=n.options.gesArray.filter((function(e){return!n.isGESComplete(e)}));if(e.length>0){var t=e.map((function(e){return'"'.concat(e.nombre,'"')})).join(", ");alert("Por favor completa los niveles de riesgo (ND, NE, NC) para: ".concat(t))}else n.options.onComplete()}})),d(this,"handleShowHelp",(function(e){var t={ND:'\n        <strong>Nivel de Deficiencia (ND):</strong>\n        <br><br>\n        Indica la magnitud de la relación entre el conjunto de peligros detectados y su relación causal directa con posibles incidentes.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>10 - Muy Alto:</strong> Se han detectado factores de riesgo significativos que determinan una muy alta probabilidad de generar incidentes.</li>\n          <li><strong>6 - Alto:</strong> Se han detectado factores de riesgo que pueden generar incidentes.</li>\n          <li><strong>2 - Medio:</strong> Se han detectado factores de riesgo de menor importancia.</li>\n          <li><strong>0 - Bajo:</strong> No se detectan anomalías destacables. El riesgo está controlado.</li>\n        </ul>\n      ',NE:'\n        <strong>Nivel de Exposición (NE):</strong>\n        <br><br>\n        Frecuencia con la que el trabajador está expuesto al peligro.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>10 - Continua:</strong> Exposición varias veces durante la jornada laboral con tiempos prolongados.</li>\n          <li><strong>6 - Frecuente:</strong> Exposición varias veces durante la jornada con tiempos cortos.</li>\n          <li><strong>3 - Ocasional:</strong> Exposición alguna vez durante la jornada con tiempo corto.</li>\n          <li><strong>1 - Esporádica:</strong> Exposición de forma irregular o muy ocasional.</li>\n        </ul>\n      ',NC:'\n        <strong>Nivel de Consecuencia (NC):</strong>\n        <br><br>\n        Consecuencia normalmente esperada si el riesgo se materializa.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>100 - Mortal:</strong> Consecuencias fatales, muerte de uno o más trabajadores.</li>\n          <li><strong>60 - Muy Grave:</strong> Incapacidad permanente parcial o invalidez.</li>\n          <li><strong>25 - Grave:</strong> Incapacidad temporal, lesiones con baja laboral.</li>\n          <li><strong>10 - Leve:</strong> Lesiones sin hospitalización, no requiere baja laboral.</li>\n        </ul>\n      '}[e]||"No hay ayuda disponible para este nivel.";n.showHelpModal(t)})),this.container="string"==typeof t?document.querySelector(t):t,!this.container)throw new Error("NivelesRiesgoForm: Container not found");this.options=Nt({cargoIndex:a.cargoIndex||0,cargoNombre:a.cargoNombre||"",gesArray:a.gesArray||[],state:a.state||null,onChange:a.onChange||function(){},onComplete:a.onComplete||function(){}},a),this.currentGESIndex=0,this.isNavigating=!1,this.sugerencias=[],this.modoVista="loading",this.empresaId=1,this.controlChangeDebounceTimer=null,this.controlChangeDebounceDelay=1500,this.isDestroyed=!1,this.niveles={ND:[{value:1,label:"Bajo / N/A",description:"No se detectan deficiencias"},{value:2,label:"Medio",description:"Deficiencias moderadas"},{value:6,label:"Alto",description:"Deficiencias graves detectadas"},{value:10,label:"Muy Alto",description:"Deficiencias muy graves detectadas"}],NE:[{value:1,label:"Esporádica (EE)",description:"Irregularmente"},{value:2,label:"Ocasional (EO)",description:"Alguna vez durante la jornada, tiempo corto"},{value:3,label:"Frecuente (EF)",description:"Varias veces durante la jornada, tiempos cortos"},{value:4,label:"Continua (EC)",description:"Varias veces durante la jornada, tiempos prolongados"}],NC:[{value:10,label:"Leve",description:"Lesiones sin hospitalización"},{value:25,label:"Grave",description:"Incapacidad temporal"},{value:60,label:"Muy Grave",description:"Incapacidad permanente parcial o invalidez"},{value:100,label:"Mortal o Catastrófica",description:"Muerte(s)"}]},this.init()}),[{key:"init",value:(n=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDestroyed){e.next=2;break}return e.abrupt("return");case 2:if(0!==this.options.gesArray.length){e.next=5;break}return this.renderEmpty(),e.abrupt("return");case 5:return e.next=7,this.loadSugerencias();case 7:if(!this.isDestroyed){e.next=10;break}return e.abrupt("return");case 10:this.sugerencias.length>0?(this.modoVista="hybrid",this.renderVistaHibrida()):(this.modoVista="step-by-step",this.renderComponent());case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadSugerencias",value:(t=r(s().mark((function e(){var t,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.options.gesArray.map((function(e){return{id_ges:e.id_ges||e.idGes,nombre:e.nombre,categoria:e.categoria,descripcion:e.descripcion}})),e.next=5,fetch("/api/plantillas-niveles/sugerir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({empresa_id:this.empresaId,gesArray:t})});case 5:return n=e.sent,e.next=8,n.json();case 8:(a=e.sent).success?this.sugerencias=a.sugerencias||[]:this.sugerencias=[],e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),this.sugerencias=[];case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return t.apply(this,arguments)})},{key:"renderVistaHibrida",value:function(){var e=this;if(!this.isDestroyed&&this.container&&this.container.isConnected&&this.container.parentNode){var t=this.sugerencias.filter((function(e){return!e.requiereRevision&&e.plantillaId})),n=this.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})),a=B(Ue||(Ue=y(['\n      <div class="niveles-vista-hibrida">\n        \x3c!-- Header --\x3e\n        <div class="niveles-hibrida__header">\n          <h2>🧠 Configuración Inteligente de Niveles</h2>\n          <p class="niveles-hibrida__subtitle">\n            Hemos pre-configurado los niveles basándonos en plantillas de tu empresa.\n            Revisa y valida las sugerencias.\n          </p>\n        </div>\n\n        \x3c!-- Stats Cards --\x3e\n        <div class="niveles-hibrida__stats">\n          <div class="stat-card stat-card--success">\n            <i class="fas fa-check-circle"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">','</span>\n              <span class="stat-card__label">Auto-aprobables</span>\n            </div>\n          </div>\n          <div class="stat-card stat-card--warning">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">','</span>\n              <span class="stat-card__label">Requieren revisión</span>\n            </div>\n          </div>\n          <div class="stat-card stat-card--info">\n            <i class="fas fa-clock"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">~',' min</span>\n              <span class="stat-card__label">Tiempo ahorrado</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Filter Tabs --\x3e\n        <div class="niveles-hibrida__filters">\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-list"></i>\n            Todas (',')\n          </button>\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-flag"></i>\n            Solo Revisión (',')\n          </button>\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-magic"></i>\n            Auto-aprobables (',')\n          </button>\n        </div>\n\n        \x3c!-- Tabla de Sugerencias --\x3e\n        <div class="niveles-hibrida__table-container">\n          <table class="niveles-hibrida__table">\n            <thead>\n              <tr>\n                <th>GES / Riesgo</th>\n                <th>Categoría</th>\n                <th>ND</th>\n                <th>NE</th>\n                <th>NC</th>\n                <th>NP</th>\n                <th>NR</th>\n                <th>Nivel</th>\n                <th>Confianza</th>\n                <th>Acciones</th>\n              </tr>\n            </thead>\n            <tbody>\n              ','\n            </tbody>\n          </table>\n        </div>\n\n        \x3c!-- Actions --\x3e\n        <div class="niveles-hibrida__actions">\n          <button\n            class="wizard-btn wizard-btn-secondary"\n            @click=','\n          >\n            <i class="fas fa-edit"></i>\n            Configurar Manualmente\n          </button>\n\n          <button\n            class="wizard-btn wizard-btn-success"\n            @click=',"\n            ?disabled=",'\n          >\n            <i class="fas fa-check-double"></i>\n            Validar Todo y Continuar\n          </button>\n        </div>\n\n        ',"\n      </div>\n    "])),t.length,n.length,Math.round(.5*this.sugerencias.length),"todas"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("todas")}),this.sugerencias.length,"revision"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("revision")}),n.length,"auto"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("auto")}),t.length,this.getSugerenciasFiltradas().map((function(t,n){return e.templateFilaSugerencia(t,n)})),(function(){return e.handleCambiarAManual()}),(function(){return e.handleValidarTodo()}),n.length>0,n.length>0?B(Je||(Je=y(['\n          <div class="niveles-hibrida__help">\n            <i class="fas fa-info-circle"></i>\n            <p>\n              <strong>Atención:</strong> Hay '," riesgos que requieren revisión manual\n              (riesgos críticos o plantillas nuevas). Revisa cada uno antes de continuar.\n            </p>\n          </div>\n        "])),n.length):"");try{oe(a,this.container)}catch(e){this.isDestroyed=!0}}}},{key:"templateFilaSugerencia",value:function(e,t){var n,a,i,r=this,o=e.nivelesSugeridos||{},s=o.ND&&o.NE?o.ND*o.NE:null,c=s&&o.NC?s*o.NC:null,l=this.interpretarNR(c),d=e.requiereRevision?"fila-sugerencia fila-sugerencia--revision":e.plantillaId?"fila-sugerencia fila-sugerencia--auto":"fila-sugerencia fila-sugerencia--manual";return B(We||(We=y(['\n      <tr class="','">\n        <td class="td-ges">\n          <strong>',"</strong>\n          ",'\n        </td>\n        <td class="td-categoria">\n          <span class="categoria-badge">','</span>\n        </td>\n        <td class="td-nivel">','</td>\n        <td class="td-nivel">','</td>\n        <td class="td-nivel">','</td>\n        <td class="td-np">\n          <strong>','</strong>\n        </td>\n        <td class="td-nr">\n          <strong>','</strong>\n        </td>\n        <td class="td-interpretacion">\n          ','\n        </td>\n        <td class="td-confianza">\n          ','\n        </td>\n        <td class="td-acciones">\n          ',"\n        </td>\n      </tr>\n    "])),d,e.gesNombre,e.plantillaId?"":B(Ye||(Ye=y(['\n            <span class="badge badge--warning">Sin plantilla</span>\n          ']))),e.gesCategoria,null!==(n=o.ND)&&void 0!==n?n:"—",null!==(a=o.NE)&&void 0!==a?a:"—",null!==(i=o.NC)&&void 0!==i?i:"—",null!=s?s:"—",null!=c?c:"—",l.texto?B(Ke||(Ke=y(['\n            <span class="nivel-badge nivel-badge--','">\n              '," ","\n            </span>\n          "])),l.clase,l.emoji||"",l.texto):"—",e.plantillaId?B(Qe||(Qe=y(['\n            <div class="confianza-bar">\n              <div\n                class="confianza-bar__fill"\n                style="width: ','%"\n              ></div>\n              <span class="confianza-bar__text">',"%</span>\n            </div>\n          "])),(100*e.confianza).toFixed(0),(100*e.confianza).toFixed(0)):"—",e.plantillaId?B(Xe||(Xe=y(['\n            <button\n              class="btn-accion btn-accion--edit"\n              @click=','\n              title="Editar niveles"\n            >\n              <i class="fas fa-edit"></i>\n            </button>\n            <button\n              class="btn-accion btn-accion--check ','"\n              @click=','\n              title="','"\n            >\n              <i class="fas ','"></i>\n            </button>\n          '])),(function(){return r.handleEditarSugerencia(t)}),e.validada?"validada":"",(function(){return r.handleValidarSugerencia(t)}),e.validada?"Validado":"Validar",e.validada?"fa-check-circle":"fa-check"):B(Ze||(Ze=y(['\n            <button\n              class="btn-accion btn-accion--edit"\n              @click=','\n              title="Configurar manualmente"\n            >\n              <i class="fas fa-cog"></i>\n            </button>\n          '])),(function(){return r.handleEditarSugerencia(t)})))}},{key:"getSugerenciasFiltradas",value:function(){return this.filtroActivo&&"todas"!==this.filtroActivo?"revision"===this.filtroActivo?this.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})):"auto"===this.filtroActivo?this.sugerencias.filter((function(e){return!e.requiereRevision&&e.plantillaId})):this.sugerencias:this.sugerencias}},{key:"registrarAplicacion",value:(e=r(s().mark((function e(t,n,a,i){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/plantillas-niveles/aplicar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plantillaId:t.plantillaId,gesId:t.gesId,cargoId:this.options.cargoIndex,nivelesSugeridos:n,nivelesFinales:a,justificacionAjuste:i?null:"Ajuste manual del usuario"})});case 3:return r=e.sent,e.next=6,r.json();case 6:e.sent.success,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(t,n,a,i){return e.apply(this,arguments)})},{key:"renderComponent",value:function(){if(!this.isDestroyed&&this.container&&this.container.isConnected&&this.container.parentNode){var e=this.options.gesArray[this.currentGESIndex],t=this.options.gesArray.length,n=B(et||(et=y(['\n      <div class="niveles-form">\n        ',"\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n    "])),this.templateCompactHeader(e,this.currentGESIndex+1,t),this.templateGESInfo(e),this.templateNivelSection("ND","Nivel de Deficiencia",e),this.templateNivelSection("NE","Nivel de Exposición",e),this.templateNivelSection("NC","Nivel de Consecuencia",e),this.templateControlesSection(e),this.templateCalculator(e),this.templateNavigation(this.currentGESIndex,t));try{oe(n,this.container)}catch(e){this.isDestroyed=!0}}}},{key:"templateCompactHeader",value:function(e,t,n){var a=this,i=this.options.gesArray.filter((function(e){return a.isGESComplete(e)})).length,r=n>0?Math.round(i/n*100):0,o=2*Math.PI*22,s="".concat(r/100*o," ").concat(o);return B(tt||(tt=y(['\n      <div class="niveles-form__header-compact">\n        <div class="niveles-form__header-left">\n          <h2>\n            <i class="fas fa-chart-bar"></i>\n            Niveles y Controles\n          </h2>\n          <p class="cargo-info-inline">\n            <i class="fas fa-briefcase"></i>\n            <strong>',"</strong>\n            <span>• Riesgo "," de ",'</span>\n          </p>\n        </div>\n        \n        <div class="niveles-form__header-right">\n          <div class="niveles-form__progress-mini">\n            <div class="progress-circle">\n              <svg viewBox="0 0 50 50">\n                <circle class="track" cx="25" cy="25" r="22"></circle>\n                <circle class="fill" cx="25" cy="25" r="22" \n                  stroke-dasharray="','"></circle>\n              </svg>\n              <div class="progress-number">\n                <span>',"</span>\n                <small>/",'</small>\n              </div>\n            </div>\n            <div class="progress-label">\n              <strong>',"%</strong>\n              completado\n            </div>\n          </div>\n        </div>\n      </div>\n    "])),this.options.cargoNombre,t,n,s,i,n,r)}},{key:"templateHeader",value:function(e,t,n){return this.templateCompactHeader(e,t,n)}},{key:"templateProgressIndicator",value:function(){return""}},{key:"templateGESInfo",value:function(e){var t=this.isGESComplete(e);return B(nt||(nt=y(['\n      <div class="niveles-form__ges-card">\n        <div class="ges-card__header">\n          <h3 class="ges-card__name">\n            <i class="fas fa-exclamation-triangle"></i>\n            ',"\n          </h3>\n          ","\n        </div>\n        ",'\n        <div class="ges-card__meta">\n          <span class="ges-card__category">\n            <i class="fas fa-tag"></i>\n            ',"\n          </span>\n        </div>\n      </div>\n    "])),e.nombre,B(t?at||(at=y(['\n            <span class="ges-card__badge ges-card__badge--complete">\n              <i class="fas fa-check-circle"></i>\n              Completo\n            </span>\n          '])):it||(it=y(['\n            <span class="ges-card__badge ges-card__badge--incomplete">\n              <i class="fas fa-clock"></i>\n              Pendiente\n            </span>\n          ']))),e.descripcion?B(rt||(rt=y(['\n          <p class="ges-card__description">',"</p>\n        "])),e.descripcion):"",e.categoria||"Sin categoría")}},{key:"templateNivelSection",value:function(e,t,n){var a,i,r=this,o=this.niveles[e],s=null!==(a=null===(i=n.niveles)||void 0===i?void 0:i[e])&&void 0!==a?a:null;return B(ot||(ot=y(['\n      <div class="niveles-form__section">\n        <div class="nivel-section__header">\n          <h3 class="nivel-section__title">\n            <span class="nivel-badge">',"</span>\n            ",'\n          </h3>\n          <button\n            class="nivel-section__help"\n            @click=','\n            title="Ayuda sobre ','"\n          >\n            <i class="fas fa-question-circle"></i>\n          </button>\n        </div>\n\n        <div class="nivel-bar">\n          ',"\n        </div>\n      </div>\n    "])),e,t,(function(){return r.handleShowHelp(e)}),t,o.map((function(t){return r.templateNivelOption(e,t,s)})))}},{key:"templateNivelOption",value:function(e,t,n){var a=this,i=n===t.value,r=this.getNivelColor(e,t.value);return B(st||(st=y(['\n      <button\n        class="nivel-option ','"\n        data-value="','"\n        @click=','\n        style="--nivel-color: ','"\n        title="',": ",'"\n      >\n        <span class="nivel-option__label">','</span>\n        <span class="nivel-option__value">',"</span>\n        ","\n      </button>\n    "])),i?"nivel-option--selected":"",t.value,(function(){return a.handleSelectNivel(e,t.value)}),r,t.label,t.description,t.label,t.value,i?B(ct||(ct=y(['<span class="nivel-option__check"><i class="fas fa-check-circle"></i></span>']))):"")}},{key:"getNivelColor",value:function(e,t){var n;return(null===(n={ND:{1:"#4caf50",2:"#ffeb3b",6:"#ff9800",10:"#f44336"},NE:{1:"#4caf50",2:"#ffeb3b",3:"#ff9800",4:"#f44336"},NC:{10:"#4caf50",25:"#ffeb3b",60:"#ff9800",100:"#f44336"}}[e])||void 0===n?void 0:n[t])||"#999"}},{key:"getNivelEmoji",value:function(e,t){var n;return(null===(n={ND:{0:"🟢",2:"🟡",6:"🟠",10:"🔴"},NE:{1:"🟢",2:"🟡",3:"🟠",4:"🔴"},NC:{10:"🟢",25:"🟡",60:"🟠",100:"🔴"}}[e])||void 0===n?void 0:n[t])||"⚪"}},{key:"findControlesFromOtherCargo",value:function(e){if(!this.options.state)return null;for(var t=this.options.state.getCargos(),n=(e.nombre||e.ges||"").trim().toLowerCase(),a=e.id_ges||e.idGes||e.id,i=0;i<t.length;i++)if(i!==this.options.cargoIndex){var r=t[i],o=r.gesSeleccionados||r.ges||[];if(Array.isArray(o)){var s,c=St(o);try{for(c.s();!(s=c.n()).done;){var l=s.value,d=l.id_ges||l.idGes||l.id,u=(l.nombre||l.ges||"").trim().toLowerCase();if((a&&d&&a===d||n&&u&&n===u)&&l.controles)if(l.controles.fuente||l.controles.medio||l.controles.individuo)return Nt({},l.controles)}}catch(e){c.e(e)}finally{c.f()}}}return null}},{key:"templateControlesSection",value:function(e){var t=this,n=null,a=!1;e.controles&&(e.controles.fuente||e.controles.medio||e.controles.individuo)||(n=this.findControlesFromOtherCargo(e))&&(e.controles={fuente:n.fuente||"",medio:n.medio||"",individuo:n.individuo||""},a=!0),e.controles||(e.controles={fuente:"",medio:"",individuo:""});var i=e.controles,r=i.fuente,o=void 0===r?"":r,s=i.medio,c=void 0===s?"":s,l=i.individuo,d=void 0===l?"":l;return B(lt||(lt=y(['\n      <div class="controles-section">\n        <div class="controles-section__header">\n          <h3 class="controles-section__title">\n            <i class="fas fa-shield-alt"></i>\n            Controles Existentes\n          </h3>\n          ','\n        </div>\n\n        <p class="controles-section__description">\n          Indique los controles que la empresa <strong>YA tiene implementados</strong> para este riesgo (GTC-45)\n        </p>\n\n        <div class="controles-grid">\n          \x3c!-- Control en la FUENTE --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-tools"></i>\n              Control en la FUENTE\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Mantenimiento preventivo de maquinaria, sustitución de materiales peligrosos..."\n              rows="3"\n              .value=',"\n              @input=",'\n            ></textarea>\n          </div>\n\n          \x3c!-- Control en el MEDIO --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-warehouse"></i>\n              Control en el MEDIO\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Ventilación adecuada, señalización de seguridad, aislamiento acústico..."\n              rows="3"\n              .value=',"\n              @input=",'\n            ></textarea>\n          </div>\n\n          \x3c!-- Control en el INDIVIDUO --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-user-shield"></i>\n              Control en el INDIVIDUO\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Uso de EPP (casco, guantes, tapones auditivos), capacitación en seguridad..."\n              rows="3"\n              .value=',"\n              @input=","\n            ></textarea>\n          </div>\n        </div>\n      </div>\n    "])),a?B(dt||(dt=y(['\n            <div class="autocompletado-badge">\n              <i class="fas fa-copy"></i>\n              Autocompletado desde otro cargo\n            </div>\n          ']))):"",o,(function(e){return t.handleControlChange("fuente",e.target.value)}),c,(function(e){return t.handleControlChange("medio",e.target.value)}),d,(function(e){return t.handleControlChange("individuo",e.target.value)}))}},{key:"templateCalculator",value:function(e){var t=e.niveles||{},n=t.ND,a=t.NE,i=t.NC,r=null!=n&&null!=a?n*a:null,o=null!==r&&null!=i?r*i:null,s=this.interpretarNP(r),c=this.interpretarNR(o);return B(ut||(ut=y(['\n      <div class="niveles-form__calculator">\n        <h3 class="calculator__title">\n          <i class="fas fa-calculator"></i>\n          Resultados del Cálculo\n        </h3>\n\n        <div class="calculator__grid">\n          \x3c!-- NP (Nivel de Probabilidad) --\x3e\n          <div class="calculator__result">\n            <div class="calculator__formula">\n              <span class="formula-label">NP</span>\n              <span class="formula-equation">=</span>\n              <span class="formula-part">ND (',')</span>\n              <span class="formula-operator">×</span>\n              <span class="formula-part">NE (',')</span>\n            </div>\n            <div class="calculator__value ','">\n              <span class="value-number">','</span>\n              <span class="value-label">Nivel de Probabilidad</span>\n            </div>\n            ','\n          </div>\n\n          \x3c!-- NR (Nivel de Riesgo) --\x3e\n          <div class="calculator__result">\n            <div class="calculator__formula">\n              <span class="formula-label">NR</span>\n              <span class="formula-equation">=</span>\n              <span class="formula-part">NP (',')</span>\n              <span class="formula-operator">×</span>\n              <span class="formula-part">NC (',')</span>\n            </div>\n            <div class="calculator__value ','">\n              <span class="value-number">','</span>\n              <span class="value-label">Nivel de Riesgo</span>\n            </div>\n            ',"\n          </div>\n        </div>\n      </div>\n    "])),null!=n?n:"?",null!=a?a:"?",s.clase,null!=r?r:"—",s.texto?B(pt||(pt=y(['\n              <div class="calculator__interpretation ','">\n                <i class="fas ','"></i>\n                <span>',"</span>\n              </div>\n            "])),s.clase,s.icono,s.texto):"",null!=r?r:"?",null!=i?i:"?",c.clase,null!=o?o:"—",c.texto?B(ft||(ft=y(['\n              <div class="calculator__interpretation ','">\n                <i class="fas ','"></i>\n                <div>\n                  <strong>',"</strong>\n                  <p>","</p>\n                </div>\n              </div>\n            "])),c.clase,c.icono,c.texto,c.descripcion):"")}},{key:"templateNavigation",value:function(e,t){var n=this,a=e>0,i=e<t-1,r=this.isGESComplete(this.options.gesArray[e]),o=this.areAllGESComplete(),s=this.getNextPendingCargoInfo(),c=!s.hasMoreCargos,l=s.allCargosComplete,d="Finalizar Configuración",u="fa-check";return!c&&o?(d="Siguiente: ".concat(s.nextCargoName),u="fa-arrow-right"):l&&(d="Terminar Configuración",u="fa-check-double"),B(vt||(vt=y(['\n      \x3c!-- Navegación tradicional (bottom sticky) --\x3e\n      <div class="niveles-form__navigation">\n        <button\n          class="wizard-btn wizard-btn-secondary"\n          ?disabled=',"\n          @click=",'\n        >\n          <i class="fas fa-chevron-left"></i>\n          Riesgo Anterior\n        </button>\n\n        <div class="navigation__info">\n          ',"\n        </div>\n\n        ","\n      </div>\n\n      \x3c!-- FAB Navigation (flotante - solo en desktop con más de 1 riesgo) --\x3e\n      ","\n    "])),!a,(function(){return n.handlePreviousGES()}),r?"":B(gt||(gt=y(['\n            <p class="navigation__warning">\n              <i class="fas fa-exclamation-circle"></i>\n              Completa los 3 niveles de riesgo (ND, NE, NC) para continuar\n            </p>\n          ']))),i?B(ht||(ht=y(['\n          <button\n            class="wizard-btn wizard-btn-primary"\n            ?disabled=',"\n            @click=",'\n          >\n            Siguiente Riesgo\n            <i class="fas fa-chevron-right"></i>\n          </button>\n        '])),!r,(function(){return n.handleNextGES()})):B(mt||(mt=y(['\n          <button\n            class="wizard-btn ','"\n            ?disabled=',"\n            @click=",'\n          >\n            <i class="fas ','"></i>\n            ',"\n          </button>\n        "])),l?"wizard-btn-success":"wizard-btn-primary",!o,(function(){return n.handleComplete()}),u,d),t>1?B(bt||(bt=y(['\n        <div class="wizard-fab-nav">\n          ',"\n\n          ","\n        </div>\n      "])),a?B(yt||(yt=y(['\n            <button\n              class="wizard-fab wizard-fab--secondary"\n              data-tooltip="Riesgo Anterior"\n              @click=','\n              aria-label="Ir al riesgo anterior"\n            >\n              <i class="fas fa-chevron-left"></i>\n            </button>\n          '])),(function(){return n.handlePreviousGES()})):"",i?B(xt||(xt=y(['\n            <button\n              class="wizard-fab"\n              data-tooltip="','"\n              ?disabled=',"\n              @click=",'\n              aria-label="Ir al siguiente riesgo"\n            >\n              <i class="fas fa-chevron-right"></i>\n              ',"\n            </button>\n          "])),r?"Siguiente Riesgo":"Completa este riesgo primero",!r,(function(){return n.handleNextGES()}),e+1<t?B(wt||(wt=y(['\n                <span class="wizard-fab__badge">',"</span>\n              "])),e+2):""):""):"")}},{key:"getNextPendingCargoInfo",value:function(){var e;if(!this.options.state)return{hasMoreCargos:!1,nextCargoName:"",allCargosComplete:!1};for(var t=this.options.state.getCargos(),n=this.options.cargoIndex,a=null,i=!0,r=0;r<t.length;r++){var o=t[r],s=o.gesSeleccionados||o.ges||[];!(s.length>0&&s.every((function(e){var t=e.niveles||{};return null!==t.ND&&void 0!==t.ND&&null!==t.NE&&void 0!==t.NE&&null!==t.NC&&void 0!==t.NC})))&&s.length>0&&(i=!1,r>n&&!a&&(a=o))}return{hasMoreCargos:null!==a,nextCargoName:(null===(e=a)||void 0===e?void 0:e.nombre)||"",allCargosComplete:i}}},{key:"showHelpModal",value:function(e){var t=document.createElement("div");t.className="niveles-help-modal",t.innerHTML='\n      <div class="help-modal__overlay"></div>\n      <div class="help-modal__content">\n        <button class="help-modal__close">\n          <i class="fas fa-times"></i>\n        </button>\n        <div class="help-modal__body">\n          '.concat(e,"\n        </div>\n      </div>\n    "),document.body.appendChild(t);var n=function(){return t.remove()};t.querySelector(".help-modal__overlay").addEventListener("click",n),t.querySelector(".help-modal__close").addEventListener("click",n)}},{key:"isGESComplete",value:function(e){var t=e.niveles||{},n=t.ND,a=t.NE,i=t.NC;return null!=n&&null!=a&&null!=i}},{key:"areAllGESComplete",value:function(){var e=this;return this.options.gesArray.every((function(t){return e.isGESComplete(t)}))}},{key:"interpretarNP",value:function(e){return null==e?{texto:"",clase:"",icono:"",descripcion:""}:e>=40?{texto:"Muy Alto",clase:"risk-muy-alto",icono:"fa-exclamation-triangle",descripcion:"Situación crítica. Corrección urgente."}:e>=20?{texto:"Alto",clase:"risk-alto",icono:"fa-exclamation-circle",descripcion:"Corregir y adoptar medidas de control."}:e>=8?{texto:"Medio",clase:"risk-medio",icono:"fa-info-circle",descripcion:"Mejorar si es posible."}:{texto:"Bajo",clase:"risk-bajo",icono:"fa-check-circle",descripcion:"Mantener las medidas de control existentes."}}},{key:"interpretarNR",value:function(e){return null==e?{texto:"",clase:"",icono:"",descripcion:""}:e>=600?{texto:"I - No Aceptable",clase:"risk-muy-alto",icono:"fa-ban",descripcion:"Situación crítica. Suspender actividades hasta controlar el riesgo."}:e>=150?{texto:"II - No Aceptable o Aceptable con Control",clase:"risk-alto",icono:"fa-exclamation-triangle",descripcion:"Intervención urgente. No iniciar actividad hasta reducir el riesgo."}:e>=40?{texto:"III - Mejorable",clase:"risk-medio",icono:"fa-tasks",descripcion:"Mejorar las medidas de control. Programar acciones de mejora."}:{texto:"IV - Aceptable",clase:"risk-bajo",icono:"fa-check-circle",descripcion:"Mantener las medidas de control actuales. Seguimiento periódico."}}},{key:"scrollToTop",value:function(){this.container.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"getCurrentGESIndex",value:function(){return this.currentGESIndex}},{key:"setCurrentGESIndex",value:function(e){this.isDestroyed||e>=0&&e<this.options.gesArray.length&&(this.currentGESIndex=e,this.renderComponent())}},{key:"updateGESArray",value:function(e){this.isDestroyed||(this.options.gesArray=e,this.currentGESIndex>=e.length&&(this.currentGESIndex=Math.max(0,e.length-1)),this.renderComponent())}},{key:"renderEmpty",value:function(){var e=this;if(!this.isDestroyed&&this.container&&this.container.isConnected&&this.container.parentNode){var t=B(Ct||(Ct=y(['\n      <div class="niveles-form__empty">\n        <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #ffeb3b; margin-bottom: 1rem;"></i>\n        <h3>No hay riesgos seleccionados</h3>\n        <p>Debes seleccionar al menos un riesgo en el paso anterior antes de configurar los niveles.</p>\n        <button\n          class="wizard-btn wizard-btn-secondary"\n          @click=','\n        >\n          <i class="fas fa-arrow-left"></i>\n          Volver a Selección de Riesgos\n        </button>\n      </div>\n    '])),(function(){return e.options.onChange({action:"go-back"})}));try{oe(t,this.container)}catch(e){this.isDestroyed=!0}}}},{key:"destroy",value:function(){this.isDestroyed=!0,this.controlChangeDebounceTimer&&(clearTimeout(this.controlChangeDebounceTimer),this.controlChangeDebounceTimer=null),this.container&&this.container.isConnected&&(this.container.innerHTML="")}}]);var e,t,n}();var Lt=function(){return f((function e(t,n){u(this,e),this.container="string"==typeof t?document.querySelector(t):t,this.state=n,this.currentGesIndex=0,this.currentCargoIndex=0,this.container}),[{key:"render",value:function(){if(this.container){var e=this.state.getCargos();if(e&&0!==e.length){var t=e[this.currentCargoIndex];if(t&&t.ges&&0!==t.ges.length){var n=t.ges[this.currentGesIndex];n&&(this.container.innerHTML=this.getHTML(e,t,n),this.attachEventListeners())}else this.renderNoRiesgos(t)}else this.renderEmptyState()}}},{key:"getHTML",value:function(e,t,n){var a=t.ges.length,i=Math.round((this.currentGesIndex+1)/a*100);return'\n      <div class="controles-form">\n        \x3c!-- Cargo Tabs --\x3e\n        '.concat(e.length>1?this.renderCargoTabs(e):"",'\n\n        \x3c!-- Header --\x3e\n        <div class="controles-header">\n          <div class="controles-header__info">\n            <h2 class="controles-header__title">Controles de Riesgo</h2>\n            <p class="controles-header__subtitle">\n              Define las medidas de control para: <strong>').concat(n.nombre||"Riesgo sin nombre",'</strong>\n            </p>\n            <p class="controles-header__cargo">\n              Cargo: <strong>').concat(t.nombre,'</strong>\n            </p>\n          </div>\n          <div class="controles-header__progress">\n            <div class="progress-circle">\n              <svg\n                viewBox="0 0 36 36"\n                class="circular-chart"\n                role="img"\n                aria-label="Progreso de GES: ').concat(this.currentGesIndex+1," de ").concat(a,'"\n              >\n                <path class="circle-bg"\n                  d="M18 2.0845\n                    a 15.9155 15.9155 0 0 1 0 31.831\n                    a 15.9155 15.9155 0 0 1 0 -31.831"\n                />\n                <path class="circle"\n                  stroke-dasharray="').concat(i,', 100"\n                  d="M18 2.0845\n                    a 15.9155 15.9155 0 0 1 0 31.831\n                    a 15.9155 15.9155 0 0 1 0 -31.831"\n                />\n              </svg>\n              <div class="progress-text" aria-hidden="true">\n                <span class="progress-number">').concat(this.currentGesIndex+1,'</span>\n                <span class="progress-total">/').concat(a,'</span>\n              </div>\n            </div>\n            <p class="progress-label">GES configurados</p>\n          </div>\n        </div>\n\n        \x3c!-- Controles Existentes (GTC-45) --\x3e\n        <div class="controles-existentes-section">\n          <div class="section-header">\n            <div class="section-header__left">\n              <i class="fas fa-shield-alt"></i>\n              <h3 class="section-title">Controles Existentes</h3>\n            </div>\n            <p class="section-description">\n              Indique los controles que la empresa <strong>YA tiene implementados</strong> para este riesgo según GTC-45\n            </p>\n          </div>\n\n          ').concat(this.renderControlesExistentesFields(n),'\n        </div>\n\n        \x3c!-- Medidas de Intervención (Sugerencias BD) --\x3e\n        <div class="medidas-intervencion-section">\n          <div class="section-header">\n            <div class="section-header__left">\n              <i class="fas fa-lightbulb"></i>\n              <h3 class="section-title">Medidas de Intervención Sugeridas</h3>\n            </div>\n            <button\n              class="wizard-btn-tertiary"\n              id="btn-cargar-sugerencias"\n              title="Cargar sugerencias desde la base de datos"\n              aria-label="Cargar sugerencias de medidas de intervención desde el catálogo">\n              <i class="fas fa-magic"></i>\n              Cargar Sugerencias desde BD\n            </button>\n          </div>\n          <p class="section-description">\n            Estas son las medidas que la empresa <strong>DEBERÍA implementar</strong> según la jerarquía de controles\n          </p>\n\n          <div class="controles-hierarchy">\n            ').concat(this.renderControlField(1,"eliminacion","Eliminación","fa-times-circle","Eliminar completamente la fuente del riesgo. Ejemplo: Eliminar proceso ruidoso, automatizar tarea peligrosa, realizar trabajos a nivel del suelo.",n),"\n\n            ").concat(this.renderControlField(2,"sustitucion","Sustitución","fa-exchange-alt","Reemplazar por algo menos peligroso. Ejemplo: Sustituir químico tóxico por alternativa más segura, usar plataformas elevadoras en lugar de andamios.",n),"\n\n            ").concat(this.renderControlField(3,"controlesIngenieria","Controles de Ingeniería","fa-cogs","Modificaciones físicas, señalización y diseño. Ejemplo: Cabinas insonorizadas, ventilación, guardas en maquinaria, señalización de seguridad, barandas.",n),"\n\n            ").concat(this.renderControlField(4,"controlesAdministrativos","Controles Administrativos","fa-clipboard-list","Procedimientos, permisos y capacitación. Ejemplo: Rotación de personal, pausas activas, permisos de trabajo, capacitaciones en SST, inspecciones periódicas.",n),'\n          </div>\n        </div>\n\n        \x3c!-- Hint --\x3e\n        <div class="wizard-hint info" style="margin-top: 2rem;">\n          <i class="fas fa-lightbulb"></i>\n          Los campos de control son opcionales. Puedes dejarlos vacíos si no aplican para este riesgo específico.\n        </div>\n\n        \x3c!-- Navigation --\x3e\n        <div class="controles-navigation">\n          ').concat(this.renderNavigationButtons(a),"\n        </div>\n      </div>\n    ")}},{key:"renderCargoTabs",value:function(e){var t=this;return'\n      <div class="wizard-tabs">\n        '.concat(e.map((function(e,n){return'\n          <button\n            class="wizard-tab '.concat(n===t.currentCargoIndex?"active":"",'"\n            data-cargo-index="').concat(n,'"\n          >\n            <i class="fas fa-user-tie"></i>\n            ').concat(e.nombre,"\n          </button>\n        ")})).join(""),"\n      </div>\n    ")}},{key:"renderControlesExistentesFields",value:function(e){this.state.getCargos()[this.currentCargoIndex];var t=e.controles||{};return'\n      <div class="controles-existentes-grid">\n        '.concat(this.renderControlExistenteField("fuente","Control en la Fuente","fa-exclamation-triangle","Ejemplo: Encerramiento del proceso ruidoso, guardas en maquinaria, aislamiento de cables eléctricos",t.fuente||""),"\n\n        ").concat(this.renderControlExistenteField("medio","Control en el Medio","fa-wind","Ejemplo: Ventilación general, extractores localizados, señalización de seguridad, barandas",t.medio||""),"\n\n        ").concat(this.renderControlExistenteField("individuo","Control en el Individuo","fa-user-shield","Ejemplo: Capacitación, EPP entregados, exámenes médicos periódicos, pausas activas",t.individuo||""),"\n      </div>\n    ")}},{key:"renderControlExistenteField",value:function(e,t,n,a,i){var r=i.length,o="control-existente-".concat(e,"-").concat(this.currentCargoIndex,"-").concat(this.currentGesIndex),s="".concat(o,"-char-count");return'\n      <div class="control-existente-group">\n        <div class="control-existente-header">\n          <i class="fas '.concat(n,'"></i>\n          <label for="').concat(o,'" class="control-existente-title">').concat(t,'</label>\n        </div>\n        <div class="control-existente-body">\n          <textarea\n            id="').concat(o,'"\n            class="control-existente-textarea ').concat(i?"filled":"",'"\n            data-control-existente="').concat(e,'"\n            placeholder="').concat(a,'"\n            maxlength="500"\n            rows="3"\n            aria-label="').concat(t,": ").concat(a,'"\n            aria-describedby="').concat(s,'"\n          >').concat(i,'</textarea>\n          <span class="control-char-count" id="').concat(s,'" aria-live="polite" aria-atomic="true">\n            <span class="char-current">').concat(r,"</span> / 500\n          </span>\n        </div>\n      </div>\n    ")}},{key:"renderControlField",value:function(e,t,n,a,i,r){this.state.getCargos()[this.currentCargoIndex];var o=(r.controles||{})[t]||"",s=o.length,c="control-".concat(t,"-").concat(this.currentCargoIndex,"-").concat(this.currentGesIndex),l="".concat(c,"-char-count");return'\n      <div class="control-group" data-level="'.concat(e,'">\n        <div class="control-header">\n          <div class="control-header__left">\n            <span class="control-number" aria-hidden="true">').concat(e,'</span>\n            <i class="fas ').concat(a,' control-icon" aria-hidden="true"></i>\n            <label for="').concat(c,'" class="control-title">').concat(n,'</label>\n          </div>\n          <span class="control-char-count" id="').concat(l,'" aria-live="polite" aria-atomic="true">\n            <span class="char-current">').concat(s,'</span> / 500 caracteres\n          </span>\n        </div>\n        <div class="control-body">\n          <textarea\n            id="').concat(c,'"\n            class="control-textarea ').concat(o?"filled":"",'"\n            data-control-type="').concat(t,'"\n            placeholder="').concat(i,'"\n            maxlength="500"\n            rows="3"\n            aria-label="').concat(n,": ").concat(i,'"\n            aria-describedby="').concat(l,'"\n          >').concat(o,"</textarea>\n        </div>\n      </div>\n    ")}},{key:"renderNavigationButtons",value:function(e){var t=0===this.currentGesIndex,n=this.currentGesIndex===e-1;return'\n      \x3c!-- Navegación tradicional --\x3e\n      <button\n        class="btn-wizard btn-wizard--secondary"\n        id="btn-ges-anterior"\n        '.concat(t?"disabled":"",'\n      >\n        <i class="fas fa-arrow-left"></i>\n        GES Anterior\n      </button>\n\n      <div class="controles-navigation__center">\n        ').concat(n?'\n          <button class="btn-wizard btn-wizard--success" id="btn-finalizar-controles">\n            Finalizar Controles\n            <i class="fas fa-check"></i>\n          </button>\n        ':'\n          <button class="btn-wizard btn-wizard--primary" id="btn-ges-siguiente">\n            Siguiente GES\n            <i class="fas fa-arrow-right"></i>\n          </button>\n        ','\n      </div>\n\n      <button class="btn-wizard btn-wizard--tertiary" id="btn-saltar-ges">\n        Saltar\n        <i class="fas fa-step-forward"></i>\n      </button>\n\n      \x3c!-- FAB Navigation (solo si hay más de 1 GES) --\x3e\n      ').concat(e>1?'\n        <div class="wizard-fab-nav">\n          '.concat(t?"":'\n            <button\n              class="wizard-fab wizard-fab--secondary"\n              id="fab-ges-anterior"\n              data-tooltip="GES Anterior"\n              aria-label="Ir al GES anterior"\n            >\n              <i class="fas fa-chevron-left"></i>\n            </button>\n          ',"\n\n          ").concat(n?"":'\n            <button\n              class="wizard-fab"\n              id="fab-ges-siguiente"\n              data-tooltip="Siguiente GES"\n              aria-label="Ir al siguiente GES"\n            >\n              <i class="fas fa-chevron-right"></i>\n              <span class="wizard-fab__badge">'.concat(this.currentGesIndex+2,"</span>\n            </button>\n          "),"\n        </div>\n      "):"","\n    ")}},{key:"renderEmptyState",value:function(){this.container.innerHTML='\n      <div class="wizard-empty-state">\n        <i class="fas fa-briefcase"></i>\n        <h3>No hay cargos creados</h3>\n        <p>Necesitas crear al menos un cargo para definir controles de riesgo.</p>\n        <button class="btn-wizard btn-wizard--primary" onclick="window.history.back()">\n          <i class="fas fa-arrow-left"></i>\n          Volver\n        </button>\n      </div>\n    '}},{key:"renderNoRiesgos",value:function(e){this.container.innerHTML='\n      <div class="wizard-empty-state">\n        <i class="fas fa-exclamation-triangle"></i>\n        <h3>Sin riesgos seleccionados</h3>\n        <p>El cargo <strong>'.concat(e.nombre,'</strong> no tiene riesgos (GES) seleccionados.</p>\n        <button class="btn-wizard btn-wizard--primary" onclick="window.history.back()">\n          <i class="fas fa-arrow-left"></i>\n          Volver a seleccionar riesgos\n        </button>\n      </div>\n    ')}},{key:"attachEventListeners",value:function(){var e=this;if(this.container){this.container.querySelectorAll("[data-cargo-index]").forEach((function(t){t.addEventListener("click",(function(t){var n=parseInt(t.currentTarget.dataset.cargoIndex,10);n!==e.currentCargoIndex&&(e.saveCurrentControles(),e.switchCargo(n))}))})),this.container.querySelectorAll(".control-existente-textarea").forEach((function(t){t.addEventListener("input",(function(t){e.updateCharCountExistente(t.target)})),t.addEventListener("blur",(function(){e.saveCurrentControles()}))})),this.container.querySelectorAll(".control-textarea").forEach((function(t){t.addEventListener("input",(function(t){e.updateCharCount(t.target)})),t.addEventListener("blur",(function(){e.saveCurrentControles()}))}));var t=this.container.querySelector("#btn-cargar-sugerencias");t&&t.addEventListener("click",(function(){e.handleLoadSugerencias()}));var n=this.container.querySelector("#btn-ges-anterior"),a=this.container.querySelector("#btn-ges-siguiente"),i=this.container.querySelector("#btn-finalizar-controles"),r=this.container.querySelector("#btn-saltar-ges");n&&n.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesAnterior()})),a&&a.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesSiguiente()})),i&&i.addEventListener("click",(function(){e.saveCurrentControles(),e.finalizarControles()})),r&&r.addEventListener("click",(function(){e.saveCurrentControles(),e.saltarGes()}));var o=this.container.querySelector("#fab-ges-anterior"),s=this.container.querySelector("#fab-ges-siguiente");o&&o.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesAnterior()})),s&&s.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesSiguiente()}))}}},{key:"updateCharCountExistente",value:function(e){var t=e.closest(".control-existente-group");if(t){var n=e.value.length,a=t.querySelector(".char-current"),i=t.querySelector(".control-char-count");a&&(a.textContent=n),n>0?e.classList.add("filled"):e.classList.remove("filled"),i&&(i.classList.remove("warning","danger"),n>=400&&n<490?i.classList.add("warning"):n>=490&&i.classList.add("danger"))}}},{key:"updateCharCount",value:function(e){var t=e.closest(".control-group");if(t){var n=e.value.length,a=t.querySelector(".char-current"),i=t.querySelector(".control-char-count");a&&(a.textContent=n),n>0?e.classList.add("filled"):e.classList.remove("filled"),i&&(i.classList.remove("warning","danger"),n>=400&&n<490?i.classList.add("warning"):n>=490&&i.classList.add("danger"))}}},{key:"saveCurrentControles",value:function(){if(this.container){var e=this.state.getCargos()[this.currentCargoIndex];if(e)if(e.ges[this.currentGesIndex]){var t={};this.container.querySelectorAll(".control-existente-textarea").forEach((function(e){var n=e.dataset.controlExistente;t[n]=e.value.trim()})),this.container.querySelectorAll(".control-textarea").forEach((function(e){var n=e.dataset.controlType;t[n]=e.value.trim()})),this.state.updateGESControles(this.currentCargoIndex,this.currentGesIndex,t)}}}},{key:"switchCargo",value:function(e){var t=this.state.getCargos();e<0||e>=t.length||(this.currentCargoIndex=e,this.currentGesIndex=0,this.render())}},{key:"navegarGesAnterior",value:function(){var e=this;if(this.currentGesIndex>0){var t=this.container.querySelector(".controles-hierarchy");t&&t.classList.add("ges-transition-exit"),setTimeout((function(){e.currentGesIndex--,e.render(),e.scrollToTop();var t=e.container.querySelector(".controles-hierarchy");t&&t.classList.add("ges-transition-enter")}),300)}}},{key:"navegarGesSiguiente",value:function(){var e=this,t=this.state.getCargos()[this.currentCargoIndex].ges.length;if(this.currentGesIndex<t-1){var n=this.container.querySelector(".controles-hierarchy");n&&n.classList.add("ges-transition-exit"),setTimeout((function(){e.currentGesIndex++,e.render(),e.scrollToTop();var t=e.container.querySelector(".controles-hierarchy");t&&t.classList.add("ges-transition-enter")}),300)}}},{key:"saltarGes",value:function(){this.navegarGesSiguiente()}},{key:"finalizarControles",value:function(){var e=new CustomEvent("controles:completed",{bubbles:!0,detail:{cargoIndex:this.currentCargoIndex,gesIndex:this.currentGesIndex}});this.container.dispatchEvent(e)}},{key:"scrollToTop",value:function(){this.container&&this.container.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"getCompletionStats",value:function(){var e=this.state.getCargos(),t=0,n=0;return e.forEach((function(e){e.ges&&e.ges.forEach((function(e){t++;var a=e.controles||{};Object.values(a).some((function(e){return e&&e.trim().length>0}))&&n++}))})),{totalGES:t,gesWithControles:n,percentage:t>0?Math.round(n/t*100):0}}},{key:"showToast",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;document.querySelectorAll(".toast-notification").forEach((function(e){return e.remove()}));var a=document.createElement("div");a.className="toast-notification ".concat(t),a.setAttribute("role","alert"),a.setAttribute("aria-live","polite");var i={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};a.innerHTML='\n      <i class="'.concat(i[t]||i.info,'"></i>\n      <span class="toast-message">').concat(e,'</span>\n      <button class="toast-close" aria-label="Cerrar notificación">\n        <i class="fas fa-times"></i>\n      </button>\n    '),document.body.appendChild(a),a.querySelector(".toast-close").addEventListener("click",(function(){a.classList.add("hiding"),setTimeout((function(){return a.remove()}),300)})),setTimeout((function(){document.body.contains(a)&&(a.classList.add("hiding"),setTimeout((function(){return a.remove()}),300))}),n)}},{key:"handleLoadSugerencias",value:(e=r(s().mark((function e(){var t,n,a,i,r,o,c,l,d,u,p,f,v,g,h,m,b=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.container.querySelector("#btn-cargar-sugerencias")){e.next=3;break}return e.abrupt("return");case 3:if(e.prev=3,n=this.state.getCargos(),a=n[this.currentCargoIndex]){e.next=8;break}return e.abrupt("return");case 8:if(i=a.ges[this.currentGesIndex]){e.next=11;break}return e.abrupt("return");case 11:return r=i.nombre,t.disabled=!0,t.classList.add("wizard-btn-loading"),t.setAttribute("aria-busy","true"),o=t.innerHTML,e.next=19,fetch("/api/catalogo/ges?search=".concat(encodeURIComponent(r),"&limit=5"));case 19:return c=e.sent,e.next=22,c.json();case 22:if((l=e.sent).success&&l.data&&0!==l.data.length){e.next=30;break}return this.showToast('No se encontraron sugerencias predefinidas para "'.concat(r,'". Puedes ingresarlas manualmente.'),"warning",6e3),t.disabled=!1,t.classList.remove("wizard-btn-loading"),t.setAttribute("aria-busy","false"),t.innerHTML=o,e.abrupt("return");case 30:if(d=l.data.find((function(e){return e.nombre.toLowerCase().trim()===r.toLowerCase().trim()})),d){e.next=38;break}return this.showToast('No se encontró coincidencia exacta para "'.concat(r,'"'),"warning",6e3),t.disabled=!1,t.classList.remove("wizard-btn-loading"),t.setAttribute("aria-busy","false"),t.innerHTML=o,e.abrupt("return");case 38:return e.next=40,fetch("/api/catalogo/ges/".concat(d.id));case 40:return u=e.sent,e.next=43,u.json();case 43:if((p=e.sent).success&&p.data){e.next=51;break}return this.showToast('No se pudieron cargar los detalles para "'.concat(r,'"'),"error"),t.disabled=!1,t.classList.remove("wizard-btn-loading"),t.setAttribute("aria-busy","false"),t.innerHTML=o,e.abrupt("return");case 51:if(f=p.data,v=f.medidas_intervencion){e.next=60;break}return this.showToast('El GES "'.concat(r,'" no tiene medidas de intervención predefinidas'),"warning"),t.disabled=!1,t.classList.remove("wizard-btn-loading"),t.setAttribute("aria-busy","false"),t.innerHTML=o,e.abrupt("return");case 60:g=this.container.querySelectorAll(".control-textarea"),h=0,g.forEach((function(e){var t="";switch(e.dataset.controlType){case"eliminacion":t=v.eliminacion||"";break;case"sustitucion":t=v.sustitucion||"";break;case"controlesIngenieria":t=v.controles_ingenieria||"";break;case"controlesAdministrativos":t=v.controles_administrativos||""}if(t){var n=e.closest(".control-group");e.value=t,e.classList.add("filled"),b.updateCharCount(e),n&&(n.style.animation="none",setTimeout((function(){n.style.animation="fieldHighlight 0.6s ease-out"}),10)),h++}})),this.saveCurrentControles(),t.disabled=!1,t.classList.remove("wizard-btn-loading"),t.setAttribute("aria-busy","false"),t.innerHTML=o,h>0?this.showToast("✓ Se cargaron ".concat(h," medidas de intervención exitosamente"),"success"):this.showToast("No se encontraron medidas predefinidas para este GES","info"),e.next=78;break;case 72:e.prev=72,e.t0=e.catch(3),(m=this.container.querySelector("#btn-cargar-sugerencias"))&&(m.disabled=!1,m.classList.remove("wizard-btn-loading"),m.setAttribute("aria-busy","false")),this.showToast("Error al cargar sugerencias. Por favor, intenta nuevamente.","error");case 78:case"end":return e.stop()}}),e,this,[[3,72]])}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){this.container&&(this.container.innerHTML="")}}]);var e}(),It=i(8491);function Dt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.placement,i=void 0===a?"bottom":a,o=n.offset,c=void 0===o?8:o,l=n.closeOnClickOutside,d=void 0===l||l,u=n.closeOnEscape,p=void 0===u||u,f=document.createElement("div");f.className="floating-popover",f.setAttribute("role","dialog"),"string"==typeof t?f.innerHTML=t:f.appendChild(t);var v=!1,g=null;function h(){return m.apply(this,arguments)}function m(){return m=r(s().mark((function t(){var n,a,r,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(v){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,(0,It.computePosition)(e,f,{placement:i,middleware:[(0,It.offset)(c),(0,It.flip)(),(0,It.shift)({padding:10}),(0,It.size)({apply:function(e){var t=e.availableWidth,n=e.availableHeight,a=e.elements;Object.assign(a.floating.style,{maxWidth:"".concat(t,"px"),maxHeight:"".concat(n,"px")})}})]});case 4:n=t.sent,a=n.x,r=n.y,o=n.placement,Object.assign(f.style,{left:"".concat(a,"px"),top:"".concat(r,"px")}),f.setAttribute("data-placement",o);case 10:case"end":return t.stop()}}),t)}))),m.apply(this,arguments)}function b(){v||(v=!0,document.body.appendChild(f),g=(0,It.autoUpdate)(e,f,h),h(),requestAnimationFrame((function(){f.classList.add("floating-popover--visible")})),d&&setTimeout((function(){document.addEventListener("click",x)}),0),p&&document.addEventListener("keydown",w))}function y(){v&&(v=!1,f.classList.remove("floating-popover--visible"),g&&(g(),g=null),document.removeEventListener("click",x),document.removeEventListener("keydown",w),setTimeout((function(){!v&&f.parentNode&&f.parentNode.removeChild(f)}),200))}function x(t){f.contains(t.target)||e.contains(t.target)||y()}function w(e){"Escape"===e.key&&y()}return{show:b,hide:y,destroy:function(){g&&(g(),g=null),document.removeEventListener("click",x),document.removeEventListener("keydown",w),f.parentNode&&f.parentNode.removeChild(f),v=!1},toggle:function(){return v?y():b()},element:f}}function zt(e,t,n){var a=document.createElement("div");a.className="wizard-resume-modal",a.setAttribute("role","dialog"),a.setAttribute("aria-modal","true"),a.setAttribute("aria-labelledby","modal-title");var i={"info-basica":"Información Básica",cargos:"Cargos",riesgos:"Riesgos por Cargo",niveles:"Niveles de Riesgo",controles:"Controles de Seguridad",resumen:"Resumen"}[e]||e;a.innerHTML='\n    <div class="modal-overlay" aria-hidden="true"></div>\n    <div class="modal-content">\n      <div class="modal-icon">\n        <i class="fas fa-save"></i>\n      </div>\n      <h3 class="modal-title" id="modal-title">Sesión guardada encontrada</h3>\n      <p class="modal-message">\n        Tienes un progreso guardado en el paso\n        <strong>"'.concat(i,'"</strong>\n      </p>\n      <p class="modal-subtitle">\n        ¿Deseas continuar donde lo dejaste o empezar de nuevo?\n      </p>\n      <div class="modal-actions">\n        <button class="btn-continue cta-button" type="button">\n          <i class="fas fa-play"></i>\n          <span>Continuar</span>\n        </button>\n        <button class="btn-new cta-button-1" type="button">\n          <i class="fas fa-refresh"></i>\n          <span>Empezar de Nuevo</span>\n        </button>\n      </div>\n    </div>\n  ');var r=a.querySelector(".btn-continue"),o=a.querySelector(".btn-new"),s=a.querySelector(".modal-overlay"),c=function(){a.classList.add("modal-closing"),setTimeout((function(){a.remove(),document.body.style.overflow=""}),300)};return r.addEventListener("click",(function(){c(),t()})),o.addEventListener("click",(function(){c(),n()})),s.addEventListener("click",c),a.addEventListener("keydown",(function(e){if("Escape"===e.key&&c(),"Tab"===e.key){var t=a.querySelectorAll("button"),n=t[0],i=t[t.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),i.focus()):e.shiftKey||document.activeElement!==i||(e.preventDefault(),n.focus())}})),document.body.style.overflow="hidden",document.body.appendChild(a),requestAnimationFrame((function(){a.classList.add("modal-visible"),r.focus()})),a}function Pt(e){var t=e.title,n=void 0===t?"¿Estás seguro?":t,a=e.message,i=void 0===a?"":a,r=e.confirmText,o=void 0===r?"Confirmar":r,s=e.cancelText,c=void 0===s?"Cancelar":s,l=e.type,d=void 0===l?"info":l,u=e.onConfirm,p=void 0===u?function(){}:u,f=e.onCancel,v=void 0===f?function(){}:f,g=document.createElement("div");g.className="wizard-confirm-modal",g.setAttribute("role","alertdialog"),g.setAttribute("aria-modal","true"),g.setAttribute("aria-labelledby","confirm-modal-title");var h={info:"fa-info-circle",success:"fa-check-circle",warning:"fa-exclamation-triangle",danger:"fa-exclamation-circle"},m=h[d]||h.info;g.innerHTML='\n    <div class="modal-overlay" aria-hidden="true"></div>\n    <div class="modal-content modal-content--'.concat(d,'">\n      <div class="modal-icon modal-icon--').concat(d,'">\n        <i class="fas ').concat(m,'"></i>\n      </div>\n      <h3 class="modal-title" id="confirm-modal-title">').concat(n,"</h3>\n      ").concat(i?'<p class="modal-message">'.concat(i,"</p>"):"",'\n      <div class="modal-actions">\n        <button class="btn-cancel cta-button-1" type="button">\n          <span>').concat(c,'</span>\n        </button>\n        <button class="btn-confirm cta-button btn-confirm--').concat(d,'" type="button">\n          <span>').concat(o,"</span>\n        </button>\n      </div>\n    </div>\n  ");var b=g.querySelector(".btn-confirm"),y=g.querySelector(".btn-cancel"),x=g.querySelector(".modal-overlay"),w=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];g.classList.add("modal-closing"),setTimeout((function(){g.remove(),document.body.style.overflow=""}),300),e?p():v()};return b.addEventListener("click",(function(){return w(!0)})),y.addEventListener("click",(function(){return w(!1)})),x.addEventListener("click",(function(){return w(!1)})),g.addEventListener("keydown",(function(e){"Escape"===e.key&&w(!1)})),document.body.style.overflow="hidden",document.body.appendChild(g),requestAnimationFrame((function(){g.classList.add("modal-visible"),b.focus()})),g}function jt(e){var t=e.message,n=void 0===t?"":t,a=e.type,i=void 0===a?"info":a,r=e.duration,o=void 0===r?3e3:r,s=document.createElement("div");s.className="wizard-toast wizard-toast--".concat(i),s.setAttribute("role","alert"),s.setAttribute("aria-live","polite");var c={info:"fa-info-circle",success:"fa-check-circle",warning:"fa-exclamation-triangle",danger:"fa-times-circle"},l=c[i]||c.info;s.innerHTML='\n    <div class="toast-icon">\n      <i class="fas '.concat(l,'"></i>\n    </div>\n    <div class="toast-message">').concat(n,'</div>\n    <button class="toast-close" type="button" aria-label="Cerrar notificación">\n      <i class="fas fa-times"></i>\n    </button>\n  ');var d=function(){s.classList.add("toast-closing"),setTimeout((function(){return s.remove()}),300)};s.querySelector(".toast-close").addEventListener("click",d);var u=document.querySelector(".wizard-toast-container");return u||((u=document.createElement("div")).className="wizard-toast-container",u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),document.body.appendChild(u)),u.appendChild(s),requestAnimationFrame((function(){return s.classList.add("toast-visible")})),o>0&&setTimeout(d,o),s}var qt=function(){return f((function e(t){u(this,e),this.state=t,this.currentPopover=null,this.currentCargoIndex=null}),[{key:"showEditPopover",value:function(e,t,n){var a=this;this.currentPopover&&(this.currentPopover.hide(),this.currentPopover.destroy(),this.currentPopover=null,this.currentCargoIndex=null),this.currentCargoIndex=t;var i=this.state.getCargo(t);if(i){var r=this.createPopoverContent(i,t);this.currentPopover=Dt(e,r,{placement:"bottom",offset:8,closeOnClickOutside:!1,closeOnEscape:!0}),this.currentPopover.element.classList.add("floating-popover--cargo-edit"),this.currentPopover.show(),this.attachEventListeners(t,n),setTimeout((function(){var e=a.currentPopover.element.querySelector("#edit-cargo-nombre");e&&e.focus()}),100)}}},{key:"createPopoverContent",value:function(e,t){var n=document.createElement("div"),a=[{name:"tareasRutinarias",icon:"fa-repeat",label:"Tareas repetitivas",severity:"warning",hint:"Puede requerir pausas activas y rotación de tareas"},{name:"conduceVehiculo",icon:"fa-car",label:"Conduce vehículo",severity:"warning",hint:"Requiere licencia de conducción vigente"},{name:"manipulaAlimentos",icon:"fa-utensils",label:"Manipula alimentos",severity:"danger",hint:"Requiere certificado de manipulación de alimentos vigente"},{name:"trabajaAlturas",icon:"fa-arrow-up",label:"Trabaja en alturas",severity:"danger",hint:"Requiere certificado de trabajo en alturas y EPP especializado"},{name:"trabajaEspaciosConfinados",icon:"fa-door-closed",label:"Espacios confinados",severity:"danger",hint:"Requiere permiso de trabajo y monitor de gases continuo"}].map((function(t){return'\n      <div class="toggle-group toggle-group--'.concat(t.severity,'">\n        <div class="toggle-header">\n          <div class="toggle-label-wrapper">\n            <i class="fas ').concat(t.icon," toggle-icon toggle-icon--").concat(t.severity,'"></i>\n            <span class="toggle-label">').concat(t.label,'</span>\n          </div>\n          <div class="wizard-switch wizard-switch--').concat(t.severity,'">\n            <input\n              type="checkbox"\n              name="').concat(t.name,'"\n              id="edit-cargo-').concat(t.name,'"\n              ').concat(e[t.name]?"checked":"",'\n            />\n            <span class="slider"></span>\n          </div>\n        </div>\n        <div class="toggle-hint">\n          <i class="fas fa-info-circle"></i>\n          ').concat(t.hint,"\n        </div>\n      </div>\n    ")})).join("");return n.innerHTML='\n      <div class="floating-popover__header">\n        <h3>Editar Cargo</h3>\n        <div class="floating-popover__header-actions">\n          <button type="button" class="btn btn--primary btn--compact" data-action="save-edit">\n            <i class="fas fa-save"></i> Guardar\n          </button>\n          <button class="floating-popover__close" data-action="close-edit">\n            &times;\n          </button>\n        </div>\n      </div>\n      <div class="floating-popover__body floating-popover__body--two-cols">\n        <form id="edit-cargo-form" class="cargo-edit-form">\n          \x3c!-- Columna Izquierda: Información Básica --\x3e\n          <div class="floating-popover__col floating-popover__col--basic">\n            <div class="form-group">\n              <label for="edit-cargo-nombre">\n                Nombre del Cargo <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-nombre"\n                name="nombre"\n                class="form-input"\n                value="'.concat(e.nombre,'"\n                placeholder="Ej: Operario de Producción"\n                required\n                minlength="3"\n                maxlength="100"\n              />\n              <span class="error-message" id="error-nombre"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-numPersonas">\n                Número de Trabajadores <span class="required">*</span>\n              </label>\n              <input\n                type="number"\n                id="edit-cargo-numPersonas"\n                name="numPersonas"\n                class="form-input"\n                value="').concat(e.numPersonas,'"\n                min="1"\n                max="9999"\n                required\n              />\n              <span class="error-message" id="error-numPersonas"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-area">\n                Área en la empresa <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-area"\n                name="area"\n                class="form-input"\n                value="').concat(e.area||"",'"\n                placeholder="Ej: Producción, Administración, Ventas"\n                required\n                maxlength="100"\n              />\n              <span class="error-message" id="error-area"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-zona">\n                Zona o lugar <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-zona"\n                name="zona"\n                class="form-input"\n                value="').concat(e.zona||"",'"\n                placeholder="Ej: Planta 1, Oficina central, Bodega 3"\n                required\n                maxlength="100"\n              />\n              <span class="error-message" id="error-zona"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-descripcion">\n                Descripción (opcional)\n              </label>\n              <textarea\n                id="edit-cargo-descripcion"\n                name="descripcion"\n                class="form-input"\n                placeholder="Descripción breve de las funciones del cargo..."\n                rows="4"\n                maxlength="500"\n              >').concat(e.descripcion||"",'</textarea>\n              <span class="form-hint">').concat((e.descripcion||"").length,'/500 caracteres</span>\n            </div>\n          </div>\n\n          \x3c!-- Columna Derecha: Características Especiales --\x3e\n          <div class="floating-popover__col floating-popover__col--toggles">\n            <div class="form-group">\n              <label class="form-label-section">\n                <i class="fas fa-shield-alt"></i>\n                Características especiales\n              </label>\n              <div class="toggles-grid-modern">\n                ').concat(a,"\n              </div>\n            </div>\n          </div>\n        </form>\n      </div>\n    "),n}},{key:"attachEventListeners",value:function(e,t){var n=this,a=this.currentPopover.element;a.querySelector('[data-action="close-edit"]').addEventListener("click",(function(){return n.closePopover()}));var i=a.querySelector('[data-action="save-edit"]');i.addEventListener("click",(function(){return n.handleSave(e,t)}));var r=a.querySelector("#edit-cargo-descripcion"),o=a.querySelector(".form-hint");r.addEventListener("input",(function(e){o.textContent="".concat(e.target.value.length,"/500 caracteres")})),a.querySelector("#edit-cargo-nombre").addEventListener("input",(function(){return n.validateField("nombre",e)})),a.querySelector("#edit-cargo-numPersonas").addEventListener("input",(function(){return n.validateField("numPersonas",e)})),a.querySelector("#edit-cargo-area").addEventListener("input",(function(){return n.validateField("area",e)})),a.querySelector("#edit-cargo-zona").addEventListener("input",(function(){return n.validateField("zona",e)})),a.addEventListener("keydown",(function(e){"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),i.click())}))}},{key:"validateField",value:function(e,t){var n=this.currentPopover.element,a=n.querySelector("#edit-cargo-".concat(e)),i=n.querySelector("#error-".concat(e));if(!a||!i)return!0;var r=a.value.trim(),o="";if("nombre"===e)r.length<3?o="El nombre debe tener al menos 3 caracteres":this.state.isCargoNameUnique(r,t)||(o="Ya existe un cargo con ese nombre");else if("numPersonas"===e){var s=parseInt(r,10);(isNaN(s)||s<1)&&(o="Debe haber al menos 1 persona")}else"area"===e?r.length<2&&(o="El área debe tener al menos 2 caracteres"):"zona"===e&&r.length<2&&(o="La zona debe tener al menos 2 caracteres");return o?(i.textContent=o,i.style.display="block",a.classList.add("input-error"),!1):(i.textContent="",i.style.display="none",a.classList.remove("input-error"),!0)}},{key:"validateForm",value:function(e){var t=this.validateField("nombre",e),n=this.validateField("numPersonas",e),a=this.validateField("area",e),i=this.validateField("zona",e);return t&&n&&a&&i}},{key:"handleSave",value:(e=r(s().mark((function e(t,n){var a,i,r,o,c,l,d,u,p,f,v,g,h,m,b=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.validateForm(t)){e.next=3;break}return e.abrupt("return");case 3:if(a=this.currentPopover.element,(i=a.querySelector('[data-action="save-edit"]')).disabled=!0,i.innerHTML='<i class="fas fa-spinner fa-spin"></i> Guardando...',e.prev=7,r=a.querySelector("#edit-cargo-nombre").value.trim(),o=parseInt(a.querySelector("#edit-cargo-numPersonas").value,10),c=a.querySelector("#edit-cargo-area").value.trim(),l=a.querySelector("#edit-cargo-zona").value.trim(),d=a.querySelector("#edit-cargo-descripcion").value.trim(),u=a.querySelector("#edit-cargo-tareasRutinarias").checked,p=a.querySelector("#edit-cargo-manipulaAlimentos").checked,f=a.querySelector("#edit-cargo-trabajaAlturas").checked,v=a.querySelector("#edit-cargo-trabajaEspaciosConfinados").checked,g=a.querySelector("#edit-cargo-conduceVehiculo").checked,(h=this.state.updateCargo(t,{nombre:r,numPersonas:o,area:c,zona:l,descripcion:d,tareasRutinarias:u,manipulaAlimentos:p,trabajaAlturas:f,trabajaEspaciosConfinados:v,conduceVehiculo:g})).success){e.next=21;break}throw new Error(h.error);case 21:m=i.innerHTML,i.innerHTML='<i class="fas fa-check"></i> Guardado',i.classList.add("btn--success"),i.disabled=!0,setTimeout((function(){i.innerHTML=m,i.classList.remove("btn--success"),i.disabled=!1,b.closePopover(),setTimeout((function(){n&&n(t)}),50)}),800),e.next=35;break;case 29:e.prev=29,e.t0=e.catch(7),jt({message:"Error al guardar: ".concat(e.t0.message),type:"danger",duration:5e3}),i.disabled=!1,i.innerHTML='<i class="fas fa-save"></i> Guardar';case 35:case"end":return e.stop()}}),e,this,[[7,29]])}))),function(t,n){return e.apply(this,arguments)})},{key:"closePopover",value:function(){var e=this;this.currentPopover&&(this.currentPopover.hide(),setTimeout((function(){e.currentPopover&&(e.currentPopover.destroy(),e.currentPopover=null,e.currentCargoIndex=null)}),250))}},{key:"destroy",value:function(){this.closePopover()}}]);var e}(),Rt=function(){return f((function e(t){u(this,e),this.button=t,this.tooltip=null,this.arrowElement=null,this.isShowing=!1,window.innerWidth>768&&!("ontouchstart"in window)&&this.init()}),[{key:"init",value:function(){var e=this;this.button.addEventListener("mouseenter",(function(){return e.show()})),this.button.addEventListener("mouseleave",(function(){return e.hide()})),this.button.addEventListener("focus",(function(){return e.show()})),this.button.addEventListener("blur",(function(){return e.hide()}))}},{key:"show",value:(t=r(s().mark((function e(){var t,n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.button.dataset.keyboardShortcut)&&!this.isShowing){e.next=3;break}return e.abrupt("return");case 3:return this.isShowing=!0,this.tooltip=document.createElement("div"),this.tooltip.className="floating-tooltip floating-tooltip--keyboard",this.tooltip.setAttribute("role","tooltip"),this.tooltip.innerHTML='\n      <div class="tooltip-content">\n        <i class="fas fa-keyboard"></i>\n        <span>'.concat(t,'</span>\n      </div>\n      <div class="floating-tooltip__arrow"></div>\n    '),document.body.appendChild(this.tooltip),this.arrowElement=this.tooltip.querySelector(".floating-tooltip__arrow"),e.next=12,this.updatePosition();case 12:requestAnimationFrame((function(){n.tooltip&&n.tooltip.classList.add("floating-tooltip--visible")}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updatePosition",value:(e=r(s().mark((function e(){var t,n,a,i,r,o,c,l,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tooltip&&this.button){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,It.computePosition)(this.button,this.tooltip,{placement:"top",middleware:[(0,It.offset)(8),(0,It.flip)(),(0,It.shift)({padding:5}),(0,It.arrow)({element:this.arrowElement})]});case 4:t=e.sent,n=t.x,a=t.y,i=t.placement,r=t.middlewareData,Object.assign(this.tooltip.style,{left:"".concat(n,"px"),top:"".concat(a,"px")}),r.arrow&&(o=r.arrow,c=o.x,l=o.y,u={top:"bottom",right:"left",bottom:"top",left:"right"}[i.split("-")[0]],Object.assign(this.arrowElement.style,d({left:null!=c?"".concat(c,"px"):"",top:null!=l?"".concat(l,"px"):"",right:"",bottom:""},u,"-4px")));case 11:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"hide",value:function(){var e=this;this.tooltip&&(this.isShowing=!1,this.tooltip.classList.remove("floating-tooltip--visible"),setTimeout((function(){e.tooltip&&e.tooltip.parentNode&&(e.tooltip.remove(),e.tooltip=null,e.arrowElement=null)}),200))}},{key:"destroy",value:function(){this.hide()}}]);var e,t}();function Ot(e){Array.isArray(e)&&e.forEach((function(e){return e.destroy()}))}function Gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ft=function(){return f((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(u(this,e),this.container=document.querySelector(t),!this.container)throw new Error("Container not found: ".concat(t));this.state=n||b(),this.unsubscribe=null,this.currentStepComponent=null,this.riesgoSelectors={},this.nivelesForm=null,this.controlesManager=null,this.cargoEditor=new qt(this.state),this.previousStep=null,this.carouselIndex=0,this.fabCleanup=null,this.keyboardHandler=null,this.keyboardTooltips=null,this.selfManagedSteps=new Set(["info-basica","cargos","riesgos","niveles"]),this.steps=[{id:"info-basica",title:"Información Básica",description:"Comencemos con los datos de tu empresa",icon:"fas fa-building",component:this.renderInfoBasica.bind(this)},{id:"cargos",title:"Cargos",description:"Agrega los puestos de trabajo de tu empresa",icon:"fas fa-users",component:this.renderCargos.bind(this)},{id:"riesgos",title:"Riesgos por Cargo",description:"Selecciona los riesgos (GES) para cada cargo",icon:"fas fa-exclamation-triangle",component:this.renderRiesgos.bind(this)},{id:"niveles",title:"Niveles y Controles",description:"Configura niveles de riesgo (ND, NE, NC) y controles existentes",icon:"fas fa-chart-bar",component:this.renderNiveles.bind(this)},{id:"resumen",title:"Resumen y Envío",description:"Revisa y genera tus documentos",icon:"fas fa-check-circle",component:this.renderResumen.bind(this)}]}),[{key:"init",value:function(){var e=this;this.unsubscribe=this.state.subscribe((function(t){var n=t.currentStep;if(n!==e.previousStep)return"niveles"===e.previousStep&&"niveles"!==n&&e.cleanupNivelesFormCache(),e.previousStep=n,void e.render();e.selfManagedSteps.has(n)?e.updateContextBar():e.render()})),this.keyboardHandler=this.handleKeyboardShortcuts.bind(this),document.addEventListener("keydown",this.keyboardHandler),this.previousStep=this.state.getCurrentStep(),this.render()}},{key:"destroy",value:function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.keyboardTooltips&&(Ot(this.keyboardTooltips),this.keyboardTooltips=null),this.cleanupNivelesFormCache()}},{key:"cleanupNivelesFormCache",value:function(){this.nivelesFormCache&&(Object.values(this.nivelesFormCache).forEach((function(e){e&&"function"==typeof e.destroy&&e.destroy()})),this.nivelesFormCache={}),this.nivelesForm=null}},{key:"handleKeyboardShortcuts",value:function(e){var t=document.activeElement;if(!(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||t.isContentEditable))&&!document.querySelector(".wizard-modal")){var n=this.state.getCurrentStep();return"Enter"!==e.key||e.shiftKey?"Enter"===e.key&&e.shiftKey?(e.preventDefault(),void this.handleBack()):void 0:(e.preventDefault(),void this.handleNext(n))}}},{key:"forceRender",value:function(){this.render()}},{key:"render",value:function(){var e=this.state.getCurrentStep(),t=this.steps.find((function(t){return t.id===e}));if(t){this.container.innerHTML="";var n=document.createElement("div");n.className="wizard-wrapper";var a=document.createElement("div");a.className="wizard-header";var i=this.renderBrandingHeader();a.appendChild(i);var r=this.renderUnifiedProgressBar(e);a.appendChild(r),n.appendChild(a);var o=this.renderComicBubble();n.appendChild(o);var s=document.createElement("div");s.className="wizard-content",s.innerHTML=t.component(),n.appendChild(s);var c=this.renderNavigation(e);n.appendChild(c),this.container.appendChild(n),this.attachEventListeners(e)}else this.container.innerHTML=this.renderError("Paso desconocido")}},{key:"calculateRemainingTime",value:function(e){for(var t={"info-basica":3,cargos:5,riesgos:8,niveles:6,controles:4,resumen:2},n=0,a=e+1;a<this.steps.length;a++){n+=t[this.steps[a].id]||3}return n}},{key:"renderBrandingHeader",value:function(){var e=document.createElement("div");return e.className="wizard-branding-header",e.innerHTML='\n      <div class="wizard-branding-content">\n        <div class="wizard-logo">\n          <a href="../index.html" aria-label="Volver al inicio">\n            <img src="../assets/images/logo_negro_vectores.svg"\n                 alt="Genesys Medicina Laboral"\n                 loading="eager">\n          </a>\n        </div>\n        <div class="wizard-title-group">\n          <h1 class="wizard-title">\n            <i class="fas fa-clipboard-list"></i>\n            Asistente de Matriz de Riesgos\n          </h1>\n          <p class="wizard-subtitle">\n            Genera tu matriz profesional en 6 pasos sencillos\n          </p>\n        </div>\n      </div>\n      <div class="wizard-header-actions">\n        <button id="btn-import-json" class="wizard-import-btn" type="button" title="Importar datos desde JSON">\n          <i class="fas fa-file-import"></i>\n          <span>Importar JSON</span>\n        </button>\n      </div>\n    ',e}},{key:"renderUnifiedProgressBar",value:function(e){var t=this.steps.findIndex((function(t){return t.id===e})),n=(t+1)/this.steps.length*100,a=(this.state.data.formData,(this.state.data.formData.cargos||[]).reduce((function(e,t){var n;return e+((null===(n=t.ges)||void 0===n?void 0:n.length)||0)}),0),document.createElement("div"));return a.className="wizard-progress-unified",a.id="wizard-progress-unified",a.innerHTML='\n      <div class="wizard-progress-unified-content">\n\n        \x3c!-- Left: Spacer (botón "Volver" removido - ya hay botones "Anterior") --\x3e\n        <div class="progress-left">\n          <div class="progress-spacer"></div>\n        </div>\n\n        \x3c!-- Center: Step Dots + Progress Bar --\x3e\n        <div class="progress-center">\n          <div class="wizard-progress-steps">\n            '.concat(this.steps.map((function(e,n){var a="wizard-progress-step";return n<t&&(a+=" completed"),n===t&&(a+=" active"),'\n                <div class="'.concat(a,'"\n                     data-step="').concat(e.id,'"\n                     role="button"\n                     tabindex="0"\n                     aria-label="').concat(e.title).concat(n<t?" - Completado":n===t?" - Paso actual":"",'"\n                     title="').concat(e.title,'">\n                  <i class="').concat(e.icon,'"></i>\n                  <span class="step-tooltip">').concat(e.title,"</span>\n                </div>\n              ")})).join(""),'\n          </div>\n\n          <div class="wizard-progress-bar-track">\n            <div class="wizard-progress-bar-fill"\n                 style="width: ').concat(n,'%"\n                 role="progressbar"\n                 aria-valuenow="').concat(n,'"\n                 aria-valuemin="0"\n                 aria-valuemax="100"\n                 aria-label="Progreso: ').concat(Math.round(n),'%">\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Right: Placeholder (comic bubble ahora es fixed) --\x3e\n        <div class="progress-right">\n          \x3c!-- Espacio reservado para balance visual --\x3e\n        </div>\n\n      </div>\n    '),a}},{key:"renderComicBubble",value:function(){var e=this.state.data.formData,t=this.state.data.formData.cargos||[],n=t.reduce((function(e,t){var n;return e+((null===(n=t.ges)||void 0===n?void 0:n.length)||0)}),0),a=t.reduce((function(e,t){return e+(parseInt(t.numPersonas)||0)}),0),i=document.getElementById("wizard-comic-bubble");if(i){var r=i.querySelector(".company-name");r&&e.nombreEmpresa&&(r.textContent=e.nombreEmpresa);var o=i.querySelectorAll(".stat-value");return o.length>=3&&(o[0].textContent=t.length,o[1].textContent=a,o[2].textContent=n),i}return(i=document.createElement("div")).className="wizard-comic-bubble",i.id="wizard-comic-bubble",i.innerHTML='\n      <div class="comic-bubble-content">\n        '.concat(e.nombreEmpresa?'\n          <div class="comic-bubble-company">\n            <i class="fas fa-building"></i>\n            <span class="company-name">'.concat(e.nombreEmpresa,"</span>\n          </div>\n        "):"",'\n\n        <div class="comic-bubble-stats">\n          <div class="stat-item">\n            <i class="fas fa-user-tie"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(t.length,'</span>\n              <span class="stat-label">Cargos</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-users"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(a,'</span>\n              <span class="stat-label">Trabajadores</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(n,'</span>\n              <span class="stat-label">Riesgos</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Cola SVG triángulo simple con punta hacia abajo (sin borde superior) --\x3e\n      <svg class="comic-bubble-tail" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Triángulo relleno --\x3e\n        <polygon points="0,0 20,0 10,15" fill="#ffffff"/>\n        \x3c!-- Bordes laterales (sin la línea superior) --\x3e\n        <line x1="0" y1="0" x2="10" y2="15" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round"/>\n        <line x1="20" y1="0" x2="10" y2="15" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round"/>\n      </svg>\n    '),i}},{key:"renderProgressBar",value:function(e){return this.renderUnifiedProgressBar(e)}},{key:"renderContextBar",value:function(){var e=this.state.data.formData,t=this.state.data.formData.cargos||[],n=t.reduce((function(e,t){var n;return e+((null===(n=t.ges)||void 0===n?void 0:n.length)||0)}),0),a=document.createElement("div");return a.className="wizard-context-bar",a.id="wizard-context-bar",a.innerHTML='\n      <div class="context-bar-content" id="wizard-context-content">\n        '.concat(e.nombreEmpresa?'\n          <div class="context-item context-item--empresa">\n            <i class="fas fa-building"></i>\n            <div class="context-item-info">\n              <span class="context-item-label">Empresa</span>\n              <span class="context-item-value">'.concat(e.nombreEmpresa,"</span>\n            </div>\n          </div>\n        "):"",'\n\n        <div class="context-item context-item--cargos">\n          <i class="fas fa-users"></i>\n          <div class="context-item-info">\n            <span class="context-item-label">Cargos</span>\n            <span class="context-item-value">').concat(t.length,'</span>\n          </div>\n        </div>\n\n        <div class="context-item context-item--riesgos">\n          <i class="fas fa-exclamation-triangle"></i>\n          <div class="context-item-info">\n            <span class="context-item-label">Riesgos</span>\n            <span class="context-item-value">').concat(n,"</span>\n          </div>\n        </div>\n      </div>\n    "),a}},{key:"updateContextBar",value:function(){var e=document.getElementById("wizard-comic-bubble");if(e){var t=this.state.data.formData,n=this.state.data.formData.cargos||[],a=n.reduce((function(e,t){var n;return e+((null===(n=t.ges)||void 0===n?void 0:n.length)||0)}),0),i=n.reduce((function(e,t){return e+(parseInt(t.numPersonas)||0)}),0),r=e.querySelector(".comic-bubble-content");r&&(r.innerHTML="\n        ".concat(t.nombreEmpresa?'\n          <div class="comic-bubble-company">\n            <i class="fas fa-building"></i>\n            <span class="company-name">'.concat(t.nombreEmpresa,"</span>\n          </div>\n        "):"",'\n\n        <div class="comic-bubble-stats">\n          <div class="stat-item">\n            <i class="fas fa-user-tie"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(n.length,'</span>\n              <span class="stat-label">Cargos</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-users"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(i,'</span>\n              <span class="stat-label">Trabajadores</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(a,'</span>\n              <span class="stat-label">Riesgos</span>\n            </div>\n          </div>\n        </div>\n      '),e.classList.add("bounce-update"),setTimeout((function(){e.classList.remove("bounce-update")}),500))}}},{key:"renderNavigation",value:function(e){var t=this,n=this.steps.findIndex((function(t){return t.id===e})),a=0===n,i=n===this.steps.length-1,r=document.createElement("div");return r.className="wizard-navigation",r.innerHTML="\n      ".concat(a?"":'\n        <button class="wizard-btn wizard-btn-back"\n                data-action="back"\n                data-keyboard-shortcut="Shift + Enter">\n          <i class="fas fa-arrow-left"></i>\n          Anterior\n        </button>\n      ','\n\n      <button class="wizard-btn wizard-btn-next"\n              data-action="next"\n              data-keyboard-shortcut="Enter">\n        ').concat(i?"Generar Documentos":"Siguiente","\n        ").concat(i?'<i class="fas fa-paper-plane"></i>':'<i class="fas fa-arrow-right"></i>',"\n      </button>\n    "),setTimeout((function(){var e,n;t.keyboardTooltips&&Ot(t.keyboardTooltips),t.keyboardTooltips=(e=document.querySelectorAll("[data-keyboard-shortcut]"),n=[],e.forEach((function(e){var t=new Rt(e);n.push(t)})),n)}),0),r}},{key:"renderError",value:function(e){return'\n      <div class="wizard-error">\n        <div class="error-content">\n          <strong>Error</strong>\n          <p>'.concat(e,"</p>\n        </div>\n      </div>\n    ")}},{key:"renderInfoBasica",value:function(){var e,t=this.state.data.formData,n=this.state.data.catalogos;return'\n      <div class="wizard-step" data-step="info-basica">\n        <div class="wizard-step-header">\n          <h2>\n            <i class="fas fa-building wizard-icon wizard-icon--primary"></i>\n            Información Básica de tu Empresa\n          </h2>\n          <p>Comencemos con los datos esenciales de tu organización</p>\n        </div>\n\n        <div class="wizard-form">\n          \x3c!-- Grid de 2 columnas en desktop, 1 en mobile --\x3e\n          <div class="wizard-form-grid">\n            \x3c!-- Nombre (ancho completo) --\x3e\n            <div class="form-group form-group--full-width">\n              <label for="nombreEmpresa" class="form-label-with-help">\n                <span class="form-label-text">Nombre de la Empresa *</span>\n                <button type="button" class="wizard-help-button"\n                  data-tooltip="Nombre legal completo de la empresa"\n                  data-tooltip-placement="right"\n                  aria-label="Ayuda">\n                  <i class="fas fa-question-circle"></i>\n                </button>\n              </label>\n              <input\n                type="text"\n                id="nombreEmpresa"\n                name="nombreEmpresa"\n                value="'.concat(t.nombreEmpresa||"",'"\n                placeholder="Ej: Constructora XYZ S.A.S."\n                required\n              />\n            </div>\n\n            \x3c!-- NIT --\x3e\n            <div class="form-group">\n              <label for="nit">NIT *</label>\n              <input\n                type="text"\n                id="nit"\n                name="nit"\n                value="').concat(t.nit||"",'"\n                placeholder="Ej: 900123456"\n                pattern="[0-9]{9,10}"\n                aria-describedby="hint-nit"\n                required\n              />\n              <div class="wizard-hint" id="hint-nit">\n                <i class="fas fa-info-circle"></i>\n                Solo números, entre 9 y 10 dígitos\n              </div>\n            </div>\n\n            \x3c!-- Email --\x3e\n            <div class="form-group">\n              <label for="email">Email de Contacto *</label>\n              <input\n                type="email"\n                id="email"\n                name="email"\n                value="').concat(t.email||"",'"\n                placeholder="contacto@empresa.com"\n                required\n              />\n            </div>\n\n            \x3c!-- Sector Económico con UX mejorada --\x3e\n            <div class="form-group form-group--sector-animated ').concat(t.ciiuSeccion?"sector-selected":"",'" id="sector-container">\n              \n              \x3c!-- Estado inicial: Solo dropdown de sector --\x3e\n              <div class="sector-initial ').concat(t.ciiuSeccion?"hidden":"",'" id="sector-initial">\n                <label for="ciiuSeccion" class="form-label-with-help">\n                  <span class="form-label-text">Sector Económico *</span>\n                  <button type="button" class="wizard-help-button"\n                    data-tooltip="Clasificación CIIU según la DIAN"\n                    data-tooltip-placement="right"\n                    aria-label="Ayuda">\n                    <i class="fas fa-question-circle"></i>\n                  </button>\n                </label>\n                <select\n                  id="ciiuSeccion"\n                  name="ciiuSeccion"\n                  class="wizard-enhanced-select wizard-select-sector"\n                  aria-describedby="hint-ciiu-seccion"\n                  required>\n                  <option value="">Selecciona tu sector económico...</option>\n                  ').concat((n.ciiuSecciones||[]).map((function(e){return'\n                    <option value="'.concat(e.codigo,'" ').concat(t.ciiuSeccion===e.codigo?"selected":"",">\n                      ").concat(e.nombre,"\n                    </option>\n                  ")})).join(""),'\n                </select>\n                <div class="wizard-hint" id="hint-ciiu-seccion">\n                  <i class="fas fa-info-circle"></i>\n                  Categoría principal según clasificación DIAN\n                </div>\n              </div>\n\n              \x3c!-- Estado después de seleccionar: Sector como badge editable + Dropdown actividad --\x3e\n              <div class="sector-selected-view ').concat(t.ciiuSeccion?"":"hidden",'" id="sector-selected-view">\n                \x3c!-- Badge del sector seleccionado --\x3e\n                <div class="sector-badge" id="sector-badge">\n                  <span class="sector-badge-label">Sector:</span>\n                  <span class="sector-badge-value" id="sector-badge-value">\n                    ').concat(t.ciiuSeccion&&(null===(e=(n.ciiuSecciones||[]).find((function(e){return e.codigo===t.ciiuSeccion})))||void 0===e?void 0:e.nombre)||"",'\n                  </span>\n                  <button type="button" class="sector-edit-btn" id="sector-edit-btn" title="Cambiar sector">\n                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>\n                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>\n                    </svg>\n                  </button>\n                </div>\n\n                \x3c!-- Dropdown de Actividad Económica --\x3e\n                <div class="activity-dropdown-container">\n                  <label for="ciiuDivision" class="form-label-with-help">\n                    <span class="form-label-text">Actividad Económica *</span>\n                    <button type="button" class="wizard-help-button"\n                      data-tooltip="Actividad específica dentro del sector"\n                      data-tooltip-placement="right"\n                      aria-label="Ayuda">\n                      <i class="fas fa-question-circle"></i>\n                    </button>\n                  </label>\n                  <select\n                    id="ciiuDivision"\n                    name="ciiuDivision"\n                    class="wizard-enhanced-select wizard-select-activity"\n                    aria-describedby="hint-ciiu-division"\n                    required>\n                    <option value="">Selecciona tu actividad económica...</option>\n                    \x3c!-- Opciones cargadas dinámicamente --\x3e\n                  </select>\n                  <div class="wizard-hint" id="hint-ciiu-division">\n                    <i class="fas fa-info-circle"></i>\n                    Actividad específica de tu empresa\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Ciudad (con datalist desde BD) --\x3e\n            <div class="form-group">\n              <label for="ciudad">Ciudad *</label>\n              <input\n                type="text"\n                id="ciudad"\n                name="ciudad"\n                list="ciudades-datalist"\n                value="').concat(t.ciudad||"",'"\n                placeholder="Ej: Bogotá"\n                autocomplete="off"\n                required\n              />\n              <datalist id="ciudades-datalist">\n                ').concat((n.ciudades||[]).map((function(e){return'\n                  <option value="'.concat(e.nombre,'" data-departamento="').concat(e.departamento,'">\n                ')})).join(""),'\n              </datalist>\n              <div class="wizard-hint">\n                <i class="fas fa-info-circle"></i>\n                Escribe para buscar tu ciudad\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ')}},{key:"renderCargoCharacteristics",value:function(e){var t=[];return e.tareasRutinarias&&t.push({icon:"fas fa-repeat",label:"Tareas repetitivas",type:"warning"}),e.conduceVehiculo&&t.push({icon:"fas fa-car",label:"Conduce vehículo",type:"warning"}),e.manipulaAlimentos&&t.push({icon:"fas fa-utensils",label:"Manipula alimentos",type:"danger"}),e.trabajaAlturas&&t.push({icon:"fas fa-arrow-up",label:"Trabajo en alturas",type:"danger"}),e.trabajaEspaciosConfinados&&t.push({icon:"fas fa-door-closed",label:"Espacios confinados",type:"danger"}),0===t.length?"":'\n      <div class="cargo-characteristics">\n        '.concat(t.map((function(e){return'\n          <span class="cargo-badge cargo-badge--'.concat(e.type,'">\n            <i class="').concat(e.icon,'"></i>\n            ').concat(e.label,"\n          </span>\n        ")})).join(""),"\n      </div>\n    ")}},{key:"renderCargos",value:function(){var e=this,t=this.state.getCargos(),n=this.carouselIndex||0;return'\n      <div class="wizard-step" data-step="cargos">\n        <h2>Cargos de tu Empresa</h2>\n        <p>Agrega los puestos de trabajo que deseas evaluar</p>\n\n        '.concat(0===t.length?'\n          <div class="wizard-form">\n            <div class="wizard-hint" style="margin-bottom: 3rem;">\n              <i class="fas fa-info-circle"></i>\n              Aún no has agregado ningún cargo\n            </div>\n            <button class="wizard-btn wizard-btn-primary wizard-btn-add-first" data-action="add-cargo" style="display: block; margin: 0 auto; padding: 2rem 4rem; font-size: 1.8rem;">\n              <i class="fas fa-plus" style="margin-right: 1rem;"></i>\n              Agrega acá tu primer cargo\n            </button>\n          </div>\n        ':'\n          \x3c!-- Navigation arrows - OUTSIDE wizard-form --\x3e\n          <button class="carousel-nav carousel-nav--prev" data-action="carousel-prev" '.concat(0===n?"disabled":"",'>\n            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n              <path d="M15 18l-6-6 6-6"/>\n            </svg>\n          </button>\n\n          <button class="carousel-nav carousel-nav--next" data-action="carousel-next" ').concat(n>=t.length-1?"disabled":"",'>\n            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n              <path d="M9 6l6 6-6 6"/>\n            </svg>\n          </button>\n\n          <div class="wizard-form">\n            <div class="cargos-list">\n              \x3c!-- Carousel track --\x3e\n              <div class="cargos-carousel" style="transform: translateX(calc(-').concat(100*n,"% - ").concat(2*n,'rem))">\n                ').concat(t.map((function(t,n){var a;return'\n                  <div class="cargo-card" data-cargo-index="'.concat(n,'">\n                    ').concat(t.area?'<div class="cargo-area">'.concat(t.area,"</div>"):"",'\n                    <div class="cargo-card-header">\n                      <h3>').concat(t.nombre,'</h3>\n                      <div class="cargo-actions">\n                        <button class="btn-icon" data-action="edit-cargo" data-index="').concat(n,'" title="Editar cargo">\n                          <i class="fas fa-edit"></i>\n                        </button>\n                        <button class="btn-icon btn-icon--danger" data-action="remove-cargo" data-index="').concat(n,'" title="Eliminar cargo">\n                          <i class="fas fa-trash"></i>\n                        </button>\n                      </div>\n                    </div>\n                    <div class="cargo-card-body">\n                      \x3c!-- Scrollable description with max height --\x3e\n                      <div class="cargo-description-scroll">\n                        <p>').concat(t.descripcion||"Sin descripción","</p>\n                      </div>\n\n                      \x3c!-- Special characteristics badges --\x3e\n                      ").concat(e.renderCargoCharacteristics(t),'\n\n                      <div class="cargo-meta">\n                        <span><i class="fas fa-user"></i> ').concat(t.numPersonas,' persona(s)</span>\n                        <span><i class="fas fa-exclamation-triangle"></i> ').concat((null===(a=t.gesSeleccionados)||void 0===a?void 0:a.length)||0," riesgo(s)</span>\n                        ").concat(t.zona?'<span><i class="fas fa-map-marker-alt"></i> '.concat(t.zona,"</span>"):"","\n                      </div>\n                    </div>\n                  </div>\n                ")})).join(""),'\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Carousel dots indicator - OUTSIDE wizard-form --\x3e\n          <div class="carousel-dots">\n            ').concat(t.map((function(e,t){return'\n              <button\n                class="carousel-dot '.concat(t===n?"active":"",'"\n                data-action="carousel-goto"\n                data-index="').concat(t,'"\n                aria-label="Ir a cargo ').concat(t+1,'"\n              ></button>\n            ')})).join(""),"\n          </div>\n        "),'\n\n        \x3c!-- FAB (Floating Action Button) - Visible solo cuando hay cargos --\x3e\n        <button\n          class="fab ').concat(0===t.length?"fab--hidden":"",'"\n          data-action="add-cargo"\n          aria-label="Agregar un nuevo cargo"\n        >\n          <span class="fab-text">Agregar un nuevo cargo</span>\n          <svg class="fab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            \x3c!-- Worker icon --\x3e\n            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="white"/>\n            \x3c!-- Plus icon (small, top-right) --\x3e\n            <circle cx="18" cy="6" r="5" fill="white"/>\n            <path d="M18 4v4m-2-2h4" stroke="#5dc4af" stroke-width="1.5" stroke-linecap="round"/>\n          </svg>\n        </button>\n        \x3c!-- Tooltip nativo usando title attribute (eliminado fab-tooltip custom) --\x3e\n\n        \x3c!-- Modal para agregar cargo (hidden by default) --\x3e\n          <div id="modal-add-cargo" class="wizard-modal" style="display: none;">\n            <div class="wizard-modal-content wizard-modal-content--two-cols">\n              <div class="wizard-modal-header">\n                <h3 id="modal-title-cargo">Agregar Nuevo Cargo</h3>\n                <div class="wizard-modal-header-actions">\n                  <button class="wizard-btn wizard-btn-primary wizard-btn-compact" data-action="save-cargo">\n                    <i class="fas fa-save"></i>\n                    Guardar\n                  </button>\n                  <button class="btn-close" data-action="close-modal">\n                    <i class="fas fa-times"></i>\n                  </button>\n                </div>\n              </div>\n              <div class="wizard-modal-body wizard-modal-body--two-cols">\n                \x3c!-- Columna Izquierda: Información Básica --\x3e\n                <div class="wizard-modal-col wizard-modal-col--basic">\n                  <div class="form-group">\n                    <label for="cargo-nombre">Nombre del Cargo *</label>\n                    <input\n                      type="text"\n                      id="cargo-nombre"\n                      placeholder="Ej: Operario de Construcción"\n                      required\n                    />\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-descripcion">Descripción (opcional)</label>\n                    <textarea\n                      id="cargo-descripcion"\n                      rows="4"\n                      placeholder="Breve descripción de las funciones del cargo"\n                    ></textarea>\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-num-personas">Número de Personas *</label>\n                    <input\n                      type="number"\n                      id="cargo-num-personas"\n                      min="1"\n                      value="1"\n                      required\n                    />\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-area">Área o Departamento del Cargo *</label>\n                    <input\n                      type="text"\n                      id="cargo-area"\n                      list="areas-list"\n                      placeholder="Ej: Producción, Administración, etc."\n                      required\n                    />\n                    <datalist id="areas-list">\n                      <option value="Producción">\n                      <option value="Administración">\n                      <option value="Logística">\n                      <option value="Ventas">\n                      <option value="Mantenimiento">\n                      <option value="Calidad">\n                      <option value="Operaciones">\n                      <option value="Recursos Humanos">\n                      <option value="Contabilidad">\n                      <option value="Sistemas">\n                      <option value="Finanzas">\n                      <option value="Compras">\n                      <option value="Almacén">\n                    </datalist>\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-zona">Zona/Lugar de Trabajo *</label>\n                    <input\n                      type="text"\n                      id="cargo-zona"\n                      placeholder="Ej: Planta 1, Oficina Principal, Bodega A"\n                      required\n                    />\n                  </div>\n                </div>\n\n                \x3c!-- Columna Derecha: Características Especiales --\x3e\n                <div class="wizard-modal-col wizard-modal-col--toggles">\n                  <div class="form-group">\n                  <label class="form-label-section">\n                    <i class="fas fa-shield-alt"></i>\n                    Características Especiales\n                  </label>\n                  <div class="toggles-grid-modern">\n                    \x3c!-- Warning toggles (amarillo) --\x3e\n                    <div class="toggle-group toggle-group--warning">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-repeat toggle-icon toggle-icon--warning"></i>\n                          <span class="toggle-label">Tareas repetitivas</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--warning">\n                          <input type="checkbox" id="cargo-tareasRutinarias" name="tareasRutinarias" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Puede requerir pausas activas y rotación de tareas\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--warning">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-car toggle-icon toggle-icon--warning"></i>\n                          <span class="toggle-label">Conduce vehículo</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--warning">\n                          <input type="checkbox" id="cargo-conduceVehiculo" name="conduceVehiculo" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere licencia de conducción vigente\n                      </div>\n                    </div>\n\n                    \x3c!-- Danger toggles (rojo) --\x3e\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-utensils toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Manipula alimentos</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-manipulaAlimentos" name="manipulaAlimentos" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere certificado de manipulación de alimentos vigente\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-arrow-up toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Trabaja en alturas</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-trabajaAlturas" name="trabajaAlturas" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere certificado de trabajo en alturas y EPP especializado\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-door-closed toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Espacios confinados</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-trabajaEspaciosConfinados" name="trabajaEspaciosConfinados" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere permiso de trabajo y monitor de gases continuo\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n      </div>\n    ')}},{key:"renderRiesgos",value:function(){var e=this.state.getCargos();return 0===e.length?'\n        <div class="wizard-step" data-step="riesgos">\n          <div class="wizard-hint" style="margin-top: 5rem;">\n            <i class="fas fa-exclamation-triangle"></i>\n            Debes agregar al menos un cargo antes de seleccionar riesgos.\n          </div>\n        </div>\n      ':1===e.length?'\n        <div class="wizard-step" data-step="riesgos">\n          <div id="riesgo-selector-0" class="riesgo-selector-container"></div>\n        </div>\n      ':'\n      <div class="wizard-step" data-step="riesgos">\n        <h2>Riesgos por Cargo</h2>\n        <p>Selecciona los riesgos para cada uno de tus cargos usando las pestañas</p>\n\n        \x3c!-- P0-3: ARIA attributes para accesibilidad + P1-2: Wrapper para scroll indicators --\x3e\n        <div class="cargo-tabs-wrapper">\n          <div class="cargo-tabs" role="tablist" aria-label="Lista de cargos">\n            '.concat(e.map((function(e,t){var n,a=(null===(n=e.ges)||void 0===n?void 0:n.length)||0,i=a>0;return'\n                <button\n                  class="cargo-tab '.concat(0===t?"active":"",'"\n                  role="tab"\n                  id="cargo-tab-').concat(t,'"\n                  aria-selected="').concat(0===t,'"\n                  aria-controls="cargo-panel-').concat(t,'"\n                  tabindex="').concat(0===t?0:-1,'"\n                  data-action="switch-cargo-tab"\n                  data-cargo-index="').concat(t,'"\n                  data-has-risks="').concat(i,'"\n                  data-cargo-name="').concat(e.nombre,'"\n                >\n                  <span class="cargo-name">').concat(e.nombre,'</span>\n                  <span class="cargo-count" aria-label="').concat(a," ").concat(1===a?"riesgo seleccionado":"riesgos seleccionados",'">\n                    ').concat(a,"\n                  </span>\n                </button>\n              ")})).join(""),'\n          </div>\n        </div>\n\n        \x3c!-- P0-3: Selector containers con role="tabpanel" --\x3e\n        ').concat(e.map((function(e,t){return'\n          <div\n            id="riesgo-selector-'.concat(t,'"\n            class="riesgo-selector-container"\n            role="tabpanel"\n            aria-labelledby="cargo-tab-').concat(t,'"\n            tabindex="0"\n            style="').concat(0===t?"":"display: none;",'"\n          ></div>\n        ')})).join(""),"\n      </div>\n    ")}},{key:"renderNiveles",value:function(){var e=this.state.getCargos(),t='\n      <div class="wizard-step" data-step="niveles">\n    ';return e.length>1&&(t+='\n        <div class="niveles-cargo-tabs">\n          '.concat(e.map((function(e,t){var n=e.gesSeleccionados||e.ges||[],a=n.length,i=n.filter((function(e){var t=e.niveles||{};return null!==t.ND&&void 0!==t.ND&&null!==t.NE&&void 0!==t.NE&&null!==t.NC&&void 0!==t.NC})).length,r=a>0&&i===a,o=r?"fa-check-circle completed":"fa-circle";return'\n              <button\n                class="niveles-cargo-tab '.concat(0===t?"active":""," ").concat(r?"completed":"",'"\n                data-action="switch-cargo-niveles"\n                data-cargo-index="').concat(t,'"\n                data-cargo-name="').concat(e.nombre,'"\n              >\n                <i class="fas ').concat(o,' cargo-status-icon"></i>\n                <span class="cargo-tab__name">').concat(e.nombre,'</span>\n                <span class="cargo-tab__count">').concat(i,"/").concat(a,"</span>\n              </button>\n            ")})).join(""),"\n        </div>\n      ")),e.forEach((function(e,n){t+='\n        <div\n          id="niveles-container-'.concat(n,'"\n          class="niveles-cargo-container"\n          style="').concat(0===n?"":"display: none;",'"\n        ></div>\n      ')})),t+="</div>",t+='\n      <div id="niveles-cargo-tooltip" class="niveles-cargo-tooltip" role="tooltip">\n        <div class="niveles-cargo-tooltip__header">\n          <i class="fas fa-briefcase"></i>\n          <span id="tooltip-cargo-name">Cargo</span>\n          <span class="tooltip-stats" id="tooltip-stats">0/0</span>\n        </div>\n        <div class="niveles-cargo-tooltip__divider"></div>\n        <div class="niveles-cargo-tooltip__body">\n          <span class="niveles-cargo-tooltip__label">Riesgos (GES)</span>\n          <ul class="niveles-cargo-tooltip__list" id="tooltip-ges-list">\n          </ul>\n        </div>\n      </div>\n    '}},{key:"renderControles",value:function(){var e=this;return setTimeout((function(){e.initControlesManager()}),0),'\n      <div class="wizard-step" data-step="controles">\n        <div id="controles-container"></div>\n      </div>\n    '}},{key:"initControlesManager",value:function(){var e=this,t=document.getElementById("controles-container");t&&(this.controlesManager&&this.controlesManager.destroy(),this.controlesManager=new Lt("#controles-container",this.state),this.controlesManager.render(),t.addEventListener("controles:completed",(function(t){e.avanzarPaso()})))}},{key:"avanzarPaso",value:function(){var e=this.state.getCurrentStep(),t=this.steps.findIndex((function(t){return t.id===e}));if(t<this.steps.length-1){var n=this.steps[t+1];this.state.setCurrentStep(n.id)}}},{key:"renderResumen",value:function(){var e=this.state.data.formData,t=this.state.getCargos(),n=this.state.getAnalytics(),a=t.reduce((function(e,t){var n;return e+((null===(n=t.gesSeleccionados)||void 0===n?void 0:n.length)||0)}),0),i=t.reduce((function(e,t){return e+(parseInt(t.numPersonas)||0)}),0),r=0,o=0;return t.forEach((function(e){e.gesSeleccionados.forEach((function(e){e.niveles&&null!==e.niveles.NR&&r++,e.controles&&Object.values(e.controles).some((function(e){return e&&e.trim()}))&&o++}))})),'\n      <div class="wizard-step" data-step="resumen">\n        <div class="resumen-header">\n          <h2><i class="fas fa-check-circle"></i> Resumen Final</h2>\n          <p>Revisa la información antes de generar tus documentos</p>\n        </div>\n\n        <div class="resumen-container">\n          \x3c!-- Información Básica --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-building"></i> Información de la Empresa</h3>\n            <div class="resumen-details">\n              <div class="detail-item">\n                <span class="detail-label">Empresa:</span>\n                <span class="detail-value">'.concat(e.nombreEmpresa||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">NIT:</span>\n                <span class="detail-value">').concat(e.nit||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">Email:</span>\n                <span class="detail-value">').concat(e.email||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">Sector Económico:</span>\n                <span class="detail-value">').concat(e.sector||"Sin especificar",'</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Cargos Summary --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-users"></i> Cargos Definidos (').concat(t.length,')</h3>\n            <div class="cargos-list">\n              ').concat(t.map((function(e,t){var n;return'\n                <div class="cargo-item">\n                  <div class="cargo-header">\n                    <span class="cargo-number">'.concat(t+1,"</span>\n                    <strong>").concat(e.nombre,'</strong>\n                  </div>\n                  <div class="cargo-stats">\n                    <span><i class="fas fa-user"></i> ').concat(e.numPersonas,' persona(s)</span>\n                    <span><i class="fas fa-exclamation-triangle"></i> ').concat((null===(n=e.gesSeleccionados)||void 0===n?void 0:n.length)||0," riesgo(s)</span>\n                  </div>\n                </div>\n              ")})).join(""),'\n            </div>\n          </div>\n\n          \x3c!-- Estadísticas Globales --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-chart-bar"></i> Estadísticas del Análisis</h3>\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-users"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(t.length,'</div>\n                  <div class="stat-label">Cargos</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-user-friends"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(i,'</div>\n                  <div class="stat-label">Personas</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(a,'</div>\n                  <div class="stat-label">Riesgos (GES)</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-calculator"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(r,'</div>\n                  <div class="stat-label">Niveles Configurados</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-shield-alt"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(o,'</div>\n                  <div class="stat-label">Controles Definidos</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-clock"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(Math.floor(n.totalTime/1e3/60),'</div>\n                  <div class="stat-label">Minutos</div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Documentos que se generarán --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-file-alt"></i> Documentos que se Generarán</h3>\n            <div class="documentos-list">\n              <div class="documento-item">\n                <i class="fas fa-file-excel documento-icon excel"></i>\n                <div class="documento-info">\n                  <strong>Matriz de Riesgos Profesionales</strong>\n                  <span>Archivo Excel con análisis completo de todos los riesgos</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Profesiograma</strong>\n                  <span>PDF con perfil profesional y requisitos de cada cargo</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Perfil de Cargo</strong>\n                  <span>PDF detallado de competencias y responsabilidades</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Cotización de Exámenes</strong>\n                  <span>PDF con precios y detalles de exámenes médicos ocupacionales</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Info Box --\x3e\n          <div class="wizard-hint info">\n            <i class="fas fa-info-circle"></i>\n            <div>\n              <strong>¿Qué sucede al generar documentos?</strong>\n              <p>Los documentos se generarán de forma asíncrona en nuestros servidores. Recibirás los links de descarga cuando estén listos (usualmente en 1-2 minutos).</p>\n            </div>\n          </div>\n\n          \x3c!-- Submit Section --\x3e\n          <div id="submit-section" class="submit-section">\n            <button id="btn-generar-documentos" class="btn-wizard btn-wizard--primary btn-large">\n              <i class="fas fa-rocket"></i>\n              Generar Documentos\n            </button>\n            <button class="btn-wizard btn-wizard--secondary" data-action="back">\n              <i class="fas fa-arrow-left"></i>\n              Volver a Controles\n            </button>\n          </div>\n\n          \x3c!-- Progress/Results Section (hidden initially) --\x3e\n          <div id="generation-status" class="generation-status" style="display: none;">\n            \x3c!-- Will be populated dynamically --\x3e\n          </div>\n        </div>\n      </div>\n    ')}},{key:"attachResumenListeners",value:function(){var e=this,t=this.container.querySelector("#btn-generar-documentos");t&&t.addEventListener("click",(function(){e.handleGenerarDocumentos()}))}},{key:"handleGenerarDocumentos",value:(p=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.showRegistrationModal();case 2:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"showRegistrationModal",value:function(){var e=this,t=this.state.exportForSubmission().userData,n='\n      <div id="registration-modal" class="wizard-modal" style="display: block;">\n        <div class="wizard-modal-content" style="max-width: 500px;">\n          <div class="wizard-modal-header">\n            <h3 style="margin: 0; color: #383d47;">\n              <i class="fas fa-user-check" style="color: #5dc4af; margin-right: 8px;"></i>\n              Completa tu Registro\n            </h3>\n            <button type="button" class="btn-close" id="close-registration-modal" aria-label="Cerrar">\n              <i class="fas fa-times"></i>\n            </button>\n          </div>\n\n          <div class="wizard-modal-body">\n            <p style="margin-bottom: 24px; color: #666; font-size: 14px;">\n              Para generar tus documentos, necesitamos algunos datos adicionales:\n            </p>\n\n            <form id="registration-form">\n              \x3c!-- Pre-filled company data (readonly) --\x3e\n              <div style="margin-bottom: 20px;">\n                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Nombre de la Empresa\n                </label>\n                <input\n                  type="text"\n                  value="'.concat(t.nombreEmpresa||"",'"\n                  readonly\n                  style="background: #f5f5f5; cursor: not-allowed;"\n                />\n              </div>\n\n              <div style="margin-bottom: 20px;">\n                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  NIT\n                </label>\n                <input\n                  type="text"\n                  value="').concat(t.nit||"",'"\n                  readonly\n                  style="background: #f5f5f5; cursor: not-allowed;"\n                />\n              </div>\n\n              \x3c!-- User data fields (required) --\x3e\n              <div style="margin-bottom: 20px;">\n                <label for="modal-email" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Correo Electrónico *\n                </label>\n                <input\n                  type="email"\n                  id="modal-email"\n                  name="email"\n                  placeholder="contacto@empresa.com"\n                  required\n                  autocomplete="email"\n                />\n              </div>\n\n              <div style="margin-bottom: 20px;">\n                <label for="modal-password" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Contraseña *\n                </label>\n                <input\n                  type="password"\n                  id="modal-password"\n                  name="password"\n                  placeholder="Mínimo 6 caracteres"\n                  required\n                  minlength="6"\n                  autocomplete="new-password"\n                />\n                <small style="display: block; margin-top: 4px; color: #666; font-size: 12px;">\n                  Usarás este correo y contraseña para acceder a tus documentos\n                </small>\n              </div>\n\n              <div style="margin-bottom: 24px;">\n                <label for="modal-nombre" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Nombre del Contacto\n                </label>\n                <input\n                  type="text"\n                  id="modal-nombre"\n                  name="nombre"\n                  placeholder="Ej: Juan Pérez"\n                  autocomplete="name"\n                />\n              </div>\n\n              <div id="modal-error" style="display: none; padding: 12px; background: #fee; border: 1px solid #fcc; border-radius: 8px; margin-bottom: 16px; color: #c33; font-size: 14px;">\n              </div>\n\n              <button type="submit" class="wizard-btn-primary wizard-btn-full submit-modal-btn">\n                <i class="fas fa-paper-plane"></i>\n                Registrar y Generar Documentos\n              </button>\n            </form>\n          </div>\n        </div>\n      </div>\n    '),a=document.createElement("div");a.innerHTML=n,document.body.appendChild(a);var i=document.getElementById("registration-modal"),o=document.getElementById("close-registration-modal"),c=document.getElementById("registration-form");o.addEventListener("click",(function(){document.body.removeChild(a)})),i.addEventListener("click",(function(e){e.target===i&&document.body.removeChild(a)})),c.addEventListener("submit",function(){var n=r(s().mark((function n(i){var r,o,l,d,u,p,f,v,g,h,m,b;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i.preventDefault(),(d=document.getElementById("modal-error"))&&(d.style.display="none"),(u={nombreEmpresa:t.nombreEmpresa,nit:t.nit,email:(null===(r=document.getElementById("modal-email"))||void 0===r?void 0:r.value.trim())||"",password:(null===(o=document.getElementById("modal-password"))||void 0===o?void 0:o.value)||"",nombre:(null===(l=document.getElementById("modal-nombre"))||void 0===l?void 0:l.value.trim())||null}).email&&u.password&&u.nombreEmpresa&&u.nit){n.next=9;break}return d&&(d.textContent="Por favor completa todos los campos requeridos (*)",d.style.display="block"),n.abrupt("return");case 9:return p=c.querySelector(".submit-modal-btn"),f=(null==p?void 0:p.textContent)||"Registrar",p&&(p.disabled=!0,p.innerHTML='<i class="fas fa-spinner fa-spin"></i> Registrando...'),n.prev=12,v=e.state.exportForSubmission(),g={formData:v.formData,userData:u},n.next=19,fetch("/api/flujo-ia/registrar-rapido",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(g)});case 19:return h=n.sent,n.next=22,h.json();case 22:if(m=n.sent,h.ok&&m.success){n.next=26;break}throw new Error(m.message||"Error ".concat(h.status));case 26:document.body.removeChild(a),localStorage.removeItem("wizardState"),m.sessionToken&&m.user&&(localStorage.setItem("authToken",m.sessionToken),localStorage.setItem("genesys_token",m.sessionToken),localStorage.setItem("user",JSON.stringify(m.user)),localStorage.setItem("genesys_user",JSON.stringify(m.user)),localStorage.setItem("empresaId",m.user.empresaId),localStorage.setItem("genesys_empresa",JSON.stringify({id:m.user.empresaId,nombre_legal:m.user.empresaNombre,nit:u.nit})),m.documentToken&&localStorage.setItem("genesys_pending_document_token",m.documentToken)),b=m.redirectUrl||"/pages/dashboard.html",window.location.href=b,n.next=40;break;case 35:n.prev=35,n.t0=n.catch(12),d&&(d.textContent="Error: ".concat(n.t0.message),d.style.display="block"),p&&(p.disabled=!1,p.innerHTML=f);case 40:case"end":return n.stop()}}),n,null,[[12,35]])})));return function(e){return n.apply(this,arguments)}}())}},{key:"startPollingStatus",value:function(e,t){var n=this;this.pollingToken=e,this.pollingInterval=setInterval(r(s().mark((function t(){var a,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/api/solicitud/".concat(e,"/estado"));case 3:return a=t.sent,t.next=6,a.json();case 6:if(i=t.sent,a.ok){t.next=9;break}throw new Error(i.message||"Error al obtener estado");case 9:n.updateStatusUI(i),"completado"!==i.estado&&"error"!==i.estado||n.stopPolling(),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(0),n.stopPolling(),n.updateStatusUI({estado:"error",mensaje:"Error al verificar estado. Recarga la página para continuar."});case 19:case"end":return t.stop()}}),t,null,[[0,14]])}))),3e3)}},{key:"stopPolling",value:function(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}},{key:"updateStatusUI",value:function(e){var t=this,n=this.container.querySelector("#generation-status");if(n){var a=e.estado,i=e.progreso,r=e.mensaje,o=e.previewUrls,s='\n      <div class="status-container">\n    ';"procesando"===a?s+='\n        <div class="status-header processing">\n          <i class="fas fa-spinner fa-spin"></i>\n          <h3>Generando Documentos...</h3>\n        </div>\n        <div class="progress-bar">\n          <div class="progress-fill" style="width: '.concat(i||0,'%"></div>\n        </div>\n        <p class="status-message">').concat(r||"Procesando tu solicitud...",'</p>\n        <p class="status-hint">Esto puede tomar 1-2 minutos. No cierres esta página.</p>\n      '):"completado"===a?s+='\n        <div class="status-header success">\n          <i class="fas fa-check-circle"></i>\n          <h3>¡Documentos Generados Exitosamente!</h3>\n        </div>\n        <p class="status-message">Tus documentos están listos para descargar:</p>\n        <div class="documentos-download">\n          '.concat(null!=o&&o.matriz?'\n            <a href="'.concat(o.matriz,'" target="_blank" class="download-card excel">\n              <i class="fas fa-file-excel"></i>\n              <span>Matriz de Riesgos (Excel)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=o&&o.profesiograma?'\n            <a href="'.concat(o.profesiograma,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Profesiograma (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=o&&o.perfil?'\n            <a href="'.concat(o.perfil,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Perfil de Cargo (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=o&&o.cotizacion?'\n            <a href="'.concat(o.cotizacion,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Cotización (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"",'\n        </div>\n        <div class="wizard-hint success">\n          <i class="fas fa-check"></i>\n          Los documentos también fueron enviados a tu email: ').concat(this.state.data.formData.email,'\n        </div>\n        <button id="btn-nueva-solicitud" class="btn-wizard btn-wizard--primary">\n          <i class="fas fa-plus"></i>\n          Nueva Solicitud\n        </button>\n      '):"error"===a&&(s+='\n        <div class="status-header error">\n          <i class="fas fa-times-circle"></i>\n          <h3>Error al Generar Documentos</h3>\n        </div>\n        <p class="status-message error">'.concat(r||"Ocurrió un error inesperado.",'</p>\n        <div class="wizard-hint error">\n          <i class="fas fa-exclamation-triangle"></i>\n          Por favor contacta a soporte técnico o intenta de nuevo.\n        </div>\n        <button id="btn-reintentar" class="btn-wizard btn-wizard--primary">\n          <i class="fas fa-redo"></i>\n          Reintentar\n        </button>\n      ')),s+="</div>",n.innerHTML=s;var c=n.querySelector("#btn-nueva-solicitud");c&&c.addEventListener("click",(function(){t.state.clearStorage(),window.location.reload()}));var l=n.querySelector("#btn-reintentar");l&&l.addEventListener("click",(function(){n.style.display="none",t.container.querySelector("#submit-section").style.display="block"}))}}},{key:"attachEventListeners",value:function(e){var t=this,n=this.container.querySelector('[data-action="back"]'),a=this.container.querySelector('[data-action="next"]');switch(n&&n.addEventListener("click",(function(){return t.handleBack()})),a&&a.addEventListener("click",(function(){return t.handleNext(e)})),e){case"info-basica":this.attachInfoBasicaListeners();break;case"cargos":this.attachCargosListeners();break;case"riesgos":this.attachRiesgosListeners();break;case"niveles":this.attachNivelesListeners();break;case"controles":break;case"resumen":this.attachResumenListeners()}}},{key:"showFieldError",value:function(e,t){if(e){e.classList.add("input-error"),e.setAttribute("aria-invalid","true"),this.clearFieldError(e);var n=document.createElement("div");n.className="field-error",n.setAttribute("role","alert"),n.setAttribute("aria-live","polite"),n.innerHTML='\n      <i class="fas fa-exclamation-circle"></i>\n      <span>'.concat(t,"</span>\n    "),e.parentElement.appendChild(n);var a="error-".concat(e.id||e.name);n.id=a,e.setAttribute("aria-describedby",a)}}},{key:"clearFieldError",value:function(e){if(e){e.classList.remove("input-error"),e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby");var t=e.parentElement.querySelector(".field-error");t&&t.remove()}}},{key:"attachInfoBasicaListeners",value:function(){var e=this;this.container.querySelectorAll("#nombreEmpresa, #nit, #email, #ciiuSeccion, #ciiuDivision, #telefono, #direccion, #ciudad").forEach((function(t){t.addEventListener("input",(function(t){e.state.updateBasicInfo(t.target.name,t.target.value,!0),e.clearFieldError(t.target)})),t.addEventListener("blur",(function(t){var n=t.target.name,a=t.target.value,i=e.state.validateSingleField(n,a);i?e.showFieldError(t.target,i):e.clearFieldError(t.target),e.state.updateBasicInfo(n,a,!0)}))})),this.setupSectorAnimatedDropdown()}},{key:"setupSectorAnimatedDropdown",value:function(){var e=this,t=this.container.querySelector("#sector-container"),n=this.container.querySelector("#sector-initial"),a=this.container.querySelector("#sector-selected-view"),i=this.container.querySelector("#ciiuSeccion"),o=this.container.querySelector("#ciiuDivision"),c=this.container.querySelector("#sector-badge-value"),l=this.container.querySelector("#sector-edit-btn");if(i&&o){i.addEventListener("change",function(){var i=r(s().mark((function i(r){var l,d,u;return s().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(l=r.target.value){i.next=3;break}return i.abrupt("return");case 3:return e.state.updateBasicInfo("ciiuDivision","",!0),e.state.updateBasicInfo("sector","",!0),o&&(o.innerHTML='<option value="">Cargando actividades...</option>',o.value=""),e.state.updateBasicInfo("ciiuSeccion",l,!0),d=r.target.options[r.target.selectedIndex],u=d.text,c&&(c.textContent=u),n&&a&&(n.style.opacity="0",n.style.transform="translateY(-10px)",setTimeout((function(){n.classList.add("hidden"),a.classList.remove("hidden"),a.style.opacity="0",a.style.transform="translateY(10px)",requestAnimationFrame((function(){a.style.transition="all 0.3s ease-out",a.style.opacity="1",a.style.transform="translateY(0)"}))}),200)),t&&t.classList.add("sector-selected"),i.next=14,e.loadCIIUDivisiones(l,o);case 14:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()),l&&l.addEventListener("click",(function(){e.state.updateBasicInfo("ciiuSeccion","",!0),e.state.updateBasicInfo("ciiuDivision","",!0),e.state.updateBasicInfo("sector","",!0),a&&n&&(a.style.opacity="0",a.style.transform="translateY(10px)",setTimeout((function(){a.classList.add("hidden"),n.classList.remove("hidden"),i&&(i.value=""),o&&(o.innerHTML='<option value="">Selecciona tu actividad económica...</option>',o.value="",o.disabled=!1),n.style.opacity="0",n.style.transform="translateY(-10px)",requestAnimationFrame((function(){n.style.transition="all 0.3s ease-out",n.style.opacity="1",n.style.transform="translateY(0)"}))}),200)),t&&t.classList.remove("sector-selected")})),o.addEventListener("change",(function(t){e.state.updateBasicInfo("ciiuDivision",t.target.value,!0),e.state.updateBasicInfo("sector",t.target.value,!0)}));var d=this.state.data.formData.ciiuSeccion,u=this.state.data.formData.ciiuDivision;d&&this.loadCIIUDivisiones(d,o).then((function(){u&&(o.value=u)}))}}},{key:"loadCIIUDivisiones",value:(d=r(s().mark((function e(t,n){var a,i,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return n.innerHTML='<option value="">Cargando actividades...</option>',n.value="",n.disabled=!0,e.prev=6,e.next=9,fetch("/api/catalogo/ciiu/secciones/".concat(t,"/divisiones?_t=").concat(Date.now()));case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error cargando actividades: ".concat(a.status));case 12:return e.next=14,a.json();case 14:i=e.sent,r=i.data||[],n.innerHTML='\n        <option value="">Selecciona tu actividad económica...</option>\n        '.concat(r.map((function(e){return'\n          <option value="'.concat(e.codigo,'">').concat(e.nombre,"</option>\n        ")})).join(""),"\n      "),n.value="",n.disabled=!1,n._dropdownApi&&"function"==typeof n._dropdownApi.refresh&&n._dropdownApi.refresh(),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(6),n.innerHTML='<option value="">Error cargando actividades</option>',n.disabled=!0;case 29:case"end":return e.stop()}}),e,null,[[6,24]])}))),function(e,t){return d.apply(this,arguments)})},{key:"positionFAB",value:(l=r(s().mark((function e(){var t,n,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.container.querySelector(".fab"),n=this.container.querySelector(".wizard-form"),t&&n){e.next=4;break}return e.abrupt("return");case 4:return this.fabCleanup&&(this.fabCleanup(),this.fabCleanup=null),a=function(){var e=r(s().mark((function e(){var a,i,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,It.computePosition)(n,t,{placement:"right-end",middleware:[(0,It.offset)(24),(0,It.shift)({padding:10})]});case 2:a=e.sent,i=a.x,r=a.y,Object.assign(t.style,{position:"absolute",left:"".concat(i,"px"),top:"".concat(r,"px")});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=8,a();case 8:i=function(){return a()},window.addEventListener("scroll",i),window.addEventListener("resize",i),this.fabCleanup=function(){window.removeEventListener("scroll",i),window.removeEventListener("resize",i)};case 12:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"attachCargosListeners",value:function(){var e=this,t=this.container.querySelector('[data-action="add-cargo"]');t&&t.addEventListener("click",(function(){return e.showAddCargoModal()})),this.positionFAB();var n=this.container.querySelector('[data-action="carousel-prev"]'),a=this.container.querySelector('[data-action="carousel-next"]');n&&n.addEventListener("click",(function(){return e.handleCarouselPrev()})),a&&a.addEventListener("click",(function(){return e.handleCarouselNext()})),this.container.querySelectorAll('[data-action="carousel-goto"]').forEach((function(t){t.addEventListener("click",(function(t){var n=parseInt(t.currentTarget.dataset.index);e.handleCarouselGoto(n)}))})),this.container.querySelectorAll('[data-action="edit-cargo"]').forEach((function(t){t.addEventListener("click",(function(t){var n=parseInt(t.currentTarget.dataset.index);e.handleEditCargo(t.currentTarget,n)}))})),this.container.querySelectorAll('[data-action="remove-cargo"]').forEach((function(t){t.addEventListener("click",(function(t){var n=parseInt(t.currentTarget.dataset.index);e.handleRemoveCargo(n)}))})),this.container.querySelectorAll('[data-action="close-modal"]').forEach((function(t){t.addEventListener("click",(function(){return e.hideAddCargoModal()}))}));var i=this.container.querySelector('[data-action="save-cargo"]');i&&i.addEventListener("click",(function(){return e.handleSaveCargo()}))}},{key:"updateCarouselPosition",value:function(){var e=this,t=this.container.querySelector(".cargos-carousel");t&&(t.style.transform="translateX(calc(-".concat(100*this.carouselIndex,"% - ").concat(2*this.carouselIndex,"rem))")),this.container.querySelectorAll(".carousel-dot").forEach((function(t,n){n===e.carouselIndex?t.classList.add("active"):t.classList.remove("active")}));var n=this.container.querySelector('[data-action="carousel-prev"]'),a=this.container.querySelector('[data-action="carousel-next"]'),i=this.state.getCargos();n&&(n.disabled=0===this.carouselIndex),a&&(a.disabled=this.carouselIndex>=i.length-1)}},{key:"handleCarouselPrev",value:function(){this.state.getCargos();this.carouselIndex>0&&(this.carouselIndex--,this.updateCarouselPosition())}},{key:"handleCarouselNext",value:function(){var e=this.state.getCargos();this.carouselIndex<e.length-1&&(this.carouselIndex++,this.updateCarouselPosition())}},{key:"handleCarouselGoto",value:function(e){var t=this.state.getCargos();e>=0&&e<t.length&&(this.carouselIndex=e,this.updateCarouselPosition())}},{key:"attachRiesgosListeners",value:function(){var e=this,t=this.state.getCargos(),n=this.state.data.catalogos;t.forEach((function(t,a){var i=e.container.querySelector("#riesgo-selector-".concat(a));if(i){e.riesgoSelectors[a]&&e.riesgoSelectors[a].destroy();var r=(n.riesgos||[]).map((function(t){return Mt(Mt({},t),{},{categoria:e.getCategoryName(t.id_riesgo||t.riesgo_id,n.categorias)})}));e.riesgoSelectors[a]=new kt(i,{cargoIndex:a,cargoNombre:t.nombre,sector:e.state.data.sector||null,catalogoGES:r,catalogoRiesgos:n.categorias||[],seleccionados:t.gesSeleccionados||[],onChange:function(t){return e.handleGESChange(a,t)}}),i.addEventListener("ges-selected",(function(t){var n=t.detail,a=n.cargoIndex,i=n.sourceElement;i&&e.animateGESToCargoTab(i,a)}))}}));var a=this.container.querySelectorAll('[data-action="switch-cargo-tab"]');a.forEach((function(t){t.addEventListener("click",(function(t){var n=parseInt(t.currentTarget.dataset.cargoIndex);e.switchCargoTab(n)})),t.addEventListener("keydown",(function(t){e.handleTabKeydown(t,a)})),t.addEventListener("mouseenter",(function(t){e.showCargoTooltip(t.currentTarget)})),t.addEventListener("mouseleave",(function(){e.hideCargoTooltip()}))})),this.setupScrollIndicators()}},{key:"handleTabKeydown",value:function(e,t){var n=Array.from(t),a=n.findIndex((function(t){return t===e.target})),i=a;switch(e.key){case"ArrowLeft":i=(a-1+n.length)%n.length;break;case"ArrowRight":i=(a+1)%n.length;break;case"Home":i=0;break;case"End":i=n.length-1;break;default:return}e.preventDefault(),n[i].click(),n[i].focus()}},{key:"setupScrollIndicators",value:function(){var e=this.container.querySelector(".cargo-tabs-wrapper"),t=this.container.querySelector(".cargo-tabs");if(t&&e){var n=function(){var n=t.scrollLeft>10,a=t.scrollLeft<t.scrollWidth-t.clientWidth-10;e.classList.toggle("has-scroll-left",n),e.classList.toggle("has-scroll-right",a)};t.addEventListener("scroll",n),window.addEventListener("resize",n),n()}}},{key:"getCategoryName",value:function(e,t){if(!t||!Array.isArray(t))return"Sin categoría";var n=t.find((function(t){return t.id===e}));return n?n.nombre:"Sin categoría"}},{key:"getCategoriesFromGES",value:function(e){var t=new Map;return e.forEach((function(e){var n=e.id_riesgo||e.riesgo_id;t.has(n)||t.set(n,{id:n,nombre:e.categoria||"Categoría ".concat(n)})})),Array.from(t.values())}},{key:"handleGESChange",value:function(e,t){var n=this.state.getCargo(e);if(n){var a=t.map((function(e){return{idGes:e.id,nombre:e.nombre,categoria:e.categoria||"",niveles:{ND:null,NE:null,NC:null,NP:null,NR:null},controles:{eliminacion:"",sustitucion:"",ingenieria:"",administrativos:"",epp:""}}}));this.state.updateCargo(e,Mt(Mt({},n),{},{ges:a,gesSeleccionados:a})),this.updateCargoCards()}}},{key:"updateCargoCards",value:function(){var e=this.state.getCargos();this.container.querySelectorAll(".cargo-card").forEach((function(t,n){var a=e[n];if(a){var i=t.querySelector(".cargo-card-header h3");i&&(i.textContent=a.nombre);var r=t.querySelector(".cargo-card-body > p");r&&(r.textContent=a.descripcion||"Sin descripción");var o=t.querySelector(".cargo-meta span:first-child");o&&(o.innerHTML='<i class="fas fa-user"></i> '.concat(a.numPersonas," persona").concat(1!==a.numPersonas?"s":""));var s=t.querySelector(".cargo-meta span:last-child");if(s){var c,l=(null===(c=a.gesSeleccionados)||void 0===c?void 0:c.length)||0;s.innerHTML='<i class="fas fa-exclamation-triangle"></i> '.concat(l," riesgo").concat(1!==l?"s":"")}}})),this.container.querySelectorAll(".cargo-tabs .cargo-tab").forEach((function(t,n){var a=e[n];if(a){var i=t.querySelector(".cargo-name");i&&(i.textContent=a.cargoName||a.nombre||"Cargo ".concat(n+1));var r=t.querySelector(".cargo-count");if(r){var o,s,c=(null===(o=a.gesSeleccionados)||void 0===o?void 0:o.length)||(null===(s=a.ges)||void 0===s?void 0:s.length)||0;r.textContent=c,r.classList.add("pulse-update"),setTimeout((function(){return r.classList.remove("pulse-update")}),400),t.setAttribute("data-has-risks",c>0?"true":"false")}}})),this.container.querySelectorAll(".niveles-cargo-tabs .niveles-cargo-tab").forEach((function(t,n){var a=e[n];if(a){var i=Array.from(t.childNodes).find((function(e){return e.nodeType===Node.TEXT_NODE}));i&&(i.textContent=a.nombre);var r=t.querySelector(".cargo-tab__count");if(r){var o,s=(null===(o=a.gesSeleccionados)||void 0===o?void 0:o.length)||0;r.textContent="".concat(s," GES")}}})),this.container.querySelectorAll(".cargo-item").forEach((function(t,n){var a=e[n];if(a){var i=t.querySelector(".cargo-stats span:last-child");if(i){var r,o=(null===(r=a.gesSeleccionados)||void 0===r?void 0:r.length)||0;i.innerHTML='<i class="fas fa-exclamation-triangle"></i> '.concat(o," riesgo").concat(1!==o?"s":"")}}}))}},{key:"switchCargoTab",value:function(e){this.container.querySelectorAll(".cargo-tab").forEach((function(t,n){n===e?(t.classList.add("active"),t.setAttribute("aria-selected","true"),t.setAttribute("tabindex","0")):(t.classList.remove("active"),t.setAttribute("aria-selected","false"),t.setAttribute("tabindex","-1"))})),this.container.querySelectorAll(".riesgo-selector-container").forEach((function(t,n){t.style.display=n===e?"":"none"}))}},{key:"getCategoryColor",value:function(e){return{Mecánico:"#3498db",Eléctrico:"#f39c12",Físico:"#9b59b6",Químico:"#e74c3c",Biológico:"#2ecc71",Ergonómico:"#1abc9c",Biomecánico:"#1abc9c",Psicosocial:"#e67e22","Factores Humanos":"#ffa726",Locativo:"#34495e",Natural:"#8e44ad",Seguridad:"#c0392b","Otros Riesgos":"#95a5a6","Saneamiento Básico":"#16a085","Salud Pública":"#27ae60",Comunes:"#5dc4af"}[e]||"#95a5a6"}},{key:"attachNivelesListeners",value:function(){var e=this;this.state.getCargos().length>0&&this.initializeNivelesForm(0),this.container.querySelectorAll('[data-action="switch-cargo-niveles"]').forEach((function(t){t.addEventListener("click",(function(t){var n=parseInt(t.currentTarget.dataset.cargoIndex);e.switchCargoNivelesTab(n)})),t.addEventListener("mouseenter",(function(t){e.showNivelesCargoTooltip(t.currentTarget)})),t.addEventListener("mouseleave",(function(){e.hideNivelesCargoTooltip()}))}))}},{key:"showNivelesCargoTooltip",value:function(e){var t=document.getElementById("niveles-cargo-tooltip");if(t){var n=parseInt(e.dataset.cargoIndex),a=this.state.getCargo(n);if(a){var i=a.gesSeleccionados||a.ges||[],r=document.getElementById("tooltip-cargo-name"),o=document.getElementById("tooltip-stats"),s=document.getElementById("tooltip-ges-list");r&&(r.textContent=a.nombre);var c=i.filter((function(e){var t=e.niveles||{};return null!==t.ND&&void 0!==t.ND&&null!==t.NE&&void 0!==t.NE&&null!==t.NC&&void 0!==t.NC})).length;if(o&&(o.textContent="".concat(c,"/").concat(i.length)),s&&(s.innerHTML=i.map((function(e){var t=e.niveles||{},n=null!==t.ND&&void 0!==t.ND&&null!==t.NE&&void 0!==t.NE&&null!==t.NC&&void 0!==t.NC,a=n?"completed":"pending",i=n?"fa-check":"fa-circle",r="";if(n&&t.NR){var o=t.NR,s="risk-bajo",c="IV";o>=600?(s="risk-muy-alto",c="I"):o>=150?(s="risk-alto",c="II"):o>=40&&(s="risk-medio",c="III"),r='<span class="item-level '.concat(s,'">').concat(c,"</span>")}return'\n          <li class="niveles-cargo-tooltip__item">\n            <span class="item-status '.concat(a,'">\n              <i class="fas ').concat(i,'"></i>\n            </span>\n            <span class="item-name">').concat(e.nombre,"</span>\n            ").concat(r,"\n          </li>\n        ")})).join("")),t.classList.add("visible"),void 0!==It.computePosition)(0,It.computePosition)(e,t,{placement:"bottom",middleware:[(0,It.offset)(8),(0,It.shift)({padding:8})]}).then((function(e){var n=e.x,a=e.y;t.style.left="".concat(n,"px"),t.style.top="".concat(a,"px")}));else{var l=e.getBoundingClientRect();t.style.left="".concat(l.left,"px"),t.style.top="".concat(l.bottom+8,"px")}}}}},{key:"hideNivelesCargoTooltip",value:function(){var e=document.getElementById("niveles-cargo-tooltip");e&&e.classList.remove("visible")}},{key:"initializeNivelesForm",value:function(e){var t=this,n=this.state.getCargo(e);if(n){var a=this.container.querySelector("#niveles-container-".concat(e));if(a)if(this.nivelesFormCache||(this.nivelesFormCache={}),this.nivelesFormCache[e]){this.nivelesForm=this.nivelesFormCache[e];var i=n.gesSeleccionados||n.ges||[];this.nivelesForm.updateGESArray(i)}else{var r=n.gesSeleccionados||n.ges||[],o=new Tt(a,{cargoIndex:e,cargoNombre:n.nombre,gesArray:r,state:this.state,onChange:function(n){return t.handleNivelesChange(e,n)},onComplete:function(){return t.handleNivelesComplete(e)}});this.nivelesFormCache[e]=o,this.nivelesForm=o}}}},{key:"handleNivelesChange",value:function(e,t){"update-niveles"===t.action?this.updateNivelesCargoTabIndicators():"go-back"===t.action&&this.state.setCurrentStep("riesgos")}},{key:"updateNivelesCargoTabIndicators",value:function(){var e=this.state.getCargos();this.container.querySelectorAll(".niveles-cargo-tab").forEach((function(t,n){if(!(n>=e.length)){var a=e[n],i=a.gesSeleccionados||a.ges||[],r=i.filter((function(e){var t=e.niveles||{};return null!==t.ND&&void 0!==t.ND&&null!==t.NE&&void 0!==t.NE&&null!==t.NC&&void 0!==t.NC})).length,o=i.length>0&&r===i.length,s=t.querySelector(".cargo-tab__count");s&&(s.textContent="".concat(r,"/").concat(i.length));var c=t.querySelector(".cargo-status-icon");c&&(o?(c.classList.remove("fa-circle"),c.classList.add("fa-check-circle","completed")):(c.classList.remove("fa-check-circle","completed"),c.classList.add("fa-circle"))),o?t.classList.add("completed"):t.classList.remove("completed")}}))}},{key:"handleNivelesComplete",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.state.getCargos(),n=-1,a=e+1;a<t.length;a++){var i=t[a],r=i.gesSeleccionados||i.ges||[];if(r.length>0)if(r.some((function(e){var t=e.niveles||{};return null===t.ND||void 0===t.ND||null===t.NE||void 0===t.NE||null===t.NC||void 0===t.NC}))){n=a;break}}-1!==n?this.switchCargoNivelesTab(n):this.handleNext("niveles")}},{key:"switchCargoNivelesTab",value:function(e){var t=this;this.container.querySelectorAll(".niveles-cargo-tab").forEach((function(t,n){n===e?t.classList.add("active"):t.classList.remove("active")})),this.container.querySelectorAll(".niveles-cargo-container").forEach((function(t,n){t.style.display=n===e?"":"none"})),setTimeout((function(){t.initializeNivelesForm(e)}),0)}},{key:"handleBack",value:function(){var e=this,t=this.steps.findIndex((function(t){return t.id===e.state.getCurrentStep()}));if(t>0){var n=this.steps[t-1];this.state.setCurrentStep(n.id)}}},{key:"migrateNivelesData",value:function(){var e=this.state.getCargos(),t=!1;e.forEach((function(e,n){e.ges&&e.ges.forEach((function(e,n){var a=e.niveles;a&&(null===a.ND||void 0===a.ND||a.deficiencia||(a.deficiencia={value:a.ND},a.exposicion={value:a.NE},a.consecuencia={value:a.NC},t=!0))}))})),t&&this.state.notify()}},{key:"handleNext",value:(o=r(s().mark((function e(t){var n,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("niveles"===t&&this.migrateNivelesData(),n=this.state.validateStep(t),!(Object.keys(n).length>0)){e.next=6;break}return this.showValidationErrors(n),e.abrupt("return");case 6:if("riesgos"!==t){e.next=12;break}return e.next=9,this.validateRiesgosStep();case 9:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:if("resumen"!==t){e.next=15;break}return this.handleGenerarDocumentos(),e.abrupt("return");case 15:if("riesgos"!==t){e.next=18;break}return e.next=18,this.preloadGESDetails();case 18:a=this.steps.findIndex((function(e){return e.id===t})),a<this.steps.length-1&&(i=this.steps[a+1],this.state.setCurrentStep(i.id));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"validateRiesgosStep",value:(a=r(s().mark((function e(){var t,n,a,i,r,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.getCargos(),n=t.map((function(e){var t;return{nombre:e.nombre,count:(null===(t=e.ges)||void 0===t?void 0:t.length)||0}})),0!==(a=n.reduce((function(e,t){return e+t.count}),0))){e.next=7;break}return e.next=6,Pt({title:"Debes seleccionar al menos un riesgo",message:'\n          <div style="text-align: left; line-height: 1.6;">\n            <p>No has seleccionado ningún riesgo para los cargos de tu empresa.</p>\n            <p><strong>¿Por qué es importante?</strong></p>\n            <ul style="margin-left: 1.5rem;">\n              <li>La matriz de riesgos es requerida por la normativa SST colombiana</li>\n              <li>Te ayuda a identificar y controlar peligros en el lugar de trabajo</li>\n              <li>Es necesaria para generar el profesiograma y perfil de cargo</li>\n            </ul>\n          </div>\n        ',confirmText:"Entendido, seleccionaré riesgos",showCancelButton:!1,type:"error",icon:"fa-exclamation-triangle"});case 6:return e.abrupt("return",!1);case 7:if(!(a/t.length<3)){e.next=21;break}return i=n.filter((function(e){return 0===e.count})).map((function(e){return e.nombre})),r=n.filter((function(e){return e.count>0&&e.count<3})).map((function(e){return"".concat(e.nombre," (").concat(e.count," ").concat(1===e.count?"riesgo":"riesgos",")")})),o='<div style="text-align: left; line-height: 1.6;">',o+="<p>Has seleccionado <strong>".concat(a," ").concat(1===a?"riesgo":"riesgos","</strong> en total.</p>"),i.length>0&&(o+="<p><strong>Cargos sin riesgos:</strong></p>",o+='<ul style="margin-left: 1.5rem;">',i.forEach((function(e){o+="<li>".concat(e,"</li>")})),o+="</ul>"),r.length>0&&(o+="<p><strong>Cargos con pocos riesgos:</strong></p>",o+='<ul style="margin-left: 1.5rem;">',r.forEach((function(e){o+="<li>".concat(e,"</li>")})),o+="</ul>"),o+="<p>Se recomienda seleccionar al menos <strong>3-5 riesgos por cargo</strong> para una evaluación completa.</p>",o+="</div>",e.next=19,Pt({title:"¿Continuar con esta selección?",message:o,confirmText:"Sí, continuar de todas formas",cancelText:"Volver a revisar riesgos",type:"warning",icon:"fa-exclamation-circle"});case 19:return c=e.sent,e.abrupt("return",c);case 21:return e.abrupt("return",!0);case 22:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"preloadGESDetails",value:(n=r(s().mark((function e(){var t,n,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=performance.now(),n=this.container.querySelector('[data-action="next"]'),a=n?n.innerHTML:"",e.prev=4,n&&(n.disabled=!0,n.innerHTML='<i class="fas fa-spinner fa-spin"></i> Cargando detalles...'),0!==(i=Object.values(this.riesgoSelectors).filter((function(e){return e&&"function"==typeof e.preloadSelectedDetails})).map((function(e){return e.preloadSelectedDetails()}))).length){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,Promise.all(i);case 12:Math.round(performance.now()-t),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4);case 19:return e.prev=19,n&&(n.disabled=!1,n.innerHTML=a),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(){return n.apply(this,arguments)})},{key:"showValidationErrors",value:function(e){var t=Object.values(e).join("<br>"),n=document.createElement("div");n.className="wizard-error",n.innerHTML='\n      <div class="error-content">\n        <strong>Por favor corrige los siguientes errores:</strong>\n        <p>'.concat(t,"</p>\n      </div>\n    ");var a=this.container.querySelector(".wizard-error");a&&a.remove(),this.container.appendChild(n),setTimeout((function(){return n.remove()}),5e3)}},{key:"showAddCargoModal",value:function(){var e=this,t=this.container.querySelector("#modal-add-cargo");if(t){this.previousFocusedElement=document.activeElement,t.style.display="flex",t.setAttribute("aria-modal","true"),t.setAttribute("role","dialog"),t.setAttribute("aria-labelledby","modal-title-cargo"),this.initialCargoFormState=this.getCargoFormState();var n=t.querySelector("#cargo-nombre");n&&requestAnimationFrame((function(){n.focus()})),this.setupModalFocusTrap(t),this.modalEscapeHandler=function(t){"Escape"===t.key&&(t.preventDefault(),e.hideAddCargoModal())},document.addEventListener("keydown",this.modalEscapeHandler)}}},{key:"setupModalFocusTrap",value:function(e){var t=["input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]",'[tabindex]:not([tabindex="-1"])'].join(", ");this.modalFocusTrapHandler=function(n){if("Tab"===n.key){var a=Array.from(e.querySelectorAll(t)),i=a[0],r=a[a.length-1];n.shiftKey?document.activeElement===i&&(n.preventDefault(),r.focus()):document.activeElement===r&&(n.preventDefault(),i.focus())}},e.addEventListener("keydown",this.modalFocusTrapHandler)}},{key:"getCargoFormState",value:function(){var e,t,n,a,i,r,o,s,c,l;return{nombre:(null===(e=this.container.querySelector("#cargo-nombre"))||void 0===e?void 0:e.value)||"",descripcion:(null===(t=this.container.querySelector("#cargo-descripcion"))||void 0===t?void 0:t.value)||"",numPersonas:(null===(n=this.container.querySelector("#cargo-num-personas"))||void 0===n?void 0:n.value)||"1",area:(null===(a=this.container.querySelector("#cargo-area"))||void 0===a?void 0:a.value)||"",zona:(null===(i=this.container.querySelector("#cargo-zona"))||void 0===i?void 0:i.value)||"",tareasRutinarias:(null===(r=this.container.querySelector("#cargo-tareasRutinarias"))||void 0===r?void 0:r.checked)||!1,manipulaAlimentos:(null===(o=this.container.querySelector("#cargo-manipulaAlimentos"))||void 0===o?void 0:o.checked)||!1,trabajaAlturas:(null===(s=this.container.querySelector("#cargo-trabajaAlturas"))||void 0===s?void 0:s.checked)||!1,trabajaEspaciosConfinados:(null===(c=this.container.querySelector("#cargo-trabajaEspaciosConfinados"))||void 0===c?void 0:c.checked)||!1,conduceVehiculo:(null===(l=this.container.querySelector("#cargo-conduceVehiculo"))||void 0===l?void 0:l.checked)||!1}}},{key:"hasCargoFormChanges",value:function(){if(!this.initialCargoFormState)return!1;var e=this.getCargoFormState();return e.nombre!==this.initialCargoFormState.nombre||e.descripcion!==this.initialCargoFormState.descripcion||e.numPersonas!==this.initialCargoFormState.numPersonas||e.tareasRutinarias!==this.initialCargoFormState.tareasRutinarias||e.manipulaAlimentos!==this.initialCargoFormState.manipulaAlimentos||e.trabajaAlturas!==this.initialCargoFormState.trabajaAlturas||e.trabajaEspaciosConfinados!==this.initialCargoFormState.trabajaEspaciosConfinados||e.conduceVehiculo!==this.initialCargoFormState.conduceVehiculo}},{key:"hideAddCargoModal",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!this.hasCargoFormChanges()?this.forceCloseAddCargoModal():Pt({title:"Cambios sin guardar",message:"¿Deseas salir sin guardar este cargo?",confirmText:"Salir sin Guardar",cancelText:"Continuar Editando",type:"warning",onConfirm:function(){e.forceCloseAddCargoModal()},onCancel:function(){}})}},{key:"forceCloseAddCargoModal",value:function(){var e=this.container.querySelector("#modal-add-cargo");e&&(e.style.display="none",e.removeAttribute("aria-modal"),e.removeAttribute("role"),e.removeAttribute("aria-labelledby"),this.modalEscapeHandler&&(document.removeEventListener("keydown",this.modalEscapeHandler),this.modalEscapeHandler=null),this.modalFocusTrapHandler&&(e.removeEventListener("keydown",this.modalFocusTrapHandler),this.modalFocusTrapHandler=null),this.previousFocusedElement&&this.previousFocusedElement.focus&&(this.previousFocusedElement.focus(),this.previousFocusedElement=null),this.container.querySelector("#cargo-nombre").value="",this.container.querySelector("#cargo-descripcion").value="",this.container.querySelector("#cargo-num-personas").value="1",this.container.querySelector("#cargo-area").value="",this.container.querySelector("#cargo-zona").value="",this.container.querySelector("#cargo-tareasRutinarias").checked=!1,this.container.querySelector("#cargo-manipulaAlimentos").checked=!1,this.container.querySelector("#cargo-trabajaAlturas").checked=!1,this.container.querySelector("#cargo-trabajaEspaciosConfinados").checked=!1,this.container.querySelector("#cargo-conduceVehiculo").checked=!1,this.initialCargoFormState=null)}},{key:"handleSaveCargo",value:function(){var e,t,n,a,i,r=this,o=this.container.querySelector("#cargo-nombre").value.trim(),s=this.container.querySelector("#cargo-descripcion").value.trim(),c=parseInt(this.container.querySelector("#cargo-num-personas").value),l=this.container.querySelector("#cargo-area").value.trim(),d=this.container.querySelector("#cargo-zona").value.trim(),u=(null===(e=this.container.querySelector("#cargo-tareasRutinarias"))||void 0===e?void 0:e.checked)||!1,p=(null===(t=this.container.querySelector("#cargo-manipulaAlimentos"))||void 0===t?void 0:t.checked)||!1,f=(null===(n=this.container.querySelector("#cargo-trabajaAlturas"))||void 0===n?void 0:n.checked)||!1,v=(null===(a=this.container.querySelector("#cargo-trabajaEspaciosConfinados"))||void 0===a?void 0:a.checked)||!1,g=(null===(i=this.container.querySelector("#cargo-conduceVehiculo"))||void 0===i?void 0:i.checked)||!1;if(o&&!(c<1)&&l&&d){var h=0===this.state.getCargos().length;this.state.addCargo({nombre:o,descripcion:s,numPersonas:c,area:l,zona:d,tareasRutinarias:u,manipulaAlimentos:p,trabajaAlturas:f,trabajaEspaciosConfinados:v,conduceVehiculo:g}),this.hideAddCargoModal(!0),h?(this.forceRender(),requestAnimationFrame((function(){requestAnimationFrame((function(){r.triggerFABBounce()}))}))):this.forceRender()}else alert("Por favor completa todos los campos requeridos")}},{key:"handleRemoveCargo",value:function(e){var t=this.state.getCargo(e);confirm('¿Estás seguro de eliminar el cargo "'.concat(t.nombre,'"?'))&&(this.state.removeCargo(e),this.forceRender())}},{key:"handleEditCargo",value:function(e,t){var n=this;this.cargoEditor.showEditPopover(e,t,(function(e){n.updateCargoCards()}))}},{key:"triggerFABBounce",value:function(){var e=this.container.querySelector(".fab");e&&(e.classList.remove("fab--hidden"),e.classList.add("fab--bounce-in"),setTimeout((function(){e.classList.remove("fab--bounce-in")}),800))}},{key:"handleSubmit",value:(t=r(s().mark((function e(){var t,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,this.showLoading("Generando documentos..."),t=this.state.exportForSubmission(),e.next=6,fetch("/api/solicitudes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 6:if((n=e.sent).ok){e.next=9;break}throw new Error("HTTP ".concat(n.status,": ").concat(n.statusText));case 9:return e.next=11,n.json();case 11:a=e.sent,this.state.clearStorage(),window.location.href="/pages/resultados.html?token=".concat(a.token),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),this.showError("Error al generar documentos. Por favor intenta de nuevo.");case 21:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(){return t.apply(this,arguments)})},{key:"showLoading",value:function(e){var t=document.createElement("div");t.className="wizard-loading-overlay",t.innerHTML='\n      <div class="wizard-loading">\n        <div class="wizard-loading__spinner"></div>\n        <p class="wizard-loading__text">'.concat(e,"</p>\n      </div>\n    "),document.body.appendChild(t)}},{key:"showError",value:function(e){alert(e)}},{key:"showCargoTooltip",value:(e=r(s().mark((function e(t){var n,a,r,o,l,d,u,p,f,v,g,h,m,b,y,x;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hideCargoTooltip(),n=parseInt(t.dataset.cargoIndex),a=t.dataset.cargoName,r=this.state.getCargos(),o=r[n]){e.next=7;break}return e.abrupt("return");case 7:if(0!==(l=o.gesSeleccionados||o.ges||[]).length){e.next=10;break}return e.abrupt("return");case 10:return(d=document.createElement("div")).className="cargo-tooltip",d.id="cargo-tooltip-floating",d.setAttribute("role","tooltip"),u=l.map((function(e){var t="string"==typeof e?e:e.nombre||e.name||"GES",n="object"===c(e)&&(e.categoria||e.riesgo)||"";return'\n        <li class="cargo-tooltip__item">\n          <i class="fas fa-shield-alt"></i>\n          <span>'.concat(t,"</span>\n          ").concat(n?"<small>".concat(n,"</small>"):"","\n        </li>\n      ")})).join(""),d.innerHTML='\n      <div class="cargo-tooltip__header">\n        <i class="fas fa-briefcase"></i>\n        <span>'.concat(a,'</span>\n      </div>\n      <div class="cargo-tooltip__divider"></div>\n      <div class="cargo-tooltip__body">\n        <p class="cargo-tooltip__label">Riesgos Seleccionados (').concat(l.length,')</p>\n        <ul class="cargo-tooltip__list">\n          ').concat(u,"\n        </ul>\n      </div>\n    "),document.body.appendChild(d),e.prev=17,e.next=20,Promise.resolve().then(i.bind(i,8491));case 20:return p=e.sent,f=p.computePosition,v=p.flip,g=p.shift,h=p.offset,e.next=27,f(t,d,{placement:"bottom",middleware:[h(10),v(),g({padding:8})]});case 27:m=e.sent,b=m.x,y=m.y,Object.assign(d.style,{left:"".concat(b,"px"),top:"".concat(y,"px")}),requestAnimationFrame((function(){d.classList.add("visible")})),e.next=41;break;case 34:e.prev=34,e.t0=e.catch(17),x=t.getBoundingClientRect(),d.style.left="".concat(x.left,"px"),d.style.top="".concat(x.bottom+10,"px"),d.classList.add("visible");case 41:case"end":return e.stop()}}),e,this,[[17,34]])}))),function(t){return e.apply(this,arguments)})},{key:"hideCargoTooltip",value:function(){var e=document.getElementById("cargo-tooltip-floating");e&&(e.classList.remove("visible"),setTimeout((function(){e.remove()}),200))}},{key:"animateGESToCargoTab",value:function(e,t){var n=this.container.querySelector('[data-cargo-index="'.concat(t,'"]'));if(n&&e){var a=e.getBoundingClientRect(),i=n.getBoundingClientRect(),r=document.createElement("div");r.className="ges-flying",r.innerHTML='<i class="fas fa-shield-alt"></i>',Object.assign(r.style,{position:"fixed",left:"".concat(a.left+a.width/2,"px"),top:"".concat(a.top+a.height/2,"px"),zIndex:"10000"}),document.body.appendChild(r);var o=i.left+i.width-25,s=i.top+i.height/2;requestAnimationFrame((function(){r.style.transition="all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)",r.style.left="".concat(o,"px"),r.style.top="".concat(s,"px"),r.style.transform="scale(0.3)",r.style.opacity="0.5"})),setTimeout((function(){var e=n.querySelector(".cargo-count");e&&(e.classList.add("pulse-animation"),setTimeout((function(){e.classList.remove("pulse-animation")}),600))}),400),setTimeout((function(){r.remove()}),600)}}}]);var e,t,n,a,o,l,d,p}(),Bt=null,Ht=null;function $t(){return Vt.apply(this,arguments)}function Vt(){return Vt=r(s().mark((function e(){var t,n,a,r,o,c=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:3,n=c.length>1&&void 0!==c[1]?c[1]:100,!(Bt&&Bt.length>0)){e.next=5;break}return e.abrupt("return",Bt);case 5:a=s().mark((function e(){var a,r,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.e(786).then(i.bind(i,7405));case 3:if(a=e.sent,!((r=a.SECTORES_ECONOMICOS)&&r.length>0)){e.next=9;break}return Bt=r,e.abrupt("return",{v:r});case 9:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0);case 15:if(!(o<t-1)){e.next=20;break}return c=n*Math.pow(2,o),e.next=20,new Promise((function(e){return setTimeout(e,c)}));case 20:case"end":return e.stop()}}),e,null,[[0,12]])})),o=0;case 7:if(!(o<t)){e.next=15;break}return e.delegateYield(a(),"t0",9);case 9:if(!(r=e.t0)){e.next=12;break}return e.abrupt("return",r.v);case 12:o++,e.next=7;break;case 15:return e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e)}))),Vt.apply(this,arguments)}function Ut(){return Jt.apply(this,arguments)}function Jt(){return Jt=r(s().mark((function e(){var t,n,a,r,o=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:3,!(Ht&&Ht.length>0)){e.next=3;break}return e.abrupt("return",Ht);case 3:n=s().mark((function e(n){var a,r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.e(786).then(i.bind(i,7405));case 3:if(a=e.sent,!(r=a.getCiudadesSimple)){e.next=11;break}if(!((o=r())&&o.length>0)){e.next=11;break}return Ht=o,e.abrupt("return",{v:o});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0);case 16:if(!(n<t-1)){e.next=19;break}return e.next=19,new Promise((function(e){return setTimeout(e,100*Math.pow(2,n))}));case 19:case"end":return e.stop()}}),e,null,[[0,13]])})),r=0;case 5:if(!(r<t)){e.next=13;break}return e.delegateYield(n(r),"t0",7);case 7:if(!(a=e.t0)){e.next=10;break}return e.abrupt("return",a.v);case 10:r++,e.next=5;break;case 13:return e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e)}))),Jt.apply(this,arguments)}function Wt(){return Yt.apply(this,arguments)}function Yt(){return(Yt=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,Promise.all([$t(),Ut()]);case 3:case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.content,a=void 0===n?"":n,i=t.placement,o=void 0===i?"top":i,c=t.offsetDistance,l=void 0===c?8:c,d=t.trigger,u=void 0===d?"hover":d,p=document.createElement("div");p.className="wizard-help-tooltip",p.setAttribute("role","tooltip"),p.innerHTML=a,p.style.position="absolute",p.style.top="0",p.style.left="0";var f=!1;function v(){return g.apply(this,arguments)}function g(){return g=r(s().mark((function t(){var n,a,i,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,It.computePosition)(e,p,{placement:o,middleware:[(0,It.offset)(l),(0,It.flip)(),(0,It.shift)({padding:8})]});case 2:n=t.sent,a=n.x,i=n.y,r=n.placement,Object.assign(p.style,{left:"".concat(a,"px"),top:"".concat(i,"px")}),p.setAttribute("data-popper-placement",r);case 8:case"end":return t.stop()}}),t)}))),g.apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return(m=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=2;break}return e.abrupt("return");case 2:return document.body.appendChild(p),e.next=5,v();case 5:requestAnimationFrame((function(){p.setAttribute("data-show",""),f=!0}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){f&&(p.removeAttribute("data-show"),f=!1,setTimeout((function(){p.parentElement&&!f&&p.remove()}),150))}function y(e){e.stopPropagation(),f?b():h()}function x(t){p.contains(t.target)||e.contains(t.target)||b()}return"hover"===u?(e.addEventListener("mouseenter",h),e.addEventListener("mouseleave",b),e.addEventListener("focus",h),e.addEventListener("blur",b)):"click"===u?(e.addEventListener("click",y),document.addEventListener("click",x)):"focus"===u&&(e.addEventListener("focus",h),e.addEventListener("blur",b)),{show:h,hide:b,destroy:function(){b(),"hover"===u?(e.removeEventListener("mouseenter",h),e.removeEventListener("mouseleave",b)):"click"===u?(e.removeEventListener("click",y),document.removeEventListener("click",x)):"focus"===u&&(e.removeEventListener("focus",h),e.removeEventListener("blur",b))},update:v}}function Qt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[data-tooltip]",t=document.querySelectorAll(e),n=[];return t.forEach((function(e){if(!e.hasAttribute("data-tooltip-initialized")){var t=e.getAttribute("data-tooltip"),a=e.getAttribute("data-tooltip-placement")||"top",i=e.getAttribute("data-tooltip-trigger")||"hover";if(t){var r=Kt(e,{content:t,placement:a,trigger:i});e.setAttribute("data-tooltip-initialized","true"),n.push(r)}}})),n.length,n}function Xt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".wizard-enhanced-select",t=document.querySelectorAll(e),n=[];return t.forEach((function(e){if(!e.hasAttribute("data-dropdown-initialized")){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.searchable,a=void 0===n||n,i=t.placeholder,o=void 0===i?e.getAttribute("placeholder")||"Seleccionar...":i,c=t.onChange,l=void 0===c?function(){}:c,d=Array.from(e.options).filter((function(e){return""!==e.value})).map((function(e){return{value:e.value,label:e.textContent,selected:e.selected}})),u=document.createElement("div");u.className="wizard-dropdown";var p=document.createElement("button");p.type="button",p.className="wizard-dropdown-trigger",p.setAttribute("aria-haspopup","listbox"),p.setAttribute("aria-expanded","false");var f=d.find((function(e){return e.selected})),v=document.createElement("span");v.textContent=f?f.label:o;var g=document.createElement("i");g.className="fas fa-chevron-down chevron",p.appendChild(v),p.appendChild(g);var h=document.createElement("div");h.className="wizard-dropdown-panel",h.setAttribute("role","listbox"),h.style.position="absolute",h.style.top="0",h.style.left="0";var m=null;if(a){var b=document.createElement("div");b.className="wizard-dropdown-search",(m=document.createElement("input")).type="text",m.placeholder="Buscar...",m.setAttribute("aria-label","Buscar opciones"),b.appendChild(m),h.appendChild(b)}var y=document.createElement("ul");y.className="wizard-dropdown-options";var w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;if(y.innerHTML="",0===e.length){var t=document.createElement("div");return t.className="wizard-dropdown-empty",t.textContent="No se encontraron resultados",void y.appendChild(t)}e.forEach((function(e){var t=document.createElement("li");t.className="wizard-dropdown-option",t.setAttribute("role","option"),t.setAttribute("data-value",e.value),t.textContent=e.label,t.tabIndex=0,e.selected&&t.setAttribute("aria-selected","true"),t.addEventListener("click",(function(){T(e)})),t.addEventListener("keydown",(function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),T(e))})),y.appendChild(t)}))};w(),h.appendChild(y),u.appendChild(p),document.body.appendChild(h),e.style.display="none",e.parentElement.insertBefore(u,e);var C=!1,E=f?f.value:"";function k(){return S.apply(this,arguments)}function S(){return S=r(s().mark((function e(){var t,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,It.computePosition)(p,h,{placement:"bottom-start",middleware:[(0,It.flip)(),(0,It.shift)({padding:8}),(0,It.size)({apply:function(e){var t=e.availableHeight,n=e.elements;Object.assign(n.floating.style,{maxHeight:"".concat(Math.min(t-16,300),"px")})}})]});case 2:t=e.sent,n=t.x,a=t.y,Object.assign(h.style,{left:"".concat(n,"px"),top:"".concat(a,"px"),width:"".concat(p.offsetWidth,"px")});case 6:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function _(){return A.apply(this,arguments)}function A(){return(A=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!C){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,k();case 4:h.setAttribute("data-show",""),p.setAttribute("aria-expanded","true"),C=!0,m&&setTimeout((function(){return m.focus()}),50);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){C&&(h.removeAttribute("data-show"),p.setAttribute("aria-expanded","false"),C=!1,m&&(m.value="",w()))}function T(t){E=t.value,v.textContent=t.label,e.value=t.value;var n=new Event("change",{bubbles:!0}),a=new Event("input",{bubbles:!0});e.dispatchEvent(a),e.dispatchEvent(n),y.querySelectorAll("[aria-selected]").forEach((function(e){e.removeAttribute("aria-selected")}));var i=y.querySelector('[data-value="'.concat(t.value,'"]'));i&&i.setAttribute("aria-selected","true"),l(t.value,t.label),N()}p.addEventListener("click",(function(){C?N():_()})),m&&(m.addEventListener("input",(function(e){var t=e.target.value.toLowerCase().trim();if(t){var n=d.filter((function(e){return e.label.toLowerCase().includes(t)}));w(n)}else w()})),m.addEventListener("keydown",(function(e){if("Enter"===e.key){e.preventDefault();var t=y.querySelectorAll(".wizard-dropdown-option");1===t.length&&t[0].click()}}))),document.addEventListener("click",(function(e){u.contains(e.target)||h.contains(e.target)||N()})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&C&&(N(),p.focus())}));var L={open:_,close:N,getValue:function(){return E},setValue:function(e){var t=d.find((function(t){return t.value===e}));t&&T(t)},refresh:function(){var t=Array.from(e.options).filter((function(e){return""!==e.value})).map((function(e){return{value:e.value,label:e.textContent,selected:e.selected}}));d.length=0,d.push.apply(d,x(t)),w();var n=t.find((function(e){return e.selected}));n?(v.textContent=n.label,E=n.value):(v.textContent=o,E="")},destroy:function(){h.remove(),u.remove(),e.style.display="",delete e._dropdownApi}};return e._dropdownApi=L,L}(e,{searchable:!1!==e.hasAttribute("data-searchable")});e.setAttribute("data-dropdown-initialized","true"),n.push(t)}})),n.length,n}function Zt(){return en.apply(this,arguments)}function en(){return(en=r(s().mark((function e(){var t,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=b(),"info-basica"===(n=t.getCurrentStep())){e.next=8;break}return nn(),zt(n,r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return tn("Cargando asistente..."),e.next=4,Wt();case 4:return e.next=6,rn(t);case 6:new Ft("#wizard-container",t).init(),an(),nn();case 10:case"end":return e.stop()}}),e)}))),(function(){t.clearStorage(),window.location.reload()})),e.abrupt("return");case 8:return tn("Cargando catálogos..."),e.prev=9,e.next=12,Wt();case 12:return e.next=14,rn(t);case 14:new Ft("#wizard-container",t).init(),an(),nn(),e.next=27;break;case 21:e.prev=21,e.t0=e.catch(9),nn(),(a=document.getElementById("wizard-container"))&&(a.innerHTML='\n        <div class="wizard-error">\n          <i class="fas fa-exclamation-triangle"></i>\n          <h3>Error al cargar el asistente</h3>\n          <p>No se pudieron cargar los catálogos necesarios. Por favor, recarga la página.</p>\n          <button onclick="window.location.reload()" class="btn-primary">\n            <i class="fas fa-redo"></i> Recargar página\n          </button>\n        </div>\n      ');case 27:case"end":return e.stop()}}),e,null,[[9,21]])})))).apply(this,arguments)}function tn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Cargando asistente...",t=document.querySelector(".wizard-loading"),n=document.querySelector(".wizard-loading__text");t&&n&&(n.textContent=e,t.style.display="flex")}function nn(){var e=document.querySelector(".wizard-loading");e&&(e.style.display="none")}function an(){var e=null,t=new MutationObserver((function(){e&&clearTimeout(e),e=setTimeout((function(){t.disconnect(),Qt("[data-tooltip]"),Xt(".wizard-enhanced-select");var e=document.querySelector("#wizard-container");e&&t.observe(e,{childList:!0,subtree:!0})}),50)})),n=document.querySelector("#wizard-container");n&&t.observe(n,{childList:!0,subtree:!0}),setTimeout((function(){Qt("[data-tooltip]"),Xt(".wizard-enhanced-select")}),100)}function rn(e){return on.apply(this,arguments)}function on(){return(on=r(s().mark((function e(t){var a,i,r,o,c,l,d,u,p,f,v,g,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={riesgos:[],categorias:[],sectores:[],ciiuSecciones:[],ciudades:[]},e.next=5,Promise.all([fetch("/api/catalogo/ges?limit=200"),fetch("/api/catalogo/riesgos"),fetch("/api/catalogo/sectores"),fetch("/api/catalogo/ciiu/secciones"),fetch("/api/catalogo/ciudades")]);case 5:if(i=e.sent,r=n(i,5),o=r[0],c=r[1],l=r[2],d=r[3],u=r[4],!o.ok){e.next=20;break}return e.next=15,o.json();case 15:p=e.sent,a.riesgos=p.data||[],e.next=21;break;case 20:case 21:if(!c.ok){e.next=29;break}return e.next=24,c.json();case 24:f=e.sent,a.categorias=f.data||[],e.next=30;break;case 29:case 30:if(!l.ok){e.next=38;break}return e.next=33,l.json();case 33:v=e.sent,a.sectores=v.data||[],e.next=39;break;case 38:case 39:if(!d.ok){e.next=47;break}return e.next=42,d.json();case 42:g=e.sent,a.ciiuSecciones=g.data||[],e.next=48;break;case 47:case 48:if(!u.ok){e.next=56;break}return e.next=51,u.json();case 51:h=e.sent,a.ciudades=h.data||[],e.next=57;break;case 56:case 57:t.setCatalogos(a),e.next=64;break;case 61:e.prev=61,e.t0=e.catch(0);case 64:case"end":return e.stop()}}),e,null,[[0,61]])})))).apply(this,arguments)}function sn(){var e=document.getElementById("import-json-modal"),t=null==e?void 0:e.querySelector(".wizard-modal__backdrop"),n=null==e?void 0:e.querySelector(".wizard-modal__close"),a=document.getElementById("btn-cancel-import"),i=document.getElementById("btn-confirm-import"),o=document.getElementById("import-file-input"),c=document.getElementById("import-dropzone"),l=document.getElementById("import-preview"),d=document.getElementById("import-preview-content"),u=document.getElementById("import-warnings"),p=document.getElementById("import-warnings-list");if(e){var f=null;document.addEventListener("click",(function(t){t.target.closest("#btn-import-json")&&(e.hidden=!1,document.body.style.overflow="hidden",g())}));var v=function(){e.hidden=!0,document.body.style.overflow="",g()};null==t||t.addEventListener("click",v),null==n||n.addEventListener("click",v),null==a||a.addEventListener("click",v);var g=function(){f=null,o.value="",l.hidden=!0,u.hidden=!0,i.disabled=!0,c.classList.remove("wizard-import-dropzone--dragover")};c.addEventListener("dragover",(function(e){e.preventDefault(),c.classList.add("wizard-import-dropzone--dragover")})),c.addEventListener("dragleave",(function(){c.classList.remove("wizard-import-dropzone--dragover")})),c.addEventListener("drop",(function(e){e.preventDefault(),c.classList.remove("wizard-import-dropzone--dragover");var t=e.dataTransfer.files[0];t&&"application/json"===t.type&&h(t)})),c.addEventListener("click",(function(){return o.click()})),o.addEventListener("change",(function(e){var t=e.target.files[0];t&&h(t)}));var h=function(){var e=r(s().mark((function e(t){var n,a,r,o,c,u,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.text();case 3:if(n=e.sent,(a=JSON.parse(n)).formData||a.cargos||a.userData){e.next=7;break}throw new Error("El archivo no tiene la estructura esperada (userData/formData)");case 7:f=a,r=a.userData||a,o=a.formData||a,c=o.cargos||[],u='<div class="preview-items">',r.nombreEmpresa&&(u+='\n          <div class="preview-item">\n            <span class="preview-label">Empresa:</span>\n            <span class="preview-value">'.concat(r.nombreEmpresa,"</span>\n          </div>\n        ")),r.nit&&(u+='\n          <div class="preview-item">\n            <span class="preview-label">NIT:</span>\n            <span class="preview-value">'.concat(r.nit,"</span>\n          </div>\n        ")),c.length>0&&(u+='\n          <div class="preview-item">\n            <span class="preview-label">Cargos:</span>\n            <span class="preview-value">'.concat(c.length," cargo(s)</span>\n          </div>\n        "),p=c.reduce((function(e,t){return e+(t.gesSeleccionados||t.ges||[]).length}),0),u+='\n          <div class="preview-item">\n            <span class="preview-label">Riesgos:</span>\n            <span class="preview-value">'.concat(p," GES en total</span>\n          </div>\n        "),u+='<div class="preview-cargos">',c.forEach((function(e){var t=e.cargoName||e.nombre||"Sin nombre",n=(e.gesSeleccionados||e.ges||[]).length;u+='\n            <div class="preview-cargo">\n              <span class="cargo-name">'.concat(t,'</span>\n              <span class="cargo-ges-count">').concat(n," riesgos</span>\n            </div>\n          ")})),u+="</div>"),u+="</div>",d.innerHTML=u,l.hidden=!1,i.disabled=!1,e.next=26;break;case 21:e.prev=21,e.t0=e.catch(0),alert("Error al procesar el archivo: "+e.t0.message),g();case 26:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t){return e.apply(this,arguments)}}();i.addEventListener("click",(function(){if(f){var e=b().importFromJSON(f);e.success?(e.warnings&&e.warnings.length>0&&(p.innerHTML=e.warnings.map((function(e){return"<li>".concat(e,"</li>")})).join(""),u.hidden=!1),alert("".concat(e.message,"\n\nCargos importados: ").concat(e.cargosImportados,"\nRiesgos importados: ").concat(e.gesImportados)),v(),window.location.reload()):alert("Error: "+e.message)}}))}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){Zt(),sn()})):(Zt(),sn())})()})();