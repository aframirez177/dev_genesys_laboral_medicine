/*! For license information please see wizardRiesgos.bundle.js.LICENSE.txt */
(()=>{var e,n,t={4633:(e,n,t)=>{var a=t(3738).default;function r(){"use strict";e.exports=r=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var n,t={},o=Object.prototype,i=o.hasOwnProperty,s=Object.defineProperty||function(e,n,t){e[n]=t.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function g(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{g({},"")}catch(n){g=function(e,n,t){return e[n]=t}}function p(e,n,t,a){var r=n&&n.prototype instanceof x?n:x,o=Object.create(r.prototype),i=new P(a||[]);return s(o,"_invoke",{value:N(e,t,i)}),o}function f(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var v="suspendedStart",h="suspendedYield",m="executing",b="completed",y={};function x(){}function w(){}function C(){}var E={};g(E,l,(function(){return this}));var S=Object.getPrototypeOf,k=S&&S(S(D([])));k&&k!==o&&i.call(k,l)&&(E=k);var A=C.prototype=x.prototype=Object.create(E);function _(e){["next","throw","return"].forEach((function(n){g(e,n,(function(e){return this._invoke(n,e)}))}))}function z(e,n){function t(r,o,s,c){var l=f(e[r],e,o);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==a(u)&&i.call(u,"__await")?n.resolve(u.__await).then((function(e){t("next",e,s,c)}),(function(e){t("throw",e,s,c)})):n.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return t("throw",e,s,c)}))}c(l.arg)}var r;s(this,"_invoke",{value:function(e,a){function o(){return new n((function(n,r){t(e,a,n,r)}))}return r=r?r.then(o,o):o()}})}function N(e,t,a){var r=v;return function(o,i){if(r===m)throw Error("Generator is already running");if(r===b){if("throw"===o)throw i;return{value:n,done:!0}}for(a.method=o,a.arg=i;;){var s=a.delegate;if(s){var c=T(s,a);if(c){if(c===y)continue;return c}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(r===v)throw r=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);r=m;var l=f(e,t,a);if("normal"===l.type){if(r=a.done?b:h,l.arg===y)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(r=b,a.method="throw",a.arg=l.arg)}}}function T(e,t){var a=t.method,r=e.iterator[a];if(r===n)return t.delegate=null,"throw"===a&&e.iterator.return&&(t.method="return",t.arg=n,T(e,t),"throw"===t.method)||"return"!==a&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+a+"' method")),y;var o=f(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,y;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,y):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function L(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function I(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function D(e){if(e||""===e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}throw new TypeError(a(e)+" is not iterable")}return w.prototype=C,s(A,"constructor",{value:C,configurable:!0}),s(C,"constructor",{value:w,configurable:!0}),w.displayName=g(C,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===w||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,g(e,u,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},_(z.prototype),g(z.prototype,d,(function(){return this})),t.AsyncIterator=z,t.async=function(e,n,a,r,o){void 0===o&&(o=Promise);var i=new z(p(e,n,a,r),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(A),g(A,u,"Generator"),g(A,l,(function(){return this})),g(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var n=Object(e),t=[];for(var a in n)t.push(a);return t.reverse(),function e(){for(;t.length;){var a=t.pop();if(a in n)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=D,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(a,r){return s.type="throw",s.arg=e,t.next=a,r&&(t.method="next",t.arg=n),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=n&&n<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,y):this.complete(o)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),y},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),I(t),y}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var a=t.completion;if("throw"===a.type){var r=a.arg;I(t)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:D(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=n),y}},t}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},3738:e=>{function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},4756:(e,n,t)=>{var a=t(4633)();e.exports=a;try{regeneratorRuntime=a}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}}},a={};function r(e){var n=a[e];if(void 0!==n)return n.exports;var o=a[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.m=t,r.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return r.d(n,{a:n}),n},r.d=(e,n)=>{for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((n,t)=>(r.f[t](e,n),n)),[])),r.u=e=>e+".bundle.js",r.miniCssF=e=>{},r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),e={},n="genesys-client:",r.l=(t,a,o,i)=>{if(e[t])e[t].push(a);else{var s,c;if(void 0!==o)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==n+o){s=u;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,r.nc&&s.setAttribute("nonce",r.nc),s.setAttribute("data-webpack",n+o),s.src=t),e[t]=[a];var g=(n,a)=>{s.onerror=s.onload=null,clearTimeout(p);var r=e[t];if(delete e[t],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(a))),n)return n(a)},p=setTimeout(g.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=g.bind(null,s.onerror),s.onload=g.bind(null,s.onload),c&&document.head.appendChild(s)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/",(()=>{var e={730:0};r.f.j=(n,t)=>{var a=r.o(e,n)?e[n]:void 0;if(0!==a)if(a)t.push(a[2]);else{var o=new Promise(((t,r)=>a=e[n]=[t,r]));t.push(a[2]=o);var i=r.p+r.u(n),s=new Error;r.l(i,(t=>{if(r.o(e,n)&&(0!==(a=e[n])&&(e[n]=void 0),a)){var o=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;s.message="Loading chunk "+n+" failed.\n("+o+": "+i+")",s.name="ChunkLoadError",s.type=o,s.request=i,a[1](s)}}),"chunk-"+n,n)}};var n=(n,t)=>{var a,o,[i,s,c]=t,l=0;if(i.some((n=>0!==e[n]))){for(a in s)r.o(s,a)&&(r.m[a]=s[a]);if(c)c(r)}for(n&&n(t);l<i.length;l++)o=i[l],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0},t=self.webpackChunkgenesys_client=self.webpackChunkgenesys_client||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),(()=>{"use strict";function e(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}function n(n,t){if(n){if("string"==typeof n)return e(n,t);var a={}.toString.call(n).slice(8,-1);return"Object"===a&&n.constructor&&(a=n.constructor.name),"Map"===a||"Set"===a?Array.from(n):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(n,t):void 0}}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,r,o,i,s=[],c=!0,l=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(a=o.call(t)).done)&&(s.push(a.value),s.length!==n);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(l)throw r}}return s}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n,t,a,r,o,i){try{var s=e[o](i),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(a,r)}function o(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function s(e){a(i,r,o,s,c,"next",e)}function c(e){a(i,r,o,s,c,"throw",e)}s(void 0)}))}}var i=r(4756),s=r.n(i);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e){var n=function(e,n){if("object"!=c(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!=c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==c(n)?n:n+""}function d(e,n,t){return(n=l(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function g(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,l(a.key),a)}}function p(e,n,t){return n&&g(e.prototype,n),t&&g(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function v(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?f(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var h=function(){return p((function e(){u(this,e),this.storageKey="genesys_wizard_state",this.sessionKey="genesys_wizard_session",this.data=this.loadFromStorage()||this.getInitialState(),this.listeners=[],this.lastToastTime=0,this.data.analytics.sessionStartTime||(this.data.analytics.sessionStartTime=Date.now())}),[{key:"getInitialState",value:function(){return{currentStep:"info-basica",formData:{nombreEmpresa:"",nit:"",email:"",sector:"",cargos:[]},catalogos:{riesgos:[],gesComunes:[],sectores:[]},validation:{errors:{},touched:{},isValid:!1},analytics:{sessionStartTime:null,timeSpentPerStep:{},stepStartTime:Date.now(),errorCount:0,cargoCount:0,gesCount:0}}}},{key:"loadFromStorage",value:function(){try{var e=localStorage.getItem(this.storageKey);if(e){var n=JSON.parse(e),t=Date.now()-(n.analytics.sessionStartTime||0);if(t<864e5)return console.log("[WizardState] Loaded state from localStorage",n),n;console.log("[WizardState] Session expired, starting fresh"),localStorage.removeItem(this.storageKey)}}catch(e){console.error("[WizardState] Error loading from storage:",e),localStorage.removeItem(this.storageKey)}return null}},{key:"saveToStorage",value:function(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.data)),console.log("[WizardState] Saved to localStorage"),this.showToast("Guardado autom√°ticamente","success")}catch(e){console.error("[WizardState] Error saving to storage:",e),this.showToast("Error al guardar","error")}}},{key:"clearStorage",value:function(){localStorage.removeItem(this.storageKey),this.data=this.getInitialState(),this.notify()}},{key:"showToast",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",t=Date.now();if("error"!==n&&t-this.lastToastTime<5e3)console.log("[WizardState] Toast throttled:",e);else{this.lastToastTime=t,document.querySelectorAll(".wizard-toast").forEach((function(e){return e.remove()}));var a=document.createElement("div");a.className="wizard-toast wizard-toast--".concat(n),a.setAttribute("role","alert"),a.setAttribute("aria-live","polite");var r="success"===n?"fa-check-circle":"error"===n?"fa-exclamation-circle":"fa-info-circle";a.innerHTML='\n      <i class="fas '.concat(r,'"></i>\n      <span>').concat(e,"</span>\n    "),document.body.appendChild(a),requestAnimationFrame((function(){a.classList.add("wizard-toast--visible")})),setTimeout((function(){a.classList.remove("wizard-toast--visible"),setTimeout((function(){a.remove()}),300)}),3e3)}}},{key:"subscribe",value:function(e){var n=this;return this.listeners.push(e),function(){n.listeners=n.listeners.filter((function(n){return n!==e}))}}},{key:"notify",value:function(){var e=this;this.listeners.forEach((function(n){try{n(e.data)}catch(e){console.error("[WizardState] Error in listener:",e)}})),this.saveToStorage()}},{key:"getCurrentStep",value:function(){return this.data.currentStep}},{key:"setCurrentStep",value:function(e){var n=this.data.currentStep,t=Date.now()-this.data.analytics.stepStartTime;this.data.analytics.timeSpentPerStep[n]||(this.data.analytics.timeSpentPerStep[n]=0),this.data.analytics.timeSpentPerStep[n]+=t,this.data.currentStep=e,this.data.analytics.stepStartTime=Date.now(),this.notify()}},{key:"validateStep",value:function(e){var n=this,t={};switch(e||this.data.currentStep){case"info-basica":(!this.data.formData.nombreEmpresa||this.data.formData.nombreEmpresa.trim().length<3)&&(t.nombreEmpresa="El nombre de la empresa debe tener al menos 3 caracteres"),this.data.formData.nit&&/^\d{9,10}$/.test(this.data.formData.nit)||(t.nit="El NIT debe tener 9 o 10 d√≠gitos"),this.data.formData.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.data.formData.email)||(t.email="Email inv√°lido"),this.data.formData.sector||(t.sector="Debe seleccionar un sector");break;case"cargos":this.data.formData.cargos&&0!==this.data.formData.cargos.length||(t.cargos="Debe agregar al menos un cargo"),this.data.formData.cargos.forEach((function(e,n){(!e.nombre||e.nombre.trim().length<3)&&(t["cargo_".concat(n,"_nombre")]="El nombre del cargo debe tener al menos 3 caracteres"),(!e.numPersonas||e.numPersonas<1)&&(t["cargo_".concat(n,"_numPersonas")]="Debe haber al menos 1 persona en el cargo"),(!e.area||e.area.trim().length<2)&&(t["cargo_".concat(n,"_area")]="El √°rea debe tener al menos 2 caracteres"),(!e.zona||e.zona.trim().length<2)&&(t["cargo_".concat(n,"_zona")]="La zona debe tener al menos 2 caracteres")}));break;case"riesgos":this.data.formData.cargos.forEach((function(e,n){e.ges&&0!==e.ges.length||(t["cargo_".concat(n,"_ges")]='El cargo "'.concat(e.nombre,'" debe tener al menos un riesgo/GES asignado'))}));break;case"niveles":this.data.formData.cargos.forEach((function(e,n){e.ges.forEach((function(e,a){var r,o,i,s,c,l,d=e.niveles;void 0!==(null===(r=d.deficiencia)||void 0===r?void 0:r.value)&&null!==(null===(o=d.deficiencia)||void 0===o?void 0:o.value)&&void 0!==(null===(i=d.exposicion)||void 0===i?void 0:i.value)&&null!==(null===(s=d.exposicion)||void 0===s?void 0:s.value)&&void 0!==(null===(c=d.consecuencia)||void 0===c?void 0:c.value)&&null!==(null===(l=d.consecuencia)||void 0===l?void 0:l.value)||(t["cargo_".concat(n,"_ges_").concat(a,"_niveles")]='Debe completar los niveles de riesgo para "'.concat(e.nombre,'"'))}))}));break;case"controles":break;case"resumen":["info-basica","cargos","riesgos","niveles"].forEach((function(e){var a=n.validateStep(e);Object.assign(t,a)}))}return this.data.validation.errors=t,this.data.validation.isValid=0===Object.keys(t).length,Object.keys(t).length>0&&this.data.analytics.errorCount++,t}},{key:"validateSingleField",value:function(e,n){switch(e){case"nombreEmpresa":if(!n||n.trim().length<3)return"El nombre de la empresa debe tener al menos 3 caracteres";if(n.trim().length>100)return"El nombre de la empresa no puede exceder 100 caracteres";break;case"nit":if(!n)return"El NIT es requerido";var t=n.replace(/[^0-9]/g,"");if(t.length<9||t.length>10)return"El NIT debe tener 9 o 10 d√≠gitos";break;case"email":if(!n)return"El email es requerido";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n))return"Por favor ingresa un email v√°lido (ejemplo: usuario@empresa.com)";break;case"sector":if(!n||""===n)return"Debe seleccionar un sector econ√≥mico";break;case"telefono":if(n&&n.length>0){var a=n.replace(/[^0-9]/g,"");if(a.length<7)return"El tel√©fono debe tener al menos 7 d√≠gitos";if(a.length>15)return"El tel√©fono no puede exceder 15 d√≠gitos"}break;case"direccion":if(n&&n.length>0&&n.trim().length<5)return"La direcci√≥n debe tener al menos 5 caracteres";break;case"ciudad":if(n&&n.length>0&&n.trim().length<3)return"La ciudad debe tener al menos 3 caracteres";break;default:return null}return null}},{key:"updateBasicInfo",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.data.formData[e]=n,this.data.validation.touched[e]=!0,this.saveToStorage(),t||this.notify()}},{key:"setCatalogos",value:function(e){this.data.catalogos=v(v({},this.data.catalogos),e),this.notify()}},{key:"addCargo",value:function(e){if(!this.isCargoNameUnique(e.nombre||""))return{success:!1,error:"Ya existe un cargo con ese nombre"};if(!e.nombre||e.nombre.trim().length<3)return{success:!1,error:"El nombre del cargo debe tener al menos 3 caracteres"};if(e.numPersonas<1)return{success:!1,error:"Debe haber al menos 1 persona en el cargo"};if(!e.area||e.area.trim().length<2)return{success:!1,error:"El √°rea debe tener al menos 2 caracteres"};if(!e.zona||e.zona.trim().length<2)return{success:!1,error:"La zona debe tener al menos 2 caracteres"};var n={nombre:e.nombre,descripcion:e.descripcion||"",numPersonas:e.numPersonas||1,area:e.area||"",zona:e.zona||"",tareasRutinarias:e.tareasRutinarias||!1,manipulaAlimentos:e.manipulaAlimentos||!1,trabajaAlturas:e.trabajaAlturas||!1,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados||!1,conduceVehiculo:e.conduceVehiculo||!1,ges:[],gesSeleccionados:[]};return this.data.formData.cargos.push(n),this.data.analytics.cargoCount++,this.notify(),{success:!0,index:this.data.formData.cargos.length-1}}},{key:"isCargoNameUnique",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return!this.data.formData.cargos.some((function(t,a){return a!==n&&t.nombre.toLowerCase().trim()===e.toLowerCase().trim()}))}},{key:"updateCargo",value:function(e,n){if(e<0||e>=this.data.formData.cargos.length)return console.error("[WizardState] Invalid cargo index:",e),{success:!1,error:"√çndice de cargo inv√°lido"};if(n.nombre){if(!this.isCargoNameUnique(n.nombre,e))return{success:!1,error:"Ya existe un cargo con ese nombre"};if(n.nombre.trim().length<3)return{success:!1,error:"El nombre del cargo debe tener al menos 3 caracteres"}}return void 0!==n.numPersonas&&n.numPersonas<1?{success:!1,error:"Debe haber al menos 1 persona en el cargo"}:void 0!==n.area&&n.area.trim().length<2?{success:!1,error:"El √°rea debe tener al menos 2 caracteres"}:void 0!==n.zona&&n.zona.trim().length<2?{success:!1,error:"La zona debe tener al menos 2 caracteres"}:(this.data.formData.cargos[e]=v(v({},this.data.formData.cargos[e]),n),this.notify(),{success:!0})}},{key:"removeCargo",value:function(e){e<0||e>=this.data.formData.cargos.length?console.error("[WizardState] Invalid cargo index:",e):(this.data.formData.cargos.splice(e,1),this.notify())}},{key:"getCargo",value:function(e){return this.data.formData.cargos[e]}},{key:"getCargos",value:function(){return this.data.formData.cargos}},{key:"addGESToCargo",value:function(e,n){if(e<0||e>=this.data.formData.cargos.length)console.error("[WizardState] Invalid cargo index:",e);else{var t=this.data.formData.cargos[e],a=t.ges.some((function(e){return e.idGes===n.idGes}));if(a)console.warn("[WizardState] GES already exists in cargo:",n.idGes);else{var r={idGes:n.idGes,nombre:n.nombre,categoria:n.categoria||"",niveles:{deficiencia:{value:null,label:"",color:"",description:""},exposicion:{value:null,label:"",color:"",description:""},consecuencia:{value:null,label:"",color:"",description:""},nivelProbabilidad:null,nivelRiesgo:null},controles:{eliminacion:"",sustitucion:"",ingenieria:"",administrativos:"",epp:""}};t.ges.push(r),this.data.analytics.gesCount++,this.notify()}}}},{key:"removeGESFromCargo",value:function(e,n){if(e<0||e>=this.data.formData.cargos.length)console.error("[WizardState] Invalid cargo index:",e);else{var t=this.data.formData.cargos[e];n<0||n>=t.ges.length?console.error("[WizardState] Invalid GES index:",n):(t.ges.splice(n,1),this.notify())}}},{key:"updateGESNiveles",value:function(e,n,t){var a,r,o,i,s,c;if(e<0||e>=this.data.formData.cargos.length)console.error("[WizardState] Invalid cargo index:",e);else{var l=this.data.formData.cargos[e];if(n<0||n>=l.ges.length)console.error("[WizardState] Invalid GES index:",n);else{var d=l.ges[n];d.niveles=v(v({},d.niveles),t),null!==(null===(a=d.niveles.deficiencia)||void 0===a?void 0:a.value)&&void 0!==(null===(r=d.niveles.deficiencia)||void 0===r?void 0:r.value)&&null!==(null===(o=d.niveles.exposicion)||void 0===o?void 0:o.value)&&void 0!==(null===(i=d.niveles.exposicion)||void 0===i?void 0:i.value)&&(d.niveles.nivelProbabilidad=d.niveles.deficiencia.value*d.niveles.exposicion.value,console.log("[WizardState] Calculated NP: ".concat(d.niveles.nivelProbabilidad))),null!==d.niveles.nivelProbabilidad&&void 0!==d.niveles.nivelProbabilidad&&null!==(null===(s=d.niveles.consecuencia)||void 0===s?void 0:s.value)&&void 0!==(null===(c=d.niveles.consecuencia)||void 0===c?void 0:c.value)&&(d.niveles.nivelRiesgo=d.niveles.nivelProbabilidad*d.niveles.consecuencia.value,console.log("[WizardState] Calculated NR: ".concat(d.niveles.nivelRiesgo))),this.notify()}}}},{key:"updateGESControles",value:function(e,n,t){if(e<0||e>=this.data.formData.cargos.length)console.error("[WizardState] Invalid cargo index:",e);else{var a=this.data.formData.cargos[e];if(n<0||n>=a.ges.length)console.error("[WizardState] Invalid GES index:",n);else{var r=a.ges[n];r.controles=v(v({},r.controles),t),this.notify()}}}},{key:"getControles",value:function(e,n){var t=this.data.formData.cargos.findIndex((function(n){return n.id===e}));if(-1===t)return console.error("[WizardState] Cargo not found:",e),null;var a=this.data.formData.cargos[t],r=a.ges.findIndex((function(e){return e.id===n}));return-1===r?(console.error("[WizardState] GES not found:",n),null):a.ges[r].controles||{}}},{key:"setControles",value:function(e,n,t){var a=this.data.formData.cargos.findIndex((function(n){return n.id===e}));if(-1!==a){var r=this.data.formData.cargos[a].ges.findIndex((function(e){return e.id===n}));-1!==r?this.updateGESControles(a,r,t):console.error("[WizardState] GES not found:",n)}else console.error("[WizardState] Cargo not found:",e)}},{key:"_convertirControlesAGTC45",value:function(e){return e?void 0!==e.fuente?e:{fuente:[e.eliminacion,e.sustitucion].filter(Boolean).join(" | "),medio:e.ingenieria||"",individuo:[e.administrativos,e.epp].filter(Boolean).join(" | ")}:{fuente:"",medio:"",individuo:""}}},{key:"_calcularNivelProbabilidad",value:function(e,n){return("object"===c(e)?e.value:e)*("object"===c(n)?n.value:n)}},{key:"_calcularNivelRiesgo",value:function(e,n){return e*("object"===c(n)?n.value:n)}},{key:"_interpretarNivelRiesgo",value:function(e){return e>=600?{nivel:"I",significado:"No Aceptable",accion:"Intervenci√≥n inmediata",color:"red"}:e>=150?{nivel:"II",significado:"No Aceptable o Aceptable con control",accion:"Corregir urgente",color:"orange"}:e>=40?{nivel:"III",significado:"Mejorable",accion:"Mejorar control",color:"yellow"}:{nivel:"IV",significado:"Aceptable",accion:"Mantener control",color:"green"}}},{key:"exportForSubmission",value:function(){var e=this;return{formData:{cargos:this.data.formData.cargos.map((function(n){return{cargoName:n.nombre,area:n.area,zona:n.zona,numTrabajadores:n.numPersonas,descripcionTareas:n.descripcion,tareasRutinarias:n.tareasRutinarias,manipulaAlimentos:n.manipulaAlimentos,trabajaAlturas:n.trabajaAlturas,trabajaEspaciosConfinados:n.trabajaEspaciosConfinados,conduceVehiculo:n.conduceVehiculo,gesSeleccionados:n.ges.map((function(n){var t=n.niveles.deficiencia,a=n.niveles.exposicion,r=n.niveles.consecuencia,o=e._calcularNivelProbabilidad(t,a),i=e._calcularNivelRiesgo(o,r),s=e._interpretarNivelRiesgo(i);return{riesgo:n.categoria,ges:n.nombre,controles:e._convertirControlesAGTC45(n.controles),niveles:{deficiencia:t,exposicion:a,consecuencia:r,nivelProbabilidad:o,nivelRiesgo:i,interpretacion:s}}}))}}))},userData:{nombreEmpresa:this.data.formData.nombreEmpresa,nit:this.data.formData.nit,email:this.data.formData.email,sector:this.data.formData.sector,nombreContacto:this.data.formData.nombreContacto||this.data.formData.email},analytics:{totalTimeSeconds:Math.floor((Date.now()-this.data.analytics.sessionStartTime)/1e3),timePerStep:this.data.analytics.timeSpentPerStep,errorCount:this.data.analytics.errorCount,cargoCount:this.data.analytics.cargoCount,gesCount:this.data.analytics.gesCount}}}},{key:"getAnalytics",value:function(){return v(v({},this.data.analytics),{},{totalTime:Date.now()-this.data.analytics.sessionStartTime,currentStepTime:Date.now()-this.data.analytics.stepStartTime})}}])}(),m=null;function b(){return m||(m=new h),m}function y(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}function x(t){return function(n){if(Array.isArray(n))return e(n)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const w=globalThis,C=w.trustedTypes,E=C?C.createPolicy("lit-html",{createHTML:e=>e}):void 0,S="$lit$",k=`lit$${Math.random().toFixed(9).slice(2)}$`,A="?"+k,_=`<${A}>`,z=document,N=()=>z.createComment(""),T=e=>null===e||"object"!=typeof e&&"function"!=typeof e,L=Array.isArray,I=e=>L(e)||"function"==typeof e?.[Symbol.iterator],P="[ \t\n\f\r]",D=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,j=/-->/g,q=/>/g,R=RegExp(`>|${P}(?:([^\\s"'>=/]+)(${P}*=${P}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),G=/'/g,O=/"/g,F=/^(?:script|style|textarea|title)$/i,M=e=>(n,...t)=>({_$litType$:e,strings:n,values:t}),$=M(1),H=(M(2),M(3),Symbol.for("lit-noChange")),B=Symbol.for("lit-nothing"),W=new WeakMap,V=z.createTreeWalker(z,129);function U(e,n){if(!L(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==E?E.createHTML(n):n}const K=(e,n)=>{const t=e.length-1,a=[];let r,o=2===n?"<svg>":3===n?"<math>":"",i=D;for(let n=0;n<t;n++){const t=e[n];let s,c,l=-1,d=0;for(;d<t.length&&(i.lastIndex=d,c=i.exec(t),null!==c);)d=i.lastIndex,i===D?"!--"===c[1]?i=j:void 0!==c[1]?i=q:void 0!==c[2]?(F.test(c[2])&&(r=RegExp("</"+c[2],"g")),i=R):void 0!==c[3]&&(i=R):i===R?">"===c[0]?(i=r??D,l=-1):void 0===c[1]?l=-2:(l=i.lastIndex-c[2].length,s=c[1],i=void 0===c[3]?R:'"'===c[3]?O:G):i===O||i===G?i=R:i===j||i===q?i=D:(i=R,r=void 0);const u=i===R&&e[n+1].startsWith("/>")?" ":"";o+=i===D?t+_:l>=0?(a.push(s),t.slice(0,l)+S+t.slice(l)+k+u):t+k+(-2===l?n:u)}return[U(e,o+(e[t]||"<?>")+(2===n?"</svg>":3===n?"</math>":"")),a]};class Y{constructor({strings:e,_$litType$:n},t){let a;this.parts=[];let r=0,o=0;const i=e.length-1,s=this.parts,[c,l]=K(e,n);if(this.el=Y.createElement(c,t),V.currentNode=this.el.content,2===n||3===n){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(a=V.nextNode())&&s.length<i;){if(1===a.nodeType){if(a.hasAttributes())for(const e of a.getAttributeNames())if(e.endsWith(S)){const n=l[o++],t=a.getAttribute(e).split(k),i=/([.?@])?(.*)/.exec(n);s.push({type:1,index:r,name:i[2],strings:t,ctor:"."===i[1]?ee:"?"===i[1]?ne:"@"===i[1]?te:Z}),a.removeAttribute(e)}else e.startsWith(k)&&(s.push({type:6,index:r}),a.removeAttribute(e));if(F.test(a.tagName)){const e=a.textContent.split(k),n=e.length-1;if(n>0){a.textContent=C?C.emptyScript:"";for(let t=0;t<n;t++)a.append(e[t],N()),V.nextNode(),s.push({type:2,index:++r});a.append(e[n],N())}}}else if(8===a.nodeType)if(a.data===A)s.push({type:2,index:r});else{let e=-1;for(;-1!==(e=a.data.indexOf(k,e+1));)s.push({type:7,index:r}),e+=k.length-1}r++}}static createElement(e,n){const t=z.createElement("template");return t.innerHTML=e,t}}function J(e,n,t=e,a){if(n===H)return n;let r=void 0!==a?t._$Co?.[a]:t._$Cl;const o=T(n)?void 0:n._$litDirective$;return r?.constructor!==o&&(r?._$AO?.(!1),void 0===o?r=void 0:(r=new o(e),r._$AT(e,t,a)),void 0!==a?(t._$Co??=[])[a]=r:t._$Cl=r),void 0!==r&&(n=J(e,r._$AS(e,n.values),r,a)),n}class X{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:n},parts:t}=this._$AD,a=(e?.creationScope??z).importNode(n,!0);V.currentNode=a;let r=V.nextNode(),o=0,i=0,s=t[0];for(;void 0!==s;){if(o===s.index){let n;2===s.type?n=new Q(r,r.nextSibling,this,e):1===s.type?n=new s.ctor(r,s.name,s.strings,this,e):6===s.type&&(n=new ae(r,this,e)),this._$AV.push(n),s=t[++i]}o!==s?.index&&(r=V.nextNode(),o++)}return V.currentNode=z,a}p(e){let n=0;for(const t of this._$AV)void 0!==t&&(void 0!==t.strings?(t._$AI(e,t,n),n+=t.strings.length-2):t._$AI(e[n])),n++}}class Q{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,n,t,a){this.type=2,this._$AH=B,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=t,this.options=a,this._$Cv=a?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return void 0!==n&&11===e?.nodeType&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=J(this,e,n),T(e)?e===B||null==e||""===e?(this._$AH!==B&&this._$AR(),this._$AH=B):e!==this._$AH&&e!==H&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):I(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==B&&T(this._$AH)?this._$AA.nextSibling.data=e:this.T(z.createTextNode(e)),this._$AH=e}$(e){const{values:n,_$litType$:t}=e,a="number"==typeof t?this._$AC(e):(void 0===t.el&&(t.el=Y.createElement(U(t.h,t.h[0]),this.options)),t);if(this._$AH?._$AD===a)this._$AH.p(n);else{const e=new X(a,this),t=e.u(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let n=W.get(e.strings);return void 0===n&&W.set(e.strings,n=new Y(e)),n}k(e){L(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let t,a=0;for(const r of e)a===n.length?n.push(t=new Q(this.O(N()),this.O(N()),this,this.options)):t=n[a],t._$AI(r),a++;a<n.length&&(this._$AR(t&&t._$AB.nextSibling,a),n.length=a)}_$AR(e=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Z{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,n,t,a,r){this.type=1,this._$AH=B,this._$AN=void 0,this.element=e,this.name=n,this._$AM=a,this.options=r,t.length>2||""!==t[0]||""!==t[1]?(this._$AH=Array(t.length-1).fill(new String),this.strings=t):this._$AH=B}_$AI(e,n=this,t,a){const r=this.strings;let o=!1;if(void 0===r)e=J(this,e,n,0),o=!T(e)||e!==this._$AH&&e!==H,o&&(this._$AH=e);else{const a=e;let i,s;for(e=r[0],i=0;i<r.length-1;i++)s=J(this,a[t+i],n,i),s===H&&(s=this._$AH[i]),o||=!T(s)||s!==this._$AH[i],s===B?e=B:e!==B&&(e+=(s??"")+r[i+1]),this._$AH[i]=s}o&&!a&&this.j(e)}j(e){e===B?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ee extends Z{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===B?void 0:e}}class ne extends Z{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==B)}}class te extends Z{constructor(e,n,t,a,r){super(e,n,t,a,r),this.type=5}_$AI(e,n=this){if((e=J(this,e,n,0)??B)===H)return;const t=this._$AH,a=e===B&&t!==B||e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive,r=e!==B&&(t===B||a);a&&this.element.removeEventListener(this.name,this,t),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class ae{constructor(e,n,t){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=t}get _$AU(){return this._$AM._$AU}_$AI(e){J(this,e)}}const re={M:S,P:k,A,C:1,L:K,R:X,D:I,V:J,I:Q,H:Z,N:ne,U:te,B:ee,F:ae},oe=w.litHtmlPolyfillSupport;oe?.(Y,Q),(w.litHtmlVersions??=[]).push("3.3.1");const ie=(e,n,t)=>{const a=t?.renderBefore??n;let r=a._$litPart$;if(void 0===r){const e=t?.renderBefore??null;a._$litPart$=r=new Q(n.insertBefore(N(),e),e,void 0,t??{})}return r._$AI(e),r},se=2;class ce{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,n,t){this._$Ct=e,this._$AM=n,this._$Ci=t}_$AS(e,n){return this.update(e,n)}update(e,n){return this.render(...n)}}const{I:le}=re,de=()=>document.createComment(""),ue=(e,n,t)=>{const a=e._$AA.parentNode,r=void 0===n?e._$AB:n._$AA;if(void 0===t){const n=a.insertBefore(de(),r),o=a.insertBefore(de(),r);t=new le(n,o,e,e.options)}else{const n=t._$AB.nextSibling,o=t._$AM,i=o!==e;if(i){let n;t._$AQ?.(e),t._$AM=e,void 0!==t._$AP&&(n=e._$AU)!==o._$AU&&t._$AP(n)}if(n!==r||i){let e=t._$AA;for(;e!==n;){const n=e.nextSibling;a.insertBefore(e,r),e=n}}}return t},ge=(e,n,t=e)=>(e._$AI(n,t),e),pe={},fe=e=>{e._$AR(),e._$AA.remove()},ve=(e,n,t)=>{const a=new Map;for(let r=n;r<=t;r++)a.set(e[r],r);return a},he=(e=>(...n)=>({_$litDirective$:e,values:n}))(class extends ce{constructor(e){if(super(e),e.type!==se)throw Error("repeat() can only be used in text expressions")}dt(e,n,t){let a;void 0===t?t=n:void 0!==n&&(a=n);const r=[],o=[];let i=0;for(const n of e)r[i]=a?a(n,i):i,o[i]=t(n,i),i++;return{values:o,keys:r}}render(e,n,t){return this.dt(e,n,t).values}update(e,[n,t,a]){const r=(e=>e._$AH)(e),{values:o,keys:i}=this.dt(n,t,a);if(!Array.isArray(r))return this.ut=i,o;const s=this.ut??=[],c=[];let l,d,u=0,g=r.length-1,p=0,f=o.length-1;for(;u<=g&&p<=f;)if(null===r[u])u++;else if(null===r[g])g--;else if(s[u]===i[p])c[p]=ge(r[u],o[p]),u++,p++;else if(s[g]===i[f])c[f]=ge(r[g],o[f]),g--,f--;else if(s[u]===i[f])c[f]=ge(r[u],o[f]),ue(e,c[f+1],r[u]),u++,f--;else if(s[g]===i[p])c[p]=ge(r[g],o[p]),ue(e,r[u],r[g]),g--,p++;else if(void 0===l&&(l=ve(i,p,f),d=ve(s,u,g)),l.has(s[u]))if(l.has(s[g])){const n=d.get(i[p]),t=void 0!==n?r[n]:null;if(null===t){const n=ue(e,r[u]);ge(n,o[p]),c[p]=n}else c[p]=ge(t,o[p]),ue(e,r[u],t),r[n]=null;p++}else fe(r[g]),g--;else fe(r[u]),u++;for(;p<=f;){const n=ue(e,c[f+1]);ge(n,o[p]),c[p++]=n}for(;u<=g;){const e=r[u++];null!==e&&fe(e)}return this.ut=i,((e,n=pe)=>{e._$AH=n})(e,c),H}});var me,be,ye,xe,we,Ce,Ee,Se,ke,Ae,_e,ze,Ne,Te,Le,Ie,Pe,De,je,qe,Re,Ge,Oe,Fe,Me,$e,He;function Be(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function We(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Be(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Be(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Ve,Ue,Ke,Ye,Je,Xe,Qe,Ze,en,nn,tn,an,rn,on,sn,cn,ln,dn,un,gn,pn,fn,vn,hn,mn,bn,yn,xn,wn,Cn,En,Sn,kn={Mec√°nico:"#cbe3f3",El√©ctrico:"#fee6fc",F√≠sico:"#fdf8cd",Qu√≠mico:"#c7f9ff",Biol√≥gico:"#d8fff1",Biomec√°nico:"#d8fff1","Factores Humanos":"#ffefd2",Psicosocial:"#e6e6e6",Locativo:"#fee6fc",Natural:"#fee6fc",Seguridad:"#fee6fc","Otros Riesgos":"#fee6fc","Saneamiento B√°sico":"#fee6fc","Salud P√∫blica":"#fee6fc"},An=function(){return p((function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(this,e),this.container="string"==typeof n?document.querySelector(n):n,!this.container)throw new Error("RiesgoSelector: Container not found");this.options=We({cargoIndex:t.cargoIndex||0,cargoNombre:t.cargoNombre||"",sector:t.sector||null,seleccionados:t.seleccionados||[],onChange:t.onChange||function(){},onDetailsLoaded:t.onDetailsLoaded||function(){}},t),this.state={vistaComunes:!0,categoriaActiva:null,busqueda:"",filtrosColapsados:!1,catalogoGES:[],catalogoRiesgos:[],gesVisible:[],seleccionados:x(this.options.seleccionados),gesDetallesCache:new Map,loadingDetalles:new Set,catalogoIncompleto:!1,categoriasFaltantes:[],gruposColapsados:new Set,carouselIndex:0,aiSuggestions:[],aiSuggestionsCache:new Map,loadingAI:!1,showAISuggestions:!0,gesRanking:new Map,loading:!1,error:null},this.debounceTimer=null,this.init()}),[{key:"init",value:(i=o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.loading=!0,this.renderComponent(),e.prev=2,e.next=5,this.loadCatalogos();case 5:return e.next=7,this.validateCatalogo();case 7:return this.updateGESVisible(),e.next=10,Promise.all([this.fetchAISuggestions(),this.fetchGESRanking()]);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("Error inicializando RiesgoSelector:",e.t0),this.state.error=e.t0.message;case 16:return e.prev=16,this.state.loading=!1,this.renderComponent(),e.finish(16);case 20:case"end":return e.stop()}}),e,this,[[2,12,16,20]])}))),function(){return i.apply(this,arguments)})},{key:"validateCatalogo",value:(r=o(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/catalogo/validate-categories");case 3:if((n=e.sent).ok){e.next=7;break}return console.warn("‚ö†Ô∏è  No se pudo validar cat√°logo:",n.statusText),e.abrupt("return");case 7:return e.next=9,n.json();case 9:t=e.sent,(a=t.data).ok?console.log("‚úÖ Validaci√≥n de cat√°logo: Todas las categor√≠as presentes"):(this.state.catalogoIncompleto=!0,this.state.categoriasFaltantes=a.missing,console.warn("‚ö†Ô∏è  Cat√°logo incompleto:",a.missing.join(", "))),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("‚ùå Error validando cat√°logo:",e.t0);case 17:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(){return r.apply(this,arguments)})},{key:"loadCatalogos",value:function(){var e=o(s().mark((function e(){var n,t,a,r,o,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("‚è≥ Cargando cat√°logos (modo ligero)..."),n=performance.now(),e.prev=2,e.next=5,fetch("/api/catalogo/riesgos");case 5:if((t=e.sent).ok){e.next=8;break}throw new Error("Error ".concat(t.status,": ").concat(t.statusText));case 8:return e.next=10,t.json();case 10:return a=e.sent,this.state.catalogoRiesgos=a.data,e.next=14,fetch("/api/catalogo/ges?fields=light&limit=200");case 14:if((r=e.sent).ok){e.next=17;break}throw new Error("Error ".concat(r.status,": ").concat(r.statusText));case 17:return e.next=19,r.json();case 19:o=e.sent,this.state.catalogoGES=o.data,i=performance.now(),c=(i-n).toFixed(2),console.log("‚úÖ Cat√°logos cargados en ".concat(c,"ms (modo ligero)")),console.log("   - Riesgos: ".concat(this.state.catalogoRiesgos.length," categor√≠as")),console.log("   - GES: ".concat(this.state.catalogoGES.length," riesgos (datos ligeros)")),console.log("   - Payload estimado: ~".concat((.2*this.state.catalogoGES.length).toFixed(1)," KB")),e.next=33;break;case 29:throw e.prev=29,e.t0=e.catch(2),console.error("‚ùå Error cargando cat√°logos:",e.t0),e.t0;case 33:case"end":return e.stop()}}),e,this,[[2,29]])})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAISuggestions",value:(a=o(s().mark((function e(){var n,t,a,r,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.options.cargoNombre,t=this.options.sector,n&&""!==n.trim()){e.next=5;break}return console.log("‚ö†Ô∏è Skip AI suggestions: No hay nombre de cargo"),e.abrupt("return");case 5:if(a="".concat(n.toLowerCase(),"-").concat(t||"general"),!this.state.aiSuggestionsCache.has(a)){e.next=10;break}return console.log('‚úÖ AI suggestions en cache para "'.concat(n,'"')),this.state.aiSuggestions=this.state.aiSuggestionsCache.get(a),e.abrupt("return");case 10:return e.prev=10,this.state.loadingAI=!0,console.log('ü§ñ Fetch AI suggestions para cargo: "'.concat(n,'"').concat(t?" (sector: ".concat(t,")"):"")),e.next=15,fetch("/api/ia/suggest-ges",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cargoName:n,sector:t||null,limit:5})});case 15:if((r=e.sent).ok){e.next=18;break}throw new Error("Error ".concat(r.status,": ").concat(r.statusText));case 18:return e.next=20,r.json();case 20:(o=e.sent).success&&o.data?(this.state.aiSuggestions=o.data,this.state.aiSuggestionsCache.set(a,o.data),console.log("‚úÖ AI suggestions cargadas: ".concat(o.data.length," sugerencias (confidence promedio: ").concat((null===(i=o.metadata)||void 0===i?void 0:i.avgConfidence)||"N/A",")"))):(console.warn("‚ö†Ô∏è No se encontraron sugerencias de IA"),this.state.aiSuggestions=[]),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(10),console.error("‚ùå Error fetching AI suggestions:",e.t0),this.state.aiSuggestions=[];case 28:return e.prev=28,this.state.loadingAI=!1,e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[10,24,28,31]])}))),function(){return a.apply(this,arguments)})},{key:"fetchGESRanking",value:(t=o(s().mark((function e(){var n,t,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("üìä Fetch GES ranking (frecuencia de uso)..."),e.next=4,fetch("/api/catalogo/ges?fields=ranking&limit=100");case 4:if((n=e.sent).ok){e.next=7;break}throw new Error("Error ".concat(n.status,": ").concat(n.statusText));case 7:return e.next=9,n.json();case 9:(t=e.sent).success&&t.data&&(t.data.forEach((function(e){if(e.es_comun||e.relevancia_por_sector){var n,t=(null===(n=e.relevancia_por_sector)||void 0===n?void 0:n[a.options.sector])||(e.es_comun?3:1),r=Math.min(5,Math.max(1,Math.round(t/2))),o=e.es_comun?.5*Math.random()+.5:.3*Math.random();a.state.gesRanking.set(e.id,{stars:r,frequency:Math.round(100*o),sector:a.options.sector,isCommon:e.es_comun,relevancia:e.relevancia_por_sector})}})),console.log("‚úÖ GES ranking cargado: ".concat(this.state.gesRanking.size," GES con ranking"))),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("‚ùå Error fetching GES ranking:",e.t0);case 16:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return t.apply(this,arguments)})},{key:"loadGESDetails",value:(n=o(s().mark((function e(n){var t,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.gesDetallesCache.has(n)){e.next=3;break}return console.log("‚úÖ GES ".concat(n," ya en cache, skip fetch")),e.abrupt("return",this.state.gesDetallesCache.get(n));case 3:if(!this.state.loadingDetalles.has(n)){e.next=6;break}return console.log("‚è≥ GES ".concat(n," ya est√° cargando, skip fetch")),e.abrupt("return",null);case 6:return e.prev=6,this.state.loadingDetalles.add(n),console.log("‚è≥ Cargando detalles de GES ".concat(n," en background...")),e.next=11,fetch("/api/catalogo/ges/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ges_ids:[n]})});case 11:if((t=e.sent).ok){e.next=14;break}throw new Error("Error ".concat(t.status,": ").concat(t.statusText));case 14:return e.next=16,t.json();case 16:if(!((a=e.sent).success&&a.data.length>0)){e.next=23;break}return r=a.data[0],this.state.gesDetallesCache.set(n,r),console.log("‚úÖ Detalles de GES ".concat(n," cargados y cacheados")),this.options.onDetailsLoaded(r),e.abrupt("return",r);case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(6),console.error("‚ùå Error cargando detalles de GES ".concat(n,":"),e.t0);case 28:return e.prev=28,this.state.loadingDetalles.delete(n),e.finish(28);case 31:return e.abrupt("return",null);case 32:case"end":return e.stop()}}),e,this,[[6,25,28,31]])}))),function(e){return n.apply(this,arguments)})},{key:"preloadSelectedDetails",value:(e=o(s().mark((function e(){var n,t,a,r,o,i,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.seleccionados.map((function(e){return e.id})).filter((function(e){return!c.state.gesDetallesCache.has(e)})),0!==n.length){e.next=4;break}return console.log("‚úÖ Todos los detalles ya est√°n en cache"),e.abrupt("return",this.state.gesDetallesCache);case 4:return console.log("‚è≥ Precargando detalles de ".concat(n.length," GES en batch...")),t=performance.now(),e.prev=6,e.next=9,fetch("/api/catalogo/ges/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ges_ids:n})});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error ".concat(a.status,": ").concat(a.statusText));case 12:return e.next=14,a.json();case 14:(r=e.sent).success&&(r.data.forEach((function(e){c.state.gesDetallesCache.set(e.id,e)})),o=performance.now(),i=(o-t).toFixed(2),console.log("‚úÖ ".concat(r.count," detalles precargados en ").concat(i,"ms")),console.log("   - Cache size: ".concat(this.state.gesDetallesCache.size," GES"))),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),console.error("‚ùå Error precargando detalles:",e.t0);case 21:return e.abrupt("return",this.state.gesDetallesCache);case 22:case"end":return e.stop()}}),e,this,[[6,18]])}))),function(){return e.apply(this,arguments)})},{key:"updateGESVisible",value:function(){var e=this,n=x(this.state.catalogoGES);if(this.state.vistaComunes&&(n=n.filter((function(e){return!0===e.es_comun}))),null!==this.state.categoriaActiva&&(n=n.filter((function(n){return n.riesgo_id===e.state.categoriaActiva}))),this.state.busqueda){var t=this.state.busqueda.toLowerCase();n=n.filter((function(e){var n;return e.nombre.toLowerCase().includes(t)||(null===(n=e.descripcion)||void 0===n?void 0:n.toLowerCase().includes(t))}))}this.state.gesVisible=n}},{key:"renderComponent",value:function(){var e=$(me||(me=y(['\n      <div class="riesgo-selector">\n        ',"\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n    "])),this.renderHeader(),this.renderWarningBanner(),this.renderSearch(),this.renderFilters(),this.renderAISuggestions(),this.state.loading?this.renderLoading():this.state.error?this.renderError():this.renderGESList(),this.renderFooter());ie(e,this.container)}},{key:"renderWarningBanner",value:function(){return this.state.catalogoIncompleto?$(be||(be=y(['\n      <div class="riesgo-selector__warning-banner">\n        <i class="fas fa-exclamation-triangle"></i>\n        <div class="riesgo-selector__warning-content">\n          <strong>Advertencia:</strong> El cat√°logo de riesgos est√° incompleto.\n          <br>\n          <small>\n            Categor√≠as no disponibles: <strong>',"</strong>\n            <br>\n            Esto puede afectar el cumplimiento de la Resoluci√≥n 0312 de 2019 (SST Colombia).\n            Por favor, contacte al administrador del sistema.\n          </small>\n        </div>\n      </div>\n    "])),this.state.categoriasFaltantes.join(", ")):""}},{key:"renderLoading",value:function(){var e=Array.from({length:6},(function(e,n){return n}));return $(ye||(ye=y(['\n      <div class="riesgo-selector__list">\n        ',"\n      </div>\n    "])),e.map((function(e){return $(xe||(xe=y(['\n          <div class="ges-item skeleton">\n            <div class="ges-item__content">\n              <div class="ges-item__header">\n                <span class="skeleton-text skeleton-text--title"></span>\n                <span class="skeleton-badge"></span>\n              </div>\n\n              <p class="skeleton-text skeleton-text--description"></p>\n              <p class="skeleton-text skeleton-text--description short"></p>\n\n              <div class="ges-item__meta">\n                <span class="skeleton-text skeleton-text--category"></span>\n              </div>\n            </div>\n          </div>\n        '])))})))}},{key:"renderError",value:function(){var e=this;return $(we||(we=y(['\n      <div class="riesgo-selector__error">\n        <i class="fas fa-exclamation-triangle"></i>\n        <p>Error cargando cat√°logo: ','</p>\n        <button class="wizard-btn wizard-btn-secondary" @click=','>\n          <i class="fas fa-redo"></i>\n          Reintentar\n        </button>\n      </div>\n    '])),this.state.error,(function(){return e.init()}))}},{key:"renderHeader",value:function(){return $(Ce||(Ce=y(['\n      <div class="riesgo-selector__header">\n        <h2>Selecciona los riesgos</h2>\n        <p class="riesgo-selector__cargo-info">\n          <i class="fas fa-briefcase"></i>\n          Cargo: <strong>',"</strong>\n        </p>\n      </div>\n    "])),this.options.cargoNombre)}},{key:"renderSearch",value:function(){var e=this;return $(Ee||(Ee=y(['\n      <div class="riesgo-selector__search">\n        <div class="search-input-wrapper">\n          <i class="fas fa-search search-icon"></i>\n          <input\n            type="text"\n            class="search-input"\n            placeholder="Buscar riesgo... (ej: ruido, posturas, ca√≠das)"\n            .value=',"\n            @input=","\n          />\n          ","\n        </div>\n      </div>\n    "])),this.state.busqueda,(function(n){return e.handleSearch(n)}),this.state.busqueda?$(Se||(Se=y(['\n            <button class="search-clear" @click=','>\n              <i class="fas fa-times"></i>\n            </button>\n          '])),(function(){return e.handleClearSearch()})):"")}},{key:"renderFilters",value:function(){var e=this,n=this.state.catalogoRiesgos;return $(ke||(ke=y(['\n      <div class="riesgo-selector__filters-compact">\n        \x3c!-- View Toggle Switch (left) --\x3e\n        <div class="filters-view-toggle">\n          <button\n            class="view-toggle-btn ','"\n            @click=','\n            title="Mostrar riesgos comunes"\n          >\n            <i class="fas fa-star"></i>\n            <span>Comunes</span>\n          </button>\n          <button\n            class="view-toggle-btn ','"\n            @click=','\n            title="Mostrar todos los riesgos"\n          >\n            <i class="fas fa-list"></i>\n            <span>Todos (',')</span>\n          </button>\n        </div>\n\n        \x3c!-- Category Dropdown (right) --\x3e\n        <div class="filters-category-dropdown">\n          <label for="category-select">\n            <i class="fas fa-filter"></i>\n            Categor√≠a:\n          </label>\n          <select\n            id="category-select"\n            .value=',"\n            @change=",'\n          >\n            <option value="">Todas las categor√≠as</option>\n            ',"\n          </select>\n        </div>\n      </div>\n    "])),this.state.vistaComunes?"active":"",(function(){return e.handleToggleView("comunes")}),this.state.vistaComunes?"":"active",(function(){return e.handleToggleView("todos")}),this.state.catalogoGES.length,this.state.categoriaActiva||"",(function(n){return e.handleFilterCategory(""===n.target.value?null:parseInt(n.target.value))}),n.map((function(e){return $(Ae||(Ae=y(['\n              <option value="','">\n                ',"\n              </option>\n            "])),e.id,e.nombre)})))}},{key:"renderAISuggestions",value:function(){var e=this;if(0===this.state.aiSuggestions.length)return"";var n=this.options.cargoNombre||"este cargo",t=this.state.showAISuggestions;return $(_e||(_e=y(['\n      <div class="ai-suggestions-panel">\n        \x3c!-- Badge trigger button --\x3e\n        <button\n          class="ai-trigger-badge ','"\n          @click=','\n          title="Ver sugerencias inteligentes de IA"\n        >\n          <i class="fas fa-brain"></i>\n          <span>Sugerencias IA</span>\n          <span class="ai-badge-count">','</span>\n        </button>\n\n        \x3c!-- Overlay invisible (cierra popover al hacer clic fuera) --\x3e\n        <div\n          class="ai-popover-overlay ','"\n          @click=','\n        ></div>\n\n        \x3c!-- Popover content --\x3e\n        <div\n          class="ai-popover ','"\n          data-popover-placement="bottom"\n        >\n          \x3c!-- Arrow (decorativo) --\x3e\n          <div class="ai-popover-arrow"></div>\n\n          \x3c!-- Header --\x3e\n          <div class="ai-popover-header">\n            <h3>\n              <i class="fas fa-sparkles"></i>\n              Sugerencias para "','"\n            </h3>\n            <p class="ai-subtitle">\n              ','\n            </p>\n          </div>\n\n          \x3c!-- Body (scrollable) --\x3e\n          <div class="ai-popover-body">\n            <div class="ai-chips-container">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- Footer --\x3e\n          <div class="ai-popover-footer">\n            <p class="ai-info-text">\n              <i class="fas fa-info-circle"></i>\n              Haz clic en "Ver riesgos" para filtrar el cat√°logo seg√∫n la sugerencia.\n            </p>\n          </div>\n        </div>\n      </div>\n    '])),t?"active":"",(function(){return e.handleToggleAISuggestions()}),this.state.aiSuggestions.length,t?"active":"",(function(){return e.handleToggleAISuggestions()}),t?"active":"",n,this.state.loadingAI?"Cargando sugerencias...":"".concat(this.state.aiSuggestions.length," riesgos recomendados"),this.state.aiSuggestions.map((function(n,t){var a=e.state.gesVisible.filter((function(e){return e.riesgo&&e.riesgo.includes(n.riesgo.replace("Riesgo ",""))})),r=a.filter((function(n){return e.state.seleccionados.some((function(e){return e.id===n.id}))})),o=a.length>0&&r.length===a.length,i=r.length>0&&!o;return $(ze||(ze=y(['\n                  <div\n                    class="ai-chip '," ",'"\n                  >\n                    \x3c!-- Header del chip --\x3e\n                    <div class="ai-chip-header">\n                      \x3c!-- Icon --\x3e\n                      <span class="ai-chip-icon">\n                        ','\n                      </span>\n\n                      \x3c!-- Info --\x3e\n                      <div class="ai-chip-info">\n                        <div class="ai-chip-name">','</div>\n                        <div class="ai-chip-meta">\n                          ',"\n                          ",'\n                        </div>\n                      </div>\n\n                      \x3c!-- Badge (index) --\x3e\n                      <div class="ai-chip-badge">','</div>\n                    </div>\n\n                    \x3c!-- Action button --\x3e\n                    <button\n                      class="ai-chip-action"\n                      @click=','\n                      title="Filtrar y ver riesgos de este tipo"\n                    >\n                      <i class="fas fa-filter"></i>\n                      <span>Ver riesgos</span>\n                    </button>\n                  </div>\n                '])),o?"all-selected":"",i?"partial-selected":"",e.getRiesgoIcon(n.riesgo),n.riesgo,a.length>0?$(Ne||(Ne=y(['\n                            <span class="ai-chip-count">'," GES disponibles</span>\n                          "])),a.length):"",n.confidence>=70?$(Te||(Te=y(['\n                            <span class="ai-confidence">\n                              <i class="fas fa-check-circle"></i>\n                              ',"% confianza\n                            </span>\n                          "])),n.confidence):"",t+1,(function(){e.handleFilterByRiesgo(n.riesgo),e.handleToggleAISuggestions()}))})))}},{key:"getRiesgoIcon",value:function(e){return{Mec√°nico:"‚öôÔ∏è",El√©ctrico:"‚ö°",F√≠sico:"üì°",Qu√≠mico:"üß™",Biol√≥gico:"ü¶†",Biomec√°nico:"ü¶¥",Psicosocial:"üß†",Locativo:"üè¢",Natural:"üå™Ô∏è","Factores Humanos":"üë§",Seguridad:"üõ°Ô∏è","Saneamiento B√°sico":"üíß","Salud P√∫blica":"üè•"}[e]||"üìã"}},{key:"renderGESList",value:function(){var e=this;if(0===this.state.gesVisible.length)return $(Le||(Le=y(['\n        <div class="riesgo-selector__empty">\n          <i class="fas fa-search" style="font-size: 4rem; color: #ccc; margin-bottom: 1rem;"></i>\n          <p>No se encontraron riesgos con los filtros seleccionados</p>\n          <button class="wizard-btn wizard-btn-secondary" @click=','>\n            <i class="fas fa-times"></i>\n            Limpiar filtros\n          </button>\n        </div>\n      '])),(function(){return e.handleClearFilters()}));var n=this.groupGESByRiesgo(),t=this.state.carouselIndex,a=n.length;return t>=a&&(this.state.carouselIndex=0),$(Ie||(Ie=y(['\n      <div class="ges-groups-carousel-wrapper">\n        \x3c!-- Carousel container --\x3e\n        <div class="ges-groups-carousel">\n          \x3c!-- Track con transform para slide --\x3e\n          <div class="carousel-track" style="transform: translateX(-','%)">\n            ','\n          </div>\n        </div>\n\n        \x3c!-- Botones de navegaci√≥n --\x3e\n        <button\n          class="carousel-nav carousel-nav-prev"\n          @click=',"\n          ?disabled=",'\n          aria-label="Riesgo anterior"\n        >\n          <i class="fas fa-chevron-left"></i>\n        </button>\n\n        <button\n          class="carousel-nav carousel-nav-next"\n          @click=',"\n          ?disabled=",'\n          aria-label="Siguiente riesgo"\n        >\n          <i class="fas fa-chevron-right"></i>\n        </button>\n\n        \x3c!-- Indicadores de progreso --\x3e\n        <div class="carousel-indicators">\n          \x3c!-- Contador num√©rico --\x3e\n          <div class="carousel-counter">\n            <span class="current">','</span>\n            <span class="separator"> / </span>\n            <span class="total">','</span>\n          </div>\n\n          \x3c!-- Dots indicators --\x3e\n          <div class="carousel-dots">\n            ','\n          </div>\n\n          \x3c!-- Quick jump dropdown --\x3e\n          <div class="carousel-quick-jump">\n            <label for="carousel-select">Ir a:</label>\n            <select\n              id="carousel-select"\n              .value=',"\n              @change=","\n            >\n              ","\n            </select>\n          </div>\n        </div>\n      </div>\n    "])),100*t,n.map((function(n){return e.renderGESGroup(n)})),(function(){return e.handleCarouselPrev()}),0===t,(function(){return e.handleCarouselNext()}),t>=a-1,t+1,a,n.map((function(n,a){return $(Pe||(Pe=y(['\n              <button\n                class="carousel-dot ','"\n                @click=','\n                aria-label="Ir a riesgo ','"\n              ></button>\n            '])),a===t?"active":"",(function(){return e.handleCarouselGoTo(a)}),a+1)})),t,(function(n){return e.handleCarouselGoTo(parseInt(n.target.value))}),n.map((function(e,n){return $(De||(De=y(['\n                <option value="','">\n                  ',"\n                </option>\n              "])),n,e.riesgo.nombre)})))}},{key:"renderGESGroup",value:function(e){var n=this,t=e.riesgo.nombre,a=kn[t]||"#f0f0f0",r=this.state.gruposColapsados.has(t),o=e.ges,i=o.length,s=o.filter((function(e){return n.state.seleccionados.some((function(n){return n.id===e.id}))})).length,c=i>0&&s===i;return $(je||(je=y(['\n      <div class="ges-group" data-riesgo="','">\n        \x3c!-- Header del grupo --\x3e\n        <div class="ges-group__header" style="background-color: ','">\n          <div class="ges-group__header-left">\n            <button\n              class="ges-group__toggle"\n              @click=','\n              aria-label="'," grupo ",'"\n            >\n              <i class="fas fa-chevron-','"></i>\n            </button>\n\n            <h3 class="ges-group__title">\n              ','\n              <span class="ges-group__count">\n                (',"/",')\n              </span>\n            </h3>\n          </div>\n\n          <button\n            class="ges-group__select-all ','"\n            @click=','\n            title="','"\n          >\n            <i class="fas fa-','-circle"></i>\n            ',"\n          </button>\n        </div>\n\n        \x3c!-- Lista de GES del grupo --\x3e\n        ","\n      </div>\n    "])),t,a,(function(){return n.handleToggleGroup(t)}),r?"Expandir":"Colapsar",t,r?"right":"down",t,s,i,c?"active":"",(function(){return n.handleSelectAllInGroup(t,o)}),c?"Deseleccionar todos":"Seleccionar todos",c?"minus":"plus",c?"Deseleccionar todos":"Seleccionar todos",r?"":$(qe||(qe=y(['\n          <div class="ges-group__items">\n            ',"\n          </div>\n        "])),he(o,(function(e){return e.id}),(function(e){return n.renderGESItem(e,a)}))))}},{key:"renderGESItem",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#f0f0f0",a=this.state.seleccionados.some((function(n){return n.id===e.id})),r=this.state.catalogoRiesgos.find((function(n){return n.id===e.riesgo_id}));return $(Re||(Re=y(['\n      <label class="ges-item ','">\n        \x3c!-- üé® H2: Barra de color lateral (6px expandible a 8px en hover) --\x3e\n        <div class="ges-item__color-bar" style="background-color: ','"></div>\n\n        <input\n          type="checkbox"\n          class="ges-item__checkbox"\n          .checked=',"\n          @change=",'\n        />\n\n        <div class="ges-item__content">\n          <div class="ges-item__header">\n            <span class="ges-item__name">',"</span>\n            ","\n          </div>\n\n          ",'\n\n          <div class="ges-item__meta">\n            <span class="ges-item__category">\n              <i class="fas fa-tag"></i>\n              ',"\n            </span>\n          </div>\n        </div>\n\n        ","\n      </label>\n    "])),a?"selected":"",t,a,(function(){return n.handleToggleGES(e)}),e.nombre,e.es_comun?$(Ge||(Ge=y(['\n              <span class="ges-item__badge">\n                <i class="fas fa-star"></i>\n                Com√∫n\n              </span>\n            ']))):"",e.descripcion?$(Oe||(Oe=y(['\n            <p class="ges-item__description">',"</p>\n          "])),e.descripcion):"",r?r.nombre:"Sin categor√≠a",a?$(Fe||(Fe=y(['\n          <div class="ges-item__checkmark">\n            <i class="fas fa-check"></i>\n          </div>\n        ']))):"")}},{key:"renderFooter",value:function(){var e=this,n=this.state.seleccionados.length,t=this.state.gesDetallesCache.size;return $(Me||(Me=y(['\n      <div class="riesgo-selector__footer">\n        <div class="riesgo-selector__counter">\n          <i class="fas fa-check-circle"></i>\n          <span>\n            <strong>',"</strong> "," ","\n          </span>\n          ","\n        </div>\n\n        ","\n      </div>\n    "])),n,1===n?"riesgo":"riesgos",1===n?"seleccionado":"seleccionados",t>0?$($e||($e=y(['\n            <span class="cache-info" title="Detalles cargados en cache">\n              ('," con detalles)\n            </span>\n          "])),t):"",n>0?$(He||(He=y(['\n          <button class="wizard-btn wizard-btn-secondary" @click=','>\n            <i class="fas fa-times"></i>\n            Limpiar selecci√≥n\n          </button>\n        '])),(function(){return e.handleClearSelection()})):"")}},{key:"handleToggleView",value:function(e){this.state.vistaComunes="comunes"===e,this.updateGESVisible(),this.renderComponent()}},{key:"handleFilterCategory",value:function(e){this.state.categoriaActiva=e,this.updateGESVisible(),this.renderComponent()}},{key:"handleToggleFiltros",value:function(){this.state.filtrosColapsados=!this.state.filtrosColapsados,this.renderComponent()}},{key:"handleSearch",value:function(e){var n=this,t=e.target.value;this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((function(){n.state.busqueda=t,n.updateGESVisible(),n.renderComponent()}),300)}},{key:"handleClearSearch",value:function(){this.state.busqueda="",this.updateGESVisible(),this.renderComponent()}},{key:"handleClearFilters",value:function(){this.state.categoriaActiva=null,this.state.busqueda="",this.state.vistaComunes=!0,this.updateGESVisible(),this.renderComponent()}},{key:"handleToggleAISuggestions",value:function(){this.state.showAISuggestions=!this.state.showAISuggestions,this.renderComponent()}},{key:"handleFilterByRiesgo",value:function(e){var n=this,t=this.state.catalogoRiesgos.find((function(n){return n.nombre===e||n.nombre.includes(e)}));t&&(this.state.categoriaActiva=t.id,console.log("üéØ Filtrando por riesgo: ".concat(t.nombre," (ID: ").concat(t.id,")")),this.updateGESVisible(),this.renderComponent(),setTimeout((function(){var e=n.container.querySelector(".ges-groups-carousel-wrapper");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}),100))}},{key:"handleToggleGES",value:function(e){var n=this.state.seleccionados.some((function(n){return n.id===e.id}));if(n)this.state.seleccionados=this.state.seleccionados.filter((function(n){return n.id!==e.id}));else{var t=this.state.catalogoRiesgos.find((function(n){return n.id===e.riesgo_id})),a=We(We({},e),{},{categoria:t?t.nombre:""});this.state.seleccionados.push(a),this.loadGESDetails(e.id).catch((function(e){console.error("Error cargando detalles en background:",e)}))}this.options.onChange(this.state.seleccionados),this.renderComponent()}},{key:"handleClearSelection",value:function(){confirm("¬øEst√°s seguro de limpiar toda la selecci√≥n?")&&(this.state.seleccionados=[],this.options.onChange(this.state.seleccionados),this.renderComponent())}},{key:"getSelection",value:function(){return x(this.state.seleccionados)}},{key:"setSelection",value:function(e){this.state.seleccionados=x(e),this.renderComponent()}},{key:"getDetailsCache",value:function(){return this.state.gesDetallesCache}},{key:"groupGESByRiesgo",value:function(){var e=this,n=new Map;return this.state.gesVisible.forEach((function(t){var a=e.state.catalogoRiesgos.find((function(e){return e.id===t.riesgo_id})),r=a?a.nombre:"Sin categor√≠a";n.has(r)||n.set(r,{riesgo:a||{nombre:"Sin categor√≠a",id:null},ges:[]}),n.get(r).ges.push(t)})),Array.from(n.values()).sort((function(e,n){return e.riesgo.nombre.localeCompare(n.riesgo.nombre)}))}},{key:"handleToggleGroup",value:function(e){this.state.gruposColapsados.has(e)?this.state.gruposColapsados.delete(e):this.state.gruposColapsados.add(e),this.renderComponent()}},{key:"handleCarouselPrev",value:function(){this.state.carouselIndex>0&&(this.state.carouselIndex--,this.renderComponent())}},{key:"handleCarouselNext",value:function(){var e=this.groupGESByRiesgo();this.state.carouselIndex<e.length-1&&(this.state.carouselIndex++,this.renderComponent())}},{key:"handleCarouselGoTo",value:function(e){var n=this.groupGESByRiesgo();e>=0&&e<n.length&&(this.state.carouselIndex=e,this.renderComponent())}},{key:"handleSelectAllInGroup",value:function(e,n){var t=this,a=n.every((function(e){return t.state.seleccionados.some((function(n){return n.id===e.id}))}));if(a){var r=n.map((function(e){return e.id}));this.state.seleccionados=this.state.seleccionados.filter((function(e){return!r.includes(e.id)}))}else n.forEach((function(e){t.state.seleccionados.some((function(n){return n.id===e.id}))||(t.state.seleccionados.push(e),t.loadGESDetails(e.id).catch((function(e){console.error("Error cargando detalles en background:",e)})))}));this.options.onChange(this.state.seleccionados),this.renderComponent()}},{key:"destroy",value:function(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.container.innerHTML=""}}]);var e,n,t,a,r,i}();function _n(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return zn(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?zn(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function zn(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}function Nn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Tn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Nn(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Nn(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Ln=function(){return p((function e(n){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(this,e),d(this,"handleCambiarFiltro",(function(e){t.filtroActivo=e,t.renderVistaHibrida()})),d(this,"handleCambiarAManual",(function(){t.modoVista="step-by-step",t.renderComponent()})),d(this,"handleValidarTodo",o(s().mark((function e(){var n,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})),!(n.length>0)){e.next=4;break}return alert("Debes revisar ".concat(n.length," riesgos antes de continuar.")),e.abrupt("return");case 4:console.log("[NivelesForm] Aplicando todas las sugerencias..."),a=s().mark((function e(){var n,a,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.sugerencias[r]).plantillaId||!n.nivelesSugeridos){e.next=12;break}if(a=t.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===n.gesId})),-1===a){e.next=12;break}return o=t.options.gesArray[a],(i=Tn({},n.nivelesSugeridos)).NP=i.ND*i.NE,i.NR=i.NP*i.NC,t.options.state&&t.options.state.updateGESNiveles(t.options.cargoIndex,a,i),o.niveles=i,e.next=12,t.registrarAplicacion(n,i,i,!0);case 12:case"end":return e.stop()}}),e)})),r=0;case 7:if(!(r<t.sugerencias.length)){e.next=12;break}return e.delegateYield(a(),"t0",9);case 9:r++,e.next=7;break;case 12:t.options.onComplete();case 13:case"end":return e.stop()}}),e)})))),d(this,"handleEditarSugerencia",(function(e){var n=t.sugerencias[e],a=t.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===n.gesId}));if(-1!==a){if(n.nivelesSugeridos)t.options.gesArray[a].niveles=Tn({},n.nivelesSugeridos);t.currentGESIndex=a,t.modoVista="step-by-step",t.renderComponent(),t.scrollToTop()}})),d(this,"handleValidarSugerencia",function(){var e=o(s().mark((function e(n){var a,r,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=t.sugerencias[n]).validada=!a.validada,!(a.validada&&a.plantillaId&&a.nivelesSugeridos)){e.next=13;break}if(r=t.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===a.gesId})),-1===r){e.next=13;break}return o=t.options.gesArray[r],(i=Tn({},a.nivelesSugeridos)).NP=i.ND*i.NE,i.NR=i.NP*i.NC,t.options.state&&t.options.state.updateGESNiveles(t.options.cargoIndex,r,i),o.niveles=i,e.next=13,t.registrarAplicacion(a,i,i,!0);case 13:t.renderVistaHibrida();case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),d(this,"handleSelectNivel",(function(e,n){console.log("[NivelesForm] Selecting ".concat(e," = ").concat(n));var a=t.options.gesArray[t.currentGESIndex];a.niveles||(a.niveles={ND:null,NE:null,NC:null,NP:null,NR:null,deficiencia:null,exposicion:null,consecuencia:null}),a.controles||(a.controles={fuente:"",medio:"",individuo:""});var r=Tn(Tn({},a.niveles),{},d({},e,n));null!==r.ND&&void 0!==r.ND&&null!==r.NE&&void 0!==r.NE&&(r.NP=r.ND*r.NE),null!==r.NP&&void 0!==r.NP&&null!==r.NC&&void 0!==r.NC&&(r.NR=r.NP*r.NC),"ND"===e?r.deficiencia={value:n}:"NE"===e?r.exposicion={value:n}:"NC"===e&&(r.consecuencia={value:n}),t.options.state&&t.options.state.updateGESNiveles(t.options.cargoIndex,t.currentGESIndex,r),a.niveles=r,t.options.onChange({action:"update-niveles",gesIndex:t.currentGESIndex,niveles:r}),console.log("[NivelesForm] Updated niveles:",r),t.renderComponent()})),d(this,"handleControlChange",(function(e,n){console.log("[NivelesForm] Control change (debouncing): ".concat(e,' = "').concat(n.substring(0,30),'..."'));var a=t.options.gesArray[t.currentGESIndex];a.controles||(a.controles={fuente:"",medio:"",individuo:""}),a.controles[e]=n,t.controlChangeDebounceTimer&&clearTimeout(t.controlChangeDebounceTimer),t.controlChangeDebounceTimer=setTimeout((function(){console.log("[NivelesForm] Saving controls after debounce: ".concat(e)),t.options.state&&t.options.state.updateGESControles(t.options.cargoIndex,t.currentGESIndex,a.controles),t.options.onChange({action:"update-controles",gesIndex:t.currentGESIndex,controles:a.controles}),console.log("[NivelesForm] Controls saved successfully")}),t.controlChangeDebounceDelay)})),d(this,"handleShowControlesHelp",(function(){alert("üìã MEDIDAS DE CONTROL - Jerarqu√≠a de Control seg√∫n GTC-45\n\n‚úÖ CONTROL EN LA FUENTE:\nAct√∫a sobre el origen del peligro para eliminarlo o reducirlo.\nEjemplos:\n‚Ä¢ Mantenimiento preventivo de maquinaria\n‚Ä¢ Sustituci√≥n de materiales peligrosos por otros m√°s seguros\n‚Ä¢ Redise√±o de procesos para eliminar riesgos\n‚Ä¢ Instalaci√≥n de guardas en equipos\n\nüè≠ CONTROL EN EL MEDIO:\nAct√∫a en el ambiente entre la fuente y el trabajador.\nEjemplos:\n‚Ä¢ Ventilaci√≥n adecuada y extracci√≥n de gases\n‚Ä¢ Se√±alizaci√≥n de seguridad\n‚Ä¢ Aislamiento ac√∫stico o t√©rmico\n‚Ä¢ Orden y aseo en √°reas de trabajo\n\nüë∑ CONTROL EN EL INDIVIDUO:\n√öltima barrera de protecci√≥n, act√∫a sobre el trabajador.\nEjemplos:\n‚Ä¢ Uso de EPP (casco, guantes, tapones auditivos, gafas)\n‚Ä¢ Capacitaci√≥n y entrenamiento en seguridad\n‚Ä¢ Rotaci√≥n de personal\n‚Ä¢ Pausas activas y ex√°menes m√©dicos peri√≥dicos\n\nüí° Recuerda: La mejor estrategia es controlar en la FUENTE, luego en el MEDIO, y finalmente en el INDIVIDUO.")})),d(this,"handleLoadSugerenciasControles",function(){var e=o(s().mark((function e(n){var a,r,o,i,c,l,d,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("[NivelesForm] Cargando sugerencias para: ".concat(n.nombre)),e.next=4,fetch("/api/catalogo/ges?search=".concat(encodeURIComponent(n.nombre),"&limit=5"));case 4:return a=e.sent,e.next=7,a.json();case 7:if((r=e.sent).success&&r.data&&0!==r.data.length){e.next=11;break}return alert('No se encontraron sugerencias predefinidas para "'.concat(n.nombre,'" en la base de datos. Puedes ingresarlas manualmente.')),e.abrupt("return");case 11:if(o=r.data.find((function(e){return e.nombre.toLowerCase().trim()===n.nombre.toLowerCase().trim()})),o){e.next=15;break}return alert('No se encontr√≥ coincidencia exacta para "'.concat(n.nombre,'". Resultados similares: ').concat(r.data.map((function(e){return e.nombre})).join(", "))),e.abrupt("return");case 15:return e.next=17,fetch("/api/catalogo/ges/".concat(o.id));case 17:return i=e.sent,e.next=20,i.json();case 20:if((c=e.sent).success&&c.data){e.next=24;break}return alert('No se pudieron cargar los detalles para "'.concat(n.nombre,'".')),e.abrupt("return");case 24:if(l=c.data,d=l.medidas_intervencion){e.next=29;break}return alert('El GES "'.concat(n.nombre,'" no tiene medidas de intervenci√≥n predefinidas.')),e.abrupt("return");case 29:u={fuente:d.eliminacion||"",medio:d.controles_ingenieria||"",individuo:d.controles_administrativos||""},t.options.gesArray[t.currentGESIndex].controles=u,t.options.state&&t.options.state.updateGESControles(t.options.cargoIndex,t.currentGESIndex,u),t.options.onChange({action:"update-controles",gesIndex:t.currentGESIndex,controles:u}),t.renderComponent(),console.log("[NivelesForm] Sugerencias cargadas desde BD:",u),e.next=42;break;case 38:e.prev=38,e.t0=e.catch(0),console.error("[NivelesForm] Error al cargar sugerencias:",e.t0),alert("Error al cargar sugerencias. Por favor, intenta nuevamente.");case 42:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(n){return e.apply(this,arguments)}}()),d(this,"handlePreviousGES",(function(){t.isNavigating?console.log("[NivelesForm] Navigation in progress, ignoring click"):t.currentGESIndex>0&&(t.isNavigating=!0,console.log("[NivelesForm] Navigating from GES ".concat(t.currentGESIndex," to ").concat(t.currentGESIndex-1)),t.currentGESIndex--,t.renderComponent(),t.scrollToTop(),setTimeout((function(){t.isNavigating=!1}),100))})),d(this,"handleNextGES",(function(){if(t.isNavigating)console.log("[NivelesForm] Navigation in progress, ignoring click");else{var e=t.options.gesArray[t.currentGESIndex];t.isGESComplete(e)?t.currentGESIndex<t.options.gesArray.length-1&&(t.isNavigating=!0,console.log("[NivelesForm] Navigating from GES ".concat(t.currentGESIndex," to ").concat(t.currentGESIndex+1)),t.currentGESIndex++,t.renderComponent(),t.scrollToTop(),setTimeout((function(){t.isNavigating=!1}),100)):alert('Por favor completa todos los niveles de riesgo (ND, NE, NC) para "'.concat(e.nombre,'" antes de continuar.'))}})),d(this,"handleComplete",(function(){console.log("[NivelesForm] handleComplete - Verificando completitud..."),console.log("[NivelesForm] gesArray:",t.options.gesArray);var e=t.options.gesArray.filter((function(e){var n=t.isGESComplete(e);return console.log('[NivelesForm] GES "'.concat(e.nombre,'":'),{niveles:e.niveles,isComplete:n}),!n}));if(e.length>0){var n=e.map((function(e){return'"'.concat(e.nombre,'"')})).join(", ");return console.error("[NivelesForm] GES incompletos:",n),void alert("Por favor completa los niveles de riesgo (ND, NE, NC) para: ".concat(n))}console.log("[NivelesForm] Todos los GES est√°n completos. Llamando onComplete()"),t.options.onComplete()})),d(this,"handleShowHelp",(function(e){var n={ND:'\n        <strong>Nivel de Deficiencia (ND):</strong>\n        <br><br>\n        Indica la magnitud de la relaci√≥n entre el conjunto de peligros detectados y su relaci√≥n causal directa con posibles incidentes.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>10 - Muy Alto:</strong> Se han detectado factores de riesgo significativos que determinan una muy alta probabilidad de generar incidentes.</li>\n          <li><strong>6 - Alto:</strong> Se han detectado factores de riesgo que pueden generar incidentes.</li>\n          <li><strong>2 - Medio:</strong> Se han detectado factores de riesgo de menor importancia.</li>\n          <li><strong>0 - Bajo:</strong> No se detectan anomal√≠as destacables. El riesgo est√° controlado.</li>\n        </ul>\n      ',NE:'\n        <strong>Nivel de Exposici√≥n (NE):</strong>\n        <br><br>\n        Frecuencia con la que el trabajador est√° expuesto al peligro.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>10 - Continua:</strong> Exposici√≥n varias veces durante la jornada laboral con tiempos prolongados.</li>\n          <li><strong>6 - Frecuente:</strong> Exposici√≥n varias veces durante la jornada con tiempos cortos.</li>\n          <li><strong>3 - Ocasional:</strong> Exposici√≥n alguna vez durante la jornada con tiempo corto.</li>\n          <li><strong>1 - Espor√°dica:</strong> Exposici√≥n de forma irregular o muy ocasional.</li>\n        </ul>\n      ',NC:'\n        <strong>Nivel de Consecuencia (NC):</strong>\n        <br><br>\n        Consecuencia normalmente esperada si el riesgo se materializa.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>100 - Mortal:</strong> Consecuencias fatales, muerte de uno o m√°s trabajadores.</li>\n          <li><strong>60 - Muy Grave:</strong> Incapacidad permanente parcial o invalidez.</li>\n          <li><strong>25 - Grave:</strong> Incapacidad temporal, lesiones con baja laboral.</li>\n          <li><strong>10 - Leve:</strong> Lesiones sin hospitalizaci√≥n, no requiere baja laboral.</li>\n        </ul>\n      '}[e]||"No hay ayuda disponible para este nivel.";t.showHelpModal(n)})),this.container="string"==typeof n?document.querySelector(n):n,!this.container)throw new Error("NivelesRiesgoForm: Container not found");this.options=Tn({cargoIndex:a.cargoIndex||0,cargoNombre:a.cargoNombre||"",gesArray:a.gesArray||[],state:a.state||null,onChange:a.onChange||function(){},onComplete:a.onComplete||function(){}},a),this.currentGESIndex=0,this.isNavigating=!1,this.sugerencias=[],this.modoVista="loading",this.empresaId=1,this.controlChangeDebounceTimer=null,this.controlChangeDebounceDelay=1500,this.niveles={ND:[{value:1,label:"Bajo / N/A",description:"No se detectan deficiencias"},{value:2,label:"Medio",description:"Deficiencias moderadas"},{value:6,label:"Alto",description:"Deficiencias graves detectadas"},{value:10,label:"Muy Alto",description:"Deficiencias muy graves detectadas"}],NE:[{value:1,label:"Espor√°dica (EE)",description:"Irregularmente"},{value:2,label:"Ocasional (EO)",description:"Alguna vez durante la jornada, tiempo corto"},{value:3,label:"Frecuente (EF)",description:"Varias veces durante la jornada, tiempos cortos"},{value:4,label:"Continua (EC)",description:"Varias veces durante la jornada, tiempos prolongados"}],NC:[{value:10,label:"Leve",description:"Lesiones sin hospitalizaci√≥n"},{value:25,label:"Grave",description:"Incapacidad temporal"},{value:60,label:"Muy Grave",description:"Incapacidad permanente parcial o invalidez"},{value:100,label:"Mortal o Catastr√≥fica",description:"Muerte(s)"}]},this.init()}),[{key:"init",value:(t=o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.options.gesArray.length){e.next=3;break}return this.renderEmpty(),e.abrupt("return");case 3:return e.next=5,this.loadSugerencias();case 5:this.sugerencias.length>0?(this.modoVista="hybrid",this.renderVistaHibrida()):(this.modoVista="step-by-step",this.renderComponent());case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"loadSugerencias",value:(n=o(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("[NivelesForm] Cargando sugerencias de plantillas..."),n=this.options.gesArray.map((function(e){return{id_ges:e.id_ges||e.idGes,nombre:e.nombre,categoria:e.categoria,descripcion:e.descripcion}})),e.next=5,fetch("/api/plantillas-niveles/sugerir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({empresa_id:this.empresaId,gesArray:n})});case 5:return t=e.sent,e.next=8,t.json();case 8:(a=e.sent).success?(this.sugerencias=a.sugerencias||[],console.log("[NivelesForm] ‚úÖ ".concat(this.sugerencias.length," sugerencias cargadas")),console.log("[NivelesForm] Stats:",a.stats)):(console.warn("[NivelesForm] Error al cargar sugerencias:",a.message),this.sugerencias=[]),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("[NivelesForm] Error al cargar sugerencias:",e.t0),this.sugerencias=[];case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return n.apply(this,arguments)})},{key:"renderVistaHibrida",value:function(){var e=this,n=this.sugerencias.filter((function(e){return!e.requiereRevision&&e.plantillaId})),t=this.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})),a=$(Ve||(Ve=y(['\n      <div class="niveles-vista-hibrida">\n        \x3c!-- Header --\x3e\n        <div class="niveles-hibrida__header">\n          <h2>üß† Configuraci√≥n Inteligente de Niveles</h2>\n          <p class="niveles-hibrida__subtitle">\n            Hemos pre-configurado los niveles bas√°ndonos en plantillas de tu empresa.\n            Revisa y valida las sugerencias.\n          </p>\n        </div>\n\n        \x3c!-- Stats Cards --\x3e\n        <div class="niveles-hibrida__stats">\n          <div class="stat-card stat-card--success">\n            <i class="fas fa-check-circle"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">','</span>\n              <span class="stat-card__label">Auto-aprobables</span>\n            </div>\n          </div>\n          <div class="stat-card stat-card--warning">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">','</span>\n              <span class="stat-card__label">Requieren revisi√≥n</span>\n            </div>\n          </div>\n          <div class="stat-card stat-card--info">\n            <i class="fas fa-clock"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">~',' min</span>\n              <span class="stat-card__label">Tiempo ahorrado</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Filter Tabs --\x3e\n        <div class="niveles-hibrida__filters">\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-list"></i>\n            Todas (',')\n          </button>\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-flag"></i>\n            Solo Revisi√≥n (',')\n          </button>\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-magic"></i>\n            Auto-aprobables (',')\n          </button>\n        </div>\n\n        \x3c!-- Tabla de Sugerencias --\x3e\n        <div class="niveles-hibrida__table-container">\n          <table class="niveles-hibrida__table">\n            <thead>\n              <tr>\n                <th>GES / Riesgo</th>\n                <th>Categor√≠a</th>\n                <th>ND</th>\n                <th>NE</th>\n                <th>NC</th>\n                <th>NP</th>\n                <th>NR</th>\n                <th>Nivel</th>\n                <th>Confianza</th>\n                <th>Acciones</th>\n              </tr>\n            </thead>\n            <tbody>\n              ','\n            </tbody>\n          </table>\n        </div>\n\n        \x3c!-- Actions --\x3e\n        <div class="niveles-hibrida__actions">\n          <button\n            class="wizard-btn wizard-btn-secondary"\n            @click=','\n          >\n            <i class="fas fa-edit"></i>\n            Configurar Manualmente\n          </button>\n\n          <button\n            class="wizard-btn wizard-btn-success"\n            @click=',"\n            ?disabled=",'\n          >\n            <i class="fas fa-check-double"></i>\n            Validar Todo y Continuar\n          </button>\n        </div>\n\n        ',"\n      </div>\n    "])),n.length,t.length,Math.round(.5*this.sugerencias.length),"todas"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("todas")}),this.sugerencias.length,"revision"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("revision")}),t.length,"auto"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("auto")}),n.length,this.getSugerenciasFiltradas().map((function(n,t){return e.templateFilaSugerencia(n,t)})),(function(){return e.handleCambiarAManual()}),(function(){return e.handleValidarTodo()}),t.length>0,t.length>0?$(Ue||(Ue=y(['\n          <div class="niveles-hibrida__help">\n            <i class="fas fa-info-circle"></i>\n            <p>\n              <strong>Atenci√≥n:</strong> Hay '," riesgos que requieren revisi√≥n manual\n              (riesgos cr√≠ticos o plantillas nuevas). Revisa cada uno antes de continuar.\n            </p>\n          </div>\n        "])),t.length):"");ie(a,this.container)}},{key:"templateFilaSugerencia",value:function(e,n){var t,a,r,o=this,i=e.nivelesSugeridos||{},s=i.ND&&i.NE?i.ND*i.NE:null,c=s&&i.NC?s*i.NC:null,l=this.interpretarNR(c),d=e.requiereRevision?"fila-sugerencia fila-sugerencia--revision":e.plantillaId?"fila-sugerencia fila-sugerencia--auto":"fila-sugerencia fila-sugerencia--manual";return $(Ke||(Ke=y(['\n      <tr class="','">\n        <td class="td-ges">\n          <strong>',"</strong>\n          ",'\n        </td>\n        <td class="td-categoria">\n          <span class="categoria-badge">','</span>\n        </td>\n        <td class="td-nivel">','</td>\n        <td class="td-nivel">','</td>\n        <td class="td-nivel">','</td>\n        <td class="td-np">\n          <strong>','</strong>\n        </td>\n        <td class="td-nr">\n          <strong>','</strong>\n        </td>\n        <td class="td-interpretacion">\n          ','\n        </td>\n        <td class="td-confianza">\n          ','\n        </td>\n        <td class="td-acciones">\n          ',"\n        </td>\n      </tr>\n    "])),d,e.gesNombre,e.plantillaId?"":$(Ye||(Ye=y(['\n            <span class="badge badge--warning">Sin plantilla</span>\n          ']))),e.gesCategoria,null!==(t=i.ND)&&void 0!==t?t:"‚Äî",null!==(a=i.NE)&&void 0!==a?a:"‚Äî",null!==(r=i.NC)&&void 0!==r?r:"‚Äî",null!=s?s:"‚Äî",null!=c?c:"‚Äî",l.texto?$(Je||(Je=y(['\n            <span class="nivel-badge nivel-badge--','">\n              '," ","\n            </span>\n          "])),l.clase,l.emoji||"",l.texto):"‚Äî",e.plantillaId?$(Xe||(Xe=y(['\n            <div class="confianza-bar">\n              <div\n                class="confianza-bar__fill"\n                style="width: ','%"\n              ></div>\n              <span class="confianza-bar__text">',"%</span>\n            </div>\n          "])),(100*e.confianza).toFixed(0),(100*e.confianza).toFixed(0)):"‚Äî",e.plantillaId?$(Qe||(Qe=y(['\n            <button\n              class="btn-accion btn-accion--edit"\n              @click=','\n              title="Editar niveles"\n            >\n              <i class="fas fa-edit"></i>\n            </button>\n            <button\n              class="btn-accion btn-accion--check ','"\n              @click=','\n              title="','"\n            >\n              <i class="fas ','"></i>\n            </button>\n          '])),(function(){return o.handleEditarSugerencia(n)}),e.validada?"validada":"",(function(){return o.handleValidarSugerencia(n)}),e.validada?"Validado":"Validar",e.validada?"fa-check-circle":"fa-check"):$(Ze||(Ze=y(['\n            <button\n              class="btn-accion btn-accion--edit"\n              @click=','\n              title="Configurar manualmente"\n            >\n              <i class="fas fa-cog"></i>\n            </button>\n          '])),(function(){return o.handleEditarSugerencia(n)})))}},{key:"getSugerenciasFiltradas",value:function(){return this.filtroActivo&&"todas"!==this.filtroActivo?"revision"===this.filtroActivo?this.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})):"auto"===this.filtroActivo?this.sugerencias.filter((function(e){return!e.requiereRevision&&e.plantillaId})):this.sugerencias:this.sugerencias}},{key:"registrarAplicacion",value:(e=o(s().mark((function e(n,t,a,r){var o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/plantillas-niveles/aplicar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plantillaId:n.plantillaId,gesId:n.gesId,cargoId:this.options.cargoIndex,nivelesSugeridos:t,nivelesFinales:a,justificacionAjuste:r?null:"Ajuste manual del usuario"})});case 3:return o=e.sent,e.next=6,o.json();case 6:(i=e.sent).success?console.log("[NivelesForm] ‚úÖ Aplicaci√≥n registrada para aprendizaje"):console.warn("[NivelesForm] Error al registrar aplicaci√≥n:",i.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("[NivelesForm] Error al registrar aplicaci√≥n:",e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(n,t,a,r){return e.apply(this,arguments)})},{key:"renderComponent",value:function(){var e=this.options.gesArray[this.currentGESIndex],n=this.options.gesArray.length,t=$(en||(en=y(['\n      <div class="niveles-form">\n        ',"\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n    "])),this.templateHeader(e,this.currentGESIndex+1,n),this.templateProgressIndicator(),this.templateGESInfo(e),this.templateNivelSection("ND","Nivel de Deficiencia",e),this.templateNivelSection("NE","Nivel de Exposici√≥n",e),this.templateNivelSection("NC","Nivel de Consecuencia",e),this.templateControlesSection(e),this.templateCalculator(e),this.templateNavigation(this.currentGESIndex,n));ie(t,this.container)}},{key:"templateHeader",value:function(e,n,t){return $(nn||(nn=y(['\n      <div class="niveles-form__header">\n        <h2>Configuraci√≥n de Niveles y Controles</h2>\n        <p class="niveles-form__cargo-info">\n          <i class="fas fa-briefcase"></i>\n          Cargo: <strong>','</strong>\n        </p>\n        <div class="niveles-form__ges-counter">\n          <span class="current-ges">','</span>\n          <span class="separator">/</span>\n          <span class="total-ges">','</span>\n          <span class="label">GES configurados</span>\n        </div>\n      </div>\n    '])),this.options.cargoNombre,n,t)}},{key:"templateProgressIndicator",value:function(){var e=this,n=this.options.gesArray.length,t=this.options.gesArray.filter((function(n){return e.isGESComplete(n)})).length,a=n>0?Math.round(t/n*100):0;return $(tn||(tn=y(['\n      <div class="niveles-form__progress">\n        <div class="progress-bar">\n          <div class="progress-bar__fill" style="width: ','%"></div>\n        </div>\n        <p class="progress-text">\n          <strong>',"</strong> de <strong>",'</strong> riesgos configurados\n          <span class="progress-percentage">(',"%)</span>\n        </p>\n      </div>\n    "])),a,t,n,a)}},{key:"templateGESInfo",value:function(e){var n=this.isGESComplete(e);return $(an||(an=y(['\n      <div class="niveles-form__ges-card">\n        <div class="ges-card__header">\n          <h3 class="ges-card__name">\n            <i class="fas fa-exclamation-triangle"></i>\n            ',"\n          </h3>\n          ","\n        </div>\n        ",'\n        <div class="ges-card__meta">\n          <span class="ges-card__category">\n            <i class="fas fa-tag"></i>\n            ',"\n          </span>\n        </div>\n      </div>\n    "])),e.nombre,$(n?rn||(rn=y(['\n            <span class="ges-card__badge ges-card__badge--complete">\n              <i class="fas fa-check-circle"></i>\n              Completo\n            </span>\n          '])):on||(on=y(['\n            <span class="ges-card__badge ges-card__badge--incomplete">\n              <i class="fas fa-clock"></i>\n              Pendiente\n            </span>\n          ']))),e.descripcion?$(sn||(sn=y(['\n          <p class="ges-card__description">',"</p>\n        "])),e.descripcion):"",e.categoria||"Sin categor√≠a")}},{key:"templateNivelSection",value:function(e,n,t){var a,r,o=this,i=this.niveles[e],s=null!==(a=null===(r=t.niveles)||void 0===r?void 0:r[e])&&void 0!==a?a:null;return $(cn||(cn=y(['\n      <div class="niveles-form__section">\n        <div class="nivel-section__header">\n          <h3 class="nivel-section__title">\n            <span class="nivel-badge">',"</span>\n            ",'\n          </h3>\n          <button\n            class="nivel-section__help"\n            @click=','\n            title="Ayuda sobre ','"\n          >\n            <i class="fas fa-question-circle"></i>\n          </button>\n        </div>\n\n        <div class="nivel-bar">\n          ',"\n        </div>\n      </div>\n    "])),e,n,(function(){return o.handleShowHelp(e)}),n,i.map((function(n){return o.templateNivelOption(e,n,s)})))}},{key:"templateNivelOption",value:function(e,n,t){var a=this,r=t===n.value,o=this.getNivelColor(e,n.value);return $(ln||(ln=y(['\n      <button\n        class="nivel-option ','"\n        data-value="','"\n        @click=','\n        style="--nivel-color: ','"\n        title="',": ",'"\n      >\n        <span class="nivel-option__label">','</span>\n        <span class="nivel-option__value">',"</span>\n        ","\n      </button>\n    "])),r?"nivel-option--selected":"",n.value,(function(){return a.handleSelectNivel(e,n.value)}),o,n.label,n.description,n.label,n.value,r?$(dn||(dn=y(['<span class="nivel-option__check"><i class="fas fa-check-circle"></i></span>']))):"")}},{key:"getNivelColor",value:function(e,n){var t,a=null===(t={ND:{1:"#4caf50",2:"#ffeb3b",6:"#ff9800",10:"#f44336"},NE:{1:"#4caf50",2:"#ffeb3b",3:"#ff9800",4:"#f44336"},NC:{10:"#4caf50",25:"#ffeb3b",60:"#ff9800",100:"#f44336"}}[e])||void 0===t?void 0:t[n];return console.log("üé® getNivelColor(".concat(e,", ").concat(n,") = ").concat(a)),a||"#999"}},{key:"getNivelEmoji",value:function(e,n){var t;return(null===(t={ND:{0:"üü¢",2:"üü°",6:"üü†",10:"üî¥"},NE:{1:"üü¢",2:"üü°",3:"üü†",4:"üî¥"},NC:{10:"üü¢",25:"üü°",60:"üü†",100:"üî¥"}}[e])||void 0===t?void 0:t[n])||"‚ö™"}},{key:"findControlesFromOtherCargo",value:function(e){if(!this.options.state)return null;for(var n=this.options.state.getCargos(),t=e.nombre||e.ges,a=0;a<n.length;a++){var r=n[a];if(r.ges&&Array.isArray(r.ges)){var o,i=_n(r.ges);try{for(i.s();!(o=i.n()).done;){var s=o.value;if((s.nombre||s.ges)===t&&s.controles)if(s.controles.fuente||s.controles.medio||s.controles.individuo)return console.log('[NivelesForm] ‚úÖ Autocompletando controles de "'.concat(t,'" desde otro cargo')),Tn({},s.controles)}}catch(e){i.e(e)}finally{i.f()}}}return null}},{key:"templateControlesSection",value:function(e){var n=this,t=this.findControlesFromOtherCargo(e);e.controles&&(e.controles.fuente||e.controles.medio||e.controles.individuo)||(e.controles={fuente:(null==t?void 0:t.fuente)||"",medio:(null==t?void 0:t.medio)||"",individuo:(null==t?void 0:t.individuo)||""});var a=e.controles,r=a.fuente,o=void 0===r?"":r,i=a.medio,s=void 0===i?"":i,c=a.individuo,l=void 0===c?"":c,d=t&&(o||s||l);return $(un||(un=y(['\n      <div class="controles-section">\n        <div class="controles-section__header">\n          <h3 class="controles-section__title">\n            <i class="fas fa-shield-alt"></i>\n            Controles Existentes\n          </h3>\n          ','\n        </div>\n\n        <p class="controles-section__description">\n          Indique los controles que la empresa <strong>YA tiene implementados</strong> para este riesgo (GTC-45)\n        </p>\n\n        <div class="controles-grid">\n          \x3c!-- Control en la FUENTE --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-tools"></i>\n              Control en la FUENTE\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Mantenimiento preventivo de maquinaria, sustituci√≥n de materiales peligrosos..."\n              rows="3"\n              .value=',"\n              @input=",'\n            ></textarea>\n          </div>\n\n          \x3c!-- Control en el MEDIO --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-warehouse"></i>\n              Control en el MEDIO\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Ventilaci√≥n adecuada, se√±alizaci√≥n de seguridad, aislamiento ac√∫stico..."\n              rows="3"\n              .value=',"\n              @input=",'\n            ></textarea>\n          </div>\n\n          \x3c!-- Control en el INDIVIDUO --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-user-shield"></i>\n              Control en el INDIVIDUO\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Uso de EPP (casco, guantes, tapones auditivos), capacitaci√≥n en seguridad..."\n              rows="3"\n              .value=',"\n              @input=","\n            ></textarea>\n          </div>\n        </div>\n      </div>\n    "])),d?$(gn||(gn=y(['\n            <div class="autocompletado-badge">\n              <i class="fas fa-copy"></i>\n              Autocompletado desde otro cargo\n            </div>\n          ']))):"",o,(function(e){return n.handleControlChange("fuente",e.target.value)}),s,(function(e){return n.handleControlChange("medio",e.target.value)}),l,(function(e){return n.handleControlChange("individuo",e.target.value)}))}},{key:"templateCalculator",value:function(e){var n=e.niveles||{},t=n.ND,a=n.NE,r=n.NC,o=null!=t&&null!=a?t*a:null,i=null!==o&&null!=r?o*r:null,s=this.interpretarNP(o),c=this.interpretarNR(i);return $(pn||(pn=y(['\n      <div class="niveles-form__calculator">\n        <h3 class="calculator__title">\n          <i class="fas fa-calculator"></i>\n          Resultados del C√°lculo\n        </h3>\n\n        <div class="calculator__grid">\n          \x3c!-- NP (Nivel de Probabilidad) --\x3e\n          <div class="calculator__result">\n            <div class="calculator__formula">\n              <span class="formula-label">NP</span>\n              <span class="formula-equation">=</span>\n              <span class="formula-part">ND (',')</span>\n              <span class="formula-operator">√ó</span>\n              <span class="formula-part">NE (',')</span>\n            </div>\n            <div class="calculator__value ','">\n              <span class="value-number">','</span>\n              <span class="value-label">Nivel de Probabilidad</span>\n            </div>\n            ','\n          </div>\n\n          \x3c!-- NR (Nivel de Riesgo) --\x3e\n          <div class="calculator__result">\n            <div class="calculator__formula">\n              <span class="formula-label">NR</span>\n              <span class="formula-equation">=</span>\n              <span class="formula-part">NP (',')</span>\n              <span class="formula-operator">√ó</span>\n              <span class="formula-part">NC (',')</span>\n            </div>\n            <div class="calculator__value ','">\n              <span class="value-number">','</span>\n              <span class="value-label">Nivel de Riesgo</span>\n            </div>\n            ',"\n          </div>\n        </div>\n      </div>\n    "])),null!=t?t:"?",null!=a?a:"?",s.clase,null!=o?o:"‚Äî",s.texto?$(fn||(fn=y(['\n              <div class="calculator__interpretation ','">\n                <i class="fas ','"></i>\n                <span>',"</span>\n              </div>\n            "])),s.clase,s.icono,s.texto):"",null!=o?o:"?",null!=r?r:"?",c.clase,null!=i?i:"‚Äî",c.texto?$(vn||(vn=y(['\n              <div class="calculator__interpretation ','">\n                <i class="fas ','"></i>\n                <div>\n                  <strong>',"</strong>\n                  <p>","</p>\n                </div>\n              </div>\n            "])),c.clase,c.icono,c.texto,c.descripcion):"")}},{key:"templateNavigation",value:function(e,n){var t=this,a=e>0,r=e<n-1,o=this.isGESComplete(this.options.gesArray[e]);return $(hn||(hn=y(['\n      \x3c!-- Navegaci√≥n tradicional (bottom sticky) --\x3e\n      <div class="niveles-form__navigation">\n        <button\n          class="wizard-btn wizard-btn-secondary"\n          ?disabled=',"\n          @click=",'\n        >\n          <i class="fas fa-chevron-left"></i>\n          Riesgo Anterior\n        </button>\n\n        <div class="navigation__info">\n          ',"\n        </div>\n\n        ","\n      </div>\n\n      \x3c!-- FAB Navigation (flotante - solo en desktop con m√°s de 1 riesgo) --\x3e\n      ","\n    "])),!a,(function(){return t.handlePreviousGES()}),o?"":$(mn||(mn=y(['\n            <p class="navigation__warning">\n              <i class="fas fa-exclamation-circle"></i>\n              Completa los 3 niveles de riesgo (ND, NE, NC) para continuar\n            </p>\n          ']))),r?$(bn||(bn=y(['\n          <button\n            class="wizard-btn wizard-btn-primary"\n            ?disabled=',"\n            @click=",'\n          >\n            Siguiente Riesgo\n            <i class="fas fa-chevron-right"></i>\n          </button>\n        '])),!o,(function(){return t.handleNextGES()})):$(yn||(yn=y(['\n          <button\n            class="wizard-btn wizard-btn-success"\n            ?disabled=',"\n            @click=",'\n          >\n            <i class="fas fa-check"></i>\n            Finalizar Configuraci√≥n\n          </button>\n        '])),!this.areAllGESComplete(),(function(){return t.handleComplete()})),n>1?$(xn||(xn=y(['\n        <div class="wizard-fab-nav">\n          ',"\n\n          ","\n        </div>\n      "])),a?$(wn||(wn=y(['\n            <button\n              class="wizard-fab wizard-fab--secondary"\n              data-tooltip="Riesgo Anterior"\n              @click=','\n              aria-label="Ir al riesgo anterior"\n            >\n              <i class="fas fa-chevron-left"></i>\n            </button>\n          '])),(function(){return t.handlePreviousGES()})):"",r?$(Cn||(Cn=y(['\n            <button\n              class="wizard-fab"\n              data-tooltip="','"\n              ?disabled=',"\n              @click=",'\n              aria-label="Ir al siguiente riesgo"\n            >\n              <i class="fas fa-chevron-right"></i>\n              ',"\n            </button>\n          "])),o?"Siguiente Riesgo":"Completa este riesgo primero",!o,(function(){return t.handleNextGES()}),e+1<n?$(En||(En=y(['\n                <span class="wizard-fab__badge">',"</span>\n              "])),e+2):""):""):"")}},{key:"showHelpModal",value:function(e){var n=document.createElement("div");n.className="niveles-help-modal",n.innerHTML='\n      <div class="help-modal__overlay"></div>\n      <div class="help-modal__content">\n        <button class="help-modal__close">\n          <i class="fas fa-times"></i>\n        </button>\n        <div class="help-modal__body">\n          '.concat(e,"\n        </div>\n      </div>\n    "),document.body.appendChild(n);var t=function(){return n.remove()};n.querySelector(".help-modal__overlay").addEventListener("click",t),n.querySelector(".help-modal__close").addEventListener("click",t)}},{key:"isGESComplete",value:function(e){var n=e.niveles||{},t=n.ND,a=n.NE,r=n.NC;return null!=t&&null!=a&&null!=r}},{key:"areAllGESComplete",value:function(){var e=this;return this.options.gesArray.every((function(n){return e.isGESComplete(n)}))}},{key:"interpretarNP",value:function(e){return null==e?{texto:"",clase:"",icono:"",descripcion:""}:e>=40?{texto:"Muy Alto",clase:"risk-muy-alto",icono:"fa-exclamation-triangle",descripcion:"Situaci√≥n cr√≠tica. Correcci√≥n urgente."}:e>=20?{texto:"Alto",clase:"risk-alto",icono:"fa-exclamation-circle",descripcion:"Corregir y adoptar medidas de control."}:e>=8?{texto:"Medio",clase:"risk-medio",icono:"fa-info-circle",descripcion:"Mejorar si es posible."}:{texto:"Bajo",clase:"risk-bajo",icono:"fa-check-circle",descripcion:"Mantener las medidas de control existentes."}}},{key:"interpretarNR",value:function(e){return null==e?{texto:"",clase:"",icono:"",descripcion:""}:e>=600?{texto:"I - No Aceptable",clase:"risk-muy-alto",icono:"fa-ban",descripcion:"Situaci√≥n cr√≠tica. Suspender actividades hasta controlar el riesgo."}:e>=150?{texto:"II - No Aceptable o Aceptable con Control",clase:"risk-alto",icono:"fa-exclamation-triangle",descripcion:"Intervenci√≥n urgente. No iniciar actividad hasta reducir el riesgo."}:e>=40?{texto:"III - Mejorable",clase:"risk-medio",icono:"fa-tasks",descripcion:"Mejorar las medidas de control. Programar acciones de mejora."}:{texto:"IV - Aceptable",clase:"risk-bajo",icono:"fa-check-circle",descripcion:"Mantener las medidas de control actuales. Seguimiento peri√≥dico."}}},{key:"scrollToTop",value:function(){this.container.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"getCurrentGESIndex",value:function(){return this.currentGESIndex}},{key:"setCurrentGESIndex",value:function(e){e>=0&&e<this.options.gesArray.length&&(this.currentGESIndex=e,this.renderComponent())}},{key:"updateGESArray",value:function(e){this.options.gesArray=e,this.currentGESIndex>=e.length&&(this.currentGESIndex=Math.max(0,e.length-1)),this.renderComponent()}},{key:"renderEmpty",value:function(){var e=this,n=$(Sn||(Sn=y(['\n      <div class="niveles-form__empty">\n        <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #ffeb3b; margin-bottom: 1rem;"></i>\n        <h3>No hay riesgos seleccionados</h3>\n        <p>Debes seleccionar al menos un riesgo en el paso anterior antes de configurar los niveles.</p>\n        <button\n          class="wizard-btn wizard-btn-secondary"\n          @click=','\n        >\n          <i class="fas fa-arrow-left"></i>\n          Volver a Selecci√≥n de Riesgos\n        </button>\n      </div>\n    '])),(function(){return e.options.onChange({action:"go-back"})}));ie(n,this.container)}},{key:"destroy",value:function(){this.container.innerHTML=""}}]);var e,n,t}();var In=function(){return p((function e(n,t){u(this,e),this.container="string"==typeof n?document.querySelector(n):n,this.state=t,this.currentGesIndex=0,this.currentCargoIndex=0,this.container||console.error("[ControlesManager] Container not found")}),[{key:"render",value:function(){if(this.container){var e=this.state.getCargos();if(e&&0!==e.length){var n=e[this.currentCargoIndex];if(n&&n.ges&&0!==n.ges.length){var t=n.ges[this.currentGesIndex];t?(this.container.innerHTML=this.getHTML(e,n,t),this.attachEventListeners()):console.warn("[ControlesManager] No GES found at current index")}else this.renderNoRiesgos(n)}else this.renderEmptyState()}}},{key:"getHTML",value:function(e,n,t){var a=n.ges.length,r=Math.round((this.currentGesIndex+1)/a*100);return'\n      <div class="controles-form">\n        \x3c!-- Cargo Tabs --\x3e\n        '.concat(e.length>1?this.renderCargoTabs(e):"",'\n\n        \x3c!-- Header --\x3e\n        <div class="controles-header">\n          <div class="controles-header__info">\n            <h2 class="controles-header__title">Controles de Riesgo</h2>\n            <p class="controles-header__subtitle">\n              Define las medidas de control para: <strong>').concat(t.nombre||"Riesgo sin nombre",'</strong>\n            </p>\n            <p class="controles-header__cargo">\n              Cargo: <strong>').concat(n.nombre,'</strong>\n            </p>\n          </div>\n          <div class="controles-header__progress">\n            <div class="progress-circle">\n              <svg\n                viewBox="0 0 36 36"\n                class="circular-chart"\n                role="img"\n                aria-label="Progreso de GES: ').concat(this.currentGesIndex+1," de ").concat(a,'"\n              >\n                <path class="circle-bg"\n                  d="M18 2.0845\n                    a 15.9155 15.9155 0 0 1 0 31.831\n                    a 15.9155 15.9155 0 0 1 0 -31.831"\n                />\n                <path class="circle"\n                  stroke-dasharray="').concat(r,', 100"\n                  d="M18 2.0845\n                    a 15.9155 15.9155 0 0 1 0 31.831\n                    a 15.9155 15.9155 0 0 1 0 -31.831"\n                />\n              </svg>\n              <div class="progress-text" aria-hidden="true">\n                <span class="progress-number">').concat(this.currentGesIndex+1,'</span>\n                <span class="progress-total">/').concat(a,'</span>\n              </div>\n            </div>\n            <p class="progress-label">GES configurados</p>\n          </div>\n        </div>\n\n        \x3c!-- Controles Existentes (GTC-45) --\x3e\n        <div class="controles-existentes-section">\n          <div class="section-header">\n            <div class="section-header__left">\n              <i class="fas fa-shield-alt"></i>\n              <h3 class="section-title">Controles Existentes</h3>\n            </div>\n            <p class="section-description">\n              Indique los controles que la empresa <strong>YA tiene implementados</strong> para este riesgo seg√∫n GTC-45\n            </p>\n          </div>\n\n          ').concat(this.renderControlesExistentesFields(t),'\n        </div>\n\n        \x3c!-- Medidas de Intervenci√≥n (Sugerencias BD) --\x3e\n        <div class="medidas-intervencion-section">\n          <div class="section-header">\n            <div class="section-header__left">\n              <i class="fas fa-lightbulb"></i>\n              <h3 class="section-title">Medidas de Intervenci√≥n Sugeridas</h3>\n            </div>\n            <button\n              class="wizard-btn-tertiary"\n              id="btn-cargar-sugerencias"\n              title="Cargar sugerencias desde la base de datos"\n              aria-label="Cargar sugerencias de medidas de intervenci√≥n desde el cat√°logo">\n              <i class="fas fa-magic"></i>\n              Cargar Sugerencias desde BD\n            </button>\n          </div>\n          <p class="section-description">\n            Estas son las medidas que la empresa <strong>DEBER√çA implementar</strong> seg√∫n la jerarqu√≠a de controles\n          </p>\n\n          <div class="controles-hierarchy">\n            ').concat(this.renderControlField(1,"eliminacion","Eliminaci√≥n","fa-times-circle","Eliminar completamente la fuente del riesgo. Ejemplo: Eliminar proceso ruidoso, automatizar tarea peligrosa, realizar trabajos a nivel del suelo.",t),"\n\n            ").concat(this.renderControlField(2,"sustitucion","Sustituci√≥n","fa-exchange-alt","Reemplazar por algo menos peligroso. Ejemplo: Sustituir qu√≠mico t√≥xico por alternativa m√°s segura, usar plataformas elevadoras en lugar de andamios.",t),"\n\n            ").concat(this.renderControlField(3,"controlesIngenieria","Controles de Ingenier√≠a","fa-cogs","Modificaciones f√≠sicas, se√±alizaci√≥n y dise√±o. Ejemplo: Cabinas insonorizadas, ventilaci√≥n, guardas en maquinaria, se√±alizaci√≥n de seguridad, barandas.",t),"\n\n            ").concat(this.renderControlField(4,"controlesAdministrativos","Controles Administrativos","fa-clipboard-list","Procedimientos, permisos y capacitaci√≥n. Ejemplo: Rotaci√≥n de personal, pausas activas, permisos de trabajo, capacitaciones en SST, inspecciones peri√≥dicas.",t),'\n          </div>\n        </div>\n\n        \x3c!-- Hint --\x3e\n        <div class="wizard-hint info" style="margin-top: 2rem;">\n          <i class="fas fa-lightbulb"></i>\n          Los campos de control son opcionales. Puedes dejarlos vac√≠os si no aplican para este riesgo espec√≠fico.\n        </div>\n\n        \x3c!-- Navigation --\x3e\n        <div class="controles-navigation">\n          ').concat(this.renderNavigationButtons(a),"\n        </div>\n      </div>\n    ")}},{key:"renderCargoTabs",value:function(e){var n=this;return'\n      <div class="wizard-tabs">\n        '.concat(e.map((function(e,t){return'\n          <button\n            class="wizard-tab '.concat(t===n.currentCargoIndex?"active":"",'"\n            data-cargo-index="').concat(t,'"\n          >\n            <i class="fas fa-user-tie"></i>\n            ').concat(e.nombre,"\n          </button>\n        ")})).join(""),"\n      </div>\n    ")}},{key:"renderControlesExistentesFields",value:function(e){this.state.getCargos()[this.currentCargoIndex];var n=e.controles||{};return'\n      <div class="controles-existentes-grid">\n        '.concat(this.renderControlExistenteField("fuente","Control en la Fuente","fa-exclamation-triangle","Ejemplo: Encerramiento del proceso ruidoso, guardas en maquinaria, aislamiento de cables el√©ctricos",n.fuente||""),"\n\n        ").concat(this.renderControlExistenteField("medio","Control en el Medio","fa-wind","Ejemplo: Ventilaci√≥n general, extractores localizados, se√±alizaci√≥n de seguridad, barandas",n.medio||""),"\n\n        ").concat(this.renderControlExistenteField("individuo","Control en el Individuo","fa-user-shield","Ejemplo: Capacitaci√≥n, EPP entregados, ex√°menes m√©dicos peri√≥dicos, pausas activas",n.individuo||""),"\n      </div>\n    ")}},{key:"renderControlExistenteField",value:function(e,n,t,a,r){var o=r.length,i="control-existente-".concat(e,"-").concat(this.currentCargoIndex,"-").concat(this.currentGesIndex),s="".concat(i,"-char-count");return'\n      <div class="control-existente-group">\n        <div class="control-existente-header">\n          <i class="fas '.concat(t,'"></i>\n          <label for="').concat(i,'" class="control-existente-title">').concat(n,'</label>\n        </div>\n        <div class="control-existente-body">\n          <textarea\n            id="').concat(i,'"\n            class="control-existente-textarea ').concat(r?"filled":"",'"\n            data-control-existente="').concat(e,'"\n            placeholder="').concat(a,'"\n            maxlength="500"\n            rows="3"\n            aria-label="').concat(n,": ").concat(a,'"\n            aria-describedby="').concat(s,'"\n          >').concat(r,'</textarea>\n          <span class="control-char-count" id="').concat(s,'" aria-live="polite" aria-atomic="true">\n            <span class="char-current">').concat(o,"</span> / 500\n          </span>\n        </div>\n      </div>\n    ")}},{key:"renderControlField",value:function(e,n,t,a,r,o){this.state.getCargos()[this.currentCargoIndex];var i=(o.controles||{})[n]||"",s=i.length,c="control-".concat(n,"-").concat(this.currentCargoIndex,"-").concat(this.currentGesIndex),l="".concat(c,"-char-count");return'\n      <div class="control-group" data-level="'.concat(e,'">\n        <div class="control-header">\n          <div class="control-header__left">\n            <span class="control-number" aria-hidden="true">').concat(e,'</span>\n            <i class="fas ').concat(a,' control-icon" aria-hidden="true"></i>\n            <label for="').concat(c,'" class="control-title">').concat(t,'</label>\n          </div>\n          <span class="control-char-count" id="').concat(l,'" aria-live="polite" aria-atomic="true">\n            <span class="char-current">').concat(s,'</span> / 500 caracteres\n          </span>\n        </div>\n        <div class="control-body">\n          <textarea\n            id="').concat(c,'"\n            class="control-textarea ').concat(i?"filled":"",'"\n            data-control-type="').concat(n,'"\n            placeholder="').concat(r,'"\n            maxlength="500"\n            rows="3"\n            aria-label="').concat(t,": ").concat(r,'"\n            aria-describedby="').concat(l,'"\n          >').concat(i,"</textarea>\n        </div>\n      </div>\n    ")}},{key:"renderNavigationButtons",value:function(e){var n=0===this.currentGesIndex,t=this.currentGesIndex===e-1;return'\n      \x3c!-- Navegaci√≥n tradicional --\x3e\n      <button\n        class="btn-wizard btn-wizard--secondary"\n        id="btn-ges-anterior"\n        '.concat(n?"disabled":"",'\n      >\n        <i class="fas fa-arrow-left"></i>\n        GES Anterior\n      </button>\n\n      <div class="controles-navigation__center">\n        ').concat(t?'\n          <button class="btn-wizard btn-wizard--success" id="btn-finalizar-controles">\n            Finalizar Controles\n            <i class="fas fa-check"></i>\n          </button>\n        ':'\n          <button class="btn-wizard btn-wizard--primary" id="btn-ges-siguiente">\n            Siguiente GES\n            <i class="fas fa-arrow-right"></i>\n          </button>\n        ','\n      </div>\n\n      <button class="btn-wizard btn-wizard--tertiary" id="btn-saltar-ges">\n        Saltar\n        <i class="fas fa-step-forward"></i>\n      </button>\n\n      \x3c!-- FAB Navigation (solo si hay m√°s de 1 GES) --\x3e\n      ').concat(e>1?'\n        <div class="wizard-fab-nav">\n          '.concat(n?"":'\n            <button\n              class="wizard-fab wizard-fab--secondary"\n              id="fab-ges-anterior"\n              data-tooltip="GES Anterior"\n              aria-label="Ir al GES anterior"\n            >\n              <i class="fas fa-chevron-left"></i>\n            </button>\n          ',"\n\n          ").concat(t?"":'\n            <button\n              class="wizard-fab"\n              id="fab-ges-siguiente"\n              data-tooltip="Siguiente GES"\n              aria-label="Ir al siguiente GES"\n            >\n              <i class="fas fa-chevron-right"></i>\n              <span class="wizard-fab__badge">'.concat(this.currentGesIndex+2,"</span>\n            </button>\n          "),"\n        </div>\n      "):"","\n    ")}},{key:"renderEmptyState",value:function(){this.container.innerHTML='\n      <div class="wizard-empty-state">\n        <i class="fas fa-briefcase"></i>\n        <h3>No hay cargos creados</h3>\n        <p>Necesitas crear al menos un cargo para definir controles de riesgo.</p>\n        <button class="btn-wizard btn-wizard--primary" onclick="window.history.back()">\n          <i class="fas fa-arrow-left"></i>\n          Volver\n        </button>\n      </div>\n    '}},{key:"renderNoRiesgos",value:function(e){this.container.innerHTML='\n      <div class="wizard-empty-state">\n        <i class="fas fa-exclamation-triangle"></i>\n        <h3>Sin riesgos seleccionados</h3>\n        <p>El cargo <strong>'.concat(e.nombre,'</strong> no tiene riesgos (GES) seleccionados.</p>\n        <button class="btn-wizard btn-wizard--primary" onclick="window.history.back()">\n          <i class="fas fa-arrow-left"></i>\n          Volver a seleccionar riesgos\n        </button>\n      </div>\n    ')}},{key:"attachEventListeners",value:function(){var e=this;if(this.container){this.container.querySelectorAll("[data-cargo-index]").forEach((function(n){n.addEventListener("click",(function(n){var t=parseInt(n.currentTarget.dataset.cargoIndex,10);t!==e.currentCargoIndex&&(e.saveCurrentControles(),e.switchCargo(t))}))})),this.container.querySelectorAll(".control-existente-textarea").forEach((function(n){n.addEventListener("input",(function(n){e.updateCharCountExistente(n.target)})),n.addEventListener("blur",(function(){e.saveCurrentControles()}))})),this.container.querySelectorAll(".control-textarea").forEach((function(n){n.addEventListener("input",(function(n){e.updateCharCount(n.target)})),n.addEventListener("blur",(function(){e.saveCurrentControles()}))}));var n=this.container.querySelector("#btn-cargar-sugerencias");n&&n.addEventListener("click",(function(){e.handleLoadSugerencias()}));var t=this.container.querySelector("#btn-ges-anterior"),a=this.container.querySelector("#btn-ges-siguiente"),r=this.container.querySelector("#btn-finalizar-controles"),o=this.container.querySelector("#btn-saltar-ges");t&&t.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesAnterior()})),a&&a.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesSiguiente()})),r&&r.addEventListener("click",(function(){e.saveCurrentControles(),e.finalizarControles()})),o&&o.addEventListener("click",(function(){e.saveCurrentControles(),e.saltarGes()}));var i=this.container.querySelector("#fab-ges-anterior"),s=this.container.querySelector("#fab-ges-siguiente");i&&i.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesAnterior()})),s&&s.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesSiguiente()}))}}},{key:"updateCharCountExistente",value:function(e){var n=e.closest(".control-existente-group");if(n){var t=e.value.length,a=n.querySelector(".char-current"),r=n.querySelector(".control-char-count");a&&(a.textContent=t),t>0?e.classList.add("filled"):e.classList.remove("filled"),r&&(r.classList.remove("warning","danger"),t>=400&&t<490?r.classList.add("warning"):t>=490&&r.classList.add("danger"))}}},{key:"updateCharCount",value:function(e){var n=e.closest(".control-group");if(n){var t=e.value.length,a=n.querySelector(".char-current"),r=n.querySelector(".control-char-count");a&&(a.textContent=t),t>0?e.classList.add("filled"):e.classList.remove("filled"),r&&(r.classList.remove("warning","danger"),t>=400&&t<490?r.classList.add("warning"):t>=490&&r.classList.add("danger"))}}},{key:"saveCurrentControles",value:function(){if(this.container){var e=this.state.getCargos()[this.currentCargoIndex];if(e)if(e.ges[this.currentGesIndex]){var n={};this.container.querySelectorAll(".control-existente-textarea").forEach((function(e){var t=e.dataset.controlExistente;n[t]=e.value.trim()})),this.container.querySelectorAll(".control-textarea").forEach((function(e){var t=e.dataset.controlType;n[t]=e.value.trim()})),console.log("[ControlesManager] Saving controles:",{cargoIndex:this.currentCargoIndex,gesIndex:this.currentGesIndex,controles:n}),this.state.updateGESControles(this.currentCargoIndex,this.currentGesIndex,n)}}}},{key:"switchCargo",value:function(e){var n=this.state.getCargos();e<0||e>=n.length||(this.currentCargoIndex=e,this.currentGesIndex=0,this.render(),console.log("[ControlesManager] Switched to cargo ".concat(e)))}},{key:"navegarGesAnterior",value:function(){var e=this;if(this.currentGesIndex>0){var n=this.container.querySelector(".controles-hierarchy");n&&n.classList.add("ges-transition-exit"),setTimeout((function(){e.currentGesIndex--,e.render(),e.scrollToTop();var n=e.container.querySelector(".controles-hierarchy");n&&n.classList.add("ges-transition-enter")}),300)}}},{key:"navegarGesSiguiente",value:function(){var e=this,n=this.state.getCargos()[this.currentCargoIndex].ges.length;if(this.currentGesIndex<n-1){var t=this.container.querySelector(".controles-hierarchy");t&&t.classList.add("ges-transition-exit"),setTimeout((function(){e.currentGesIndex++,e.render(),e.scrollToTop();var n=e.container.querySelector(".controles-hierarchy");n&&n.classList.add("ges-transition-enter")}),300)}}},{key:"saltarGes",value:function(){this.navegarGesSiguiente()}},{key:"finalizarControles",value:function(){console.log("[ControlesManager] Finalizando controles...");var e=new CustomEvent("controles:completed",{bubbles:!0,detail:{cargoIndex:this.currentCargoIndex,gesIndex:this.currentGesIndex}});this.container.dispatchEvent(e)}},{key:"scrollToTop",value:function(){this.container&&this.container.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"getCompletionStats",value:function(){var e=this.state.getCargos(),n=0,t=0;return e.forEach((function(e){e.ges&&e.ges.forEach((function(e){n++;var a=e.controles||{};Object.values(a).some((function(e){return e&&e.trim().length>0}))&&t++}))})),{totalGES:n,gesWithControles:t,percentage:n>0?Math.round(t/n*100):0}}},{key:"showToast",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;document.querySelectorAll(".toast-notification").forEach((function(e){return e.remove()}));var a=document.createElement("div");a.className="toast-notification ".concat(n),a.setAttribute("role","alert"),a.setAttribute("aria-live","polite");var r={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};a.innerHTML='\n      <i class="'.concat(r[n]||r.info,'"></i>\n      <span class="toast-message">').concat(e,'</span>\n      <button class="toast-close" aria-label="Cerrar notificaci√≥n">\n        <i class="fas fa-times"></i>\n      </button>\n    '),document.body.appendChild(a),a.querySelector(".toast-close").addEventListener("click",(function(){a.classList.add("hiding"),setTimeout((function(){return a.remove()}),300)})),setTimeout((function(){document.body.contains(a)&&(a.classList.add("hiding"),setTimeout((function(){return a.remove()}),300))}),t)}},{key:"handleLoadSugerencias",value:(e=o(s().mark((function e(){var n,t,a,r,o,i,c,l,d,u,g,p,f,v,h,m,b=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.container.querySelector("#btn-cargar-sugerencias")){e.next=3;break}return e.abrupt("return");case 3:if(e.prev=3,t=this.state.getCargos(),a=t[this.currentCargoIndex]){e.next=8;break}return e.abrupt("return");case 8:if(r=a.ges[this.currentGesIndex]){e.next=11;break}return e.abrupt("return");case 11:return o=r.nombre,console.log("[ControlesManager] Cargando sugerencias para: ".concat(o)),n.disabled=!0,n.classList.add("wizard-btn-loading"),n.setAttribute("aria-busy","true"),i=n.innerHTML,e.next=19,fetch("/api/catalogo/ges?search=".concat(encodeURIComponent(o),"&limit=5"));case 19:return c=e.sent,e.next=22,c.json();case 22:if((l=e.sent).success&&l.data&&0!==l.data.length){e.next=30;break}return this.showToast('No se encontraron sugerencias predefinidas para "'.concat(o,'". Puedes ingresarlas manualmente.'),"warning",6e3),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,e.abrupt("return");case 30:if(d=l.data.find((function(e){return e.nombre.toLowerCase().trim()===o.toLowerCase().trim()})),d){e.next=38;break}return this.showToast('No se encontr√≥ coincidencia exacta para "'.concat(o,'"'),"warning",6e3),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,e.abrupt("return");case 38:return e.next=40,fetch("/api/catalogo/ges/".concat(d.id));case 40:return u=e.sent,e.next=43,u.json();case 43:if((g=e.sent).success&&g.data){e.next=51;break}return this.showToast('No se pudieron cargar los detalles para "'.concat(o,'"'),"error"),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,e.abrupt("return");case 51:if(p=g.data,f=p.medidas_intervencion){e.next=60;break}return this.showToast('El GES "'.concat(o,'" no tiene medidas de intervenci√≥n predefinidas'),"warning"),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,e.abrupt("return");case 60:v=this.container.querySelectorAll(".control-textarea"),h=0,v.forEach((function(e){var n="";switch(e.dataset.controlType){case"eliminacion":n=f.eliminacion||"";break;case"sustitucion":n=f.sustitucion||"";break;case"controlesIngenieria":n=f.controles_ingenieria||"";break;case"controlesAdministrativos":n=f.controles_administrativos||""}if(n){var t=e.closest(".control-group");e.value=n,e.classList.add("filled"),b.updateCharCount(e),t&&(t.style.animation="none",setTimeout((function(){t.style.animation="fieldHighlight 0.6s ease-out"}),10)),h++}})),this.saveCurrentControles(),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,h>0?this.showToast("‚úì Se cargaron ".concat(h," medidas de intervenci√≥n exitosamente"),"success"):this.showToast("No se encontraron medidas predefinidas para este GES","info"),console.log("[ControlesManager] Sugerencias cargadas desde BD"),e.next=78;break;case 72:e.prev=72,e.t0=e.catch(3),console.error("[ControlesManager] Error al cargar sugerencias:",e.t0),(m=this.container.querySelector("#btn-cargar-sugerencias"))&&(m.disabled=!1,m.classList.remove("wizard-btn-loading"),m.setAttribute("aria-busy","false")),this.showToast("Error al cargar sugerencias. Por favor, intenta nuevamente.","error");case 78:case"end":return e.stop()}}),e,this,[[3,72]])}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){this.container&&(this.container.innerHTML="")}}]);var e}();const Pn=Math.min,Dn=Math.max,jn=Math.round,qn=Math.floor,Rn=e=>({x:e,y:e}),Gn={left:"right",right:"left",bottom:"top",top:"bottom"},On={start:"end",end:"start"};function Fn(e,n,t){return Dn(e,Pn(n,t))}function Mn(e,n){return"function"==typeof e?e(n):e}function $n(e){return e.split("-")[0]}function Hn(e){return e.split("-")[1]}function Bn(e){return"x"===e?"y":"x"}function Wn(e){return"y"===e?"height":"width"}const Vn=new Set(["top","bottom"]);function Un(e){return Vn.has($n(e))?"y":"x"}function Kn(e){return Bn(Un(e))}function Yn(e){return e.replace(/start|end/g,(e=>On[e]))}const Jn=["left","right"],Xn=["right","left"],Qn=["top","bottom"],Zn=["bottom","top"];function et(e,n,t,a){const r=Hn(e);let o=function(e,n,t){switch(e){case"top":case"bottom":return t?n?Xn:Jn:n?Jn:Xn;case"left":case"right":return n?Qn:Zn;default:return[]}}($n(e),"start"===t,a);return r&&(o=o.map((e=>e+"-"+r)),n&&(o=o.concat(o.map(Yn)))),o}function nt(e){return e.replace(/left|right|bottom|top/g,(e=>Gn[e]))}function tt(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function at(e){const{x:n,y:t,width:a,height:r}=e;return{width:a,height:r,top:t,left:n,right:n+a,bottom:t+r,x:n,y:t}}function rt(e,n,t){let{reference:a,floating:r}=e;const o=Un(n),i=Kn(n),s=Wn(i),c=$n(n),l="y"===o,d=a.x+a.width/2-r.width/2,u=a.y+a.height/2-r.height/2,g=a[s]/2-r[s]/2;let p;switch(c){case"top":p={x:d,y:a.y-r.height};break;case"bottom":p={x:d,y:a.y+a.height};break;case"right":p={x:a.x+a.width,y:u};break;case"left":p={x:a.x-r.width,y:u};break;default:p={x:a.x,y:a.y}}switch(Hn(n)){case"start":p[i]-=g*(t&&l?-1:1);break;case"end":p[i]+=g*(t&&l?-1:1)}return p}async function ot(e,n){var t;void 0===n&&(n={});const{x:a,y:r,platform:o,rects:i,elements:s,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:g=!1,padding:p=0}=Mn(n,e),f=tt(p),v=s[g?"floating"===u?"reference":"floating":u],h=at(await o.getClippingRect({element:null==(t=await(null==o.isElement?void 0:o.isElement(v)))||t?v:v.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(s.floating)),boundary:l,rootBoundary:d,strategy:c})),m="floating"===u?{x:a,y:r,width:i.floating.width,height:i.floating.height}:i.reference,b=await(null==o.getOffsetParent?void 0:o.getOffsetParent(s.floating)),y=await(null==o.isElement?void 0:o.isElement(b))&&await(null==o.getScale?void 0:o.getScale(b))||{x:1,y:1},x=at(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:m,offsetParent:b,strategy:c}):m);return{top:(h.top-x.top+f.top)/y.y,bottom:(x.bottom-h.bottom+f.bottom)/y.y,left:(h.left-x.left+f.left)/y.x,right:(x.right-h.right+f.right)/y.x}}const it=new Set(["left","top"]);function st(){return"undefined"!=typeof window}function ct(e){return ut(e)?(e.nodeName||"").toLowerCase():"#document"}function lt(e){var n;return(null==e||null==(n=e.ownerDocument)?void 0:n.defaultView)||window}function dt(e){var n;return null==(n=(ut(e)?e.ownerDocument:e.document)||window.document)?void 0:n.documentElement}function ut(e){return!!st()&&(e instanceof Node||e instanceof lt(e).Node)}function gt(e){return!!st()&&(e instanceof Element||e instanceof lt(e).Element)}function pt(e){return!!st()&&(e instanceof HTMLElement||e instanceof lt(e).HTMLElement)}function ft(e){return!(!st()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof lt(e).ShadowRoot)}const vt=new Set(["inline","contents"]);function ht(e){const{overflow:n,overflowX:t,overflowY:a,display:r}=zt(e);return/auto|scroll|overlay|hidden|clip/.test(n+a+t)&&!vt.has(r)}const mt=new Set(["table","td","th"]);function bt(e){return mt.has(ct(e))}const yt=[":popover-open",":modal"];function xt(e){return yt.some((n=>{try{return e.matches(n)}catch(e){return!1}}))}const wt=["transform","translate","scale","rotate","perspective"],Ct=["transform","translate","scale","rotate","perspective","filter"],Et=["paint","layout","strict","content"];function St(e){const n=kt(),t=gt(e)?zt(e):e;return wt.some((e=>!!t[e]&&"none"!==t[e]))||!!t.containerType&&"normal"!==t.containerType||!n&&!!t.backdropFilter&&"none"!==t.backdropFilter||!n&&!!t.filter&&"none"!==t.filter||Ct.some((e=>(t.willChange||"").includes(e)))||Et.some((e=>(t.contain||"").includes(e)))}function kt(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const At=new Set(["html","body","#document"]);function _t(e){return At.has(ct(e))}function zt(e){return lt(e).getComputedStyle(e)}function Nt(e){return gt(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Tt(e){if("html"===ct(e))return e;const n=e.assignedSlot||e.parentNode||ft(e)&&e.host||dt(e);return ft(n)?n.host:n}function Lt(e){const n=Tt(e);return _t(n)?e.ownerDocument?e.ownerDocument.body:e.body:pt(n)&&ht(n)?n:Lt(n)}function It(e,n,t){var a;void 0===n&&(n=[]),void 0===t&&(t=!0);const r=Lt(e),o=r===(null==(a=e.ownerDocument)?void 0:a.body),i=lt(r);if(o){const e=Pt(i);return n.concat(i,i.visualViewport||[],ht(r)?r:[],e&&t?It(e):[])}return n.concat(r,It(r,[],t))}function Pt(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Dt(e){const n=zt(e);let t=parseFloat(n.width)||0,a=parseFloat(n.height)||0;const r=pt(e),o=r?e.offsetWidth:t,i=r?e.offsetHeight:a,s=jn(t)!==o||jn(a)!==i;return s&&(t=o,a=i),{width:t,height:a,$:s}}function jt(e){return gt(e)?e:e.contextElement}function qt(e){const n=jt(e);if(!pt(n))return Rn(1);const t=n.getBoundingClientRect(),{width:a,height:r,$:o}=Dt(n);let i=(o?jn(t.width):t.width)/a,s=(o?jn(t.height):t.height)/r;return i&&Number.isFinite(i)||(i=1),s&&Number.isFinite(s)||(s=1),{x:i,y:s}}const Rt=Rn(0);function Gt(e){const n=lt(e);return kt()&&n.visualViewport?{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}:Rt}function Ot(e,n,t,a){void 0===n&&(n=!1),void 0===t&&(t=!1);const r=e.getBoundingClientRect(),o=jt(e);let i=Rn(1);n&&(a?gt(a)&&(i=qt(a)):i=qt(e));const s=function(e,n,t){return void 0===n&&(n=!1),!(!t||n&&t!==lt(e))&&n}(o,t,a)?Gt(o):Rn(0);let c=(r.left+s.x)/i.x,l=(r.top+s.y)/i.y,d=r.width/i.x,u=r.height/i.y;if(o){const e=lt(o),n=a&&gt(a)?lt(a):a;let t=e,r=Pt(t);for(;r&&a&&n!==t;){const e=qt(r),n=r.getBoundingClientRect(),a=zt(r),o=n.left+(r.clientLeft+parseFloat(a.paddingLeft))*e.x,i=n.top+(r.clientTop+parseFloat(a.paddingTop))*e.y;c*=e.x,l*=e.y,d*=e.x,u*=e.y,c+=o,l+=i,t=lt(r),r=Pt(t)}}return at({width:d,height:u,x:c,y:l})}function Ft(e,n){const t=Nt(e).scrollLeft;return n?n.left+t:Ot(dt(e)).left+t}function Mt(e,n){const t=e.getBoundingClientRect();return{x:t.left+n.scrollLeft-Ft(e,t),y:t.top+n.scrollTop}}const $t=new Set(["absolute","fixed"]);function Ht(e,n,t){let a;if("viewport"===n)a=function(e,n){const t=lt(e),a=dt(e),r=t.visualViewport;let o=a.clientWidth,i=a.clientHeight,s=0,c=0;if(r){o=r.width,i=r.height;const e=kt();(!e||e&&"fixed"===n)&&(s=r.offsetLeft,c=r.offsetTop)}const l=Ft(a);if(l<=0){const e=a.ownerDocument,n=e.body,t=getComputedStyle(n),r="CSS1Compat"===e.compatMode&&parseFloat(t.marginLeft)+parseFloat(t.marginRight)||0,i=Math.abs(a.clientWidth-n.clientWidth-r);i<=25&&(o-=i)}else l<=25&&(o+=l);return{width:o,height:i,x:s,y:c}}(e,t);else if("document"===n)a=function(e){const n=dt(e),t=Nt(e),a=e.ownerDocument.body,r=Dn(n.scrollWidth,n.clientWidth,a.scrollWidth,a.clientWidth),o=Dn(n.scrollHeight,n.clientHeight,a.scrollHeight,a.clientHeight);let i=-t.scrollLeft+Ft(e);const s=-t.scrollTop;return"rtl"===zt(a).direction&&(i+=Dn(n.clientWidth,a.clientWidth)-r),{width:r,height:o,x:i,y:s}}(dt(e));else if(gt(n))a=function(e,n){const t=Ot(e,!0,"fixed"===n),a=t.top+e.clientTop,r=t.left+e.clientLeft,o=pt(e)?qt(e):Rn(1);return{width:e.clientWidth*o.x,height:e.clientHeight*o.y,x:r*o.x,y:a*o.y}}(n,t);else{const t=Gt(e);a={x:n.x-t.x,y:n.y-t.y,width:n.width,height:n.height}}return at(a)}function Bt(e,n){const t=Tt(e);return!(t===n||!gt(t)||_t(t))&&("fixed"===zt(t).position||Bt(t,n))}function Wt(e,n,t){const a=pt(n),r=dt(n),o="fixed"===t,i=Ot(e,!0,o,n);let s={scrollLeft:0,scrollTop:0};const c=Rn(0);function l(){c.x=Ft(r)}if(a||!a&&!o)if(("body"!==ct(n)||ht(r))&&(s=Nt(n)),a){const e=Ot(n,!0,o,n);c.x=e.x+n.clientLeft,c.y=e.y+n.clientTop}else r&&l();o&&!a&&r&&l();const d=!r||a||o?Rn(0):Mt(r,s);return{x:i.left+s.scrollLeft-c.x-d.x,y:i.top+s.scrollTop-c.y-d.y,width:i.width,height:i.height}}function Vt(e){return"static"===zt(e).position}function Ut(e,n){if(!pt(e)||"fixed"===zt(e).position)return null;if(n)return n(e);let t=e.offsetParent;return dt(e)===t&&(t=t.ownerDocument.body),t}function Kt(e,n){const t=lt(e);if(xt(e))return t;if(!pt(e)){let n=Tt(e);for(;n&&!_t(n);){if(gt(n)&&!Vt(n))return n;n=Tt(n)}return t}let a=Ut(e,n);for(;a&&bt(a)&&Vt(a);)a=Ut(a,n);return a&&_t(a)&&Vt(a)&&!St(a)?t:a||function(e){let n=Tt(e);for(;pt(n)&&!_t(n);){if(St(n))return n;if(xt(n))return null;n=Tt(n)}return null}(e)||t}const Yt={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:n,rect:t,offsetParent:a,strategy:r}=e;const o="fixed"===r,i=dt(a),s=!!n&&xt(n.floating);if(a===i||s&&o)return t;let c={scrollLeft:0,scrollTop:0},l=Rn(1);const d=Rn(0),u=pt(a);if((u||!u&&!o)&&(("body"!==ct(a)||ht(i))&&(c=Nt(a)),pt(a))){const e=Ot(a);l=qt(a),d.x=e.x+a.clientLeft,d.y=e.y+a.clientTop}const g=!i||u||o?Rn(0):Mt(i,c);return{width:t.width*l.x,height:t.height*l.y,x:t.x*l.x-c.scrollLeft*l.x+d.x+g.x,y:t.y*l.y-c.scrollTop*l.y+d.y+g.y}},getDocumentElement:dt,getClippingRect:function(e){let{element:n,boundary:t,rootBoundary:a,strategy:r}=e;const o=[..."clippingAncestors"===t?xt(n)?[]:function(e,n){const t=n.get(e);if(t)return t;let a=It(e,[],!1).filter((e=>gt(e)&&"body"!==ct(e))),r=null;const o="fixed"===zt(e).position;let i=o?Tt(e):e;for(;gt(i)&&!_t(i);){const n=zt(i),t=St(i);t||"fixed"!==n.position||(r=null),(o?!t&&!r:!t&&"static"===n.position&&r&&$t.has(r.position)||ht(i)&&!t&&Bt(e,i))?a=a.filter((e=>e!==i)):r=n,i=Tt(i)}return n.set(e,a),a}(n,this._c):[].concat(t),a],i=o[0],s=o.reduce(((e,t)=>{const a=Ht(n,t,r);return e.top=Dn(a.top,e.top),e.right=Pn(a.right,e.right),e.bottom=Pn(a.bottom,e.bottom),e.left=Dn(a.left,e.left),e}),Ht(n,i,r));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}},getOffsetParent:Kt,getElementRects:async function(e){const n=this.getOffsetParent||Kt,t=this.getDimensions,a=await t(e.floating);return{reference:Wt(e.reference,await n(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:n,height:t}=Dt(e);return{width:n,height:t}},getScale:qt,isElement:gt,isRTL:function(e){return"rtl"===zt(e).direction}};function Jt(e,n){return e.x===n.x&&e.y===n.y&&e.width===n.width&&e.height===n.height}function Xt(e,n,t,a){void 0===a&&(a={});const{ancestorScroll:r=!0,ancestorResize:o=!0,elementResize:i="function"==typeof ResizeObserver,layoutShift:s="function"==typeof IntersectionObserver,animationFrame:c=!1}=a,l=jt(e),d=r||o?[...l?It(l):[],...It(n)]:[];d.forEach((e=>{r&&e.addEventListener("scroll",t,{passive:!0}),o&&e.addEventListener("resize",t)}));const u=l&&s?function(e,n){let t,a=null;const r=dt(e);function o(){var e;clearTimeout(t),null==(e=a)||e.disconnect(),a=null}return function i(s,c){void 0===s&&(s=!1),void 0===c&&(c=1),o();const l=e.getBoundingClientRect(),{left:d,top:u,width:g,height:p}=l;if(s||n(),!g||!p)return;const f={rootMargin:-qn(u)+"px "+-qn(r.clientWidth-(d+g))+"px "+-qn(r.clientHeight-(u+p))+"px "+-qn(d)+"px",threshold:Dn(0,Pn(1,c))||1};let v=!0;function h(n){const a=n[0].intersectionRatio;if(a!==c){if(!v)return i();a?i(!1,a):t=setTimeout((()=>{i(!1,1e-7)}),1e3)}1!==a||Jt(l,e.getBoundingClientRect())||i(),v=!1}try{a=new IntersectionObserver(h,{...f,root:r.ownerDocument})}catch(e){a=new IntersectionObserver(h,f)}a.observe(e)}(!0),o}(l,t):null;let g,p=-1,f=null;i&&(f=new ResizeObserver((e=>{let[a]=e;a&&a.target===l&&f&&(f.unobserve(n),cancelAnimationFrame(p),p=requestAnimationFrame((()=>{var e;null==(e=f)||e.observe(n)}))),t()})),l&&!c&&f.observe(l),f.observe(n));let v=c?Ot(e):null;return c&&function n(){const a=Ot(e);v&&!Jt(v,a)&&t();v=a,g=requestAnimationFrame(n)}(),t(),()=>{var e;d.forEach((e=>{r&&e.removeEventListener("scroll",t),o&&e.removeEventListener("resize",t)})),null==u||u(),null==(e=f)||e.disconnect(),f=null,c&&cancelAnimationFrame(g)}}const Qt=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(n){var t,a;const{x:r,y:o,placement:i,middlewareData:s}=n,c=await async function(e,n){const{placement:t,platform:a,elements:r}=e,o=await(null==a.isRTL?void 0:a.isRTL(r.floating)),i=$n(t),s=Hn(t),c="y"===Un(t),l=it.has(i)?-1:1,d=o&&c?-1:1,u=Mn(n,e);let{mainAxis:g,crossAxis:p,alignmentAxis:f}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return s&&"number"==typeof f&&(p="end"===s?-1*f:f),c?{x:p*d,y:g*l}:{x:g*l,y:p*d}}(n,e);return i===(null==(t=s.offset)?void 0:t.placement)&&null!=(a=s.arrow)&&a.alignmentOffset?{}:{x:r+c.x,y:o+c.y,data:{...c,placement:i}}}}},Zt=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(n){const{x:t,y:a,placement:r}=n,{mainAxis:o=!0,crossAxis:i=!1,limiter:s={fn:e=>{let{x:n,y:t}=e;return{x:n,y:t}}},...c}=Mn(e,n),l={x:t,y:a},d=await ot(n,c),u=Un($n(r)),g=Bn(u);let p=l[g],f=l[u];if(o){const e="y"===g?"bottom":"right";p=Fn(p+d["y"===g?"top":"left"],p,p-d[e])}if(i){const e="y"===u?"bottom":"right";f=Fn(f+d["y"===u?"top":"left"],f,f-d[e])}const v=s.fn({...n,[g]:p,[u]:f});return{...v,data:{x:v.x-t,y:v.y-a,enabled:{[g]:o,[u]:i}}}}}},ea=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(n){var t,a;const{placement:r,middlewareData:o,rects:i,initialPlacement:s,platform:c,elements:l}=n,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:g,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:v=!0,...h}=Mn(e,n);if(null!=(t=o.arrow)&&t.alignmentOffset)return{};const m=$n(r),b=Un(s),y=$n(s)===s,x=await(null==c.isRTL?void 0:c.isRTL(l.floating)),w=g||(y||!v?[nt(s)]:function(e){const n=nt(e);return[Yn(e),n,Yn(n)]}(s)),C="none"!==f;!g&&C&&w.push(...et(s,v,f,x));const E=[s,...w],S=await ot(n,h),k=[];let A=(null==(a=o.flip)?void 0:a.overflows)||[];if(d&&k.push(S[m]),u){const e=function(e,n,t){void 0===t&&(t=!1);const a=Hn(e),r=Kn(e),o=Wn(r);let i="x"===r?a===(t?"end":"start")?"right":"left":"start"===a?"bottom":"top";return n.reference[o]>n.floating[o]&&(i=nt(i)),[i,nt(i)]}(r,i,x);k.push(S[e[0]],S[e[1]])}if(A=[...A,{placement:r,overflows:k}],!k.every((e=>e<=0))){var _,z;const e=((null==(_=o.flip)?void 0:_.index)||0)+1,n=E[e];if(n){if(!("alignment"===u&&b!==Un(n))||A.every((e=>Un(e.placement)!==b||e.overflows[0]>0)))return{data:{index:e,overflows:A},reset:{placement:n}}}let t=null==(z=A.filter((e=>e.overflows[0]<=0)).sort(((e,n)=>e.overflows[1]-n.overflows[1]))[0])?void 0:z.placement;if(!t)switch(p){case"bestFit":{var N;const e=null==(N=A.filter((e=>{if(C){const n=Un(e.placement);return n===b||"y"===n}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,n)=>e+n),0)])).sort(((e,n)=>e[1]-n[1]))[0])?void 0:N[0];e&&(t=e);break}case"initialPlacement":t=s}if(r!==t)return{reset:{placement:t}}}return{}}}},na=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(n){var t,a;const{placement:r,rects:o,platform:i,elements:s}=n,{apply:c=()=>{},...l}=Mn(e,n),d=await ot(n,l),u=$n(r),g=Hn(r),p="y"===Un(r),{width:f,height:v}=o.floating;let h,m;"top"===u||"bottom"===u?(h=u,m=g===(await(null==i.isRTL?void 0:i.isRTL(s.floating))?"start":"end")?"left":"right"):(m=u,h="end"===g?"top":"bottom");const b=v-d.top-d.bottom,y=f-d.left-d.right,x=Pn(v-d[h],b),w=Pn(f-d[m],y),C=!n.middlewareData.shift;let E=x,S=w;if(null!=(t=n.middlewareData.shift)&&t.enabled.x&&(S=y),null!=(a=n.middlewareData.shift)&&a.enabled.y&&(E=b),C&&!g){const e=Dn(d.left,0),n=Dn(d.right,0),t=Dn(d.top,0),a=Dn(d.bottom,0);p?S=f-2*(0!==e||0!==n?e+n:Dn(d.left,d.right)):E=v-2*(0!==t||0!==a?t+a:Dn(d.top,d.bottom))}await c({...n,availableWidth:S,availableHeight:E});const k=await i.getDimensions(s.floating);return f!==k.width||v!==k.height?{reset:{rects:!0}}:{}}}},ta=e=>({name:"arrow",options:e,async fn(n){const{x:t,y:a,placement:r,rects:o,platform:i,elements:s,middlewareData:c}=n,{element:l,padding:d=0}=Mn(e,n)||{};if(null==l)return{};const u=tt(d),g={x:t,y:a},p=Kn(r),f=Wn(p),v=await i.getDimensions(l),h="y"===p,m=h?"top":"left",b=h?"bottom":"right",y=h?"clientHeight":"clientWidth",x=o.reference[f]+o.reference[p]-g[p]-o.floating[f],w=g[p]-o.reference[p],C=await(null==i.getOffsetParent?void 0:i.getOffsetParent(l));let E=C?C[y]:0;E&&await(null==i.isElement?void 0:i.isElement(C))||(E=s.floating[y]||o.floating[f]);const S=x/2-w/2,k=E/2-v[f]/2-1,A=Pn(u[m],k),_=Pn(u[b],k),z=A,N=E-v[f]-_,T=E/2-v[f]/2+S,L=Fn(z,T,N),I=!c.arrow&&null!=Hn(r)&&T!==L&&o.reference[f]/2-(T<z?A:_)-v[f]/2<0,P=I?T<z?T-z:T-N:0;return{[p]:g[p]+P,data:{[p]:L,centerOffset:T-L-P,...I&&{alignmentOffset:P}},reset:I}}}),aa=(e,n,t)=>{const a=new Map,r={platform:Yt,...t},o={...r.platform,_c:a};return(async(e,n,t)=>{const{placement:a="bottom",strategy:r="absolute",middleware:o=[],platform:i}=t,s=o.filter(Boolean),c=await(null==i.isRTL?void 0:i.isRTL(n));let l=await i.getElementRects({reference:e,floating:n,strategy:r}),{x:d,y:u}=rt(l,a,c),g=a,p={},f=0;for(let t=0;t<s.length;t++){const{name:o,fn:v}=s[t],{x:h,y:m,data:b,reset:y}=await v({x:d,y:u,initialPlacement:a,placement:g,strategy:r,middlewareData:p,rects:l,platform:i,elements:{reference:e,floating:n}});d=null!=h?h:d,u=null!=m?m:u,p={...p,[o]:{...p[o],...b}},y&&f<=50&&(f++,"object"==typeof y&&(y.placement&&(g=y.placement),y.rects&&(l=!0===y.rects?await i.getElementRects({reference:e,floating:n,strategy:r}):y.rects),({x:d,y:u}=rt(l,g,c))),t=-1)}return{x:d,y:u,placement:g,strategy:r,middlewareData:p}})(e,n,{...r,platform:o})};function ra(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.placement,r=void 0===a?"top":a,i=t.offset,c=void 0===i?8:i,l=t.arrow,u=void 0===l||l,g=t.trigger,p=void 0===g?"hover":g,f=t.delay,v=void 0===f?200:f,h=document.createElement("div");h.className="floating-tooltip",h.setAttribute("role","tooltip"),"string"==typeof n?h.innerHTML=n:h.appendChild(n);var m=null;u&&((m=document.createElement("div")).className="floating-tooltip__arrow",h.appendChild(m));var b=!1,y=null,x=null;function w(){return C.apply(this,arguments)}function C(){return C=o(s().mark((function n(){var t,a,o,i,l,g,p,f,v,y;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(b){n.next=2;break}return n.abrupt("return");case 2:return t=[Qt(c),ea(),Zt({padding:5})],u&&m&&t.push(ta({element:m})),n.next=6,aa(e,h,{placement:r,middleware:t});case 6:a=n.sent,o=a.x,i=a.y,l=a.placement,g=a.middlewareData,Object.assign(h.style,{left:"".concat(o,"px"),top:"".concat(i,"px")}),g.arrow&&m&&(p=g.arrow,f=p.x,v=p.y,y={top:"bottom",right:"left",bottom:"top",left:"right"}[l.split("-")[0]],Object.assign(m.style,d({left:null!=f?"".concat(f,"px"):"",top:null!=v?"".concat(v,"px"):"",right:"",bottom:""},y,"-4px"))),h.setAttribute("data-placement",l);case 14:case"end":return n.stop()}}),n)}))),C.apply(this,arguments)}function E(){b||(b=!0,document.body.appendChild(h),x=Xt(e,h,w),w(),requestAnimationFrame((function(){h.classList.add("floating-tooltip--visible")})))}function S(){b&&(b=!1,h.classList.remove("floating-tooltip--visible"),x&&(x(),x=null),setTimeout((function(){!b&&h.parentNode&&h.parentNode.removeChild(h)}),200))}function k(){y&&clearTimeout(y),y=setTimeout(E,v)}function A(){y&&(clearTimeout(y),y=null)}function _(){b?S():E()}return"hover"===p?(e.addEventListener("mouseenter",k),e.addEventListener("mouseleave",(function(){A(),S()})),e.addEventListener("focus",k),e.addEventListener("blur",(function(){A(),S()}))):"click"===p&&e.addEventListener("click",_),{show:E,hide:S,destroy:function(){S(),"hover"===p?(e.removeEventListener("mouseenter",k),e.removeEventListener("mouseleave",S),e.removeEventListener("focus",k),e.removeEventListener("blur",S)):"click"===p&&e.removeEventListener("click",_)},toggle:_,element:h}}function oa(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.placement,r=void 0===a?"bottom":a,i=t.offset,c=void 0===i?8:i,l=t.closeOnClickOutside,d=void 0===l||l,u=t.closeOnEscape,g=void 0===u||u,p=document.createElement("div");p.className="floating-popover",p.setAttribute("role","dialog"),"string"==typeof n?p.innerHTML=n:p.appendChild(n);var f=!1,v=null;function h(){return m.apply(this,arguments)}function m(){return m=o(s().mark((function n(){var t,a,o,i;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(f){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,aa(e,p,{placement:r,middleware:[Qt(c),ea(),Zt({padding:10}),na({apply:function(e){var n=e.availableWidth,t=e.availableHeight,a=e.elements;Object.assign(a.floating.style,{maxWidth:"".concat(n,"px"),maxHeight:"".concat(t,"px")})}})]});case 4:t=n.sent,a=t.x,o=t.y,i=t.placement,Object.assign(p.style,{left:"".concat(a,"px"),top:"".concat(o,"px")}),p.setAttribute("data-placement",i);case 10:case"end":return n.stop()}}),n)}))),m.apply(this,arguments)}function b(){f||(f=!0,document.body.appendChild(p),v=Xt(e,p,h),h(),requestAnimationFrame((function(){p.classList.add("floating-popover--visible")})),d&&setTimeout((function(){document.addEventListener("click",x)}),0),g&&document.addEventListener("keydown",w))}function y(){f&&(f=!1,p.classList.remove("floating-popover--visible"),v&&(v(),v=null),document.removeEventListener("click",x),document.removeEventListener("keydown",w),setTimeout((function(){!f&&p.parentNode&&p.parentNode.removeChild(p)}),200))}function x(n){p.contains(n.target)||e.contains(n.target)||y()}function w(e){"Escape"===e.key&&y()}return{show:b,hide:y,destroy:function(){v&&(v(),v=null),document.removeEventListener("click",x),document.removeEventListener("keydown",w),p.parentNode&&p.parentNode.removeChild(p),f=!1},toggle:function(){return f?y():b()},element:p}}function ia(e,n,t){var a=document.createElement("div");a.className="wizard-resume-modal",a.setAttribute("role","dialog"),a.setAttribute("aria-modal","true"),a.setAttribute("aria-labelledby","modal-title");var r={"info-basica":"Informaci√≥n B√°sica",cargos:"Cargos",riesgos:"Riesgos por Cargo",niveles:"Niveles de Riesgo",controles:"Controles de Seguridad",resumen:"Resumen"}[e]||e;a.innerHTML='\n    <div class="modal-overlay" aria-hidden="true"></div>\n    <div class="modal-content">\n      <div class="modal-icon">\n        <i class="fas fa-save"></i>\n      </div>\n      <h3 class="modal-title" id="modal-title">Sesi√≥n guardada encontrada</h3>\n      <p class="modal-message">\n        Tienes un progreso guardado en el paso\n        <strong>"'.concat(r,'"</strong>\n      </p>\n      <p class="modal-subtitle">\n        ¬øDeseas continuar donde lo dejaste o empezar de nuevo?\n      </p>\n      <div class="modal-actions">\n        <button class="btn-continue cta-button" type="button">\n          <i class="fas fa-play"></i>\n          <span>Continuar</span>\n        </button>\n        <button class="btn-new cta-button-1" type="button">\n          <i class="fas fa-refresh"></i>\n          <span>Empezar de Nuevo</span>\n        </button>\n      </div>\n    </div>\n  ');var o=a.querySelector(".btn-continue"),i=a.querySelector(".btn-new"),s=a.querySelector(".modal-overlay"),c=function(){a.classList.add("modal-closing"),setTimeout((function(){a.remove(),document.body.style.overflow=""}),300)};return o.addEventListener("click",(function(){c(),n()})),i.addEventListener("click",(function(){c(),t()})),s.addEventListener("click",c),a.addEventListener("keydown",(function(e){if("Escape"===e.key&&c(),"Tab"===e.key){var n=a.querySelectorAll("button"),t=n[0],r=n[n.length-1];e.shiftKey&&document.activeElement===t?(e.preventDefault(),r.focus()):e.shiftKey||document.activeElement!==r||(e.preventDefault(),t.focus())}})),document.body.style.overflow="hidden",document.body.appendChild(a),requestAnimationFrame((function(){a.classList.add("modal-visible"),o.focus()})),a}function sa(e){var n=e.title,t=void 0===n?"¬øEst√°s seguro?":n,a=e.message,r=void 0===a?"":a,o=e.confirmText,i=void 0===o?"Confirmar":o,s=e.cancelText,c=void 0===s?"Cancelar":s,l=e.type,d=void 0===l?"info":l,u=e.onConfirm,g=void 0===u?function(){}:u,p=e.onCancel,f=void 0===p?function(){}:p,v=document.createElement("div");v.className="wizard-confirm-modal",v.setAttribute("role","alertdialog"),v.setAttribute("aria-modal","true"),v.setAttribute("aria-labelledby","confirm-modal-title");var h={info:"fa-info-circle",success:"fa-check-circle",warning:"fa-exclamation-triangle",danger:"fa-exclamation-circle"},m=h[d]||h.info;v.innerHTML='\n    <div class="modal-overlay" aria-hidden="true"></div>\n    <div class="modal-content modal-content--'.concat(d,'">\n      <div class="modal-icon modal-icon--').concat(d,'">\n        <i class="fas ').concat(m,'"></i>\n      </div>\n      <h3 class="modal-title" id="confirm-modal-title">').concat(t,"</h3>\n      ").concat(r?'<p class="modal-message">'.concat(r,"</p>"):"",'\n      <div class="modal-actions">\n        <button class="btn-cancel cta-button-1" type="button">\n          <span>').concat(c,'</span>\n        </button>\n        <button class="btn-confirm cta-button btn-confirm--').concat(d,'" type="button">\n          <span>').concat(i,"</span>\n        </button>\n      </div>\n    </div>\n  ");var b=v.querySelector(".btn-confirm"),y=v.querySelector(".btn-cancel"),x=v.querySelector(".modal-overlay"),w=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v.classList.add("modal-closing"),setTimeout((function(){v.remove(),document.body.style.overflow=""}),300),e?g():f()};return b.addEventListener("click",(function(){return w(!0)})),y.addEventListener("click",(function(){return w(!1)})),x.addEventListener("click",(function(){return w(!1)})),v.addEventListener("keydown",(function(e){"Escape"===e.key&&w(!1)})),document.body.style.overflow="hidden",document.body.appendChild(v),requestAnimationFrame((function(){v.classList.add("modal-visible"),b.focus()})),v}function ca(e){var n=e.message,t=void 0===n?"":n,a=e.type,r=void 0===a?"info":a,o=e.duration,i=void 0===o?3e3:o,s=document.createElement("div");s.className="wizard-toast wizard-toast--".concat(r),s.setAttribute("role","alert"),s.setAttribute("aria-live","polite");var c={info:"fa-info-circle",success:"fa-check-circle",warning:"fa-exclamation-triangle",danger:"fa-times-circle"},l=c[r]||c.info;s.innerHTML='\n    <div class="toast-icon">\n      <i class="fas '.concat(l,'"></i>\n    </div>\n    <div class="toast-message">').concat(t,'</div>\n    <button class="toast-close" type="button" aria-label="Cerrar notificaci√≥n">\n      <i class="fas fa-times"></i>\n    </button>\n  ');var d=function(){s.classList.add("toast-closing"),setTimeout((function(){return s.remove()}),300)};s.querySelector(".toast-close").addEventListener("click",d);var u=document.querySelector(".wizard-toast-container");return u||((u=document.createElement("div")).className="wizard-toast-container",u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),document.body.appendChild(u)),u.appendChild(s),requestAnimationFrame((function(){return s.classList.add("toast-visible")})),i>0&&setTimeout(d,i),s}var la=function(){return p((function e(n){u(this,e),this.state=n,this.currentPopover=null,this.currentCargoIndex=null}),[{key:"showEditPopover",value:function(e,n,t){var a=this;console.log("[CargoEditor] showEditPopover called",{referenceElement:e,cargoIndex:n}),this.currentPopover&&(console.log("[CargoEditor] Closing existing popover"),this.currentPopover.hide(),this.currentPopover.destroy(),this.currentPopover=null,this.currentCargoIndex=null),this.currentCargoIndex=n;var r=this.state.getCargo(n);if(r){console.log("[CargoEditor] Creating popover for cargo:",r);var o=this.createPopoverContent(r,n);console.log("[CargoEditor] Creating popover with Floating UI..."),this.currentPopover=oa(e,o,{placement:"bottom",offset:8,closeOnClickOutside:!1,closeOnEscape:!0}),this.currentPopover.element.classList.add("floating-popover--cargo-edit"),console.log("[CargoEditor] Showing popover..."),this.currentPopover.show(),console.log("[CargoEditor] Popover shown, element:",this.currentPopover.element),console.log("[CargoEditor] Popover in DOM:",document.body.contains(this.currentPopover.element)),this.attachEventListeners(n,t),setTimeout((function(){var e=a.currentPopover.element.querySelector("#edit-cargo-nombre");e?(console.log("[CargoEditor] Focusing first input"),e.focus()):console.error("[CargoEditor] First input not found!")}),100)}else console.error("[CargoEditor] Cargo not found:",n)}},{key:"createPopoverContent",value:function(e,n){var t=document.createElement("div"),a=[{name:"tareasRutinarias",icon:"fa-repeat",label:"Tareas repetitivas",severity:"warning",hint:"Puede requerir pausas activas y rotaci√≥n de tareas"},{name:"conduceVehiculo",icon:"fa-car",label:"Conduce veh√≠culo",severity:"warning",hint:"Requiere licencia de conducci√≥n vigente"},{name:"manipulaAlimentos",icon:"fa-utensils",label:"Manipula alimentos",severity:"danger",hint:"Requiere certificado de manipulaci√≥n de alimentos vigente"},{name:"trabajaAlturas",icon:"fa-arrow-up",label:"Trabaja en alturas",severity:"danger",hint:"Requiere certificado de trabajo en alturas y EPP especializado"},{name:"trabajaEspaciosConfinados",icon:"fa-door-closed",label:"Espacios confinados",severity:"danger",hint:"Requiere permiso de trabajo y monitor de gases continuo"}].map((function(n){return'\n      <div class="toggle-group toggle-group--'.concat(n.severity,'">\n        <div class="toggle-header">\n          <div class="toggle-label-wrapper">\n            <i class="fas ').concat(n.icon," toggle-icon toggle-icon--").concat(n.severity,'"></i>\n            <span class="toggle-label">').concat(n.label,'</span>\n          </div>\n          <div class="wizard-switch wizard-switch--').concat(n.severity,'">\n            <input\n              type="checkbox"\n              name="').concat(n.name,'"\n              id="edit-cargo-').concat(n.name,'"\n              ').concat(e[n.name]?"checked":"",'\n            />\n            <span class="slider"></span>\n          </div>\n        </div>\n        <div class="toggle-hint">\n          <i class="fas fa-info-circle"></i>\n          ').concat(n.hint,"\n        </div>\n      </div>\n    ")})).join("");return t.innerHTML='\n      <div class="floating-popover__header">\n        <h3>Editar Cargo</h3>\n        <div class="floating-popover__header-actions">\n          <button type="button" class="btn btn--primary btn--compact" data-action="save-edit">\n            <i class="fas fa-save"></i> Guardar\n          </button>\n          <button class="floating-popover__close" data-action="close-edit">\n            &times;\n          </button>\n        </div>\n      </div>\n      <div class="floating-popover__body floating-popover__body--two-cols">\n        <form id="edit-cargo-form" class="cargo-edit-form">\n          \x3c!-- Columna Izquierda: Informaci√≥n B√°sica --\x3e\n          <div class="floating-popover__col floating-popover__col--basic">\n            <div class="form-group">\n              <label for="edit-cargo-nombre">\n                Nombre del Cargo <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-nombre"\n                name="nombre"\n                class="form-input"\n                value="'.concat(e.nombre,'"\n                placeholder="Ej: Operario de Producci√≥n"\n                required\n                minlength="3"\n                maxlength="100"\n              />\n              <span class="error-message" id="error-nombre"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-numPersonas">\n                N√∫mero de Trabajadores <span class="required">*</span>\n              </label>\n              <input\n                type="number"\n                id="edit-cargo-numPersonas"\n                name="numPersonas"\n                class="form-input"\n                value="').concat(e.numPersonas,'"\n                min="1"\n                max="9999"\n                required\n              />\n              <span class="error-message" id="error-numPersonas"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-area">\n                √Årea en la empresa <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-area"\n                name="area"\n                class="form-input"\n                value="').concat(e.area||"",'"\n                placeholder="Ej: Producci√≥n, Administraci√≥n, Ventas"\n                required\n                maxlength="100"\n              />\n              <span class="error-message" id="error-area"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-zona">\n                Zona o lugar <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-zona"\n                name="zona"\n                class="form-input"\n                value="').concat(e.zona||"",'"\n                placeholder="Ej: Planta 1, Oficina central, Bodega 3"\n                required\n                maxlength="100"\n              />\n              <span class="error-message" id="error-zona"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-descripcion">\n                Descripci√≥n (opcional)\n              </label>\n              <textarea\n                id="edit-cargo-descripcion"\n                name="descripcion"\n                class="form-input"\n                placeholder="Descripci√≥n breve de las funciones del cargo..."\n                rows="4"\n                maxlength="500"\n              >').concat(e.descripcion||"",'</textarea>\n              <span class="form-hint">').concat((e.descripcion||"").length,'/500 caracteres</span>\n            </div>\n          </div>\n\n          \x3c!-- Columna Derecha: Caracter√≠sticas Especiales --\x3e\n          <div class="floating-popover__col floating-popover__col--toggles">\n            <div class="form-group">\n              <label class="form-label-section">\n                <i class="fas fa-shield-alt"></i>\n                Caracter√≠sticas especiales\n              </label>\n              <div class="toggles-grid-modern">\n                ').concat(a,"\n              </div>\n            </div>\n          </div>\n        </form>\n      </div>\n    "),t}},{key:"attachEventListeners",value:function(e,n){var t=this,a=this.currentPopover.element;a.querySelector('[data-action="close-edit"]').addEventListener("click",(function(){return t.closePopover()}));var r=a.querySelector('[data-action="save-edit"]');r.addEventListener("click",(function(){return t.handleSave(e,n)}));var o=a.querySelector("#edit-cargo-descripcion"),i=a.querySelector(".form-hint");o.addEventListener("input",(function(e){i.textContent="".concat(e.target.value.length,"/500 caracteres")})),a.querySelector("#edit-cargo-nombre").addEventListener("input",(function(){return t.validateField("nombre",e)})),a.querySelector("#edit-cargo-numPersonas").addEventListener("input",(function(){return t.validateField("numPersonas",e)})),a.querySelector("#edit-cargo-area").addEventListener("input",(function(){return t.validateField("area",e)})),a.querySelector("#edit-cargo-zona").addEventListener("input",(function(){return t.validateField("zona",e)})),a.addEventListener("keydown",(function(e){"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),r.click())}))}},{key:"validateField",value:function(e,n){var t=this.currentPopover.element,a=t.querySelector("#edit-cargo-".concat(e)),r=t.querySelector("#error-".concat(e));if(!a||!r)return!0;var o=a.value.trim(),i="";if("nombre"===e)o.length<3?i="El nombre debe tener al menos 3 caracteres":this.state.isCargoNameUnique(o,n)||(i="Ya existe un cargo con ese nombre");else if("numPersonas"===e){var s=parseInt(o,10);(isNaN(s)||s<1)&&(i="Debe haber al menos 1 persona")}else"area"===e?o.length<2&&(i="El √°rea debe tener al menos 2 caracteres"):"zona"===e&&o.length<2&&(i="La zona debe tener al menos 2 caracteres");return i?(r.textContent=i,r.style.display="block",a.classList.add("input-error"),!1):(r.textContent="",r.style.display="none",a.classList.remove("input-error"),!0)}},{key:"validateForm",value:function(e){var n=this.validateField("nombre",e),t=this.validateField("numPersonas",e),a=this.validateField("area",e),r=this.validateField("zona",e);return n&&t&&a&&r}},{key:"handleSave",value:(e=o(s().mark((function e(n,t){var a,r,o,i,c,l,d,u,g,p,f,v,h,m,b=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.validateForm(n)){e.next=3;break}return console.log("[CargoEditor] Validation failed"),e.abrupt("return");case 3:if(a=this.currentPopover.element,(r=a.querySelector('[data-action="save-edit"]')).disabled=!0,r.innerHTML='<i class="fas fa-spinner fa-spin"></i> Guardando...',e.prev=7,o=a.querySelector("#edit-cargo-nombre").value.trim(),i=parseInt(a.querySelector("#edit-cargo-numPersonas").value,10),c=a.querySelector("#edit-cargo-area").value.trim(),l=a.querySelector("#edit-cargo-zona").value.trim(),d=a.querySelector("#edit-cargo-descripcion").value.trim(),u=a.querySelector("#edit-cargo-tareasRutinarias").checked,g=a.querySelector("#edit-cargo-manipulaAlimentos").checked,p=a.querySelector("#edit-cargo-trabajaAlturas").checked,f=a.querySelector("#edit-cargo-trabajaEspaciosConfinados").checked,v=a.querySelector("#edit-cargo-conduceVehiculo").checked,(h=this.state.updateCargo(n,{nombre:o,numPersonas:i,area:c,zona:l,descripcion:d,tareasRutinarias:u,manipulaAlimentos:g,trabajaAlturas:p,trabajaEspaciosConfinados:f,conduceVehiculo:v})).success){e.next=21;break}throw new Error(h.error);case 21:console.log("[CargoEditor] Cargo updated successfully",{nombre:o,numPersonas:i,descripcion:d,tareasRutinarias:u,manipulaAlimentos:g,trabajaAlturas:p,trabajaEspaciosConfinados:f,conduceVehiculo:v}),m=r.innerHTML,r.innerHTML='<i class="fas fa-check"></i> Guardado',r.classList.add("btn--success"),r.disabled=!0,setTimeout((function(){r.innerHTML=m,r.classList.remove("btn--success"),r.disabled=!1,b.closePopover(),setTimeout((function(){t&&t(n)}),50)}),800),e.next=35;break;case 29:e.prev=29,e.t0=e.catch(7),console.error("[CargoEditor] Error saving cargo:",e.t0),ca({message:"Error al guardar: ".concat(e.t0.message),type:"danger",duration:5e3}),r.disabled=!1,r.innerHTML='<i class="fas fa-save"></i> Guardar';case 35:case"end":return e.stop()}}),e,this,[[7,29]])}))),function(n,t){return e.apply(this,arguments)})},{key:"closePopover",value:function(){var e=this;this.currentPopover&&(this.currentPopover.hide(),setTimeout((function(){e.currentPopover&&(e.currentPopover.destroy(),e.currentPopover=null,e.currentCargoIndex=null)}),250))}},{key:"destroy",value:function(){this.closePopover()}}]);var e}(),da=function(){return p((function e(n){u(this,e),this.button=n,this.tooltip=null,this.arrowElement=null,this.isShowing=!1,window.innerWidth>768&&!("ontouchstart"in window)&&this.init()}),[{key:"init",value:function(){var e=this;this.button.addEventListener("mouseenter",(function(){return e.show()})),this.button.addEventListener("mouseleave",(function(){return e.hide()})),this.button.addEventListener("focus",(function(){return e.show()})),this.button.addEventListener("blur",(function(){return e.hide()}))}},{key:"show",value:(n=o(s().mark((function e(){var n,t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.button.dataset.keyboardShortcut)&&!this.isShowing){e.next=3;break}return e.abrupt("return");case 3:return this.isShowing=!0,this.tooltip=document.createElement("div"),this.tooltip.className="floating-tooltip floating-tooltip--keyboard",this.tooltip.setAttribute("role","tooltip"),this.tooltip.innerHTML='\n      <div class="tooltip-content">\n        <i class="fas fa-keyboard"></i>\n        <span>'.concat(n,'</span>\n      </div>\n      <div class="floating-tooltip__arrow"></div>\n    '),document.body.appendChild(this.tooltip),this.arrowElement=this.tooltip.querySelector(".floating-tooltip__arrow"),e.next=12,this.updatePosition();case 12:requestAnimationFrame((function(){t.tooltip&&t.tooltip.classList.add("floating-tooltip--visible")}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updatePosition",value:(e=o(s().mark((function e(){var n,t,a,r,o,i,c,l,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tooltip&&this.button){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,aa(this.button,this.tooltip,{placement:"top",middleware:[Qt(8),ea(),Zt({padding:5}),ta({element:this.arrowElement})]});case 4:n=e.sent,t=n.x,a=n.y,r=n.placement,o=n.middlewareData,Object.assign(this.tooltip.style,{left:"".concat(t,"px"),top:"".concat(a,"px")}),o.arrow&&(i=o.arrow,c=i.x,l=i.y,u={top:"bottom",right:"left",bottom:"top",left:"right"}[r.split("-")[0]],Object.assign(this.arrowElement.style,d({left:null!=c?"".concat(c,"px"):"",top:null!=l?"".concat(l,"px"):"",right:"",bottom:""},u,"-4px")));case 11:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"hide",value:function(){var e=this;this.tooltip&&(this.isShowing=!1,this.tooltip.classList.remove("floating-tooltip--visible"),setTimeout((function(){e.tooltip&&e.tooltip.parentNode&&(e.tooltip.remove(),e.tooltip=null,e.arrowElement=null)}),200))}},{key:"destroy",value:function(){this.hide()}}]);var e,n}();function ua(e){Array.isArray(e)&&(e.forEach((function(e){return e.destroy()})),console.log("üóëÔ∏è  Keyboard tooltips destroyed (".concat(e.length," instances)")))}function ga(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function pa(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ga(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ga(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var fa=function(){return p((function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(u(this,e),this.container=document.querySelector(n),!this.container)throw new Error("Container not found: ".concat(n));this.state=t||b(),this.unsubscribe=null,this.currentStepComponent=null,this.riesgoSelectors={},this.nivelesForm=null,this.controlesManager=null,this.cargoEditor=new la(this.state),this.previousStep=null,this.carouselIndex=0,this.fabCleanup=null,this.keyboardHandler=null,this.keyboardTooltips=null,this.selfManagedSteps=new Set(["info-basica","cargos","riesgos","niveles"]),this.steps=[{id:"info-basica",title:"Informaci√≥n B√°sica",description:"Comencemos con los datos de tu empresa",icon:"fas fa-building",component:this.renderInfoBasica.bind(this)},{id:"cargos",title:"Cargos",description:"Agrega los puestos de trabajo de tu empresa",icon:"fas fa-users",component:this.renderCargos.bind(this)},{id:"riesgos",title:"Riesgos por Cargo",description:"Selecciona los riesgos (GES) para cada cargo",icon:"fas fa-exclamation-triangle",component:this.renderRiesgos.bind(this)},{id:"niveles",title:"Niveles y Controles",description:"Configura niveles de riesgo (ND, NE, NC) y controles existentes",icon:"fas fa-chart-bar",component:this.renderNiveles.bind(this)},{id:"resumen",title:"Resumen y Env√≠o",description:"Revisa y genera tus documentos",icon:"fas fa-check-circle",component:this.renderResumen.bind(this)}],console.log("[WizardCore] Initialized with",this.steps.length,"steps")}),[{key:"init",value:function(){var e=this;console.log("[WizardCore] Starting initialization..."),this.unsubscribe=this.state.subscribe((function(n){var t=n.currentStep;return t!==e.previousStep?(console.log("[WizardCore] Step changed:",e.previousStep,"->",t),e.previousStep=t,void e.render()):e.selfManagedSteps.has(t)?(console.log("[WizardCore] State updated for self-managed step, updating context bar only"),void e.updateContextBar()):(console.log("[WizardCore] State updated for template step, re-rendering"),void e.render())})),this.keyboardHandler=this.handleKeyboardShortcuts.bind(this),document.addEventListener("keydown",this.keyboardHandler),this.previousStep=this.state.getCurrentStep(),this.render(),console.log("[WizardCore] Initialization complete")}},{key:"destroy",value:function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.keyboardTooltips&&(ua(this.keyboardTooltips),this.keyboardTooltips=null),console.log("[WizardCore] Destroyed")}},{key:"handleKeyboardShortcuts",value:function(e){var n=document.activeElement;if(!(n&&("INPUT"===n.tagName||"TEXTAREA"===n.tagName||"SELECT"===n.tagName||n.isContentEditable))&&!document.querySelector(".wizard-modal")){var t=this.state.getCurrentStep();return"Enter"!==e.key||e.shiftKey?"Enter"===e.key&&e.shiftKey?(e.preventDefault(),console.log("[WizardCore] Keyboard shortcut: Shift+Enter ‚Üí Previous"),void this.handleBack()):void 0:(e.preventDefault(),console.log("[WizardCore] Keyboard shortcut: Enter ‚Üí Next"),void this.handleNext(t))}}},{key:"forceRender",value:function(){console.log("[WizardCore] Forcing re-render"),this.render()}},{key:"render",value:function(){var e=this.state.getCurrentStep(),n=this.steps.find((function(n){return n.id===e}));if(!n)return console.error("[WizardCore] Unknown step:",e),void(this.container.innerHTML=this.renderError("Paso desconocido"));console.log("[WizardCore] Rendering step:",e),this.container.innerHTML="";var t=document.createElement("div");t.className="wizard-wrapper";var a=document.createElement("div");a.className="wizard-header";var r=this.renderBrandingHeader();a.appendChild(r);var o=this.renderUnifiedProgressBar(e);a.appendChild(o),t.appendChild(a);var i=this.renderComicBubble();t.appendChild(i);var s=document.createElement("div");s.className="wizard-content",s.innerHTML=n.component(),t.appendChild(s);var c=this.renderNavigation(e);t.appendChild(c),this.container.appendChild(t),this.attachEventListeners(e)}},{key:"calculateRemainingTime",value:function(e){for(var n={"info-basica":3,cargos:5,riesgos:8,niveles:6,controles:4,resumen:2},t=0,a=e+1;a<this.steps.length;a++){t+=n[this.steps[a].id]||3}return t}},{key:"renderBrandingHeader",value:function(){var e=document.createElement("div");return e.className="wizard-branding-header",e.innerHTML='\n      <div class="wizard-branding-content">\n        <div class="wizard-logo">\n          <img src="../assets/images/logo_negro_vectores.svg"\n               alt="Genesys Medicina Laboral"\n               loading="eager">\n        </div>\n        <div class="wizard-title-group">\n          <h1 class="wizard-title">\n            <i class="fas fa-clipboard-list"></i>\n            Asistente de Matriz de Riesgos\n          </h1>\n          <p class="wizard-subtitle">\n            Genera tu matriz profesional en 6 pasos sencillos\n          </p>\n        </div>\n      </div>\n    ',e}},{key:"renderUnifiedProgressBar",value:function(e){var n=this.steps.findIndex((function(n){return n.id===e})),t=(n+1)/this.steps.length*100,a=(this.state.data.formData,(this.state.data.formData.cargos||[]).reduce((function(e,n){var t;return e+((null===(t=n.ges)||void 0===t?void 0:t.length)||0)}),0),document.createElement("div"));return a.className="wizard-progress-unified",a.id="wizard-progress-unified",a.innerHTML='\n      <div class="wizard-progress-unified-content">\n\n        \x3c!-- Left: Spacer (bot√≥n "Volver" removido - ya hay botones "Anterior") --\x3e\n        <div class="progress-left">\n          <div class="progress-spacer"></div>\n        </div>\n\n        \x3c!-- Center: Step Dots + Progress Bar --\x3e\n        <div class="progress-center">\n          <div class="wizard-progress-steps">\n            '.concat(this.steps.map((function(e,t){var a="wizard-progress-step";return t<n&&(a+=" completed"),t===n&&(a+=" active"),'\n                <div class="'.concat(a,'"\n                     data-step="').concat(e.id,'"\n                     role="button"\n                     tabindex="0"\n                     aria-label="').concat(e.title).concat(t<n?" - Completado":t===n?" - Paso actual":"",'"\n                     title="').concat(e.title,'">\n                  <i class="').concat(e.icon,'"></i>\n                  <span class="step-tooltip">').concat(e.title,"</span>\n                </div>\n              ")})).join(""),'\n          </div>\n\n          <div class="wizard-progress-bar-track">\n            <div class="wizard-progress-bar-fill"\n                 style="width: ').concat(t,'%"\n                 role="progressbar"\n                 aria-valuenow="').concat(t,'"\n                 aria-valuemin="0"\n                 aria-valuemax="100"\n                 aria-label="Progreso: ').concat(Math.round(t),'%">\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Right: Placeholder (comic bubble ahora es fixed) --\x3e\n        <div class="progress-right">\n          \x3c!-- Espacio reservado para balance visual --\x3e\n        </div>\n\n      </div>\n    '),a}},{key:"renderComicBubble",value:function(){var e=this.state.data.formData,n=this.state.data.formData.cargos||[],t=n.reduce((function(e,n){var t;return e+((null===(t=n.ges)||void 0===t?void 0:t.length)||0)}),0),a=n.reduce((function(e,n){return e+(parseInt(n.numPersonas)||0)}),0),r=document.getElementById("wizard-comic-bubble");if(r){var o=r.querySelector(".company-name");o&&e.nombreEmpresa&&(o.textContent=e.nombreEmpresa);var i=r.querySelectorAll(".stat-value");return i.length>=3&&(i[0].textContent=n.length,i[1].textContent=a,i[2].textContent=t),r}return(r=document.createElement("div")).className="wizard-comic-bubble",r.id="wizard-comic-bubble",r.innerHTML='\n      <div class="comic-bubble-content">\n        '.concat(e.nombreEmpresa?'\n          <div class="comic-bubble-company">\n            <i class="fas fa-building"></i>\n            <span class="company-name">'.concat(e.nombreEmpresa,"</span>\n          </div>\n        "):"",'\n\n        <div class="comic-bubble-stats">\n          <div class="stat-item">\n            <i class="fas fa-user-tie"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(n.length,'</span>\n              <span class="stat-label">Cargos</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-users"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(a,'</span>\n              <span class="stat-label">Trabajadores</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(t,'</span>\n              <span class="stat-label">Riesgos</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Cola SVG tri√°ngulo simple con punta hacia abajo (sin borde superior) --\x3e\n      <svg class="comic-bubble-tail" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Tri√°ngulo relleno --\x3e\n        <polygon points="0,0 20,0 10,15" fill="#ffffff"/>\n        \x3c!-- Bordes laterales (sin la l√≠nea superior) --\x3e\n        <line x1="0" y1="0" x2="10" y2="15" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round"/>\n        <line x1="20" y1="0" x2="10" y2="15" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round"/>\n      </svg>\n    '),r}},{key:"renderProgressBar",value:function(e){return console.warn("[WizardCore] renderProgressBar is deprecated, use renderUnifiedProgressBar"),this.renderUnifiedProgressBar(e)}},{key:"renderContextBar",value:function(){var e=this.state.data.formData,n=this.state.data.formData.cargos||[],t=n.reduce((function(e,n){var t;return e+((null===(t=n.ges)||void 0===t?void 0:t.length)||0)}),0),a=document.createElement("div");return a.className="wizard-context-bar",a.id="wizard-context-bar",a.innerHTML='\n      <div class="context-bar-content" id="wizard-context-content">\n        '.concat(e.nombreEmpresa?'\n          <div class="context-item context-item--empresa">\n            <i class="fas fa-building"></i>\n            <div class="context-item-info">\n              <span class="context-item-label">Empresa</span>\n              <span class="context-item-value">'.concat(e.nombreEmpresa,"</span>\n            </div>\n          </div>\n        "):"",'\n\n        <div class="context-item context-item--cargos">\n          <i class="fas fa-users"></i>\n          <div class="context-item-info">\n            <span class="context-item-label">Cargos</span>\n            <span class="context-item-value">').concat(n.length,'</span>\n          </div>\n        </div>\n\n        <div class="context-item context-item--riesgos">\n          <i class="fas fa-exclamation-triangle"></i>\n          <div class="context-item-info">\n            <span class="context-item-label">Riesgos</span>\n            <span class="context-item-value">').concat(t,"</span>\n          </div>\n        </div>\n      </div>\n    "),a}},{key:"updateContextBar",value:function(){var e=document.getElementById("wizard-comic-bubble");if(e){var n=this.state.data.formData,t=this.state.data.formData.cargos||[],a=t.reduce((function(e,n){var t;return e+((null===(t=n.ges)||void 0===t?void 0:t.length)||0)}),0),r=t.reduce((function(e,n){return e+(parseInt(n.numPersonas)||0)}),0),o=e.querySelector(".comic-bubble-content");o&&(o.innerHTML="\n        ".concat(n.nombreEmpresa?'\n          <div class="comic-bubble-company">\n            <i class="fas fa-building"></i>\n            <span class="company-name">'.concat(n.nombreEmpresa,"</span>\n          </div>\n        "):"",'\n\n        <div class="comic-bubble-stats">\n          <div class="stat-item">\n            <i class="fas fa-user-tie"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(t.length,'</span>\n              <span class="stat-label">Cargos</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-users"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(r,'</span>\n              <span class="stat-label">Trabajadores</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(a,'</span>\n              <span class="stat-label">Riesgos</span>\n            </div>\n          </div>\n        </div>\n      '),e.classList.add("bounce-update"),setTimeout((function(){e.classList.remove("bounce-update")}),500)),console.log("[WizardCore] Comic bubble updated:",{cargos:t.length,riesgos:a})}else console.warn("[WizardCore] Comic bubble not found in DOM, skipping update")}},{key:"renderNavigation",value:function(e){var n=this,t=this.steps.findIndex((function(n){return n.id===e})),a=0===t,r=t===this.steps.length-1,o=document.createElement("div");return o.className="wizard-navigation",o.innerHTML="\n      ".concat(a?"":'\n        <button class="wizard-btn wizard-btn-back"\n                data-action="back"\n                data-keyboard-shortcut="Shift + Enter">\n          <i class="fas fa-arrow-left"></i>\n          Anterior\n        </button>\n      ','\n\n      <button class="wizard-btn wizard-btn-next"\n              data-action="next"\n              data-keyboard-shortcut="Enter">\n        ').concat(r?"Generar Documentos":"Siguiente","\n        ").concat(r?'<i class="fas fa-paper-plane"></i>':'<i class="fas fa-arrow-right"></i>',"\n      </button>\n    "),setTimeout((function(){var e,t;n.keyboardTooltips&&ua(n.keyboardTooltips),n.keyboardTooltips=(e=document.querySelectorAll("[data-keyboard-shortcut]"),t=[],e.forEach((function(e){var n=new da(e);t.push(n)})),console.log("‚úÖ Keyboard tooltips initialized for ".concat(e.length," buttons")),t)}),0),o}},{key:"renderError",value:function(e){return'\n      <div class="wizard-error">\n        <div class="error-content">\n          <strong>Error</strong>\n          <p>'.concat(e,"</p>\n        </div>\n      </div>\n    ")}},{key:"renderInfoBasica",value:function(){var e=this.state.data.formData,n=this.state.data.catalogos;return'\n      <div class="wizard-step" data-step="info-basica">\n        <div class="wizard-step-header">\n          <h2>\n            <i class="fas fa-building wizard-icon wizard-icon--primary"></i>\n            Informaci√≥n B√°sica de tu Empresa\n          </h2>\n          <p>Comencemos con los datos esenciales de tu organizaci√≥n</p>\n        </div>\n\n        <div class="wizard-form">\n          \x3c!-- Grid de 2 columnas en desktop, 1 en mobile --\x3e\n          <div class="wizard-form-grid">\n            \x3c!-- Nombre (ancho completo) --\x3e\n            <div class="form-group form-group--full-width">\n              <label for="nombreEmpresa" class="form-label-with-help">\n                <span class="form-label-text">Nombre de la Empresa *</span>\n                <button type="button" class="wizard-help-button"\n                  data-tooltip="Nombre legal completo de la empresa"\n                  data-tooltip-placement="right"\n                  aria-label="Ayuda">\n                  <i class="fas fa-question-circle"></i>\n                </button>\n              </label>\n              <input\n                type="text"\n                id="nombreEmpresa"\n                name="nombreEmpresa"\n                value="'.concat(e.nombreEmpresa||"",'"\n                placeholder="Ej: Constructora XYZ S.A.S."\n                required\n              />\n            </div>\n\n            \x3c!-- NIT --\x3e\n            <div class="form-group">\n              <label for="nit">NIT *</label>\n              <input\n                type="text"\n                id="nit"\n                name="nit"\n                value="').concat(e.nit||"",'"\n                placeholder="Ej: 900123456"\n                pattern="[0-9]{9,10}"\n                aria-describedby="hint-nit"\n                required\n              />\n              <div class="wizard-hint" id="hint-nit">\n                <i class="fas fa-info-circle"></i>\n                Solo n√∫meros, entre 9 y 10 d√≠gitos\n              </div>\n            </div>\n\n            \x3c!-- Email --\x3e\n            <div class="form-group">\n              <label for="email">Email de Contacto *</label>\n              <input\n                type="email"\n                id="email"\n                name="email"\n                value="').concat(e.email||"",'"\n                placeholder="contacto@empresa.com"\n                required\n              />\n            </div>\n\n            \x3c!-- Sector Econ√≥mico --\x3e\n            <div class="form-group">\n              <label for="sector">Sector Econ√≥mico *</label>\n              <select\n                id="sector"\n                name="sector"\n                class="wizard-enhanced-select"\n                aria-describedby="hint-sector"\n                required>\n                <option value="">Selecciona un sector</option>\n                ').concat((n.sectores||[]).map((function(n){return'\n                  <option value="'.concat(n.codigo||n.id,'" ').concat(e.sector===(n.codigo||n.id)?"selected":"",">\n                    ").concat(n.nombre,"\n                  </option>\n                ")})).join(""),"\n              </select>\n              ").concat(n.sectores&&0!==n.sectores.length?'\n                <div class="wizard-hint" id="hint-sector">\n                  <i class="fas fa-info-circle"></i>\n                  Actividad econ√≥mica principal de tu empresa\n                </div>\n              ':'\n                <div class="wizard-hint warning" id="hint-sector">\n                  <i class="fas fa-exclamation-triangle"></i>\n                  Cargando sectores...\n                </div>\n              ','\n            </div>\n\n            \x3c!-- Ciudad --\x3e\n            <div class="form-group">\n              <label for="ciudad">Ciudad *</label>\n              <input\n                type="text"\n                id="ciudad"\n                name="ciudad"\n                value="').concat(e.ciudad||"",'"\n                placeholder="Ej: Bogot√°"\n                required\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    ')}},{key:"renderCargoCharacteristics",value:function(e){var n=[];return e.tareasRutinarias&&n.push({icon:"fas fa-repeat",label:"Tareas repetitivas",type:"warning"}),e.conduceVehiculo&&n.push({icon:"fas fa-car",label:"Conduce veh√≠culo",type:"warning"}),e.manipulaAlimentos&&n.push({icon:"fas fa-utensils",label:"Manipula alimentos",type:"danger"}),e.trabajaAlturas&&n.push({icon:"fas fa-arrow-up",label:"Trabajo en alturas",type:"danger"}),e.trabajaEspaciosConfinados&&n.push({icon:"fas fa-door-closed",label:"Espacios confinados",type:"danger"}),0===n.length?"":'\n      <div class="cargo-characteristics">\n        '.concat(n.map((function(e){return'\n          <span class="cargo-badge cargo-badge--'.concat(e.type,'">\n            <i class="').concat(e.icon,'"></i>\n            ').concat(e.label,"\n          </span>\n        ")})).join(""),"\n      </div>\n    ")}},{key:"renderCargos",value:function(){var e=this,n=this.state.getCargos(),t=this.carouselIndex||0;return'\n      <div class="wizard-step" data-step="cargos">\n        <h2>Cargos de tu Empresa</h2>\n        <p>Agrega los puestos de trabajo que deseas evaluar</p>\n\n        '.concat(0===n.length?'\n          <div class="wizard-form">\n            <div class="wizard-hint" style="margin-bottom: 3rem;">\n              <i class="fas fa-info-circle"></i>\n              A√∫n no has agregado ning√∫n cargo\n            </div>\n            <button class="wizard-btn wizard-btn-primary wizard-btn-add-first" data-action="add-cargo" style="display: block; margin: 0 auto; padding: 2rem 4rem; font-size: 1.8rem;">\n              <i class="fas fa-plus" style="margin-right: 1rem;"></i>\n              Agrega ac√° tu primer cargo\n            </button>\n          </div>\n        ':'\n          \x3c!-- Navigation arrows - OUTSIDE wizard-form --\x3e\n          <button class="carousel-nav carousel-nav--prev" data-action="carousel-prev" '.concat(0===t?"disabled":"",'>\n            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n              <path d="M15 18l-6-6 6-6"/>\n            </svg>\n          </button>\n\n          <button class="carousel-nav carousel-nav--next" data-action="carousel-next" ').concat(t>=n.length-1?"disabled":"",'>\n            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n              <path d="M9 6l6 6-6 6"/>\n            </svg>\n          </button>\n\n          <div class="wizard-form">\n            <div class="cargos-list">\n              \x3c!-- Carousel track --\x3e\n              <div class="cargos-carousel" style="transform: translateX(calc(-').concat(100*t,"% - ").concat(2*t,'rem))">\n                ').concat(n.map((function(n,t){var a;return'\n                  <div class="cargo-card" data-cargo-index="'.concat(t,'">\n                    ').concat(n.area?'<div class="cargo-area">'.concat(n.area,"</div>"):"",'\n                    <div class="cargo-card-header">\n                      <h3>').concat(n.nombre,'</h3>\n                      <div class="cargo-actions">\n                        <button class="btn-icon" data-action="edit-cargo" data-index="').concat(t,'" title="Editar cargo">\n                          <i class="fas fa-edit"></i>\n                        </button>\n                        <button class="btn-icon btn-icon--danger" data-action="remove-cargo" data-index="').concat(t,'" title="Eliminar cargo">\n                          <i class="fas fa-trash"></i>\n                        </button>\n                      </div>\n                    </div>\n                    <div class="cargo-card-body">\n                      \x3c!-- Scrollable description with max height --\x3e\n                      <div class="cargo-description-scroll">\n                        <p>').concat(n.descripcion||"Sin descripci√≥n","</p>\n                      </div>\n\n                      \x3c!-- Special characteristics badges --\x3e\n                      ").concat(e.renderCargoCharacteristics(n),'\n\n                      <div class="cargo-meta">\n                        <span><i class="fas fa-user"></i> ').concat(n.numPersonas,' persona(s)</span>\n                        <span><i class="fas fa-exclamation-triangle"></i> ').concat((null===(a=n.gesSeleccionados)||void 0===a?void 0:a.length)||0," riesgo(s)</span>\n                        ").concat(n.zona?'<span><i class="fas fa-map-marker-alt"></i> '.concat(n.zona,"</span>"):"","\n                      </div>\n                    </div>\n                  </div>\n                ")})).join(""),'\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Carousel dots indicator - OUTSIDE wizard-form --\x3e\n          <div class="carousel-dots">\n            ').concat(n.map((function(e,n){return'\n              <button\n                class="carousel-dot '.concat(n===t?"active":"",'"\n                data-action="carousel-goto"\n                data-index="').concat(n,'"\n                aria-label="Ir a cargo ').concat(n+1,'"\n              ></button>\n            ')})).join(""),"\n          </div>\n        "),'\n\n        \x3c!-- FAB (Floating Action Button) - Visible solo cuando hay cargos --\x3e\n        <button\n          class="fab ').concat(0===n.length?"fab--hidden":"",'"\n          data-action="add-cargo"\n          aria-label="Agregar un nuevo cargo"\n        >\n          <span class="fab-text">Agregar un nuevo cargo</span>\n          <svg class="fab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            \x3c!-- Worker icon --\x3e\n            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="white"/>\n            \x3c!-- Plus icon (small, top-right) --\x3e\n            <circle cx="18" cy="6" r="5" fill="white"/>\n            <path d="M18 4v4m-2-2h4" stroke="#5dc4af" stroke-width="1.5" stroke-linecap="round"/>\n          </svg>\n        </button>\n        \x3c!-- Tooltip nativo usando title attribute (eliminado fab-tooltip custom) --\x3e\n\n        \x3c!-- Modal para agregar cargo (hidden by default) --\x3e\n          <div id="modal-add-cargo" class="wizard-modal" style="display: none;">\n            <div class="wizard-modal-content wizard-modal-content--two-cols">\n              <div class="wizard-modal-header">\n                <h3 id="modal-title-cargo">Agregar Nuevo Cargo</h3>\n                <div class="wizard-modal-header-actions">\n                  <button class="wizard-btn wizard-btn-primary wizard-btn-compact" data-action="save-cargo">\n                    <i class="fas fa-save"></i>\n                    Guardar\n                  </button>\n                  <button class="btn-close" data-action="close-modal">\n                    <i class="fas fa-times"></i>\n                  </button>\n                </div>\n              </div>\n              <div class="wizard-modal-body wizard-modal-body--two-cols">\n                \x3c!-- Columna Izquierda: Informaci√≥n B√°sica --\x3e\n                <div class="wizard-modal-col wizard-modal-col--basic">\n                  <div class="form-group">\n                    <label for="cargo-nombre">Nombre del Cargo *</label>\n                    <input\n                      type="text"\n                      id="cargo-nombre"\n                      placeholder="Ej: Operario de Construcci√≥n"\n                      required\n                    />\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-descripcion">Descripci√≥n (opcional)</label>\n                    <textarea\n                      id="cargo-descripcion"\n                      rows="4"\n                      placeholder="Breve descripci√≥n de las funciones del cargo"\n                    ></textarea>\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-num-personas">N√∫mero de Personas *</label>\n                    <input\n                      type="number"\n                      id="cargo-num-personas"\n                      min="1"\n                      value="1"\n                      required\n                    />\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-area">√Årea o Departamento del Cargo *</label>\n                    <input\n                      type="text"\n                      id="cargo-area"\n                      list="areas-list"\n                      placeholder="Ej: Producci√≥n, Administraci√≥n, etc."\n                      required\n                    />\n                    <datalist id="areas-list">\n                      <option value="Producci√≥n">\n                      <option value="Administraci√≥n">\n                      <option value="Log√≠stica">\n                      <option value="Ventas">\n                      <option value="Mantenimiento">\n                      <option value="Calidad">\n                      <option value="Operaciones">\n                      <option value="Recursos Humanos">\n                      <option value="Contabilidad">\n                      <option value="Sistemas">\n                      <option value="Finanzas">\n                      <option value="Compras">\n                      <option value="Almac√©n">\n                    </datalist>\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-zona">Zona/Lugar de Trabajo *</label>\n                    <input\n                      type="text"\n                      id="cargo-zona"\n                      placeholder="Ej: Planta 1, Oficina Principal, Bodega A"\n                      required\n                    />\n                  </div>\n                </div>\n\n                \x3c!-- Columna Derecha: Caracter√≠sticas Especiales --\x3e\n                <div class="wizard-modal-col wizard-modal-col--toggles">\n                  <div class="form-group">\n                  <label class="form-label-section">\n                    <i class="fas fa-shield-alt"></i>\n                    Caracter√≠sticas Especiales\n                  </label>\n                  <div class="toggles-grid-modern">\n                    \x3c!-- Warning toggles (amarillo) --\x3e\n                    <div class="toggle-group toggle-group--warning">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-repeat toggle-icon toggle-icon--warning"></i>\n                          <span class="toggle-label">Tareas repetitivas</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--warning">\n                          <input type="checkbox" id="cargo-tareasRutinarias" name="tareasRutinarias" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Puede requerir pausas activas y rotaci√≥n de tareas\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--warning">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-car toggle-icon toggle-icon--warning"></i>\n                          <span class="toggle-label">Conduce veh√≠culo</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--warning">\n                          <input type="checkbox" id="cargo-conduceVehiculo" name="conduceVehiculo" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere licencia de conducci√≥n vigente\n                      </div>\n                    </div>\n\n                    \x3c!-- Danger toggles (rojo) --\x3e\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-utensils toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Manipula alimentos</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-manipulaAlimentos" name="manipulaAlimentos" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere certificado de manipulaci√≥n de alimentos vigente\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-arrow-up toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Trabaja en alturas</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-trabajaAlturas" name="trabajaAlturas" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere certificado de trabajo en alturas y EPP especializado\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-door-closed toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Espacios confinados</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-trabajaEspaciosConfinados" name="trabajaEspaciosConfinados" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere permiso de trabajo y monitor de gases continuo\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n      </div>\n    ')}},{key:"renderRiesgos",value:function(){var e=this.state.getCargos();return 0===e.length?'\n        <div class="wizard-step" data-step="riesgos">\n          <div class="wizard-hint" style="margin-top: 5rem;">\n            <i class="fas fa-exclamation-triangle"></i>\n            Debes agregar al menos un cargo antes de seleccionar riesgos.\n          </div>\n        </div>\n      ':1===e.length?'\n        <div class="wizard-step" data-step="riesgos">\n          <div id="riesgo-selector-0" class="riesgo-selector-container"></div>\n        </div>\n      ':'\n      <div class="wizard-step" data-step="riesgos">\n        <h2>Riesgos por Cargo</h2>\n        <p>Selecciona los riesgos para cada uno de tus cargos usando las pesta√±as</p>\n\n        \x3c!-- P0-3: ARIA attributes para accesibilidad + P1-2: Wrapper para scroll indicators --\x3e\n        <div class="cargo-tabs-wrapper">\n          <div class="cargo-tabs" role="tablist" aria-label="Lista de cargos">\n            '.concat(e.map((function(e,n){var t,a=(null===(t=e.ges)||void 0===t?void 0:t.length)||0,r=a>0;return'\n                <button\n                  class="cargo-tab '.concat(0===n?"active":"",'"\n                  role="tab"\n                  id="cargo-tab-').concat(n,'"\n                  aria-selected="').concat(0===n,'"\n                  aria-controls="cargo-panel-').concat(n,'"\n                  tabindex="').concat(0===n?0:-1,'"\n                  data-action="switch-cargo-tab"\n                  data-cargo-index="').concat(n,'"\n                  data-has-risks="').concat(r,'"\n                  data-cargo-name="').concat(e.nombre,'"\n                >\n                  <span class="cargo-name">').concat(e.nombre,'</span>\n                  <span class="cargo-count" aria-label="').concat(a," ").concat(1===a?"riesgo seleccionado":"riesgos seleccionados",'">\n                    ').concat(a,"\n                  </span>\n                </button>\n              ")})).join(""),'\n          </div>\n        </div>\n\n        \x3c!-- P0-3: Selector containers con role="tabpanel" --\x3e\n        ').concat(e.map((function(e,n){return'\n          <div\n            id="riesgo-selector-'.concat(n,'"\n            class="riesgo-selector-container"\n            role="tabpanel"\n            aria-labelledby="cargo-tab-').concat(n,'"\n            tabindex="0"\n            style="').concat(0===n?"":"display: none;",'"\n          ></div>\n        ')})).join(""),"\n      </div>\n    ")}},{key:"renderNiveles",value:function(){var e=this.state.getCargos(),n='\n      <div class="wizard-step" data-step="niveles">\n        <h2>Niveles de Riesgo</h2>\n        <p>Configura los niveles de deficiencia, exposici√≥n y consecuencia para cada riesgo</p>\n    ';return e.length>1&&(n+='\n        <div class="niveles-cargo-tabs">\n          '.concat(e.map((function(e,n){var t;return'\n            <button\n              class="niveles-cargo-tab '.concat(0===n?"active":"",'"\n              data-action="switch-cargo-niveles"\n              data-cargo-index="').concat(n,'"\n            >\n              <span class="cargo-tab__name">').concat(e.nombre,'</span>\n              <span class="cargo-tab__count">').concat((null===(t=e.gesSeleccionados)||void 0===t?void 0:t.length)||0," GES</span>\n            </button>\n          ")})).join(""),"\n        </div>\n      ")),e.forEach((function(e,t){n+='\n        <div\n          id="niveles-container-'.concat(t,'"\n          class="niveles-cargo-container"\n          style="').concat(0===t?"":"display: none;",'"\n        ></div>\n      ')})),n+="</div>"}},{key:"renderControles",value:function(){var e=this;console.log("[WizardCore] Rendering controles step with ControlesManager");return setTimeout((function(){e.initControlesManager()}),0),'\n      <div class="wizard-step" data-step="controles">\n        <div id="controles-container"></div>\n      </div>\n    '}},{key:"initControlesManager",value:function(){var e=this,n=document.getElementById("controles-container");n?(this.controlesManager&&this.controlesManager.destroy(),this.controlesManager=new In("#controles-container",this.state),this.controlesManager.render(),n.addEventListener("controles:completed",(function(n){console.log("[WizardCore] Controles completed",n.detail),e.avanzarPaso()})),console.log("[WizardCore] ControlesManager initialized")):console.error("[WizardCore] controles-container not found")}},{key:"avanzarPaso",value:function(){var e=this.state.getCurrentStep(),n=this.steps.findIndex((function(n){return n.id===e}));if(n<this.steps.length-1){var t=this.steps[n+1];console.log("[WizardCore] Avanzando de ".concat(e," a ").concat(t.id)),this.state.setCurrentStep(t.id)}else console.warn("[WizardCore] Ya est√°s en el √∫ltimo paso")}},{key:"renderResumen",value:function(){var e=this.state.data.formData,n=this.state.getCargos(),t=this.state.getAnalytics(),a=n.reduce((function(e,n){var t;return e+((null===(t=n.gesSeleccionados)||void 0===t?void 0:t.length)||0)}),0),r=n.reduce((function(e,n){return e+(parseInt(n.numPersonas)||0)}),0),o=0,i=0;return n.forEach((function(e){e.gesSeleccionados.forEach((function(e){e.niveles&&null!==e.niveles.NR&&o++,e.controles&&Object.values(e.controles).some((function(e){return e&&e.trim()}))&&i++}))})),'\n      <div class="wizard-step" data-step="resumen">\n        <div class="resumen-header">\n          <h2><i class="fas fa-check-circle"></i> Resumen Final</h2>\n          <p>Revisa la informaci√≥n antes de generar tus documentos</p>\n        </div>\n\n        <div class="resumen-container">\n          \x3c!-- Informaci√≥n B√°sica --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-building"></i> Informaci√≥n de la Empresa</h3>\n            <div class="resumen-details">\n              <div class="detail-item">\n                <span class="detail-label">Empresa:</span>\n                <span class="detail-value">'.concat(e.nombreEmpresa||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">NIT:</span>\n                <span class="detail-value">').concat(e.nit||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">Email:</span>\n                <span class="detail-value">').concat(e.email||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">Sector Econ√≥mico:</span>\n                <span class="detail-value">').concat(e.sector||"Sin especificar",'</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Cargos Summary --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-users"></i> Cargos Definidos (').concat(n.length,')</h3>\n            <div class="cargos-list">\n              ').concat(n.map((function(e,n){var t;return'\n                <div class="cargo-item">\n                  <div class="cargo-header">\n                    <span class="cargo-number">'.concat(n+1,"</span>\n                    <strong>").concat(e.nombre,'</strong>\n                  </div>\n                  <div class="cargo-stats">\n                    <span><i class="fas fa-user"></i> ').concat(e.numPersonas,' persona(s)</span>\n                    <span><i class="fas fa-exclamation-triangle"></i> ').concat((null===(t=e.gesSeleccionados)||void 0===t?void 0:t.length)||0," riesgo(s)</span>\n                  </div>\n                </div>\n              ")})).join(""),'\n            </div>\n          </div>\n\n          \x3c!-- Estad√≠sticas Globales --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-chart-bar"></i> Estad√≠sticas del An√°lisis</h3>\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-users"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(n.length,'</div>\n                  <div class="stat-label">Cargos</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-user-friends"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(r,'</div>\n                  <div class="stat-label">Personas</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(a,'</div>\n                  <div class="stat-label">Riesgos (GES)</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-calculator"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(o,'</div>\n                  <div class="stat-label">Niveles Configurados</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-shield-alt"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(i,'</div>\n                  <div class="stat-label">Controles Definidos</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-clock"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(Math.floor(t.totalTime/1e3/60),'</div>\n                  <div class="stat-label">Minutos</div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Documentos que se generar√°n --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-file-alt"></i> Documentos que se Generar√°n</h3>\n            <div class="documentos-list">\n              <div class="documento-item">\n                <i class="fas fa-file-excel documento-icon excel"></i>\n                <div class="documento-info">\n                  <strong>Matriz de Riesgos Profesionales</strong>\n                  <span>Archivo Excel con an√°lisis completo de todos los riesgos</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Profesiograma</strong>\n                  <span>PDF con perfil profesional y requisitos de cada cargo</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Perfil de Cargo</strong>\n                  <span>PDF detallado de competencias y responsabilidades</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Cotizaci√≥n de Ex√°menes</strong>\n                  <span>PDF con precios y detalles de ex√°menes m√©dicos ocupacionales</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Info Box --\x3e\n          <div class="wizard-hint info">\n            <i class="fas fa-info-circle"></i>\n            <div>\n              <strong>¬øQu√© sucede al generar documentos?</strong>\n              <p>Los documentos se generar√°n de forma as√≠ncrona en nuestros servidores. Recibir√°s los links de descarga cuando est√©n listos (usualmente en 1-2 minutos).</p>\n            </div>\n          </div>\n\n          \x3c!-- Submit Section --\x3e\n          <div id="submit-section" class="submit-section">\n            <button id="btn-generar-documentos" class="btn-wizard btn-wizard--primary btn-large">\n              <i class="fas fa-rocket"></i>\n              Generar Documentos\n            </button>\n            <button class="btn-wizard btn-wizard--secondary" data-action="back">\n              <i class="fas fa-arrow-left"></i>\n              Volver a Controles\n            </button>\n          </div>\n\n          \x3c!-- Progress/Results Section (hidden initially) --\x3e\n          <div id="generation-status" class="generation-status" style="display: none;">\n            \x3c!-- Will be populated dynamically --\x3e\n          </div>\n        </div>\n      </div>\n    ')}},{key:"attachResumenListeners",value:function(){var e=this,n=this.container.querySelector("#btn-generar-documentos");n&&n.addEventListener("click",(function(){e.handleGenerarDocumentos()}))}},{key:"handleGenerarDocumentos",value:(c=o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[WizardCore] üöÄ handleGenerarDocumentos iniciado"),this.showRegistrationModal();case 2:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"showRegistrationModal",value:function(){var e=this,n=this.state.exportForSubmission().userData,t='\n      <div id="registration-modal" class="wizard-modal" style="display: block;">\n        <div class="wizard-modal-content" style="max-width: 500px;">\n          <div class="wizard-modal-header">\n            <h3 style="margin: 0; color: #383d47;">\n              <i class="fas fa-user-check" style="color: #5dc4af; margin-right: 8px;"></i>\n              Completa tu Registro\n            </h3>\n            <button type="button" class="btn-close" id="close-registration-modal" aria-label="Cerrar">\n              <i class="fas fa-times"></i>\n            </button>\n          </div>\n\n          <div class="wizard-modal-body">\n            <p style="margin-bottom: 24px; color: #666; font-size: 14px;">\n              Para generar tus documentos, necesitamos algunos datos adicionales:\n            </p>\n\n            <form id="registration-form">\n              \x3c!-- Pre-filled company data (readonly) --\x3e\n              <div style="margin-bottom: 20px;">\n                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Nombre de la Empresa\n                </label>\n                <input\n                  type="text"\n                  value="'.concat(n.nombreEmpresa||"",'"\n                  readonly\n                  style="background: #f5f5f5; cursor: not-allowed;"\n                />\n              </div>\n\n              <div style="margin-bottom: 20px;">\n                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  NIT\n                </label>\n                <input\n                  type="text"\n                  value="').concat(n.nit||"",'"\n                  readonly\n                  style="background: #f5f5f5; cursor: not-allowed;"\n                />\n              </div>\n\n              \x3c!-- User data fields (required) --\x3e\n              <div style="margin-bottom: 20px;">\n                <label for="modal-email" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Correo Electr√≥nico *\n                </label>\n                <input\n                  type="email"\n                  id="modal-email"\n                  name="email"\n                  placeholder="contacto@empresa.com"\n                  required\n                  autocomplete="email"\n                />\n              </div>\n\n              <div style="margin-bottom: 20px;">\n                <label for="modal-password" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Contrase√±a *\n                </label>\n                <input\n                  type="password"\n                  id="modal-password"\n                  name="password"\n                  placeholder="M√≠nimo 6 caracteres"\n                  required\n                  minlength="6"\n                  autocomplete="new-password"\n                />\n                <small style="display: block; margin-top: 4px; color: #666; font-size: 12px;">\n                  Usar√°s este correo y contrase√±a para acceder a tus documentos\n                </small>\n              </div>\n\n              <div style="margin-bottom: 24px;">\n                <label for="modal-nombre" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Nombre del Contacto\n                </label>\n                <input\n                  type="text"\n                  id="modal-nombre"\n                  name="nombre"\n                  placeholder="Ej: Juan P√©rez"\n                  autocomplete="name"\n                />\n              </div>\n\n              <div id="modal-error" style="display: none; padding: 12px; background: #fee; border: 1px solid #fcc; border-radius: 8px; margin-bottom: 16px; color: #c33; font-size: 14px;">\n              </div>\n\n              <button type="submit" class="wizard-btn-primary wizard-btn-full submit-modal-btn">\n                <i class="fas fa-paper-plane"></i>\n                Registrar y Generar Documentos\n              </button>\n            </form>\n          </div>\n        </div>\n      </div>\n    '),a=document.createElement("div");a.innerHTML=t,document.body.appendChild(a);var r=document.getElementById("registration-modal"),i=document.getElementById("close-registration-modal"),c=document.getElementById("registration-form");i.addEventListener("click",(function(){document.body.removeChild(a)})),r.addEventListener("click",(function(e){e.target===r&&document.body.removeChild(a)})),c.addEventListener("submit",function(){var t=o(s().mark((function t(r){var o,i,l,d,u,g,p,f,v,h,m;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.preventDefault(),console.log("[WizardCore] üìã Formulario de registro enviado"),(d=document.getElementById("modal-error"))&&(d.style.display="none"),u={nombreEmpresa:n.nombreEmpresa,nit:n.nit,email:(null===(o=document.getElementById("modal-email"))||void 0===o?void 0:o.value.trim())||"",password:(null===(i=document.getElementById("modal-password"))||void 0===i?void 0:i.value)||"",nombre:(null===(l=document.getElementById("modal-nombre"))||void 0===l?void 0:l.value.trim())||null},console.log("[WizardCore] üë§ Datos del usuario:",u),u.email&&u.password&&u.nombreEmpresa&&u.nit){t.next=9;break}return d&&(d.textContent="Por favor completa todos los campos requeridos (*)",d.style.display="block"),t.abrupt("return");case 9:return g=c.querySelector(".submit-modal-btn"),p=(null==g?void 0:g.textContent)||"Registrar",g&&(g.disabled=!0,g.innerHTML='<i class="fas fa-spinner fa-spin"></i> Registrando...'),t.prev=12,console.log("[WizardCore] üì§ Enviando al backend..."),f=e.state.exportForSubmission(),v={formData:f.formData,userData:u},console.log("[WizardCore] üì¶ Payload completo:",v),t.next=19,fetch("/api/flujo-ia/registrar-y-generar",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(v)});case 19:return h=t.sent,t.next=22,h.json();case 22:if(m=t.sent,console.log("[WizardCore] üì• Respuesta:",m),h.ok&&m.success){t.next=26;break}throw new Error(m.message||"Error ".concat(h.status));case 26:if(console.log("[WizardCore] ‚úÖ Registro exitoso"),document.body.removeChild(a),localStorage.removeItem("wizardState"),!m.documentToken){t.next=34;break}console.log("[WizardCore] Redirigiendo a resultados.html?token="+m.documentToken),window.location.href="../pages/resultados.html?token=".concat(m.documentToken),t.next=35;break;case 34:throw new Error("El backend no devolvi√≥ un documentToken");case 35:t.next=42;break;case 37:t.prev=37,t.t0=t.catch(12),console.error("[WizardCore] ‚ùå Error:",t.t0),d&&(d.textContent="Error: ".concat(t.t0.message),d.style.display="block"),g&&(g.disabled=!1,g.innerHTML=p);case 42:case"end":return t.stop()}}),t,null,[[12,37]])})));return function(e){return t.apply(this,arguments)}}())}},{key:"startPollingStatus",value:function(e,n){var t=this;this.pollingToken=e,this.pollingInterval=setInterval(o(s().mark((function n(){var a,r;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("/api/solicitud/".concat(e,"/estado"));case 3:return a=n.sent,n.next=6,a.json();case 6:if(r=n.sent,a.ok){n.next=9;break}throw new Error(r.message||"Error al obtener estado");case 9:console.log("[WizardCore] Status update:",r),t.updateStatusUI(r),"completado"!==r.estado&&"error"!==r.estado||t.stopPolling(),n.next=19;break;case 14:n.prev=14,n.t0=n.catch(0),console.error("[WizardCore] Error polling status:",n.t0),t.stopPolling(),t.updateStatusUI({estado:"error",mensaje:"Error al verificar estado. Recarga la p√°gina para continuar."});case 19:case"end":return n.stop()}}),n,null,[[0,14]])}))),3e3)}},{key:"stopPolling",value:function(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}},{key:"updateStatusUI",value:function(e){var n=this,t=this.container.querySelector("#generation-status");if(t){var a=e.estado,r=e.progreso,o=e.mensaje,i=e.previewUrls,s='\n      <div class="status-container">\n    ';"procesando"===a?s+='\n        <div class="status-header processing">\n          <i class="fas fa-spinner fa-spin"></i>\n          <h3>Generando Documentos...</h3>\n        </div>\n        <div class="progress-bar">\n          <div class="progress-fill" style="width: '.concat(r||0,'%"></div>\n        </div>\n        <p class="status-message">').concat(o||"Procesando tu solicitud...",'</p>\n        <p class="status-hint">Esto puede tomar 1-2 minutos. No cierres esta p√°gina.</p>\n      '):"completado"===a?s+='\n        <div class="status-header success">\n          <i class="fas fa-check-circle"></i>\n          <h3>¬°Documentos Generados Exitosamente!</h3>\n        </div>\n        <p class="status-message">Tus documentos est√°n listos para descargar:</p>\n        <div class="documentos-download">\n          '.concat(null!=i&&i.matriz?'\n            <a href="'.concat(i.matriz,'" target="_blank" class="download-card excel">\n              <i class="fas fa-file-excel"></i>\n              <span>Matriz de Riesgos (Excel)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=i&&i.profesiograma?'\n            <a href="'.concat(i.profesiograma,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Profesiograma (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=i&&i.perfil?'\n            <a href="'.concat(i.perfil,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Perfil de Cargo (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=i&&i.cotizacion?'\n            <a href="'.concat(i.cotizacion,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Cotizaci√≥n (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"",'\n        </div>\n        <div class="wizard-hint success">\n          <i class="fas fa-check"></i>\n          Los documentos tambi√©n fueron enviados a tu email: ').concat(this.state.data.formData.email,'\n        </div>\n        <button id="btn-nueva-solicitud" class="btn-wizard btn-wizard--primary">\n          <i class="fas fa-plus"></i>\n          Nueva Solicitud\n        </button>\n      '):"error"===a&&(s+='\n        <div class="status-header error">\n          <i class="fas fa-times-circle"></i>\n          <h3>Error al Generar Documentos</h3>\n        </div>\n        <p class="status-message error">'.concat(o||"Ocurri√≥ un error inesperado.",'</p>\n        <div class="wizard-hint error">\n          <i class="fas fa-exclamation-triangle"></i>\n          Por favor contacta a soporte t√©cnico o intenta de nuevo.\n        </div>\n        <button id="btn-reintentar" class="btn-wizard btn-wizard--primary">\n          <i class="fas fa-redo"></i>\n          Reintentar\n        </button>\n      ')),s+="</div>",t.innerHTML=s;var c=t.querySelector("#btn-nueva-solicitud");c&&c.addEventListener("click",(function(){n.state.clearStorage(),window.location.reload()}));var l=t.querySelector("#btn-reintentar");l&&l.addEventListener("click",(function(){t.style.display="none",n.container.querySelector("#submit-section").style.display="block"}))}}},{key:"attachEventListeners",value:function(e){var n=this,t=this.container.querySelector('[data-action="back"]'),a=this.container.querySelector('[data-action="next"]');switch(t&&t.addEventListener("click",(function(){return n.handleBack()})),a&&a.addEventListener("click",(function(){return n.handleNext(e)})),e){case"info-basica":this.attachInfoBasicaListeners();break;case"cargos":this.attachCargosListeners();break;case"riesgos":this.attachRiesgosListeners();break;case"niveles":this.attachNivelesListeners();break;case"controles":break;case"resumen":this.attachResumenListeners()}}},{key:"showFieldError",value:function(e,n){if(e){e.classList.add("input-error"),e.setAttribute("aria-invalid","true"),this.clearFieldError(e);var t=document.createElement("div");t.className="field-error",t.setAttribute("role","alert"),t.setAttribute("aria-live","polite"),t.innerHTML='\n      <i class="fas fa-exclamation-circle"></i>\n      <span>'.concat(n,"</span>\n    "),e.parentElement.appendChild(t);var a="error-".concat(e.id||e.name);t.id=a,e.setAttribute("aria-describedby",a)}}},{key:"clearFieldError",value:function(e){if(e){e.classList.remove("input-error"),e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby");var n=e.parentElement.querySelector(".field-error");n&&n.remove()}}},{key:"attachInfoBasicaListeners",value:function(){var e=this;this.container.querySelectorAll("#nombreEmpresa, #nit, #email, #sector, #telefono, #direccion, #ciudad").forEach((function(n){n.addEventListener("input",(function(n){e.state.updateBasicInfo(n.target.name,n.target.value,!0),e.clearFieldError(n.target)})),n.addEventListener("blur",(function(n){var t=n.target.name,a=n.target.value,r=e.state.validateSingleField(t,a);r?e.showFieldError(n.target,r):e.clearFieldError(n.target),e.state.updateBasicInfo(t,a,!0)}))}))}},{key:"positionFAB",value:(i=o(s().mark((function e(){var n,t,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.container.querySelector(".fab"),t=this.container.querySelector(".wizard-form"),n&&t){e.next=4;break}return e.abrupt("return");case 4:return this.fabCleanup&&(this.fabCleanup(),this.fabCleanup=null),a=function(){var e=o(s().mark((function e(){var a,r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,aa(t,n,{placement:"right-end",middleware:[Qt(24),Zt({padding:10})]});case 2:a=e.sent,r=a.x,o=a.y,Object.assign(n.style,{position:"absolute",left:"".concat(r,"px"),top:"".concat(o,"px")});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=8,a();case 8:r=function(){return a()},window.addEventListener("scroll",r),window.addEventListener("resize",r),this.fabCleanup=function(){window.removeEventListener("scroll",r),window.removeEventListener("resize",r)};case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"attachCargosListeners",value:function(){var e=this,n=this.container.querySelector('[data-action="add-cargo"]');n&&n.addEventListener("click",(function(){return e.showAddCargoModal()})),this.positionFAB();var t=this.container.querySelector('[data-action="carousel-prev"]'),a=this.container.querySelector('[data-action="carousel-next"]');t&&t.addEventListener("click",(function(){return e.handleCarouselPrev()})),a&&a.addEventListener("click",(function(){return e.handleCarouselNext()})),this.container.querySelectorAll('[data-action="carousel-goto"]').forEach((function(n){n.addEventListener("click",(function(n){var t=parseInt(n.currentTarget.dataset.index);e.handleCarouselGoto(t)}))}));var r=this.container.querySelectorAll('[data-action="edit-cargo"]');console.log("[WizardCore] Found edit buttons:",r.length),r.forEach((function(n){n.addEventListener("click",(function(n){console.log("[WizardCore] Edit button clicked!");var t=parseInt(n.currentTarget.dataset.index);e.handleEditCargo(n.currentTarget,t)}))})),this.container.querySelectorAll('[data-action="remove-cargo"]').forEach((function(n){n.addEventListener("click",(function(n){var t=parseInt(n.currentTarget.dataset.index);e.handleRemoveCargo(t)}))})),this.container.querySelectorAll('[data-action="close-modal"]').forEach((function(n){n.addEventListener("click",(function(){return e.hideAddCargoModal()}))}));var o=this.container.querySelector('[data-action="save-cargo"]');o&&o.addEventListener("click",(function(){return e.handleSaveCargo()}))}},{key:"updateCarouselPosition",value:function(){var e=this,n=this.container.querySelector(".cargos-carousel");n&&(n.style.transform="translateX(calc(-".concat(100*this.carouselIndex,"% - ").concat(2*this.carouselIndex,"rem))")),this.container.querySelectorAll(".carousel-dot").forEach((function(n,t){t===e.carouselIndex?n.classList.add("active"):n.classList.remove("active")}));var t=this.container.querySelector('[data-action="carousel-prev"]'),a=this.container.querySelector('[data-action="carousel-next"]'),r=this.state.getCargos();t&&(t.disabled=0===this.carouselIndex),a&&(a.disabled=this.carouselIndex>=r.length-1)}},{key:"handleCarouselPrev",value:function(){this.state.getCargos();this.carouselIndex>0&&(this.carouselIndex--,this.updateCarouselPosition())}},{key:"handleCarouselNext",value:function(){var e=this.state.getCargos();this.carouselIndex<e.length-1&&(this.carouselIndex++,this.updateCarouselPosition())}},{key:"handleCarouselGoto",value:function(e){var n=this.state.getCargos();e>=0&&e<n.length&&(this.carouselIndex=e,this.updateCarouselPosition())}},{key:"attachRiesgosListeners",value:function(){var e,n,t=this,a=this.state.getCargos(),r=this.state.data.catalogos;console.log("[WizardCore] Initializing RiesgoSelector for",a.length,"cargo(s)"),console.log("[WizardCore] Available GES:",(null===(e=r.riesgos)||void 0===e?void 0:e.length)||0),console.log("[WizardCore] Available categories:",(null===(n=r.categorias)||void 0===n?void 0:n.length)||0),a.forEach((function(e,n){var a=t.container.querySelector("#riesgo-selector-".concat(n));if(a){t.riesgoSelectors[n]&&t.riesgoSelectors[n].destroy();var o=(r.riesgos||[]).map((function(e){return pa(pa({},e),{},{categoria:t.getCategoryName(e.id_riesgo||e.riesgo_id,r.categorias)})}));t.riesgoSelectors[n]=new An(a,{cargoIndex:n,cargoNombre:e.nombre,sector:t.state.data.sector||null,catalogoGES:o,catalogoRiesgos:r.categorias||[],seleccionados:e.gesSeleccionados||[],onChange:function(e){return t.handleGESChange(n,e)}}),console.log("[WizardCore] ‚úÖ RiesgoSelector #".concat(n,' initialized for cargo "').concat(e.nombre,'"'))}else console.warn("[WizardCore] Container #riesgo-selector-".concat(n," not found"))}));var o=this.container.querySelectorAll('[data-action="switch-cargo-tab"]');o.forEach((function(e){e.addEventListener("click",(function(e){var n=parseInt(e.currentTarget.dataset.cargoIndex);t.switchCargoTab(n)})),e.addEventListener("keydown",(function(e){t.handleTabKeydown(e,o)})),e.addEventListener("mouseenter",(function(e){t.showCargoTooltip(e.currentTarget)})),e.addEventListener("mouseleave",(function(){t.hideCargoTooltip()}))})),this.setupScrollIndicators()}},{key:"handleTabKeydown",value:function(e,n){var t=Array.from(n),a=t.findIndex((function(n){return n===e.target})),r=a;switch(e.key){case"ArrowLeft":r=(a-1+t.length)%t.length;break;case"ArrowRight":r=(a+1)%t.length;break;case"Home":r=0;break;case"End":r=t.length-1;break;default:return}e.preventDefault(),t[r].click(),t[r].focus()}},{key:"setupScrollIndicators",value:function(){var e=this.container.querySelector(".cargo-tabs-wrapper"),n=this.container.querySelector(".cargo-tabs");if(n&&e){var t=function(){var t=n.scrollLeft>10,a=n.scrollLeft<n.scrollWidth-n.clientWidth-10;e.classList.toggle("has-scroll-left",t),e.classList.toggle("has-scroll-right",a)};n.addEventListener("scroll",t),window.addEventListener("resize",t),t()}}},{key:"getCategoryName",value:function(e,n){if(!n||!Array.isArray(n))return"Sin categor√≠a";var t=n.find((function(n){return n.id===e}));return t?t.nombre:"Sin categor√≠a"}},{key:"getCategoriesFromGES",value:function(e){var n=new Map;return e.forEach((function(e){var t=e.id_riesgo||e.riesgo_id;n.has(t)||n.set(t,{id:t,nombre:e.categoria||"Categor√≠a ".concat(t)})})),Array.from(n.values())}},{key:"handleGESChange",value:function(e,n){var t=this.state.getCargo(e);if(t){var a=n.map((function(e){return{idGes:e.id,nombre:e.nombre,categoria:e.categoria||"",niveles:{ND:null,NE:null,NC:null,NP:null,NR:null},controles:{eliminacion:"",sustitucion:"",ingenieria:"",administrativos:"",epp:""}}}));this.state.updateCargo(e,pa(pa({},t),{},{ges:a,gesSeleccionados:a})),console.log("[WizardCore] Updated cargo ".concat(e," with ").concat(n.length," GES")),this.updateCargoCards()}}},{key:"updateCargoCards",value:function(){var e=this.state.getCargos();this.container.querySelectorAll(".cargo-card").forEach((function(n,t){var a=e[t];if(a){var r=n.querySelector(".cargo-card-header h3");r&&(r.textContent=a.nombre);var o=n.querySelector(".cargo-card-body > p");o&&(o.textContent=a.descripcion||"Sin descripci√≥n");var i=n.querySelector(".cargo-meta span:first-child");i&&(i.innerHTML='<i class="fas fa-user"></i> '.concat(a.numPersonas," persona").concat(1!==a.numPersonas?"s":""));var s=n.querySelector(".cargo-meta span:last-child");if(s){var c,l=(null===(c=a.gesSeleccionados)||void 0===c?void 0:c.length)||0;s.innerHTML='<i class="fas fa-exclamation-triangle"></i> '.concat(l," riesgo").concat(1!==l?"s":"")}}})),this.container.querySelectorAll(".cargo-tabs .cargo-tab").forEach((function(n,t){var a=e[t];if(a){var r=n.querySelector(".cargo-name");r&&(r.textContent=a.cargoName||a.nombre||"Cargo ".concat(t+1));var o=n.querySelector(".cargo-count");if(o){var i,s,c=(null===(i=a.gesSeleccionados)||void 0===i?void 0:i.length)||(null===(s=a.ges)||void 0===s?void 0:s.length)||0;o.textContent=c,o.classList.add("pulse-update"),setTimeout((function(){return o.classList.remove("pulse-update")}),400),n.setAttribute("data-has-risks",c>0?"true":"false")}}})),this.container.querySelectorAll(".niveles-cargo-tabs .niveles-cargo-tab").forEach((function(n,t){var a=e[t];if(a){var r=Array.from(n.childNodes).find((function(e){return e.nodeType===Node.TEXT_NODE}));r&&(r.textContent=a.nombre);var o=n.querySelector(".cargo-tab__count");if(o){var i,s=(null===(i=a.gesSeleccionados)||void 0===i?void 0:i.length)||0;o.textContent="".concat(s," GES")}}})),this.container.querySelectorAll(".cargo-item").forEach((function(n,t){var a=e[t];if(a){var r=n.querySelector(".cargo-stats span:last-child");if(r){var o,i=(null===(o=a.gesSeleccionados)||void 0===o?void 0:o.length)||0;r.innerHTML='<i class="fas fa-exclamation-triangle"></i> '.concat(i," riesgo").concat(1!==i?"s":"")}}})),console.log("[WizardCore] Cargo cards and tabs updated")}},{key:"switchCargoTab",value:function(e){this.container.querySelectorAll(".cargo-tab").forEach((function(n,t){t===e?(n.classList.add("active"),n.setAttribute("aria-selected","true"),n.setAttribute("tabindex","0")):(n.classList.remove("active"),n.setAttribute("aria-selected","false"),n.setAttribute("tabindex","-1"))})),this.container.querySelectorAll(".riesgo-selector-container").forEach((function(n,t){n.style.display=t===e?"":"none"}))}},{key:"showCargoTooltip",value:function(e){var n=this,a=parseInt(e.dataset.cargoIndex),r=this.state.getCargo(a);if(r){var o=r.ges||[];if(0!==o.length){var i={};o.forEach((function(e){var n=e.categoria||"Otros";i[n]||(i[n]=[]),i[n].push(e)}));var s='<div class="cargo-tooltip">';s+='<div class="tooltip-header">'.concat(r.nombre,"</div>"),s+='<div class="tooltip-body">',Object.entries(i).forEach((function(e){var a=t(e,2),r=a[0],o=a[1],i=n.getCategoryColor(r),c=o.slice(0,5),l=o.length-5;s+='<div class="tooltip-category">',s+='<div class="category-badge" style="background: '.concat(i,'">').concat(r,"</div>"),s+='<ul class="tooltip-risks">',c.forEach((function(e){s+="<li>".concat(e.nombre,"</li>")})),l>0&&(s+='<li class="more">...y '.concat(l," m√°s</li>")),s+="</ul></div>"})),s+="</div></div>";var c=document.createElement("div");c.innerHTML=s,this.currentTooltip=ra(e,c.firstChild,{placement:"top",offset:12,trigger:"manual"}),this.currentTooltip.show()}}}},{key:"hideCargoTooltip",value:function(){var e=this;this.currentTooltip&&(this.currentTooltip.hide(),setTimeout((function(){e.currentTooltip&&(e.currentTooltip.destroy(),e.currentTooltip=null)}),200))}},{key:"getCategoryColor",value:function(e){return{Mec√°nico:"#3498db",El√©ctrico:"#f39c12",F√≠sico:"#9b59b6",Qu√≠mico:"#e74c3c",Biol√≥gico:"#2ecc71",Ergon√≥mico:"#1abc9c",Biomec√°nico:"#1abc9c",Psicosocial:"#e67e22","Factores Humanos":"#ffa726",Locativo:"#34495e",Natural:"#8e44ad",Seguridad:"#c0392b","Otros Riesgos":"#95a5a6","Saneamiento B√°sico":"#16a085","Salud P√∫blica":"#27ae60",Comunes:"#5dc4af"}[e]||"#95a5a6"}},{key:"attachNivelesListeners",value:function(){var e=this;this.state.getCargos().length>0&&this.initializeNivelesForm(0),this.container.querySelectorAll('[data-action="switch-cargo-niveles"]').forEach((function(n){n.addEventListener("click",(function(n){var t=parseInt(n.currentTarget.dataset.cargoIndex);e.switchCargoNivelesTab(t)}))}))}},{key:"initializeNivelesForm",value:function(e){var n=this,t=this.state.getCargo(e);if(t){var a=this.container.querySelector("#niveles-container-".concat(e));a&&(this.nivelesForm&&this.nivelesForm.destroy(),this.nivelesForm=new Ln(a,{cargoIndex:e,cargoNombre:t.nombre,gesArray:t.gesSeleccionados||[],state:this.state,onChange:function(t){return n.handleNivelesChange(e,t)},onComplete:function(){return n.handleNivelesComplete()}}))}}},{key:"handleNivelesChange",value:function(e,n){"update-niveles"===n.action?console.log("[WizardCore] Niveles updated for cargo ".concat(e,", GES ").concat(n.gesIndex)):"go-back"===n.action&&this.state.setCurrentStep("riesgos")}},{key:"handleNivelesComplete",value:function(){console.log("[WizardCore] All niveles completed, proceeding to next step"),this.handleNext("niveles")}},{key:"switchCargoNivelesTab",value:function(e){this.container.querySelectorAll(".niveles-cargo-tab").forEach((function(n,t){t===e?n.classList.add("active"):n.classList.remove("active")})),this.container.querySelectorAll(".niveles-cargo-container").forEach((function(n,t){n.style.display=t===e?"":"none"})),this.initializeNivelesForm(e)}},{key:"handleBack",value:function(){var e=this,n=this.steps.findIndex((function(n){return n.id===e.state.getCurrentStep()}));if(n>0){var t=this.steps[n-1];this.state.setCurrentStep(t.id)}}},{key:"migrateNivelesData",value:function(){var e=this.state.getCargos(),n=!1;e.forEach((function(e,t){e.ges&&e.ges.forEach((function(e,a){var r=e.niveles;r&&(null===r.ND||void 0===r.ND||r.deficiencia||(console.log("[WizardCore] Migrando niveles para cargo ".concat(t,", GES ").concat(a,":"),e.nombre),r.deficiencia={value:r.ND},r.exposicion={value:r.NE},r.consecuencia={value:r.NC},n=!0))}))})),n&&(console.log("[WizardCore] Datos de niveles migrados, guardando..."),this.state.notify())}},{key:"handleNext",value:(r=o(s().mark((function e(n){var t,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("niveles"===n&&this.migrateNivelesData(),t=this.state.validateStep(n),!(Object.keys(t).length>0)){e.next=6;break}return console.error("[WizardCore] Validation errors:",t),this.showValidationErrors(t),e.abrupt("return");case 6:if("riesgos"!==n){e.next=12;break}return e.next=9,this.validateRiesgosStep();case 9:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:if("resumen"!==n){e.next=15;break}return this.handleSubmit(),e.abrupt("return");case 15:if("riesgos"!==n){e.next=18;break}return e.next=18,this.preloadGESDetails();case 18:a=this.steps.findIndex((function(e){return e.id===n})),a<this.steps.length-1&&(r=this.steps[a+1],this.state.setCurrentStep(r.id));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"validateRiesgosStep",value:(a=o(s().mark((function e(){var n,t,a,r,o,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.getCargos(),t=n.map((function(e){var n;return{nombre:e.nombre,count:(null===(n=e.ges)||void 0===n?void 0:n.length)||0}})),0!==(a=t.reduce((function(e,n){return e+n.count}),0))){e.next=7;break}return e.next=6,sa({title:"Debes seleccionar al menos un riesgo",message:'\n          <div style="text-align: left; line-height: 1.6;">\n            <p>No has seleccionado ning√∫n riesgo para los cargos de tu empresa.</p>\n            <p><strong>¬øPor qu√© es importante?</strong></p>\n            <ul style="margin-left: 1.5rem;">\n              <li>La matriz de riesgos es requerida por la normativa SST colombiana</li>\n              <li>Te ayuda a identificar y controlar peligros en el lugar de trabajo</li>\n              <li>Es necesaria para generar el profesiograma y perfil de cargo</li>\n            </ul>\n          </div>\n        ',confirmText:"Entendido, seleccionar√© riesgos",showCancelButton:!1,type:"error",icon:"fa-exclamation-triangle"});case 6:return e.abrupt("return",!1);case 7:if(!(a/n.length<3)){e.next=21;break}return r=t.filter((function(e){return 0===e.count})).map((function(e){return e.nombre})),o=t.filter((function(e){return e.count>0&&e.count<3})).map((function(e){return"".concat(e.nombre," (").concat(e.count," ").concat(1===e.count?"riesgo":"riesgos",")")})),i='<div style="text-align: left; line-height: 1.6;">',i+="<p>Has seleccionado <strong>".concat(a," ").concat(1===a?"riesgo":"riesgos","</strong> en total.</p>"),r.length>0&&(i+="<p><strong>Cargos sin riesgos:</strong></p>",i+='<ul style="margin-left: 1.5rem;">',r.forEach((function(e){i+="<li>".concat(e,"</li>")})),i+="</ul>"),o.length>0&&(i+="<p><strong>Cargos con pocos riesgos:</strong></p>",i+='<ul style="margin-left: 1.5rem;">',o.forEach((function(e){i+="<li>".concat(e,"</li>")})),i+="</ul>"),i+="<p>Se recomienda seleccionar al menos <strong>3-5 riesgos por cargo</strong> para una evaluaci√≥n completa.</p>",i+="</div>",e.next=19,sa({title:"¬øContinuar con esta selecci√≥n?",message:i,confirmText:"S√≠, continuar de todas formas",cancelText:"Volver a revisar riesgos",type:"warning",icon:"fa-exclamation-circle"});case 19:return c=e.sent,e.abrupt("return",c);case 21:return e.abrupt("return",!0);case 22:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"preloadGESDetails",value:(n=o(s().mark((function e(){var n,t,a,r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[WizardCore] üîÑ Precargando detalles de GES seleccionados..."),n=performance.now(),t=this.container.querySelector('[data-action="next"]'),a=t?t.innerHTML:"",e.prev=4,t&&(t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Cargando detalles...'),0!==(r=Object.values(this.riesgoSelectors).filter((function(e){return e&&"function"==typeof e.preloadSelectedDetails})).map((function(e){return e.preloadSelectedDetails()}))).length){e.next=10;break}return console.log("[WizardCore] No hay selectores activos para precargar"),e.abrupt("return");case 10:return e.next=12,Promise.all(r);case 12:o=Math.round(performance.now()-n),console.log("[WizardCore] ‚úÖ Precarga completada en ".concat(o,"ms")),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),console.error("[WizardCore] ‚ùå Error en precarga de detalles:",e.t0);case 19:return e.prev=19,t&&(t.disabled=!1,t.innerHTML=a),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(){return n.apply(this,arguments)})},{key:"showValidationErrors",value:function(e){var n=Object.values(e).join("<br>"),t=document.createElement("div");t.className="wizard-error",t.innerHTML='\n      <div class="error-content">\n        <strong>Por favor corrige los siguientes errores:</strong>\n        <p>'.concat(n,"</p>\n      </div>\n    ");var a=this.container.querySelector(".wizard-error");a&&a.remove(),this.container.appendChild(t),setTimeout((function(){return t.remove()}),5e3)}},{key:"showAddCargoModal",value:function(){var e=this,n=this.container.querySelector("#modal-add-cargo");if(n){this.previousFocusedElement=document.activeElement,n.style.display="flex",n.setAttribute("aria-modal","true"),n.setAttribute("role","dialog"),n.setAttribute("aria-labelledby","modal-title-cargo"),this.initialCargoFormState=this.getCargoFormState();var t=n.querySelector("#cargo-nombre");t&&requestAnimationFrame((function(){t.focus()})),this.setupModalFocusTrap(n),this.modalEscapeHandler=function(n){"Escape"===n.key&&(n.preventDefault(),e.hideAddCargoModal())},document.addEventListener("keydown",this.modalEscapeHandler)}}},{key:"setupModalFocusTrap",value:function(e){var n=["input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]",'[tabindex]:not([tabindex="-1"])'].join(", ");this.modalFocusTrapHandler=function(t){if("Tab"===t.key){var a=Array.from(e.querySelectorAll(n)),r=a[0],o=a[a.length-1];t.shiftKey?document.activeElement===r&&(t.preventDefault(),o.focus()):document.activeElement===o&&(t.preventDefault(),r.focus())}},e.addEventListener("keydown",this.modalFocusTrapHandler)}},{key:"getCargoFormState",value:function(){var e,n,t,a,r,o,i,s,c,l;return{nombre:(null===(e=this.container.querySelector("#cargo-nombre"))||void 0===e?void 0:e.value)||"",descripcion:(null===(n=this.container.querySelector("#cargo-descripcion"))||void 0===n?void 0:n.value)||"",numPersonas:(null===(t=this.container.querySelector("#cargo-num-personas"))||void 0===t?void 0:t.value)||"1",area:(null===(a=this.container.querySelector("#cargo-area"))||void 0===a?void 0:a.value)||"",zona:(null===(r=this.container.querySelector("#cargo-zona"))||void 0===r?void 0:r.value)||"",tareasRutinarias:(null===(o=this.container.querySelector("#cargo-tareasRutinarias"))||void 0===o?void 0:o.checked)||!1,manipulaAlimentos:(null===(i=this.container.querySelector("#cargo-manipulaAlimentos"))||void 0===i?void 0:i.checked)||!1,trabajaAlturas:(null===(s=this.container.querySelector("#cargo-trabajaAlturas"))||void 0===s?void 0:s.checked)||!1,trabajaEspaciosConfinados:(null===(c=this.container.querySelector("#cargo-trabajaEspaciosConfinados"))||void 0===c?void 0:c.checked)||!1,conduceVehiculo:(null===(l=this.container.querySelector("#cargo-conduceVehiculo"))||void 0===l?void 0:l.checked)||!1}}},{key:"hasCargoFormChanges",value:function(){if(!this.initialCargoFormState)return!1;var e=this.getCargoFormState();return e.nombre!==this.initialCargoFormState.nombre||e.descripcion!==this.initialCargoFormState.descripcion||e.numPersonas!==this.initialCargoFormState.numPersonas||e.tareasRutinarias!==this.initialCargoFormState.tareasRutinarias||e.manipulaAlimentos!==this.initialCargoFormState.manipulaAlimentos||e.trabajaAlturas!==this.initialCargoFormState.trabajaAlturas||e.trabajaEspaciosConfinados!==this.initialCargoFormState.trabajaEspaciosConfinados||e.conduceVehiculo!==this.initialCargoFormState.conduceVehiculo}},{key:"hideAddCargoModal",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!this.hasCargoFormChanges()?this.forceCloseAddCargoModal():sa({title:"Cambios sin guardar",message:"¬øDeseas salir sin guardar este cargo?",confirmText:"Salir sin Guardar",cancelText:"Continuar Editando",type:"warning",onConfirm:function(){e.forceCloseAddCargoModal()},onCancel:function(){}})}},{key:"forceCloseAddCargoModal",value:function(){var e=this.container.querySelector("#modal-add-cargo");e&&(e.style.display="none",e.removeAttribute("aria-modal"),e.removeAttribute("role"),e.removeAttribute("aria-labelledby"),this.modalEscapeHandler&&(document.removeEventListener("keydown",this.modalEscapeHandler),this.modalEscapeHandler=null),this.modalFocusTrapHandler&&(e.removeEventListener("keydown",this.modalFocusTrapHandler),this.modalFocusTrapHandler=null),this.previousFocusedElement&&this.previousFocusedElement.focus&&(this.previousFocusedElement.focus(),this.previousFocusedElement=null),this.container.querySelector("#cargo-nombre").value="",this.container.querySelector("#cargo-descripcion").value="",this.container.querySelector("#cargo-num-personas").value="1",this.container.querySelector("#cargo-area").value="",this.container.querySelector("#cargo-zona").value="",this.container.querySelector("#cargo-tareasRutinarias").checked=!1,this.container.querySelector("#cargo-manipulaAlimentos").checked=!1,this.container.querySelector("#cargo-trabajaAlturas").checked=!1,this.container.querySelector("#cargo-trabajaEspaciosConfinados").checked=!1,this.container.querySelector("#cargo-conduceVehiculo").checked=!1,this.initialCargoFormState=null)}},{key:"handleSaveCargo",value:function(){var e,n,t,a,r,o=this,i=this.container.querySelector("#cargo-nombre").value.trim(),s=this.container.querySelector("#cargo-descripcion").value.trim(),c=parseInt(this.container.querySelector("#cargo-num-personas").value),l=this.container.querySelector("#cargo-area").value.trim(),d=this.container.querySelector("#cargo-zona").value.trim(),u=(null===(e=this.container.querySelector("#cargo-tareasRutinarias"))||void 0===e?void 0:e.checked)||!1,g=(null===(n=this.container.querySelector("#cargo-manipulaAlimentos"))||void 0===n?void 0:n.checked)||!1,p=(null===(t=this.container.querySelector("#cargo-trabajaAlturas"))||void 0===t?void 0:t.checked)||!1,f=(null===(a=this.container.querySelector("#cargo-trabajaEspaciosConfinados"))||void 0===a?void 0:a.checked)||!1,v=(null===(r=this.container.querySelector("#cargo-conduceVehiculo"))||void 0===r?void 0:r.checked)||!1;if(i&&!(c<1)&&l&&d){var h=0===this.state.getCargos().length;this.state.addCargo({nombre:i,descripcion:s,numPersonas:c,area:l,zona:d,tareasRutinarias:u,manipulaAlimentos:g,trabajaAlturas:p,trabajaEspaciosConfinados:f,conduceVehiculo:v}),this.hideAddCargoModal(!0),h?(this.forceRender(),requestAnimationFrame((function(){requestAnimationFrame((function(){o.triggerFABBounce()}))}))):this.forceRender()}else alert("Por favor completa todos los campos requeridos")}},{key:"handleRemoveCargo",value:function(e){var n=this.state.getCargo(e);confirm('¬øEst√°s seguro de eliminar el cargo "'.concat(n.nombre,'"?'))&&(this.state.removeCargo(e),this.forceRender())}},{key:"handleEditCargo",value:function(e,n){var t=this;console.log("[WizardCore] Opening edit popover for cargo:",n),this.cargoEditor.showEditPopover(e,n,(function(e){console.log("[WizardCore] Cargo updated successfully:",e),t.updateCargoCards()}))}},{key:"triggerFABBounce",value:function(){var e=this.container.querySelector(".fab");e?(console.log("[WizardCore] ‚ú® Triggering FAB bounce animation"),e.classList.remove("fab--hidden"),e.classList.add("fab--bounce-in"),setTimeout((function(){e.classList.remove("fab--bounce-in"),console.log("[WizardCore] ‚úì FAB bounce animation completed")}),800)):console.warn("[WizardCore] FAB not found for bounce animation")}},{key:"handleSubmit",value:(e=o(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[WizardCore] Submitting wizard..."),e.prev=1,this.showLoading("Generando documentos..."),n=this.state.exportForSubmission(),e.next=6,fetch("/api/solicitudes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 6:if((t=e.sent).ok){e.next=9;break}throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText));case 9:return e.next=11,t.json();case 11:a=e.sent,console.log("[WizardCore] Submission successful:",a),this.state.clearStorage(),window.location.href="/pages/resultados.html?token=".concat(a.token),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),console.error("[WizardCore] Submission error:",e.t0),this.showError("Error al generar documentos. Por favor intenta de nuevo.");case 21:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(){return e.apply(this,arguments)})},{key:"showLoading",value:function(e){var n=document.createElement("div");n.className="wizard-loading-overlay",n.innerHTML='\n      <div class="wizard-loading">\n        <div class="wizard-loading__spinner"></div>\n        <p class="wizard-loading__text">'.concat(e,"</p>\n      </div>\n    "),document.body.appendChild(n)}},{key:"showError",value:function(e){alert(e)}}]);var e,n,a,r,i,c}(),va=null,ha=null;function ma(){return ba.apply(this,arguments)}function ba(){return ba=o(s().mark((function e(){var n,t,a,o,i,c=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>0&&void 0!==c[0]?c[0]:3,t=c.length>1&&void 0!==c[1]?c[1]:100,!(va&&va.length>0)){e.next=5;break}return console.log("[SectorLoader] ‚úì Returning cached SECTORES_ECONOMICOS:",va.length),e.abrupt("return",va);case 5:a=s().mark((function e(){var a,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.e(786).then(r.bind(r,7405));case 3:if(a=e.sent,!((o=a.SECTORES_ECONOMICOS)&&o.length>0)){e.next=9;break}return va=o,console.log("[SectorLoader] ‚úì Loaded SECTORES_ECONOMICOS on attempt ".concat(i+1,":"),o.length),e.abrupt("return",{v:o});case 9:console.warn("[SectorLoader] Attempt ".concat(i+1,": SECTORES_ECONOMICOS empty or undefined")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("[SectorLoader] Attempt ".concat(i+1," failed:"),e.t0);case 15:if(!(i<n-1)){e.next=20;break}return c=t*Math.pow(2,i),console.log("[SectorLoader] Waiting ".concat(c,"ms before retry...")),e.next=20,new Promise((function(e){return setTimeout(e,c)}));case 20:case"end":return e.stop()}}),e,null,[[0,12]])})),i=0;case 7:if(!(i<n)){e.next=15;break}return e.delegateYield(a(),"t0",9);case 9:if(!(o=e.t0)){e.next=12;break}return e.abrupt("return",o.v);case 12:i++,e.next=7;break;case 15:return console.error("[SectorLoader] ‚ùå Failed to load SECTORES_ECONOMICOS after",n,"attempts"),e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e)}))),ba.apply(this,arguments)}function ya(){return xa.apply(this,arguments)}function xa(){return xa=o(s().mark((function e(){var n,t,a,o,i=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>0&&void 0!==i[0]?i[0]:3,!(ha&&ha.length>0)){e.next=3;break}return e.abrupt("return",ha);case 3:t=s().mark((function e(t){var a,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.e(786).then(r.bind(r,7405));case 3:if(a=e.sent,!(o=a.getCiudadesSimple)){e.next=11;break}if(!((i=o())&&i.length>0)){e.next=11;break}return ha=i,console.log("[SectorLoader] ‚úì Loaded ciudades on attempt ".concat(t+1,":"),i.length),e.abrupt("return",{v:i});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("[SectorLoader] Ciudades attempt ".concat(t+1," failed:"),e.t0);case 16:if(!(t<n-1)){e.next=19;break}return e.next=19,new Promise((function(e){return setTimeout(e,100*Math.pow(2,t))}));case 19:case"end":return e.stop()}}),e,null,[[0,13]])})),o=0;case 5:if(!(o<n)){e.next=13;break}return e.delegateYield(t(o),"t0",7);case 7:if(!(a=e.t0)){e.next=10;break}return e.abrupt("return",a.v);case 10:o++,e.next=5;break;case 13:return console.error("[SectorLoader] ‚ùå Failed to load ciudades"),e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e)}))),xa.apply(this,arguments)}function wa(){return Ca.apply(this,arguments)}function Ca(){return(Ca=o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[SectorLoader] Preloading catalogos..."),e.next=3,Promise.all([ma(),ya()]);case 3:console.log("[SectorLoader] ‚úì Catalogos preloaded successfully");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ea(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.content,a=void 0===t?"":t,r=n.placement,i=void 0===r?"top":r,c=n.offsetDistance,l=void 0===c?8:c,d=n.trigger,u=void 0===d?"hover":d,g=document.createElement("div");g.className="wizard-help-tooltip",g.setAttribute("role","tooltip"),g.innerHTML=a,g.style.position="absolute",g.style.top="0",g.style.left="0";var p=!1;function f(){return v.apply(this,arguments)}function v(){return v=o(s().mark((function n(){var t,a,r,o;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,aa(e,g,{placement:i,middleware:[Qt(l),ea(),Zt({padding:8})]});case 2:t=n.sent,a=t.x,r=t.y,o=t.placement,Object.assign(g.style,{left:"".concat(a,"px"),top:"".concat(r,"px")}),g.setAttribute("data-popper-placement",o);case 8:case"end":return n.stop()}}),n)}))),v.apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return(m=o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=2;break}return e.abrupt("return");case 2:return document.body.appendChild(g),e.next=5,f();case 5:requestAnimationFrame((function(){g.setAttribute("data-show",""),p=!0}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){p&&(g.removeAttribute("data-show"),p=!1,setTimeout((function(){g.parentElement&&!p&&g.remove()}),150))}function y(e){e.stopPropagation(),p?b():h()}function x(n){g.contains(n.target)||e.contains(n.target)||b()}return"hover"===u?(e.addEventListener("mouseenter",h),e.addEventListener("mouseleave",b),e.addEventListener("focus",h),e.addEventListener("blur",b)):"click"===u?(e.addEventListener("click",y),document.addEventListener("click",x)):"focus"===u&&(e.addEventListener("focus",h),e.addEventListener("blur",b)),{show:h,hide:b,destroy:function(){b(),"hover"===u?(e.removeEventListener("mouseenter",h),e.removeEventListener("mouseleave",b)):"click"===u?(e.removeEventListener("click",y),document.removeEventListener("click",x)):"focus"===u&&(e.removeEventListener("focus",h),e.removeEventListener("blur",b))},update:f}}function Sa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[data-tooltip]",n=document.querySelectorAll(e),t=[];return n.forEach((function(e){if(!e.hasAttribute("data-tooltip-initialized")){var n=e.getAttribute("data-tooltip"),a=e.getAttribute("data-tooltip-placement")||"top",r=e.getAttribute("data-tooltip-trigger")||"hover";if(n){var o=Ea(e,{content:n,placement:a,trigger:r});e.setAttribute("data-tooltip-initialized","true"),t.push(o)}}})),t.length>0&&console.log("[Tooltips] Initialized ".concat(t.length," tooltips")),t}function ka(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".wizard-enhanced-select",n=document.querySelectorAll(e),t=[];return n.forEach((function(e){if(!e.hasAttribute("data-dropdown-initialized")){var n=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.searchable,a=void 0===t||t,r=n.placeholder,i=void 0===r?e.getAttribute("placeholder")||"Seleccionar...":r,c=n.onChange,l=void 0===c?function(){}:c,d=Array.from(e.options).filter((function(e){return""!==e.value})).map((function(e){return{value:e.value,label:e.textContent,selected:e.selected}})),u=document.createElement("div");u.className="wizard-dropdown";var g=document.createElement("button");g.type="button",g.className="wizard-dropdown-trigger",g.setAttribute("aria-haspopup","listbox"),g.setAttribute("aria-expanded","false");var p=d.find((function(e){return e.selected})),f=document.createElement("span");f.textContent=p?p.label:i;var v=document.createElement("i");v.className="fas fa-chevron-down chevron",g.appendChild(f),g.appendChild(v);var h=document.createElement("div");h.className="wizard-dropdown-panel",h.setAttribute("role","listbox"),h.style.position="absolute",h.style.top="0",h.style.left="0";var m=null;if(a){var b=document.createElement("div");b.className="wizard-dropdown-search",(m=document.createElement("input")).type="text",m.placeholder="Buscar...",m.setAttribute("aria-label","Buscar opciones"),b.appendChild(m),h.appendChild(b)}var y=document.createElement("ul");y.className="wizard-dropdown-options";var x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;if(y.innerHTML="",0===e.length){var n=document.createElement("div");return n.className="wizard-dropdown-empty",n.textContent="No se encontraron resultados",void y.appendChild(n)}e.forEach((function(e){var n=document.createElement("li");n.className="wizard-dropdown-option",n.setAttribute("role","option"),n.setAttribute("data-value",e.value),n.textContent=e.label,n.tabIndex=0,e.selected&&n.setAttribute("aria-selected","true"),n.addEventListener("click",(function(){z(e)})),n.addEventListener("keydown",(function(n){"Enter"!==n.key&&" "!==n.key||(n.preventDefault(),z(e))})),y.appendChild(n)}))};x(),h.appendChild(y),u.appendChild(g),document.body.appendChild(h),e.style.display="none",e.parentElement.insertBefore(u,e);var w=!1,C=p?p.value:"";function E(){return S.apply(this,arguments)}function S(){return S=o(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,aa(g,h,{placement:"bottom-start",middleware:[ea(),Zt({padding:8}),na({apply:function(e){var n=e.availableHeight,t=e.elements;Object.assign(t.floating.style,{maxHeight:"".concat(Math.min(n-16,300),"px")})}})]});case 2:n=e.sent,t=n.x,a=n.y,Object.assign(h.style,{left:"".concat(t,"px"),top:"".concat(a,"px"),width:"".concat(g.offsetWidth,"px")});case 6:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function k(){return A.apply(this,arguments)}function A(){return(A=o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,E();case 4:h.setAttribute("data-show",""),g.setAttribute("aria-expanded","true"),w=!0,m&&setTimeout((function(){return m.focus()}),50);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){w&&(h.removeAttribute("data-show"),g.setAttribute("aria-expanded","false"),w=!1,m&&(m.value="",x()))}function z(n){C=n.value,f.textContent=n.label,e.value=n.value;var t=new Event("change",{bubbles:!0}),a=new Event("input",{bubbles:!0});e.dispatchEvent(a),e.dispatchEvent(t),y.querySelectorAll("[aria-selected]").forEach((function(e){e.removeAttribute("aria-selected")}));var r=y.querySelector('[data-value="'.concat(n.value,'"]'));r&&r.setAttribute("aria-selected","true"),l(n.value,n.label),_()}return g.addEventListener("click",(function(){w?_():k()})),m&&(m.addEventListener("input",(function(e){var n=e.target.value.toLowerCase().trim();if(n){var t=d.filter((function(e){return e.label.toLowerCase().includes(n)}));x(t)}else x()})),m.addEventListener("keydown",(function(e){if("Enter"===e.key){e.preventDefault();var n=y.querySelectorAll(".wizard-dropdown-option");1===n.length&&n[0].click()}}))),document.addEventListener("click",(function(e){u.contains(e.target)||h.contains(e.target)||_()})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&w&&(_(),g.focus())})),{open:k,close:_,getValue:function(){return C},setValue:function(e){var n=d.find((function(n){return n.value===e}));n&&z(n)},destroy:function(){h.remove(),u.remove(),e.style.display=""}}}(e,{searchable:!1!==e.hasAttribute("data-searchable")});e.setAttribute("data-dropdown-initialized","true"),t.push(n)}})),t.length>0&&console.log("[Dropdowns] Initialized ".concat(t.length," enhanced dropdowns")),t}function Aa(){return _a.apply(this,arguments)}function _a(){return(_a=o(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[Wizard Riesgos] Initializing..."),n=b(),console.log("[Wizard Riesgos] Current state:",n.data),"info-basica"===(t=n.getCurrentStep())){e.next=8;break}return Na(),ia(t,o(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[Wizard Riesgos] Resuming from step:",t),za("Cargando asistente..."),e.next=4,wa();case 4:return e.next=6,La(n);case 6:new fa("#wizard-container",n).init(),Ta(),Na();case 10:case"end":return e.stop()}}),e)}))),(function(){n.clearStorage(),console.log("[Wizard Riesgos] Session cleared, starting fresh"),window.location.reload()})),e.abrupt("return");case 8:return za("Cargando cat√°logos..."),e.prev=9,e.next=12,wa();case 12:return e.next=14,La(n);case 14:new fa("#wizard-container",n).init(),Ta(),console.log("[Wizard Riesgos] Initialized successfully with Floating-UI enhancements"),Na(),e.next=27;break;case 21:e.prev=21,e.t0=e.catch(9),console.error("[Wizard Riesgos] Error during initialization:",e.t0),Na(),(a=document.getElementById("wizard-container"))&&(a.innerHTML='\n        <div class="wizard-error">\n          <i class="fas fa-exclamation-triangle"></i>\n          <h3>Error al cargar el asistente</h3>\n          <p>No se pudieron cargar los cat√°logos necesarios. Por favor, recarga la p√°gina.</p>\n          <button onclick="window.location.reload()" class="btn-primary">\n            <i class="fas fa-redo"></i> Recargar p√°gina\n          </button>\n        </div>\n      ');case 27:case"end":return e.stop()}}),e,null,[[9,21]])})))).apply(this,arguments)}function za(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Cargando asistente...",n=document.querySelector(".wizard-loading"),t=document.querySelector(".wizard-loading__text");n&&t&&(t.textContent=e,n.style.display="flex")}function Na(){var e=document.querySelector(".wizard-loading");e&&(e.style.display="none")}function Ta(){var e=null,n=new MutationObserver((function(){e&&clearTimeout(e),e=setTimeout((function(){n.disconnect(),Sa("[data-tooltip]"),ka(".wizard-enhanced-select");var e=document.querySelector("#wizard-container");e&&n.observe(e,{childList:!0,subtree:!0})}),50)})),t=document.querySelector("#wizard-container");t&&n.observe(t,{childList:!0,subtree:!0}),setTimeout((function(){Sa("[data-tooltip]"),ka(".wizard-enhanced-select")}),100)}function La(e){return Ia.apply(this,arguments)}function Ia(){return(Ia=o(s().mark((function e(n){var a,r,o,i,c,l,d,u,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("[Wizard Riesgos] Loading catalogos from new API..."),a={riesgos:[],categorias:[],sectores:[]},e.next=5,Promise.all([fetch("/api/catalogo/ges?limit=200"),fetch("/api/catalogo/riesgos"),fetch("/api/catalogo/sectores")]);case 5:if(r=e.sent,o=t(r,3),i=o[0],c=o[1],l=o[2],!i.ok){e.next=18;break}return e.next=13,i.json();case 13:d=e.sent,a.riesgos=d.data||[],console.log("[Wizard Riesgos] ‚úÖ Loaded ".concat(a.riesgos.length," GES from catalog API")),e.next=19;break;case 18:console.error("[Wizard Riesgos] ‚ùå Error loading GES:",i.statusText);case 19:if(!c.ok){e.next=27;break}return e.next=22,c.json();case 22:u=e.sent,a.categorias=u.data||[],console.log("[Wizard Riesgos] ‚úÖ Loaded ".concat(a.categorias.length," risk categories")),e.next=28;break;case 27:console.error("[Wizard Riesgos] ‚ùå Error loading categories:",c.statusText);case 28:if(!l.ok){e.next=36;break}return e.next=31,l.json();case 31:g=e.sent,a.sectores=g.data||[],console.log("[Wizard Riesgos] ‚úÖ Loaded ".concat(a.sectores.length," sectors")),e.next=37;break;case 36:console.error("[Wizard Riesgos] ‚ùå Error loading sectors:",l.statusText);case 37:n.setCatalogos(a),console.log("[Wizard Riesgos] üéØ All catalogos loaded successfully"),e.next=44;break;case 41:e.prev=41,e.t0=e.catch(0),console.error("[Wizard Riesgos] ‚ùå Error loading catalogos:",e.t0);case 44:case"end":return e.stop()}}),e,null,[[0,41]])})))).apply(this,arguments)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Aa):Aa()})()})();