/*! For license information please see wizardRiesgos.bundle.js.LICENSE.txt */
(()=>{var e,n,t={4633:(e,n,t)=>{var a=t(3738).default;function o(){"use strict";e.exports=o=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var n,t={},r=Object.prototype,i=r.hasOwnProperty,s=Object.defineProperty||function(e,n,t){e[n]=t.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function g(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{g({},"")}catch(n){g=function(e,n,t){return e[n]=t}}function p(e,n,t,a){var o=n&&n.prototype instanceof x?n:x,r=Object.create(o.prototype),i=new D(a||[]);return s(r,"_invoke",{value:z(e,t,i)}),r}function v(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var f="suspendedStart",h="suspendedYield",m="executing",b="completed",y={};function x(){}function w(){}function C(){}var E={};g(E,l,(function(){return this}));var S=Object.getPrototypeOf,k=S&&S(S(P([])));k&&k!==r&&i.call(k,l)&&(E=k);var A=C.prototype=x.prototype=Object.create(E);function _(e){["next","throw","return"].forEach((function(n){g(e,n,(function(e){return this._invoke(n,e)}))}))}function N(e,n){function t(o,r,s,c){var l=v(e[o],e,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==a(u)&&i.call(u,"__await")?n.resolve(u.__await).then((function(e){t("next",e,s,c)}),(function(e){t("throw",e,s,c)})):n.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return t("throw",e,s,c)}))}c(l.arg)}var o;s(this,"_invoke",{value:function(e,a){function r(){return new n((function(n,o){t(e,a,n,o)}))}return o=o?o.then(r,r):r()}})}function z(e,t,a){var o=f;return function(r,i){if(o===m)throw Error("Generator is already running");if(o===b){if("throw"===r)throw i;return{value:n,done:!0}}for(a.method=r,a.arg=i;;){var s=a.delegate;if(s){var c=T(s,a);if(c){if(c===y)continue;return c}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===f)throw o=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=m;var l=v(e,t,a);if("normal"===l.type){if(o=a.done?b:h,l.arg===y)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(o=b,a.method="throw",a.arg=l.arg)}}}function T(e,t){var a=t.method,o=e.iterator[a];if(o===n)return t.delegate=null,"throw"===a&&e.iterator.return&&(t.method="return",t.arg=n,T(e,t),"throw"===t.method)||"return"!==a&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+a+"' method")),y;var r=v(o,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,y;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,y):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function I(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function L(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function P(e){if(e||""===e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return r.next=r}}throw new TypeError(a(e)+" is not iterable")}return w.prototype=C,s(A,"constructor",{value:C,configurable:!0}),s(C,"constructor",{value:w,configurable:!0}),w.displayName=g(C,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===w||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,g(e,u,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},_(N.prototype),g(N.prototype,d,(function(){return this})),t.AsyncIterator=N,t.async=function(e,n,a,o,r){void 0===r&&(r=Promise);var i=new N(p(e,n,a,o),r);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(A),g(A,u,"Generator"),g(A,l,(function(){return this})),g(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var n=Object(e),t=[];for(var a in n)t.push(a);return t.reverse(),function e(){for(;t.length;){var a=t.pop();if(a in n)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=P,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(L),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(a,o){return s.type="throw",s.arg=e,t.next=a,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],s=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var c=i.call(r,"catchLoc"),l=i.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=e,r.arg=n,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(r)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),y},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),L(t),y}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var a=t.completion;if("throw"===a.type){var o=a.arg;L(t)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:P(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=n),y}},t}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},3738:e=>{function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},4756:(e,n,t)=>{var a=t(4633)();e.exports=a;try{regeneratorRuntime=a}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}},5361:(e,n,t)=>{"use strict";t.d(n,{BN:()=>m,ER:()=>b,Ej:()=>y,RK:()=>c,UE:()=>s,UU:()=>l,__:()=>i,cY:()=>h,jD:()=>g,mG:()=>v,rD:()=>r});var a=t(7193);function o(e,n,t){let{reference:o,floating:r}=e;const i=(0,a.TV)(n),s=(0,a.Dz)(n),c=(0,a.sq)(s),l=(0,a.C0)(n),d="y"===i,u=o.x+o.width/2-r.width/2,g=o.y+o.height/2-r.height/2,p=o[c]/2-r[c]/2;let v;switch(l){case"top":v={x:u,y:o.y-r.height};break;case"bottom":v={x:u,y:o.y+o.height};break;case"right":v={x:o.x+o.width,y:g};break;case"left":v={x:o.x-r.width,y:g};break;default:v={x:o.x,y:o.y}}switch((0,a.Sg)(n)){case"start":v[s]-=p*(t&&d?-1:1);break;case"end":v[s]+=p*(t&&d?-1:1)}return v}const r=async(e,n,t)=>{const{placement:a="bottom",strategy:r="absolute",middleware:i=[],platform:s}=t,c=i.filter(Boolean),l=await(null==s.isRTL?void 0:s.isRTL(n));let d=await s.getElementRects({reference:e,floating:n,strategy:r}),{x:u,y:g}=o(d,a,l),p=a,v={},f=0;for(let t=0;t<c.length;t++){const{name:i,fn:h}=c[t],{x:m,y:b,data:y,reset:x}=await h({x:u,y:g,initialPlacement:a,placement:p,strategy:r,middlewareData:v,rects:d,platform:s,elements:{reference:e,floating:n}});u=null!=m?m:u,g=null!=b?b:g,v={...v,[i]:{...v[i],...y}},x&&f<=50&&(f++,"object"==typeof x&&(x.placement&&(p=x.placement),x.rects&&(d=!0===x.rects?await s.getElementRects({reference:e,floating:n,strategy:r}):x.rects),({x:u,y:g}=o(d,p,l))),t=-1)}return{x:u,y:g,placement:p,strategy:r,middlewareData:v}};async function i(e,n){var t;void 0===n&&(n={});const{x:o,y:r,platform:i,rects:s,elements:c,strategy:l}=e,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:g="floating",altBoundary:p=!1,padding:v=0}=(0,a._3)(n,e),f=(0,a.nI)(v),h=c[p?"floating"===g?"reference":"floating":g],m=(0,a.B1)(await i.getClippingRect({element:null==(t=await(null==i.isElement?void 0:i.isElement(h)))||t?h:h.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(c.floating)),boundary:d,rootBoundary:u,strategy:l})),b="floating"===g?{x:o,y:r,width:s.floating.width,height:s.floating.height}:s.reference,y=await(null==i.getOffsetParent?void 0:i.getOffsetParent(c.floating)),x=await(null==i.isElement?void 0:i.isElement(y))&&await(null==i.getScale?void 0:i.getScale(y))||{x:1,y:1},w=(0,a.B1)(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:b,offsetParent:y,strategy:l}):b);return{top:(m.top-w.top+f.top)/x.y,bottom:(w.bottom-m.bottom+f.bottom)/x.y,left:(m.left-w.left+f.left)/x.x,right:(w.right-m.right+f.right)/x.x}}const s=e=>({name:"arrow",options:e,async fn(n){const{x:t,y:o,placement:r,rects:i,platform:s,elements:c,middlewareData:l}=n,{element:d,padding:u=0}=(0,a._3)(e,n)||{};if(null==d)return{};const g=(0,a.nI)(u),p={x:t,y:o},v=(0,a.Dz)(r),f=(0,a.sq)(v),h=await s.getDimensions(d),m="y"===v,b=m?"top":"left",y=m?"bottom":"right",x=m?"clientHeight":"clientWidth",w=i.reference[f]+i.reference[v]-p[v]-i.floating[f],C=p[v]-i.reference[v],E=await(null==s.getOffsetParent?void 0:s.getOffsetParent(d));let S=E?E[x]:0;S&&await(null==s.isElement?void 0:s.isElement(E))||(S=c.floating[x]||i.floating[f]);const k=w/2-C/2,A=S/2-h[f]/2-1,_=(0,a.jk)(g[b],A),N=(0,a.jk)(g[y],A),z=_,T=S-h[f]-N,I=S/2-h[f]/2+k,L=(0,a.qE)(z,I,T),D=!l.arrow&&null!=(0,a.Sg)(r)&&I!==L&&i.reference[f]/2-(I<z?_:N)-h[f]/2<0,P=D?I<z?I-z:I-T:0;return{[v]:p[v]+P,data:{[v]:L,centerOffset:I-L-P,...D&&{alignmentOffset:P}},reset:D}}});const c=function(e){return void 0===e&&(e={}),{name:"autoPlacement",options:e,async fn(n){var t,o,r;const{rects:s,middlewareData:c,placement:l,platform:d,elements:u}=n,{crossAxis:g=!1,alignment:p,allowedPlacements:v=a.DD,autoAlignment:f=!0,...h}=(0,a._3)(e,n),m=void 0!==p||v===a.DD?function(e,n,t){return(e?[...t.filter((n=>(0,a.Sg)(n)===e)),...t.filter((n=>(0,a.Sg)(n)!==e))]:t.filter((e=>(0,a.C0)(e)===e))).filter((t=>!e||(0,a.Sg)(t)===e||!!n&&(0,a.aD)(t)!==t))}(p||null,f,v):v,b=await i(n,h),y=(null==(t=c.autoPlacement)?void 0:t.index)||0,x=m[y];if(null==x)return{};const w=(0,a.w7)(x,s,await(null==d.isRTL?void 0:d.isRTL(u.floating)));if(l!==x)return{reset:{placement:m[0]}};const C=[b[(0,a.C0)(x)],b[w[0]],b[w[1]]],E=[...(null==(o=c.autoPlacement)?void 0:o.overflows)||[],{placement:x,overflows:C}],S=m[y+1];if(S)return{data:{index:y+1,overflows:E},reset:{placement:S}};const k=E.map((e=>{const n=(0,a.Sg)(e.placement);return[e.placement,n&&g?e.overflows.slice(0,2).reduce(((e,n)=>e+n),0):e.overflows[0],e.overflows]})).sort(((e,n)=>e[1]-n[1])),A=(null==(r=k.filter((e=>e[2].slice(0,(0,a.Sg)(e[0])?2:3).every((e=>e<=0))))[0])?void 0:r[0])||k[0][0];return A!==l?{data:{index:y+1,overflows:E},reset:{placement:A}}:{}}}},l=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(n){var t,o;const{placement:r,middlewareData:s,rects:c,initialPlacement:l,platform:d,elements:u}=n,{mainAxis:g=!0,crossAxis:p=!0,fallbackPlacements:v,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:h="none",flipAlignment:m=!0,...b}=(0,a._3)(e,n);if(null!=(t=s.arrow)&&t.alignmentOffset)return{};const y=(0,a.C0)(r),x=(0,a.TV)(l),w=(0,a.C0)(l)===l,C=await(null==d.isRTL?void 0:d.isRTL(u.floating)),E=v||(w||!m?[(0,a.bV)(l)]:(0,a.WJ)(l)),S="none"!==h;!v&&S&&E.push(...(0,a.lP)(l,m,h,C));const k=[l,...E],A=await i(n,b),_=[];let N=(null==(o=s.flip)?void 0:o.overflows)||[];if(g&&_.push(A[y]),p){const e=(0,a.w7)(r,c,C);_.push(A[e[0]],A[e[1]])}if(N=[...N,{placement:r,overflows:_}],!_.every((e=>e<=0))){var z,T;const e=((null==(z=s.flip)?void 0:z.index)||0)+1,n=k[e];if(n){if(!("alignment"===p&&x!==(0,a.TV)(n))||N.every((e=>(0,a.TV)(e.placement)!==x||e.overflows[0]>0)))return{data:{index:e,overflows:N},reset:{placement:n}}}let t=null==(T=N.filter((e=>e.overflows[0]<=0)).sort(((e,n)=>e.overflows[1]-n.overflows[1]))[0])?void 0:T.placement;if(!t)switch(f){case"bestFit":{var I;const e=null==(I=N.filter((e=>{if(S){const n=(0,a.TV)(e.placement);return n===x||"y"===n}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,n)=>e+n),0)])).sort(((e,n)=>e[1]-n[1]))[0])?void 0:I[0];e&&(t=e);break}case"initialPlacement":t=l}if(r!==t)return{reset:{placement:t}}}return{}}}};function d(e,n){return{top:e.top-n.height,right:e.right-n.width,bottom:e.bottom-n.height,left:e.left-n.width}}function u(e){return a.r_.some((n=>e[n]>=0))}const g=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(n){const{rects:t}=n,{strategy:o="referenceHidden",...r}=(0,a._3)(e,n);switch(o){case"referenceHidden":{const e=d(await i(n,{...r,elementContext:"reference"}),t.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:u(e)}}}case"escaped":{const e=d(await i(n,{...r,altBoundary:!0}),t.floating);return{data:{escapedOffsets:e,escaped:u(e)}}}default:return{}}}}};function p(e){const n=(0,a.jk)(...e.map((e=>e.left))),t=(0,a.jk)(...e.map((e=>e.top)));return{x:n,y:t,width:(0,a.T9)(...e.map((e=>e.right)))-n,height:(0,a.T9)(...e.map((e=>e.bottom)))-t}}const v=function(e){return void 0===e&&(e={}),{name:"inline",options:e,async fn(n){const{placement:t,elements:o,rects:r,platform:i,strategy:s}=n,{padding:c=2,x:l,y:d}=(0,a._3)(e,n),u=Array.from(await(null==i.getClientRects?void 0:i.getClientRects(o.reference))||[]),g=function(e){const n=e.slice().sort(((e,n)=>e.y-n.y)),t=[];let o=null;for(let e=0;e<n.length;e++){const a=n[e];!o||a.y-o.y>o.height/2?t.push([a]):t[t.length-1].push(a),o=a}return t.map((e=>(0,a.B1)(p(e))))}(u),v=(0,a.B1)(p(u)),f=(0,a.nI)(c);const h=await i.getElementRects({reference:{getBoundingClientRect:function(){if(2===g.length&&g[0].left>g[1].right&&null!=l&&null!=d)return g.find((e=>l>e.left-f.left&&l<e.right+f.right&&d>e.top-f.top&&d<e.bottom+f.bottom))||v;if(g.length>=2){if("y"===(0,a.TV)(t)){const e=g[0],n=g[g.length-1],o="top"===(0,a.C0)(t),r=e.top,i=n.bottom,s=o?e.left:n.left,c=o?e.right:n.right;return{top:r,bottom:i,left:s,right:c,width:c-s,height:i-r,x:s,y:r}}const e="left"===(0,a.C0)(t),n=(0,a.T9)(...g.map((e=>e.right))),o=(0,a.jk)(...g.map((e=>e.left))),r=g.filter((t=>e?t.left===o:t.right===n)),i=r[0].top,s=r[r.length-1].bottom;return{top:i,bottom:s,left:o,right:n,width:n-o,height:s-i,x:o,y:i}}return v}},floating:o.floating,strategy:s});return r.reference.x!==h.reference.x||r.reference.y!==h.reference.y||r.reference.width!==h.reference.width||r.reference.height!==h.reference.height?{reset:{rects:h}}:{}}}},f=new Set(["left","top"]);const h=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(n){var t,o;const{x:r,y:i,placement:s,middlewareData:c}=n,l=await async function(e,n){const{placement:t,platform:o,elements:r}=e,i=await(null==o.isRTL?void 0:o.isRTL(r.floating)),s=(0,a.C0)(t),c=(0,a.Sg)(t),l="y"===(0,a.TV)(t),d=f.has(s)?-1:1,u=i&&l?-1:1,g=(0,a._3)(n,e);let{mainAxis:p,crossAxis:v,alignmentAxis:h}="number"==typeof g?{mainAxis:g,crossAxis:0,alignmentAxis:null}:{mainAxis:g.mainAxis||0,crossAxis:g.crossAxis||0,alignmentAxis:g.alignmentAxis};return c&&"number"==typeof h&&(v="end"===c?-1*h:h),l?{x:v*u,y:p*d}:{x:p*d,y:v*u}}(n,e);return s===(null==(t=c.offset)?void 0:t.placement)&&null!=(o=c.arrow)&&o.alignmentOffset?{}:{x:r+l.x,y:i+l.y,data:{...l,placement:s}}}}},m=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(n){const{x:t,y:o,placement:r}=n,{mainAxis:s=!0,crossAxis:c=!1,limiter:l={fn:e=>{let{x:n,y:t}=e;return{x:n,y:t}}},...d}=(0,a._3)(e,n),u={x:t,y:o},g=await i(n,d),p=(0,a.TV)((0,a.C0)(r)),v=(0,a.PG)(p);let f=u[v],h=u[p];if(s){const e="y"===v?"bottom":"right",n=f+g["y"===v?"top":"left"],t=f-g[e];f=(0,a.qE)(n,f,t)}if(c){const e="y"===p?"bottom":"right",n=h+g["y"===p?"top":"left"],t=h-g[e];h=(0,a.qE)(n,h,t)}const m=l.fn({...n,[v]:f,[p]:h});return{...m,data:{x:m.x-t,y:m.y-o,enabled:{[v]:s,[p]:c}}}}}},b=function(e){return void 0===e&&(e={}),{options:e,fn(n){const{x:t,y:o,placement:r,rects:i,middlewareData:s}=n,{offset:c=0,mainAxis:l=!0,crossAxis:d=!0}=(0,a._3)(e,n),u={x:t,y:o},g=(0,a.TV)(r),p=(0,a.PG)(g);let v=u[p],h=u[g];const m=(0,a._3)(c,n),b="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const e="y"===p?"height":"width",n=i.reference[p]-i.floating[e]+b.mainAxis,t=i.reference[p]+i.reference[e]-b.mainAxis;v<n?v=n:v>t&&(v=t)}if(d){var y,x;const e="y"===p?"width":"height",n=f.has((0,a.C0)(r)),t=i.reference[g]-i.floating[e]+(n&&(null==(y=s.offset)?void 0:y[g])||0)+(n?0:b.crossAxis),o=i.reference[g]+i.reference[e]+(n?0:(null==(x=s.offset)?void 0:x[g])||0)-(n?b.crossAxis:0);h<t?h=t:h>o&&(h=o)}return{[p]:v,[g]:h}}}},y=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(n){var t,o;const{placement:r,rects:s,platform:c,elements:l}=n,{apply:d=()=>{},...u}=(0,a._3)(e,n),g=await i(n,u),p=(0,a.C0)(r),v=(0,a.Sg)(r),f="y"===(0,a.TV)(r),{width:h,height:m}=s.floating;let b,y;"top"===p||"bottom"===p?(b=p,y=v===(await(null==c.isRTL?void 0:c.isRTL(l.floating))?"start":"end")?"left":"right"):(y=p,b="end"===v?"top":"bottom");const x=m-g.top-g.bottom,w=h-g.left-g.right,C=(0,a.jk)(m-g[b],x),E=(0,a.jk)(h-g[y],w),S=!n.middlewareData.shift;let k=C,A=E;if(null!=(t=n.middlewareData.shift)&&t.enabled.x&&(A=w),null!=(o=n.middlewareData.shift)&&o.enabled.y&&(k=x),S&&!v){const e=(0,a.T9)(g.left,0),n=(0,a.T9)(g.right,0),t=(0,a.T9)(g.top,0),o=(0,a.T9)(g.bottom,0);f?A=h-2*(0!==e||0!==n?e+n:(0,a.T9)(g.left,g.right)):k=m-2*(0!==t||0!==o?t+o:(0,a.T9)(g.top,g.bottom))}await d({...n,availableWidth:A,availableHeight:k});const _=await c.getDimensions(l.floating);return h!==_.width||m!==_.height?{reset:{rects:!0}}:{}}}}},8491:(e,n,t)=>{"use strict";t.r(n),t.d(n,{arrow:()=>I,autoPlacement:()=>A,autoUpdate:()=>E,computePosition:()=>P,detectOverflow:()=>S,flip:()=>N,getOverflowAncestors:()=>r.v9,hide:()=>T,inline:()=>L,limitShift:()=>D,offset:()=>k,platform:()=>w,shift:()=>_,size:()=>z});var a=t(7193),o=t(5361),r=t(6635);function i(e){const n=(0,r.L9)(e);let t=parseFloat(n.width)||0,o=parseFloat(n.height)||0;const i=(0,r.sb)(e),s=i?e.offsetWidth:t,c=i?e.offsetHeight:o,l=(0,a.LI)(t)!==s||(0,a.LI)(o)!==c;return l&&(t=s,o=c),{width:t,height:o,$:l}}function s(e){return(0,r.vq)(e)?e:e.contextElement}function c(e){const n=s(e);if(!(0,r.sb)(n))return(0,a.Jx)(1);const t=n.getBoundingClientRect(),{width:o,height:c,$:l}=i(n);let d=(l?(0,a.LI)(t.width):t.width)/o,u=(l?(0,a.LI)(t.height):t.height)/c;return d&&Number.isFinite(d)||(d=1),u&&Number.isFinite(u)||(u=1),{x:d,y:u}}const l=(0,a.Jx)(0);function d(e){const n=(0,r.zk)(e);return(0,r.Tc)()&&n.visualViewport?{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}:l}function u(e,n,t,o){void 0===n&&(n=!1),void 0===t&&(t=!1);const i=e.getBoundingClientRect(),l=s(e);let u=(0,a.Jx)(1);n&&(o?(0,r.vq)(o)&&(u=c(o)):u=c(e));const g=function(e,n,t){return void 0===n&&(n=!1),!(!t||n&&t!==(0,r.zk)(e))&&n}(l,t,o)?d(l):(0,a.Jx)(0);let p=(i.left+g.x)/u.x,v=(i.top+g.y)/u.y,f=i.width/u.x,h=i.height/u.y;if(l){const e=(0,r.zk)(l),n=o&&(0,r.vq)(o)?(0,r.zk)(o):o;let t=e,a=(0,r._m)(t);for(;a&&o&&n!==t;){const e=c(a),n=a.getBoundingClientRect(),o=(0,r.L9)(a),i=n.left+(a.clientLeft+parseFloat(o.paddingLeft))*e.x,s=n.top+(a.clientTop+parseFloat(o.paddingTop))*e.y;p*=e.x,v*=e.y,f*=e.x,h*=e.y,p+=i,v+=s,t=(0,r.zk)(a),a=(0,r._m)(t)}}return(0,a.B1)({width:f,height:h,x:p,y:v})}function g(e,n){const t=(0,r.CP)(e).scrollLeft;return n?n.left+t:u((0,r.ep)(e)).left+t}function p(e,n){const t=e.getBoundingClientRect();return{x:t.left+n.scrollLeft-g(e,t),y:t.top+n.scrollTop}}const v=new Set(["absolute","fixed"]);function f(e,n,t){let o;if("viewport"===n)o=function(e,n){const t=(0,r.zk)(e),a=(0,r.ep)(e),o=t.visualViewport;let i=a.clientWidth,s=a.clientHeight,c=0,l=0;if(o){i=o.width,s=o.height;const e=(0,r.Tc)();(!e||e&&"fixed"===n)&&(c=o.offsetLeft,l=o.offsetTop)}const d=g(a);if(d<=0){const e=a.ownerDocument,n=e.body,t=getComputedStyle(n),o="CSS1Compat"===e.compatMode&&parseFloat(t.marginLeft)+parseFloat(t.marginRight)||0,r=Math.abs(a.clientWidth-n.clientWidth-o);r<=25&&(i-=r)}else d<=25&&(i+=d);return{width:i,height:s,x:c,y:l}}(e,t);else if("document"===n)o=function(e){const n=(0,r.ep)(e),t=(0,r.CP)(e),o=e.ownerDocument.body,i=(0,a.T9)(n.scrollWidth,n.clientWidth,o.scrollWidth,o.clientWidth),s=(0,a.T9)(n.scrollHeight,n.clientHeight,o.scrollHeight,o.clientHeight);let c=-t.scrollLeft+g(e);const l=-t.scrollTop;return"rtl"===(0,r.L9)(o).direction&&(c+=(0,a.T9)(n.clientWidth,o.clientWidth)-i),{width:i,height:s,x:c,y:l}}((0,r.ep)(e));else if((0,r.vq)(n))o=function(e,n){const t=u(e,!0,"fixed"===n),o=t.top+e.clientTop,i=t.left+e.clientLeft,s=(0,r.sb)(e)?c(e):(0,a.Jx)(1);return{width:e.clientWidth*s.x,height:e.clientHeight*s.y,x:i*s.x,y:o*s.y}}(n,t);else{const t=d(e);o={x:n.x-t.x,y:n.y-t.y,width:n.width,height:n.height}}return(0,a.B1)(o)}function h(e,n){const t=(0,r.$4)(e);return!(t===n||!(0,r.vq)(t)||(0,r.eu)(t))&&("fixed"===(0,r.L9)(t).position||h(t,n))}function m(e,n,t){const o=(0,r.sb)(n),i=(0,r.ep)(n),s="fixed"===t,c=u(e,!0,s,n);let l={scrollLeft:0,scrollTop:0};const d=(0,a.Jx)(0);function v(){d.x=g(i)}if(o||!o&&!s)if(("body"!==(0,r.mq)(n)||(0,r.ZU)(i))&&(l=(0,r.CP)(n)),o){const e=u(n,!0,s,n);d.x=e.x+n.clientLeft,d.y=e.y+n.clientTop}else i&&v();s&&!o&&i&&v();const f=!i||o||s?(0,a.Jx)(0):p(i,l);return{x:c.left+l.scrollLeft-d.x-f.x,y:c.top+l.scrollTop-d.y-f.y,width:c.width,height:c.height}}function b(e){return"static"===(0,r.L9)(e).position}function y(e,n){if(!(0,r.sb)(e)||"fixed"===(0,r.L9)(e).position)return null;if(n)return n(e);let t=e.offsetParent;return(0,r.ep)(e)===t&&(t=t.ownerDocument.body),t}function x(e,n){const t=(0,r.zk)(e);if((0,r.Tf)(e))return t;if(!(0,r.sb)(e)){let n=(0,r.$4)(e);for(;n&&!(0,r.eu)(n);){if((0,r.vq)(n)&&!b(n))return n;n=(0,r.$4)(n)}return t}let a=y(e,n);for(;a&&(0,r.Lv)(a)&&b(a);)a=y(a,n);return a&&(0,r.eu)(a)&&b(a)&&!(0,r.sQ)(a)?t:a||(0,r.gJ)(e)||t}const w={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:n,rect:t,offsetParent:o,strategy:i}=e;const s="fixed"===i,l=(0,r.ep)(o),d=!!n&&(0,r.Tf)(n.floating);if(o===l||d&&s)return t;let g={scrollLeft:0,scrollTop:0},v=(0,a.Jx)(1);const f=(0,a.Jx)(0),h=(0,r.sb)(o);if((h||!h&&!s)&&(("body"!==(0,r.mq)(o)||(0,r.ZU)(l))&&(g=(0,r.CP)(o)),(0,r.sb)(o))){const e=u(o);v=c(o),f.x=e.x+o.clientLeft,f.y=e.y+o.clientTop}const m=!l||h||s?(0,a.Jx)(0):p(l,g);return{width:t.width*v.x,height:t.height*v.y,x:t.x*v.x-g.scrollLeft*v.x+f.x+m.x,y:t.y*v.y-g.scrollTop*v.y+f.y+m.y}},getDocumentElement:r.ep,getClippingRect:function(e){let{element:n,boundary:t,rootBoundary:o,strategy:i}=e;const s=[..."clippingAncestors"===t?(0,r.Tf)(n)?[]:function(e,n){const t=n.get(e);if(t)return t;let a=(0,r.v9)(e,[],!1).filter((e=>(0,r.vq)(e)&&"body"!==(0,r.mq)(e))),o=null;const i="fixed"===(0,r.L9)(e).position;let s=i?(0,r.$4)(e):e;for(;(0,r.vq)(s)&&!(0,r.eu)(s);){const n=(0,r.L9)(s),t=(0,r.sQ)(s);t||"fixed"!==n.position||(o=null),(i?!t&&!o:!t&&"static"===n.position&&o&&v.has(o.position)||(0,r.ZU)(s)&&!t&&h(e,s))?a=a.filter((e=>e!==s)):o=n,s=(0,r.$4)(s)}return n.set(e,a),a}(n,this._c):[].concat(t),o],c=s[0],l=s.reduce(((e,t)=>{const o=f(n,t,i);return e.top=(0,a.T9)(o.top,e.top),e.right=(0,a.jk)(o.right,e.right),e.bottom=(0,a.jk)(o.bottom,e.bottom),e.left=(0,a.T9)(o.left,e.left),e}),f(n,c,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}},getOffsetParent:x,getElementRects:async function(e){const n=this.getOffsetParent||x,t=this.getDimensions,a=await t(e.floating);return{reference:m(e.reference,await n(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:n,height:t}=i(e);return{width:n,height:t}},getScale:c,isElement:r.vq,isRTL:function(e){return"rtl"===(0,r.L9)(e).direction}};function C(e,n){return e.x===n.x&&e.y===n.y&&e.width===n.width&&e.height===n.height}function E(e,n,t,o){void 0===o&&(o={});const{ancestorScroll:i=!0,ancestorResize:c=!0,elementResize:l="function"==typeof ResizeObserver,layoutShift:d="function"==typeof IntersectionObserver,animationFrame:g=!1}=o,p=s(e),v=i||c?[...p?(0,r.v9)(p):[],...(0,r.v9)(n)]:[];v.forEach((e=>{i&&e.addEventListener("scroll",t,{passive:!0}),c&&e.addEventListener("resize",t)}));const f=p&&d?function(e,n){let t,o=null;const i=(0,r.ep)(e);function s(){var e;clearTimeout(t),null==(e=o)||e.disconnect(),o=null}return function r(c,l){void 0===c&&(c=!1),void 0===l&&(l=1),s();const d=e.getBoundingClientRect(),{left:u,top:g,width:p,height:v}=d;if(c||n(),!p||!v)return;const f={rootMargin:-(0,a.RI)(g)+"px "+-(0,a.RI)(i.clientWidth-(u+p))+"px "+-(0,a.RI)(i.clientHeight-(g+v))+"px "+-(0,a.RI)(u)+"px",threshold:(0,a.T9)(0,(0,a.jk)(1,l))||1};let h=!0;function m(n){const a=n[0].intersectionRatio;if(a!==l){if(!h)return r();a?r(!1,a):t=setTimeout((()=>{r(!1,1e-7)}),1e3)}1!==a||C(d,e.getBoundingClientRect())||r(),h=!1}try{o=new IntersectionObserver(m,{...f,root:i.ownerDocument})}catch(e){o=new IntersectionObserver(m,f)}o.observe(e)}(!0),s}(p,t):null;let h,m=-1,b=null;l&&(b=new ResizeObserver((e=>{let[a]=e;a&&a.target===p&&b&&(b.unobserve(n),cancelAnimationFrame(m),m=requestAnimationFrame((()=>{var e;null==(e=b)||e.observe(n)}))),t()})),p&&!g&&b.observe(p),b.observe(n));let y=g?u(e):null;return g&&function n(){const a=u(e);y&&!C(y,a)&&t();y=a,h=requestAnimationFrame(n)}(),t(),()=>{var e;v.forEach((e=>{i&&e.removeEventListener("scroll",t),c&&e.removeEventListener("resize",t)})),null==f||f(),null==(e=b)||e.disconnect(),b=null,g&&cancelAnimationFrame(h)}}const S=o.__,k=o.cY,A=o.RK,_=o.BN,N=o.UU,z=o.Ej,T=o.jD,I=o.UE,L=o.mG,D=o.ER,P=(e,n,t)=>{const a=new Map,r={platform:w,...t},i={...r.platform,_c:a};return(0,o.rD)(e,n,{...r,platform:i})}},6635:(e,n,t)=>{"use strict";function a(){return"undefined"!=typeof window}function o(e){return s(e)?(e.nodeName||"").toLowerCase():"#document"}function r(e){var n;return(null==e||null==(n=e.ownerDocument)?void 0:n.defaultView)||window}function i(e){var n;return null==(n=(s(e)?e.ownerDocument:e.document)||window.document)?void 0:n.documentElement}function s(e){return!!a()&&(e instanceof Node||e instanceof r(e).Node)}function c(e){return!!a()&&(e instanceof Element||e instanceof r(e).Element)}function l(e){return!!a()&&(e instanceof HTMLElement||e instanceof r(e).HTMLElement)}function d(e){return!(!a()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof r(e).ShadowRoot)}t.d(n,{$4:()=>_,CP:()=>A,L9:()=>k,Lv:()=>v,Tc:()=>C,Tf:()=>h,ZU:()=>g,_m:()=>T,ep:()=>i,eu:()=>S,gJ:()=>w,mq:()=>o,sQ:()=>x,sb:()=>l,v9:()=>z,vq:()=>c,zk:()=>r});const u=new Set(["inline","contents"]);function g(e){const{overflow:n,overflowX:t,overflowY:a,display:o}=k(e);return/auto|scroll|overlay|hidden|clip/.test(n+a+t)&&!u.has(o)}const p=new Set(["table","td","th"]);function v(e){return p.has(o(e))}const f=[":popover-open",":modal"];function h(e){return f.some((n=>{try{return e.matches(n)}catch(e){return!1}}))}const m=["transform","translate","scale","rotate","perspective"],b=["transform","translate","scale","rotate","perspective","filter"],y=["paint","layout","strict","content"];function x(e){const n=C(),t=c(e)?k(e):e;return m.some((e=>!!t[e]&&"none"!==t[e]))||!!t.containerType&&"normal"!==t.containerType||!n&&!!t.backdropFilter&&"none"!==t.backdropFilter||!n&&!!t.filter&&"none"!==t.filter||b.some((e=>(t.willChange||"").includes(e)))||y.some((e=>(t.contain||"").includes(e)))}function w(e){let n=_(e);for(;l(n)&&!S(n);){if(x(n))return n;if(h(n))return null;n=_(n)}return null}function C(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const E=new Set(["html","body","#document"]);function S(e){return E.has(o(e))}function k(e){return r(e).getComputedStyle(e)}function A(e){return c(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function _(e){if("html"===o(e))return e;const n=e.assignedSlot||e.parentNode||d(e)&&e.host||i(e);return d(n)?n.host:n}function N(e){const n=_(e);return S(n)?e.ownerDocument?e.ownerDocument.body:e.body:l(n)&&g(n)?n:N(n)}function z(e,n,t){var a;void 0===n&&(n=[]),void 0===t&&(t=!0);const o=N(e),i=o===(null==(a=e.ownerDocument)?void 0:a.body),s=r(o);if(i){const e=T(s);return n.concat(s,s.visualViewport||[],g(o)?o:[],e&&t?z(e):[])}return n.concat(o,z(o,[],t))}function T(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}},7193:(e,n,t)=>{"use strict";t.d(n,{B1:()=>L,C0:()=>f,DD:()=>r,Dz:()=>w,Jx:()=>d,LI:()=>c,PG:()=>m,RI:()=>l,Sg:()=>h,T9:()=>s,TV:()=>x,WJ:()=>E,_3:()=>v,aD:()=>S,bV:()=>T,jk:()=>i,lP:()=>z,nI:()=>I,qE:()=>p,r_:()=>a,sq:()=>b,w7:()=>C});const a=["top","right","bottom","left"],o=["start","end"],r=a.reduce(((e,n)=>e.concat(n,n+"-"+o[0],n+"-"+o[1])),[]),i=Math.min,s=Math.max,c=Math.round,l=Math.floor,d=e=>({x:e,y:e}),u={left:"right",right:"left",bottom:"top",top:"bottom"},g={start:"end",end:"start"};function p(e,n,t){return s(e,i(n,t))}function v(e,n){return"function"==typeof e?e(n):e}function f(e){return e.split("-")[0]}function h(e){return e.split("-")[1]}function m(e){return"x"===e?"y":"x"}function b(e){return"y"===e?"height":"width"}const y=new Set(["top","bottom"]);function x(e){return y.has(f(e))?"y":"x"}function w(e){return m(x(e))}function C(e,n,t){void 0===t&&(t=!1);const a=h(e),o=w(e),r=b(o);let i="x"===o?a===(t?"end":"start")?"right":"left":"start"===a?"bottom":"top";return n.reference[r]>n.floating[r]&&(i=T(i)),[i,T(i)]}function E(e){const n=T(e);return[S(e),n,S(n)]}function S(e){return e.replace(/start|end/g,(e=>g[e]))}const k=["left","right"],A=["right","left"],_=["top","bottom"],N=["bottom","top"];function z(e,n,t,a){const o=h(e);let r=function(e,n,t){switch(e){case"top":case"bottom":return t?n?A:k:n?k:A;case"left":case"right":return n?_:N;default:return[]}}(f(e),"start"===t,a);return o&&(r=r.map((e=>e+"-"+o)),n&&(r=r.concat(r.map(S)))),r}function T(e){return e.replace(/left|right|bottom|top/g,(e=>u[e]))}function I(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function L(e){const{x:n,y:t,width:a,height:o}=e;return{width:a,height:o,top:t,left:n,right:n+a,bottom:t+o,x:n,y:t}}}},a={};function o(e){var n=a[e];if(void 0!==n)return n.exports;var r=a[e]={exports:{}};return t[e](r,r.exports,o),r.exports}o.m=t,o.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return o.d(n,{a:n}),n},o.d=(e,n)=>{for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((n,t)=>(o.f[t](e,n),n)),[])),o.u=e=>e+".bundle.js",o.miniCssF=e=>{},o.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),e={},n="genesys-client:",o.l=(t,a,r,i)=>{if(e[t])e[t].push(a);else{var s,c;if(void 0!==r)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==n+r){s=u;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.setAttribute("data-webpack",n+r),s.src=t),e[t]=[a];var g=(n,a)=>{s.onerror=s.onload=null,clearTimeout(p);var o=e[t];if(delete e[t],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((e=>e(a))),n)return n(a)},p=setTimeout(g.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=g.bind(null,s.onerror),s.onload=g.bind(null,s.onload),c&&document.head.appendChild(s)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="/",(()=>{var e={730:0};o.f.j=(n,t)=>{var a=o.o(e,n)?e[n]:void 0;if(0!==a)if(a)t.push(a[2]);else{var r=new Promise(((t,o)=>a=e[n]=[t,o]));t.push(a[2]=r);var i=o.p+o.u(n),s=new Error;o.l(i,(t=>{if(o.o(e,n)&&(0!==(a=e[n])&&(e[n]=void 0),a)){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;s.message="Loading chunk "+n+" failed.\n("+r+": "+i+")",s.name="ChunkLoadError",s.type=r,s.request=i,a[1](s)}}),"chunk-"+n,n)}};var n=(n,t)=>{var a,r,[i,s,c]=t,l=0;if(i.some((n=>0!==e[n]))){for(a in s)o.o(s,a)&&(o.m[a]=s[a]);if(c)c(o)}for(n&&n(t);l<i.length;l++)r=i[l],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0},t=self.webpackChunkgenesys_client=self.webpackChunkgenesys_client||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),(()=>{"use strict";function e(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}function n(n,t){if(n){if("string"==typeof n)return e(n,t);var a={}.toString.call(n).slice(8,-1);return"Object"===a&&n.constructor&&(a=n.constructor.name),"Map"===a||"Set"===a?Array.from(n):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(n,t):void 0}}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,o,r,i,s=[],c=!0,l=!1;try{if(r=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(a=r.call(t)).done)&&(s.push(a.value),s.length!==n);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(l)throw o}}return s}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n,t,a,o,r,i){try{var s=e[r](i),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(a,o)}function r(e){return function(){var n=this,t=arguments;return new Promise((function(o,r){var i=e.apply(n,t);function s(e){a(i,o,r,s,c,"next",e)}function c(e){a(i,o,r,s,c,"throw",e)}s(void 0)}))}}var i=o(4756),s=o.n(i);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e){var n=function(e,n){if("object"!=c(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!=c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==c(n)?n:n+""}function d(e,n,t){return(n=l(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function g(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,l(a.key),a)}}function p(e,n,t){return n&&g(e.prototype,n),t&&g(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?v(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var h=function(){return p((function e(){u(this,e),this.storageKey="genesys_wizard_state",this.sessionKey="genesys_wizard_session",this.data=this.loadFromStorage()||this.getInitialState(),this.listeners=[],this.lastToastTime=0,this.data.analytics.sessionStartTime||(this.data.analytics.sessionStartTime=Date.now())}),[{key:"getInitialState",value:function(){return{currentStep:"info-basica",formData:{nombreEmpresa:"",nit:"",email:"",sector:"",ciiuSeccion:"",ciiuDivision:"",ciudad:"",cargos:[]},catalogos:{riesgos:[],gesComunes:[],sectores:[]},validation:{errors:{},touched:{},isValid:!1},analytics:{sessionStartTime:null,timeSpentPerStep:{},stepStartTime:Date.now(),errorCount:0,cargoCount:0,gesCount:0}}}},{key:"loadFromStorage",value:function(){try{var e=localStorage.getItem(this.storageKey);if(e){var n=JSON.parse(e),t=Date.now()-(n.analytics.sessionStartTime||0);if(t<864e5)return console.log("[WizardState] Loaded state from localStorage",n),n;console.log("[WizardState] Session expired, starting fresh"),localStorage.removeItem(this.storageKey)}}catch(e){console.error("[WizardState] Error loading from storage:",e),localStorage.removeItem(this.storageKey)}return null}},{key:"saveToStorage",value:function(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.data)),console.log("[WizardState] Saved to localStorage"),this.showToast("Guardado automáticamente","success")}catch(e){console.error("[WizardState] Error saving to storage:",e),this.showToast("Error al guardar","error")}}},{key:"clearStorage",value:function(){localStorage.removeItem(this.storageKey),this.data=this.getInitialState(),this.notify()}},{key:"showToast",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",t=Date.now();if("error"!==n&&t-this.lastToastTime<5e3)console.log("[WizardState] Toast throttled:",e);else{this.lastToastTime=t,document.querySelectorAll(".wizard-toast").forEach((function(e){return e.remove()}));var a=document.createElement("div");a.className="wizard-toast wizard-toast--".concat(n),a.setAttribute("role","alert"),a.setAttribute("aria-live","polite");var o="success"===n?"fa-check-circle":"error"===n?"fa-exclamation-circle":"fa-info-circle";a.innerHTML='\n      <i class="fas '.concat(o,'"></i>\n      <span>').concat(e,"</span>\n    "),document.body.appendChild(a),requestAnimationFrame((function(){a.classList.add("wizard-toast--visible")})),setTimeout((function(){a.classList.remove("wizard-toast--visible"),setTimeout((function(){a.remove()}),300)}),3e3)}}},{key:"subscribe",value:function(e){var n=this;return this.listeners.push(e),function(){n.listeners=n.listeners.filter((function(n){return n!==e}))}}},{key:"notify",value:function(){var e=this;this.listeners.forEach((function(n){try{n(e.data)}catch(e){console.error("[WizardState] Error in listener:",e)}})),this.saveToStorage()}},{key:"getCurrentStep",value:function(){return this.data.currentStep}},{key:"setCurrentStep",value:function(e){var n=this.data.currentStep,t=Date.now()-this.data.analytics.stepStartTime;this.data.analytics.timeSpentPerStep[n]||(this.data.analytics.timeSpentPerStep[n]=0),this.data.analytics.timeSpentPerStep[n]+=t,this.data.currentStep=e,this.data.analytics.stepStartTime=Date.now(),this.notify()}},{key:"validateStep",value:function(e){var n=this,t={};switch(e||this.data.currentStep){case"info-basica":(!this.data.formData.nombreEmpresa||this.data.formData.nombreEmpresa.trim().length<3)&&(t.nombreEmpresa="El nombre de la empresa debe tener al menos 3 caracteres"),this.data.formData.nit&&/^\d{9,10}$/.test(this.data.formData.nit)||(t.nit="El NIT debe tener 9 o 10 dígitos"),this.data.formData.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.data.formData.email)||(t.email="Email inválido"),this.data.formData.ciiuSeccion||(t.ciiuSeccion="Debe seleccionar una sección económica"),this.data.formData.ciiuDivision||(t.ciiuDivision="Debe seleccionar una actividad económica"),(!this.data.formData.ciudad||this.data.formData.ciudad.trim().length<2)&&(t.ciudad="Debe ingresar una ciudad");break;case"cargos":this.data.formData.cargos&&0!==this.data.formData.cargos.length||(t.cargos="Debe agregar al menos un cargo"),this.data.formData.cargos.forEach((function(e,n){(!e.nombre||e.nombre.trim().length<3)&&(t["cargo_".concat(n,"_nombre")]="El nombre del cargo debe tener al menos 3 caracteres"),(!e.numPersonas||e.numPersonas<1)&&(t["cargo_".concat(n,"_numPersonas")]="Debe haber al menos 1 persona en el cargo"),(!e.area||e.area.trim().length<2)&&(t["cargo_".concat(n,"_area")]="El área debe tener al menos 2 caracteres"),(!e.zona||e.zona.trim().length<2)&&(t["cargo_".concat(n,"_zona")]="La zona debe tener al menos 2 caracteres")}));break;case"riesgos":this.data.formData.cargos.forEach((function(e,n){e.ges&&0!==e.ges.length||(t["cargo_".concat(n,"_ges")]='El cargo "'.concat(e.nombre,'" debe tener al menos un riesgo/GES asignado'))}));break;case"niveles":this.data.formData.cargos.forEach((function(e,n){e.ges.forEach((function(e,a){var o,r,i,s,c,l,d=e.niveles;void 0!==(null===(o=d.deficiencia)||void 0===o?void 0:o.value)&&null!==(null===(r=d.deficiencia)||void 0===r?void 0:r.value)&&void 0!==(null===(i=d.exposicion)||void 0===i?void 0:i.value)&&null!==(null===(s=d.exposicion)||void 0===s?void 0:s.value)&&void 0!==(null===(c=d.consecuencia)||void 0===c?void 0:c.value)&&null!==(null===(l=d.consecuencia)||void 0===l?void 0:l.value)||(t["cargo_".concat(n,"_ges_").concat(a,"_niveles")]='Debe completar los niveles de riesgo para "'.concat(e.nombre,'"'))}))}));break;case"controles":break;case"resumen":["info-basica","cargos","riesgos","niveles"].forEach((function(e){var a=n.validateStep(e);Object.assign(t,a)}))}return this.data.validation.errors=t,this.data.validation.isValid=0===Object.keys(t).length,Object.keys(t).length>0&&this.data.analytics.errorCount++,t}},{key:"validateSingleField",value:function(e,n){switch(e){case"nombreEmpresa":if(!n||n.trim().length<3)return"El nombre de la empresa debe tener al menos 3 caracteres";if(n.trim().length>100)return"El nombre de la empresa no puede exceder 100 caracteres";break;case"nit":if(!n)return"El NIT es requerido";var t=n.replace(/[^0-9]/g,"");if(t.length<9||t.length>10)return"El NIT debe tener 9 o 10 dígitos";break;case"email":if(!n)return"El email es requerido";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n))return"Por favor ingresa un email válido (ejemplo: usuario@empresa.com)";break;case"sector":break;case"ciiuSeccion":if(!n||""===n)return"Debe seleccionar una sección económica";break;case"ciiuDivision":if(!n||""===n)return"Debe seleccionar una actividad económica";break;case"telefono":if(n&&n.length>0){var a=n.replace(/[^0-9]/g,"");if(a.length<7)return"El teléfono debe tener al menos 7 dígitos";if(a.length>15)return"El teléfono no puede exceder 15 dígitos"}break;case"direccion":if(n&&n.length>0&&n.trim().length<5)return"La dirección debe tener al menos 5 caracteres";break;case"ciudad":if(n&&n.length>0&&n.trim().length<3)return"La ciudad debe tener al menos 3 caracteres";break;default:return null}return null}},{key:"updateBasicInfo",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.data.formData[e]=n,this.data.validation.touched[e]=!0,this.saveToStorage(),t||this.notify()}},{key:"setCatalogos",value:function(e){this.data.catalogos=f(f({},this.data.catalogos),e),this.notify()}},{key:"addCargo",value:function(e){if(!this.isCargoNameUnique(e.nombre||""))return{success:!1,error:"Ya existe un cargo con ese nombre"};if(!e.nombre||e.nombre.trim().length<3)return{success:!1,error:"El nombre del cargo debe tener al menos 3 caracteres"};if(e.numPersonas<1)return{success:!1,error:"Debe haber al menos 1 persona en el cargo"};if(!e.area||e.area.trim().length<2)return{success:!1,error:"El área debe tener al menos 2 caracteres"};if(!e.zona||e.zona.trim().length<2)return{success:!1,error:"La zona debe tener al menos 2 caracteres"};var n={nombre:e.nombre,descripcion:e.descripcion||"",numPersonas:e.numPersonas||1,area:e.area||"",zona:e.zona||"",tareasRutinarias:e.tareasRutinarias||!1,manipulaAlimentos:e.manipulaAlimentos||!1,trabajaAlturas:e.trabajaAlturas||!1,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados||!1,conduceVehiculo:e.conduceVehiculo||!1,ges:[],gesSeleccionados:[]};return this.data.formData.cargos.push(n),this.data.analytics.cargoCount++,this.notify(),{success:!0,index:this.data.formData.cargos.length-1}}},{key:"isCargoNameUnique",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return!this.data.formData.cargos.some((function(t,a){return a!==n&&t.nombre.toLowerCase().trim()===e.toLowerCase().trim()}))}},{key:"updateCargo",value:function(e,n){if(e<0||e>=this.data.formData.cargos.length)return console.error("[WizardState] Invalid cargo index:",e),{success:!1,error:"Índice de cargo inválido"};if(n.nombre){if(!this.isCargoNameUnique(n.nombre,e))return{success:!1,error:"Ya existe un cargo con ese nombre"};if(n.nombre.trim().length<3)return{success:!1,error:"El nombre del cargo debe tener al menos 3 caracteres"}}return void 0!==n.numPersonas&&n.numPersonas<1?{success:!1,error:"Debe haber al menos 1 persona en el cargo"}:void 0!==n.area&&n.area.trim().length<2?{success:!1,error:"El área debe tener al menos 2 caracteres"}:void 0!==n.zona&&n.zona.trim().length<2?{success:!1,error:"La zona debe tener al menos 2 caracteres"}:(this.data.formData.cargos[e]=f(f({},this.data.formData.cargos[e]),n),this.notify(),{success:!0})}},{key:"removeCargo",value:function(e){e<0||e>=this.data.formData.cargos.length?console.error("[WizardState] Invalid cargo index:",e):(this.data.formData.cargos.splice(e,1),this.notify())}},{key:"getCargo",value:function(e){return this.data.formData.cargos[e]}},{key:"getCargos",value:function(){return this.data.formData.cargos}},{key:"addGESToCargo",value:function(e,n){if(e<0||e>=this.data.formData.cargos.length)console.error("[WizardState] Invalid cargo index:",e);else{var t=this.data.formData.cargos[e],a=t.ges.some((function(e){return e.idGes===n.idGes}));if(a)console.warn("[WizardState] GES already exists in cargo:",n.idGes);else{var o={idGes:n.idGes,nombre:n.nombre,categoria:n.categoria||"",niveles:{deficiencia:{value:null,label:"",color:"",description:""},exposicion:{value:null,label:"",color:"",description:""},consecuencia:{value:null,label:"",color:"",description:""},nivelProbabilidad:null,nivelRiesgo:null},controles:{eliminacion:"",sustitucion:"",ingenieria:"",administrativos:"",epp:""}};t.ges.push(o),this.data.analytics.gesCount++,this.notify()}}}},{key:"removeGESFromCargo",value:function(e,n){if(e<0||e>=this.data.formData.cargos.length)console.error("[WizardState] Invalid cargo index:",e);else{var t=this.data.formData.cargos[e];n<0||n>=t.ges.length?console.error("[WizardState] Invalid GES index:",n):(t.ges.splice(n,1),this.notify())}}},{key:"updateGESNiveles",value:function(e,n,t){var a,o,r,i,s,c;if(e<0||e>=this.data.formData.cargos.length)console.error("[WizardState] Invalid cargo index:",e);else{var l=this.data.formData.cargos[e];if(n<0||n>=l.ges.length)console.error("[WizardState] Invalid GES index:",n);else{var d=l.ges[n];d.niveles=f(f({},d.niveles),t),null!==(null===(a=d.niveles.deficiencia)||void 0===a?void 0:a.value)&&void 0!==(null===(o=d.niveles.deficiencia)||void 0===o?void 0:o.value)&&null!==(null===(r=d.niveles.exposicion)||void 0===r?void 0:r.value)&&void 0!==(null===(i=d.niveles.exposicion)||void 0===i?void 0:i.value)&&(d.niveles.nivelProbabilidad=d.niveles.deficiencia.value*d.niveles.exposicion.value,console.log("[WizardState] Calculated NP: ".concat(d.niveles.nivelProbabilidad))),null!==d.niveles.nivelProbabilidad&&void 0!==d.niveles.nivelProbabilidad&&null!==(null===(s=d.niveles.consecuencia)||void 0===s?void 0:s.value)&&void 0!==(null===(c=d.niveles.consecuencia)||void 0===c?void 0:c.value)&&(d.niveles.nivelRiesgo=d.niveles.nivelProbabilidad*d.niveles.consecuencia.value,console.log("[WizardState] Calculated NR: ".concat(d.niveles.nivelRiesgo))),this.notify()}}}},{key:"updateGESControles",value:function(e,n,t){if(e<0||e>=this.data.formData.cargos.length)console.error("[WizardState] Invalid cargo index:",e);else{var a=this.data.formData.cargos[e];if(n<0||n>=a.ges.length)console.error("[WizardState] Invalid GES index:",n);else{var o=a.ges[n];o.controles=f(f({},o.controles),t),this.notify()}}}},{key:"getControles",value:function(e,n){var t=this.data.formData.cargos.findIndex((function(n){return n.id===e}));if(-1===t)return console.error("[WizardState] Cargo not found:",e),null;var a=this.data.formData.cargos[t],o=a.ges.findIndex((function(e){return e.id===n}));return-1===o?(console.error("[WizardState] GES not found:",n),null):a.ges[o].controles||{}}},{key:"setControles",value:function(e,n,t){var a=this.data.formData.cargos.findIndex((function(n){return n.id===e}));if(-1!==a){var o=this.data.formData.cargos[a].ges.findIndex((function(e){return e.id===n}));-1!==o?this.updateGESControles(a,o,t):console.error("[WizardState] GES not found:",n)}else console.error("[WizardState] Cargo not found:",e)}},{key:"importFromJSON",value:function(e){var n=this,t=[];try{if(!e)return{success:!1,message:"El archivo JSON está vacío"};var a=e.userData||e,o=(e.formData||e).cargos||[];if(a.nombreEmpresa&&a.nombreEmpresa.length>=3?this.data.formData.nombreEmpresa=a.nombreEmpresa:a.nombreEmpresa&&t.push("Nombre de empresa muy corto (mínimo 3 caracteres)"),a.nit){var r=a.nit.replace(/[^0-9]/g,"");/^\d{9,10}$/.test(r)?this.data.formData.nit=r:t.push("NIT inválido (debe tener 9-10 dígitos)")}a.email&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)?this.data.formData.email=a.email:t.push("Email inválido")),a.ciiuSeccion&&(this.data.formData.ciiuSeccion=a.ciiuSeccion),a.ciiuDivision&&(this.data.formData.ciiuDivision=a.ciiuDivision),a.ciudad&&(this.data.formData.ciudad=a.ciudad),o&&0!==o.length?(this.data.formData.cargos=[],this.data.analytics.cargoCount=0,this.data.analytics.gesCount=0,o.forEach((function(e,a){var o=e.cargoName||e.nombre||"Cargo ".concat(a+1);if(o.length<3)t.push("Cargo ".concat(a+1,": nombre muy corto"));else{var r={nombre:o,descripcion:e.descripcionTareas||e.descripcion||"",numPersonas:e.numTrabajadores||e.numPersonas||1,area:e.area||"General",zona:e.zona||"Principal",tareasRutinarias:e.tareasRutinarias||!1,manipulaAlimentos:e.manipulaAlimentos||!1,trabajaAlturas:e.trabajaAlturas||!1,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados||!1,conduceVehiculo:e.conduceVehiculo||!1,ges:[],gesSeleccionados:[]},i=e.gesSeleccionados||e.ges||[];0===i.length&&t.push('Cargo "'.concat(o,'": no tiene riesgos asignados')),i.forEach((function(e,t){var o=e.ges||e.nombre||"Riesgo ".concat(t+1),i=e.riesgo||e.categoria||"Otros Riesgos",s={Físico:"Riesgo Físico",Químico:"Riesgo Químico",Biológico:"Riesgo Biológico",Biomecánico:"Riesgo Biomecánico",Psicosocial:"Riesgo Psicosocial",Mecánico:"Condiciones de Seguridad",Eléctrico:"Condiciones de Seguridad",Locativo:"Condiciones de Seguridad",Seguridad:"Condiciones de Seguridad",Natural:"Fenómenos Naturales",Tecnológico:"Riesgo Tecnológico","Riesgo Físico":"Riesgo Físico","Riesgo Químico":"Riesgo Químico","Riesgo Biológico":"Riesgo Biológico","Riesgo Biomecánico":"Riesgo Biomecánico","Riesgo Psicosocial":"Riesgo Psicosocial","Condiciones de Seguridad":"Condiciones de Seguridad","Fenómenos Naturales":"Fenómenos Naturales","Riesgo Tecnológico":"Riesgo Tecnológico"}[i]||i,l=e.niveles||{},d=function(e){return e?"number"==typeof e?e:"object"===c(e)&&void 0!==e.value?e.value:parseInt(e)||null:null},u=d(l.deficiencia)||2,g=d(l.exposicion)||2,p=d(l.consecuencia)||25,v=u*g,f={idGes:t+1e3+100*a,nombre:o,categoria:s,niveles:{ND:u,NE:g,NC:p,NP:v,NR:v*p},controles:n._parseControlesImport(e.controles)};r.ges.push(f),r.gesSeleccionados.push(f),n.data.analytics.gesCount++})),n.data.formData.cargos.push(r),n.data.analytics.cargoCount++}}))):t.push("No se encontraron cargos en el JSON"),this.saveToStorage(),this.notify();var i=this.data.formData.cargos.length,s=this.data.formData.cargos.reduce((function(e,n){return e+n.ges.length}),0);return t.length>0?{success:!0,message:"Importación completada con ".concat(t.length," advertencia(s)"),warnings:t,cargosImportados:i,gesImportados:s}:{success:!0,message:"Importación exitosa",cargosImportados:i,gesImportados:s}}catch(e){return console.error("[WizardState] Error importing JSON:",e),{success:!1,message:"Error al procesar el archivo JSON: "+e.message}}}},{key:"_parseControlesImport",value:function(e){return e?void 0!==e.fuente||void 0!==e.medio||void 0!==e.individuo?{fuente:e.fuente||"",medio:e.medio||"",individuo:e.individuo||""}:void 0!==e.eliminacion?{fuente:[e.eliminacion,e.sustitucion].filter(Boolean).join(" | ")||"",medio:e.ingenieria||"",individuo:[e.administrativos,e.epp].filter(Boolean).join(" | ")||""}:{fuente:"",medio:"",individuo:""}:{fuente:"",medio:"",individuo:""}}},{key:"_convertirControlesAGTC45",value:function(e){return e?void 0!==e.fuente?e:{fuente:[e.eliminacion,e.sustitucion].filter(Boolean).join(" | "),medio:e.ingenieria||"",individuo:[e.administrativos,e.epp].filter(Boolean).join(" | ")}:{fuente:"",medio:"",individuo:""}}},{key:"_calcularNivelProbabilidad",value:function(e,n){return("object"===c(e)?e.value:e)*("object"===c(n)?n.value:n)}},{key:"_calcularNivelRiesgo",value:function(e,n){return e*("object"===c(n)?n.value:n)}},{key:"_interpretarNivelRiesgo",value:function(e){return e>=600?{nivel:"I",significado:"No Aceptable",accion:"Intervención inmediata",color:"red"}:e>=150?{nivel:"II",significado:"No Aceptable o Aceptable con control",accion:"Corregir urgente",color:"orange"}:e>=40?{nivel:"III",significado:"Mejorable",accion:"Mejorar control",color:"yellow"}:{nivel:"IV",significado:"Aceptable",accion:"Mantener control",color:"green"}}},{key:"exportForSubmission",value:function(){var e=this;return{formData:{cargos:this.data.formData.cargos.map((function(n){return{cargoName:n.nombre,area:n.area,zona:n.zona,numTrabajadores:n.numPersonas,descripcionTareas:n.descripcion,tareasRutinarias:n.tareasRutinarias,manipulaAlimentos:n.manipulaAlimentos,trabajaAlturas:n.trabajaAlturas,trabajaEspaciosConfinados:n.trabajaEspaciosConfinados,conduceVehiculo:n.conduceVehiculo,gesSeleccionados:n.ges.map((function(n){var t=n.niveles.deficiencia,a=n.niveles.exposicion,o=n.niveles.consecuencia,r=e._calcularNivelProbabilidad(t,a),i=e._calcularNivelRiesgo(r,o),s=e._interpretarNivelRiesgo(i);return{riesgo:n.categoria,ges:n.nombre,controles:e._convertirControlesAGTC45(n.controles),niveles:{deficiencia:t,exposicion:a,consecuencia:o,nivelProbabilidad:r,nivelRiesgo:i,interpretacion:s}}}))}}))},userData:{nombreEmpresa:this.data.formData.nombreEmpresa,nit:this.data.formData.nit,email:this.data.formData.email,sector:this.data.formData.ciiuDivision||this.data.formData.sector,ciiuSeccion:this.data.formData.ciiuSeccion,ciiuDivision:this.data.formData.ciiuDivision,ciudad:this.data.formData.ciudad,nombreContacto:this.data.formData.nombreContacto||this.data.formData.email},analytics:{totalTimeSeconds:Math.floor((Date.now()-this.data.analytics.sessionStartTime)/1e3),timePerStep:this.data.analytics.timeSpentPerStep,errorCount:this.data.analytics.errorCount,cargoCount:this.data.analytics.cargoCount,gesCount:this.data.analytics.gesCount}}}},{key:"getAnalytics",value:function(){return f(f({},this.data.analytics),{},{totalTime:Date.now()-this.data.analytics.sessionStartTime,currentStepTime:Date.now()-this.data.analytics.stepStartTime})}}])}(),m=null;function b(){return m||(m=new h),m}function y(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}function x(t){return function(n){if(Array.isArray(n))return e(n)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const w=globalThis,C=w.trustedTypes,E=C?C.createPolicy("lit-html",{createHTML:e=>e}):void 0,S="$lit$",k=`lit$${Math.random().toFixed(9).slice(2)}$`,A="?"+k,_=`<${A}>`,N=document,z=()=>N.createComment(""),T=e=>null===e||"object"!=typeof e&&"function"!=typeof e,I=Array.isArray,L=e=>I(e)||"function"==typeof e?.[Symbol.iterator],D="[ \t\n\f\r]",P=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,j=/-->/g,R=/>/g,q=RegExp(`>|${D}(?:([^\\s"'>=/]+)(${D}*=${D}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),F=/'/g,G=/"/g,O=/^(?:script|style|textarea|title)$/i,M=e=>(n,...t)=>({_$litType$:e,strings:n,values:t}),B=M(1),H=(M(2),M(3),Symbol.for("lit-noChange")),$=Symbol.for("lit-nothing"),W=new WeakMap,V=N.createTreeWalker(N,129);function U(e,n){if(!I(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==E?E.createHTML(n):n}const J=(e,n)=>{const t=e.length-1,a=[];let o,r=2===n?"<svg>":3===n?"<math>":"",i=P;for(let n=0;n<t;n++){const t=e[n];let s,c,l=-1,d=0;for(;d<t.length&&(i.lastIndex=d,c=i.exec(t),null!==c);)d=i.lastIndex,i===P?"!--"===c[1]?i=j:void 0!==c[1]?i=R:void 0!==c[2]?(O.test(c[2])&&(o=RegExp("</"+c[2],"g")),i=q):void 0!==c[3]&&(i=q):i===q?">"===c[0]?(i=o??P,l=-1):void 0===c[1]?l=-2:(l=i.lastIndex-c[2].length,s=c[1],i=void 0===c[3]?q:'"'===c[3]?G:F):i===G||i===F?i=q:i===j||i===R?i=P:(i=q,o=void 0);const u=i===q&&e[n+1].startsWith("/>")?" ":"";r+=i===P?t+_:l>=0?(a.push(s),t.slice(0,l)+S+t.slice(l)+k+u):t+k+(-2===l?n:u)}return[U(e,r+(e[t]||"<?>")+(2===n?"</svg>":3===n?"</math>":"")),a]};class K{constructor({strings:e,_$litType$:n},t){let a;this.parts=[];let o=0,r=0;const i=e.length-1,s=this.parts,[c,l]=J(e,n);if(this.el=K.createElement(c,t),V.currentNode=this.el.content,2===n||3===n){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(a=V.nextNode())&&s.length<i;){if(1===a.nodeType){if(a.hasAttributes())for(const e of a.getAttributeNames())if(e.endsWith(S)){const n=l[r++],t=a.getAttribute(e).split(k),i=/([.?@])?(.*)/.exec(n);s.push({type:1,index:o,name:i[2],strings:t,ctor:"."===i[1]?ee:"?"===i[1]?ne:"@"===i[1]?te:Z}),a.removeAttribute(e)}else e.startsWith(k)&&(s.push({type:6,index:o}),a.removeAttribute(e));if(O.test(a.tagName)){const e=a.textContent.split(k),n=e.length-1;if(n>0){a.textContent=C?C.emptyScript:"";for(let t=0;t<n;t++)a.append(e[t],z()),V.nextNode(),s.push({type:2,index:++o});a.append(e[n],z())}}}else if(8===a.nodeType)if(a.data===A)s.push({type:2,index:o});else{let e=-1;for(;-1!==(e=a.data.indexOf(k,e+1));)s.push({type:7,index:o}),e+=k.length-1}o++}}static createElement(e,n){const t=N.createElement("template");return t.innerHTML=e,t}}function Y(e,n,t=e,a){if(n===H)return n;let o=void 0!==a?t._$Co?.[a]:t._$Cl;const r=T(n)?void 0:n._$litDirective$;return o?.constructor!==r&&(o?._$AO?.(!1),void 0===r?o=void 0:(o=new r(e),o._$AT(e,t,a)),void 0!==a?(t._$Co??=[])[a]=o:t._$Cl=o),void 0!==o&&(n=Y(e,o._$AS(e,n.values),o,a)),n}class Q{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:n},parts:t}=this._$AD,a=(e?.creationScope??N).importNode(n,!0);V.currentNode=a;let o=V.nextNode(),r=0,i=0,s=t[0];for(;void 0!==s;){if(r===s.index){let n;2===s.type?n=new X(o,o.nextSibling,this,e):1===s.type?n=new s.ctor(o,s.name,s.strings,this,e):6===s.type&&(n=new ae(o,this,e)),this._$AV.push(n),s=t[++i]}r!==s?.index&&(o=V.nextNode(),r++)}return V.currentNode=N,a}p(e){let n=0;for(const t of this._$AV)void 0!==t&&(void 0!==t.strings?(t._$AI(e,t,n),n+=t.strings.length-2):t._$AI(e[n])),n++}}class X{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,n,t,a){this.type=2,this._$AH=$,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=t,this.options=a,this._$Cv=a?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return void 0!==n&&11===e?.nodeType&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=Y(this,e,n),T(e)?e===$||null==e||""===e?(this._$AH!==$&&this._$AR(),this._$AH=$):e!==this._$AH&&e!==H&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):L(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==$&&T(this._$AH)?this._$AA.nextSibling.data=e:this.T(N.createTextNode(e)),this._$AH=e}$(e){const{values:n,_$litType$:t}=e,a="number"==typeof t?this._$AC(e):(void 0===t.el&&(t.el=K.createElement(U(t.h,t.h[0]),this.options)),t);if(this._$AH?._$AD===a)this._$AH.p(n);else{const e=new Q(a,this),t=e.u(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let n=W.get(e.strings);return void 0===n&&W.set(e.strings,n=new K(e)),n}k(e){I(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let t,a=0;for(const o of e)a===n.length?n.push(t=new X(this.O(z()),this.O(z()),this,this.options)):t=n[a],t._$AI(o),a++;a<n.length&&(this._$AR(t&&t._$AB.nextSibling,a),n.length=a)}_$AR(e=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Z{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,n,t,a,o){this.type=1,this._$AH=$,this._$AN=void 0,this.element=e,this.name=n,this._$AM=a,this.options=o,t.length>2||""!==t[0]||""!==t[1]?(this._$AH=Array(t.length-1).fill(new String),this.strings=t):this._$AH=$}_$AI(e,n=this,t,a){const o=this.strings;let r=!1;if(void 0===o)e=Y(this,e,n,0),r=!T(e)||e!==this._$AH&&e!==H,r&&(this._$AH=e);else{const a=e;let i,s;for(e=o[0],i=0;i<o.length-1;i++)s=Y(this,a[t+i],n,i),s===H&&(s=this._$AH[i]),r||=!T(s)||s!==this._$AH[i],s===$?e=$:e!==$&&(e+=(s??"")+o[i+1]),this._$AH[i]=s}r&&!a&&this.j(e)}j(e){e===$?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ee extends Z{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===$?void 0:e}}class ne extends Z{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==$)}}class te extends Z{constructor(e,n,t,a,o){super(e,n,t,a,o),this.type=5}_$AI(e,n=this){if((e=Y(this,e,n,0)??$)===H)return;const t=this._$AH,a=e===$&&t!==$||e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive,o=e!==$&&(t===$||a);a&&this.element.removeEventListener(this.name,this,t),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class ae{constructor(e,n,t){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=t}get _$AU(){return this._$AM._$AU}_$AI(e){Y(this,e)}}const oe={M:S,P:k,A,C:1,L:J,R:Q,D:L,V:Y,I:X,H:Z,N:ne,U:te,B:ee,F:ae},re=w.litHtmlPolyfillSupport;re?.(K,X),(w.litHtmlVersions??=[]).push("3.3.1");const ie=(e,n,t)=>{const a=t?.renderBefore??n;let o=a._$litPart$;if(void 0===o){const e=t?.renderBefore??null;a._$litPart$=o=new X(n.insertBefore(z(),e),e,void 0,t??{})}return o._$AI(e),o},se=2;class ce{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,n,t){this._$Ct=e,this._$AM=n,this._$Ci=t}_$AS(e,n){return this.update(e,n)}update(e,n){return this.render(...n)}}const{I:le}=oe,de=()=>document.createComment(""),ue=(e,n,t)=>{const a=e._$AA.parentNode,o=void 0===n?e._$AB:n._$AA;if(void 0===t){const n=a.insertBefore(de(),o),r=a.insertBefore(de(),o);t=new le(n,r,e,e.options)}else{const n=t._$AB.nextSibling,r=t._$AM,i=r!==e;if(i){let n;t._$AQ?.(e),t._$AM=e,void 0!==t._$AP&&(n=e._$AU)!==r._$AU&&t._$AP(n)}if(n!==o||i){let e=t._$AA;for(;e!==n;){const n=e.nextSibling;a.insertBefore(e,o),e=n}}}return t},ge=(e,n,t=e)=>(e._$AI(n,t),e),pe={},ve=e=>{e._$AR(),e._$AA.remove()},fe=(e,n,t)=>{const a=new Map;for(let o=n;o<=t;o++)a.set(e[o],o);return a},he=(e=>(...n)=>({_$litDirective$:e,values:n}))(class extends ce{constructor(e){if(super(e),e.type!==se)throw Error("repeat() can only be used in text expressions")}dt(e,n,t){let a;void 0===t?t=n:void 0!==n&&(a=n);const o=[],r=[];let i=0;for(const n of e)o[i]=a?a(n,i):i,r[i]=t(n,i),i++;return{values:r,keys:o}}render(e,n,t){return this.dt(e,n,t).values}update(e,[n,t,a]){const o=(e=>e._$AH)(e),{values:r,keys:i}=this.dt(n,t,a);if(!Array.isArray(o))return this.ut=i,r;const s=this.ut??=[],c=[];let l,d,u=0,g=o.length-1,p=0,v=r.length-1;for(;u<=g&&p<=v;)if(null===o[u])u++;else if(null===o[g])g--;else if(s[u]===i[p])c[p]=ge(o[u],r[p]),u++,p++;else if(s[g]===i[v])c[v]=ge(o[g],r[v]),g--,v--;else if(s[u]===i[v])c[v]=ge(o[u],r[v]),ue(e,c[v+1],o[u]),u++,v--;else if(s[g]===i[p])c[p]=ge(o[g],r[p]),ue(e,o[u],o[g]),g--,p++;else if(void 0===l&&(l=fe(i,p,v),d=fe(s,u,g)),l.has(s[u]))if(l.has(s[g])){const n=d.get(i[p]),t=void 0!==n?o[n]:null;if(null===t){const n=ue(e,o[u]);ge(n,r[p]),c[p]=n}else c[p]=ge(t,r[p]),ue(e,o[u],t),o[n]=null;p++}else ve(o[g]),g--;else ve(o[u]),u++;for(;p<=v;){const n=ue(e,c[v+1]);ge(n,r[p]),c[p++]=n}for(;u<=g;){const e=o[u++];null!==e&&ve(e)}return this.ut=i,((e,n=pe)=>{e._$AH=n})(e,c),H}});var me,be,ye,xe,we,Ce,Ee,Se,ke,Ae,_e,Ne,ze,Te,Ie,Le,De,Pe,je,Re,qe,Fe,Ge,Oe,Me,Be,He;function $e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function We(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?$e(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$e(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Ve,Ue,Je,Ke,Ye,Qe,Xe,Ze,en,nn,tn,an,on,rn,sn,cn,ln,dn,un,gn,pn,vn,fn,hn,mn,bn,yn,xn,wn,Cn,En,Sn={Mecánico:"#cbe3f3",Eléctrico:"#fee6fc",Físico:"#fdf8cd",Químico:"#c7f9ff",Biológico:"#d8fff1",Biomecánico:"#d8fff1","Factores Humanos":"#ffefd2",Psicosocial:"#e6e6e6",Locativo:"#fee6fc",Natural:"#fee6fc",Seguridad:"#fee6fc","Otros Riesgos":"#fee6fc","Saneamiento Básico":"#fee6fc","Salud Pública":"#fee6fc"},kn=function(){return p((function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(this,e),this.container="string"==typeof n?document.querySelector(n):n,!this.container)throw new Error("RiesgoSelector: Container not found");this.options=We({cargoIndex:t.cargoIndex||0,cargoNombre:t.cargoNombre||"",sector:t.sector||null,seleccionados:t.seleccionados||[],onChange:t.onChange||function(){},onDetailsLoaded:t.onDetailsLoaded||function(){}},t),this.state={vistaComunes:!0,categoriaActiva:null,busqueda:"",filtrosColapsados:!1,catalogoGES:[],catalogoRiesgos:[],gesVisible:[],seleccionados:x(this.options.seleccionados),gesDetallesCache:new Map,loadingDetalles:new Set,catalogoIncompleto:!1,categoriasFaltantes:[],gruposColapsados:new Set,carouselIndex:0,aiSuggestions:[],aiSuggestionsCache:new Map,loadingAI:!1,showAISuggestions:!0,gesRanking:new Map,loading:!1,error:null},this.debounceTimer=null,this.init()}),[{key:"init",value:(i=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.loading=!0,this.renderComponent(),e.prev=2,e.next=5,this.loadCatalogos();case 5:return e.next=7,this.validateCatalogo();case 7:return this.updateGESVisible(),e.next=10,Promise.all([this.fetchAISuggestions(),this.fetchGESRanking()]);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("Error inicializando RiesgoSelector:",e.t0),this.state.error=e.t0.message;case 16:return e.prev=16,this.state.loading=!1,this.renderComponent(),e.finish(16);case 20:case"end":return e.stop()}}),e,this,[[2,12,16,20]])}))),function(){return i.apply(this,arguments)})},{key:"validateCatalogo",value:(o=r(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/catalogo/validate-categories");case 3:if((n=e.sent).ok){e.next=7;break}return console.warn("⚠️  No se pudo validar catálogo:",n.statusText),e.abrupt("return");case 7:return e.next=9,n.json();case 9:t=e.sent,(a=t.data).ok?console.log("✅ Validación de catálogo: Todas las categorías presentes"):(this.state.catalogoIncompleto=!0,this.state.categoriasFaltantes=a.missing,console.warn("⚠️  Catálogo incompleto:",a.missing.join(", "))),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("❌ Error validando catálogo:",e.t0);case 17:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(){return o.apply(this,arguments)})},{key:"loadCatalogos",value:function(){var e=r(s().mark((function e(){var n,t,a,o,r,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("⏳ Cargando catálogos (modo ligero)..."),n=performance.now(),e.prev=2,e.next=5,fetch("/api/catalogo/riesgos");case 5:if((t=e.sent).ok){e.next=8;break}throw new Error("Error ".concat(t.status,": ").concat(t.statusText));case 8:return e.next=10,t.json();case 10:return a=e.sent,this.state.catalogoRiesgos=a.data,e.next=14,fetch("/api/catalogo/ges?fields=light&limit=200");case 14:if((o=e.sent).ok){e.next=17;break}throw new Error("Error ".concat(o.status,": ").concat(o.statusText));case 17:return e.next=19,o.json();case 19:r=e.sent,this.state.catalogoGES=r.data,i=performance.now(),c=(i-n).toFixed(2),console.log("✅ Catálogos cargados en ".concat(c,"ms (modo ligero)")),console.log("   - Riesgos: ".concat(this.state.catalogoRiesgos.length," categorías")),console.log("   - GES: ".concat(this.state.catalogoGES.length," riesgos (datos ligeros)")),console.log("   - Payload estimado: ~".concat((.2*this.state.catalogoGES.length).toFixed(1)," KB")),e.next=33;break;case 29:throw e.prev=29,e.t0=e.catch(2),console.error("❌ Error cargando catálogos:",e.t0),e.t0;case 33:case"end":return e.stop()}}),e,this,[[2,29]])})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAISuggestions",value:(a=r(s().mark((function e(){var n,t,a,o,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.options.cargoNombre,t=this.options.sector,n&&""!==n.trim()){e.next=5;break}return console.log("⚠️ Skip AI suggestions: No hay nombre de cargo"),e.abrupt("return");case 5:if(a="".concat(n.toLowerCase(),"-").concat(t||"general"),!this.state.aiSuggestionsCache.has(a)){e.next=10;break}return console.log('✅ AI suggestions en cache para "'.concat(n,'"')),this.state.aiSuggestions=this.state.aiSuggestionsCache.get(a),e.abrupt("return");case 10:return e.prev=10,this.state.loadingAI=!0,console.log('🤖 Fetch AI suggestions para cargo: "'.concat(n,'"').concat(t?" (sector: ".concat(t,")"):"")),e.next=15,fetch("/api/ia/suggest-ges",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cargoName:n,sector:t||null,limit:5})});case 15:if((o=e.sent).ok){e.next=18;break}throw new Error("Error ".concat(o.status,": ").concat(o.statusText));case 18:return e.next=20,o.json();case 20:(r=e.sent).success&&r.data?(this.state.aiSuggestions=r.data,this.state.aiSuggestionsCache.set(a,r.data),console.log("✅ AI suggestions cargadas: ".concat(r.data.length," sugerencias (confidence promedio: ").concat((null===(i=r.metadata)||void 0===i?void 0:i.avgConfidence)||"N/A",")"))):(console.warn("⚠️ No se encontraron sugerencias de IA"),this.state.aiSuggestions=[]),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(10),console.error("❌ Error fetching AI suggestions:",e.t0),this.state.aiSuggestions=[];case 28:return e.prev=28,this.state.loadingAI=!1,e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[10,24,28,31]])}))),function(){return a.apply(this,arguments)})},{key:"fetchGESRanking",value:(t=r(s().mark((function e(){var n,t,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("📊 Fetch GES ranking (frecuencia de uso)..."),e.next=4,fetch("/api/catalogo/ges?fields=ranking&limit=100");case 4:if((n=e.sent).ok){e.next=7;break}throw new Error("Error ".concat(n.status,": ").concat(n.statusText));case 7:return e.next=9,n.json();case 9:(t=e.sent).success&&t.data&&(t.data.forEach((function(e){if(e.es_comun||e.relevancia_por_sector){var n,t=(null===(n=e.relevancia_por_sector)||void 0===n?void 0:n[a.options.sector])||(e.es_comun?3:1),o=Math.min(5,Math.max(1,Math.round(t/2))),r=e.es_comun?.5*Math.random()+.5:.3*Math.random();a.state.gesRanking.set(e.id,{stars:o,frequency:Math.round(100*r),sector:a.options.sector,isCommon:e.es_comun,relevancia:e.relevancia_por_sector})}})),console.log("✅ GES ranking cargado: ".concat(this.state.gesRanking.size," GES con ranking"))),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("❌ Error fetching GES ranking:",e.t0);case 16:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return t.apply(this,arguments)})},{key:"loadGESDetails",value:(n=r(s().mark((function e(n){var t,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.gesDetallesCache.has(n)){e.next=3;break}return console.log("✅ GES ".concat(n," ya en cache, skip fetch")),e.abrupt("return",this.state.gesDetallesCache.get(n));case 3:if(!this.state.loadingDetalles.has(n)){e.next=6;break}return console.log("⏳ GES ".concat(n," ya está cargando, skip fetch")),e.abrupt("return",null);case 6:return e.prev=6,this.state.loadingDetalles.add(n),console.log("⏳ Cargando detalles de GES ".concat(n," en background...")),e.next=11,fetch("/api/catalogo/ges/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ges_ids:[n]})});case 11:if((t=e.sent).ok){e.next=14;break}throw new Error("Error ".concat(t.status,": ").concat(t.statusText));case 14:return e.next=16,t.json();case 16:if(!((a=e.sent).success&&a.data.length>0)){e.next=23;break}return o=a.data[0],this.state.gesDetallesCache.set(n,o),console.log("✅ Detalles de GES ".concat(n," cargados y cacheados")),this.options.onDetailsLoaded(o),e.abrupt("return",o);case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(6),console.error("❌ Error cargando detalles de GES ".concat(n,":"),e.t0);case 28:return e.prev=28,this.state.loadingDetalles.delete(n),e.finish(28);case 31:return e.abrupt("return",null);case 32:case"end":return e.stop()}}),e,this,[[6,25,28,31]])}))),function(e){return n.apply(this,arguments)})},{key:"preloadSelectedDetails",value:(e=r(s().mark((function e(){var n,t,a,o,r,i,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.seleccionados.map((function(e){return e.id})).filter((function(e){return!c.state.gesDetallesCache.has(e)})),0!==n.length){e.next=4;break}return console.log("✅ Todos los detalles ya están en cache"),e.abrupt("return",this.state.gesDetallesCache);case 4:return console.log("⏳ Precargando detalles de ".concat(n.length," GES en batch...")),t=performance.now(),e.prev=6,e.next=9,fetch("/api/catalogo/ges/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ges_ids:n})});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error ".concat(a.status,": ").concat(a.statusText));case 12:return e.next=14,a.json();case 14:(o=e.sent).success&&(o.data.forEach((function(e){c.state.gesDetallesCache.set(e.id,e)})),r=performance.now(),i=(r-t).toFixed(2),console.log("✅ ".concat(o.count," detalles precargados en ").concat(i,"ms")),console.log("   - Cache size: ".concat(this.state.gesDetallesCache.size," GES"))),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),console.error("❌ Error precargando detalles:",e.t0);case 21:return e.abrupt("return",this.state.gesDetallesCache);case 22:case"end":return e.stop()}}),e,this,[[6,18]])}))),function(){return e.apply(this,arguments)})},{key:"updateGESVisible",value:function(){var e=this,n=x(this.state.catalogoGES);if(this.state.vistaComunes&&(n=n.filter((function(e){return!0===e.es_comun}))),null!==this.state.categoriaActiva&&(n=n.filter((function(n){return n.riesgo_id===e.state.categoriaActiva}))),this.state.busqueda){var t=this.state.busqueda.toLowerCase();n=n.filter((function(e){var n;return e.nombre.toLowerCase().includes(t)||(null===(n=e.descripcion)||void 0===n?void 0:n.toLowerCase().includes(t))}))}this.state.gesVisible=n}},{key:"renderComponent",value:function(){var e=B(me||(me=y(['\n      <div class="riesgo-selector">\n        ',"\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n    "])),this.renderHeader(),this.renderWarningBanner(),this.renderSearch(),this.renderFilters(),this.renderAISuggestions(),this.state.loading?this.renderLoading():this.state.error?this.renderError():this.renderGESList(),this.renderFooter());ie(e,this.container)}},{key:"renderWarningBanner",value:function(){return this.state.catalogoIncompleto?B(be||(be=y(['\n      <div class="riesgo-selector__warning-banner">\n        <i class="fas fa-exclamation-triangle"></i>\n        <div class="riesgo-selector__warning-content">\n          <strong>Advertencia:</strong> El catálogo de riesgos está incompleto.\n          <br>\n          <small>\n            Categorías no disponibles: <strong>',"</strong>\n            <br>\n            Esto puede afectar el cumplimiento de la Resolución 0312 de 2019 (SST Colombia).\n            Por favor, contacte al administrador del sistema.\n          </small>\n        </div>\n      </div>\n    "])),this.state.categoriasFaltantes.join(", ")):""}},{key:"renderLoading",value:function(){var e=Array.from({length:6},(function(e,n){return n}));return B(ye||(ye=y(['\n      <div class="riesgo-selector__list">\n        ',"\n      </div>\n    "])),e.map((function(e){return B(xe||(xe=y(['\n          <div class="ges-item skeleton">\n            <div class="ges-item__content">\n              <div class="ges-item__header">\n                <span class="skeleton-text skeleton-text--title"></span>\n                <span class="skeleton-badge"></span>\n              </div>\n\n              <p class="skeleton-text skeleton-text--description"></p>\n              <p class="skeleton-text skeleton-text--description short"></p>\n\n              <div class="ges-item__meta">\n                <span class="skeleton-text skeleton-text--category"></span>\n              </div>\n            </div>\n          </div>\n        '])))})))}},{key:"renderError",value:function(){var e=this;return B(we||(we=y(['\n      <div class="riesgo-selector__error">\n        <i class="fas fa-exclamation-triangle"></i>\n        <p>Error cargando catálogo: ','</p>\n        <button class="wizard-btn wizard-btn-secondary" @click=','>\n          <i class="fas fa-redo"></i>\n          Reintentar\n        </button>\n      </div>\n    '])),this.state.error,(function(){return e.init()}))}},{key:"renderHeader",value:function(){return B(Ce||(Ce=y(['\n      <div class="riesgo-selector__header">\n        <h2>Selecciona los riesgos</h2>\n        <p class="riesgo-selector__cargo-info">\n          <i class="fas fa-briefcase"></i>\n          Cargo: <strong>',"</strong>\n        </p>\n      </div>\n    "])),this.options.cargoNombre)}},{key:"renderSearch",value:function(){var e=this;return B(Ee||(Ee=y(['\n      <div class="riesgo-selector__search">\n        <div class="search-input-wrapper">\n          <i class="fas fa-search search-icon"></i>\n          <input\n            type="text"\n            class="search-input"\n            placeholder="Buscar riesgo... (ej: ruido, posturas, caídas)"\n            .value=',"\n            @input=","\n          />\n          ","\n        </div>\n      </div>\n    "])),this.state.busqueda,(function(n){return e.handleSearch(n)}),this.state.busqueda?B(Se||(Se=y(['\n            <button class="search-clear" @click=','>\n              <i class="fas fa-times"></i>\n            </button>\n          '])),(function(){return e.handleClearSearch()})):"")}},{key:"renderFilters",value:function(){var e=this,n=this.state.catalogoRiesgos;return B(ke||(ke=y(['\n      <div class="riesgo-selector__filters-compact">\n        \x3c!-- View Toggle Switch (left) --\x3e\n        <div class="filters-view-toggle">\n          <button\n            class="view-toggle-btn ','"\n            @click=','\n            title="Mostrar riesgos comunes"\n          >\n            <i class="fas fa-star"></i>\n            <span>Comunes</span>\n          </button>\n          <button\n            class="view-toggle-btn ','"\n            @click=','\n            title="Mostrar todos los riesgos"\n          >\n            <i class="fas fa-list"></i>\n            <span>Todos (',')</span>\n          </button>\n        </div>\n\n        \x3c!-- Category Dropdown (right) --\x3e\n        <div class="filters-category-dropdown">\n          <label for="category-select">\n            <i class="fas fa-filter"></i>\n            Categoría:\n          </label>\n          <select\n            id="category-select"\n            .value=',"\n            @change=",'\n          >\n            <option value="">Todas las categorías</option>\n            ',"\n          </select>\n        </div>\n      </div>\n    "])),this.state.vistaComunes?"active":"",(function(){return e.handleToggleView("comunes")}),this.state.vistaComunes?"":"active",(function(){return e.handleToggleView("todos")}),this.state.catalogoGES.length,this.state.categoriaActiva||"",(function(n){return e.handleFilterCategory(""===n.target.value?null:parseInt(n.target.value))}),n.map((function(e){return B(Ae||(Ae=y(['\n              <option value="','">\n                ',"\n              </option>\n            "])),e.id,e.nombre)})))}},{key:"renderAISuggestions",value:function(){var e=this;if(0===this.state.aiSuggestions.length)return"";var n=this.options.cargoNombre||"este cargo",t=this.state.showAISuggestions;return B(_e||(_e=y(['\n      <div class="ai-suggestions-panel">\n        \x3c!-- Badge trigger button --\x3e\n        <button\n          class="ai-trigger-badge ','"\n          @click=','\n          title="Ver sugerencias inteligentes de IA"\n        >\n          <i class="fas fa-brain"></i>\n          <span>Sugerencias IA</span>\n          <span class="ai-badge-count">','</span>\n        </button>\n\n        \x3c!-- Overlay invisible (cierra popover al hacer clic fuera) --\x3e\n        <div\n          class="ai-popover-overlay ','"\n          @click=','\n        ></div>\n\n        \x3c!-- Popover content --\x3e\n        <div\n          class="ai-popover ','"\n          data-popover-placement="bottom"\n        >\n          \x3c!-- Arrow (decorativo) --\x3e\n          <div class="ai-popover-arrow"></div>\n\n          \x3c!-- Header --\x3e\n          <div class="ai-popover-header">\n            <h3>\n              <i class="fas fa-sparkles"></i>\n              Sugerencias para "','"\n            </h3>\n            <p class="ai-subtitle">\n              ','\n            </p>\n          </div>\n\n          \x3c!-- Body (scrollable) --\x3e\n          <div class="ai-popover-body">\n            <div class="ai-chips-container">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- Footer --\x3e\n          <div class="ai-popover-footer">\n            <p class="ai-info-text">\n              <i class="fas fa-info-circle"></i>\n              Haz clic en "Ver riesgos" para filtrar el catálogo según la sugerencia.\n            </p>\n          </div>\n        </div>\n      </div>\n    '])),t?"active":"",(function(){return e.handleToggleAISuggestions()}),this.state.aiSuggestions.length,t?"active":"",(function(){return e.handleToggleAISuggestions()}),t?"active":"",n,this.state.loadingAI?"Cargando sugerencias...":"".concat(this.state.aiSuggestions.length," riesgos recomendados"),this.state.aiSuggestions.map((function(n,t){var a=e.state.gesVisible.filter((function(e){return e.riesgo&&e.riesgo.includes(n.riesgo.replace("Riesgo ",""))})),o=a.filter((function(n){return e.state.seleccionados.some((function(e){return e.id===n.id}))})),r=a.length>0&&o.length===a.length,i=o.length>0&&!r;return B(Ne||(Ne=y(['\n                  <div\n                    class="ai-chip '," ",'"\n                  >\n                    \x3c!-- Header del chip --\x3e\n                    <div class="ai-chip-header">\n                      \x3c!-- Icon --\x3e\n                      <span class="ai-chip-icon">\n                        ','\n                      </span>\n\n                      \x3c!-- Info --\x3e\n                      <div class="ai-chip-info">\n                        <div class="ai-chip-name">','</div>\n                        <div class="ai-chip-meta">\n                          ',"\n                          ",'\n                        </div>\n                      </div>\n\n                      \x3c!-- Badge (index) --\x3e\n                      <div class="ai-chip-badge">','</div>\n                    </div>\n\n                    \x3c!-- Action button --\x3e\n                    <button\n                      class="ai-chip-action"\n                      @click=','\n                      title="Filtrar y ver riesgos de este tipo"\n                    >\n                      <i class="fas fa-filter"></i>\n                      <span>Ver riesgos</span>\n                    </button>\n                  </div>\n                '])),r?"all-selected":"",i?"partial-selected":"",e.getRiesgoIcon(n.riesgo),n.riesgo,a.length>0?B(ze||(ze=y(['\n                            <span class="ai-chip-count">'," GES disponibles</span>\n                          "])),a.length):"",n.confidence>=70?B(Te||(Te=y(['\n                            <span class="ai-confidence">\n                              <i class="fas fa-check-circle"></i>\n                              ',"% confianza\n                            </span>\n                          "])),n.confidence):"",t+1,(function(){e.handleFilterByRiesgo(n.riesgo),e.handleToggleAISuggestions()}))})))}},{key:"getRiesgoIcon",value:function(e){return{Mecánico:"⚙️",Eléctrico:"⚡",Físico:"📡",Químico:"🧪",Biológico:"🦠",Biomecánico:"🦴",Psicosocial:"🧠",Locativo:"🏢",Natural:"🌪️","Factores Humanos":"👤",Seguridad:"🛡️","Saneamiento Básico":"💧","Salud Pública":"🏥"}[e]||"📋"}},{key:"renderGESList",value:function(){var e=this;if(0===this.state.gesVisible.length)return B(Ie||(Ie=y(['\n        <div class="riesgo-selector__empty">\n          <i class="fas fa-search" style="font-size: 4rem; color: #ccc; margin-bottom: 1rem;"></i>\n          <p>No se encontraron riesgos con los filtros seleccionados</p>\n          <button class="wizard-btn wizard-btn-secondary" @click=','>\n            <i class="fas fa-times"></i>\n            Limpiar filtros\n          </button>\n        </div>\n      '])),(function(){return e.handleClearFilters()}));var n=this.groupGESByRiesgo(),t=this.state.carouselIndex,a=n.length;return t>=a&&(this.state.carouselIndex=0),B(Le||(Le=y(['\n      <div class="ges-groups-carousel-wrapper">\n        \x3c!-- Carousel container --\x3e\n        <div class="ges-groups-carousel">\n          \x3c!-- Track con transform para slide --\x3e\n          <div class="carousel-track" style="transform: translateX(-','%)">\n            ','\n          </div>\n        </div>\n\n        \x3c!-- Botones de navegación --\x3e\n        <button\n          class="carousel-nav carousel-nav-prev"\n          @click=',"\n          ?disabled=",'\n          aria-label="Riesgo anterior"\n        >\n          <i class="fas fa-chevron-left"></i>\n        </button>\n\n        <button\n          class="carousel-nav carousel-nav-next"\n          @click=',"\n          ?disabled=",'\n          aria-label="Siguiente riesgo"\n        >\n          <i class="fas fa-chevron-right"></i>\n        </button>\n\n        \x3c!-- Indicadores de progreso --\x3e\n        <div class="carousel-indicators">\n          \x3c!-- Contador numérico --\x3e\n          <div class="carousel-counter">\n            <span class="current">','</span>\n            <span class="separator"> / </span>\n            <span class="total">','</span>\n          </div>\n\n          \x3c!-- Dots indicators --\x3e\n          <div class="carousel-dots">\n            ','\n          </div>\n\n          \x3c!-- Quick jump dropdown --\x3e\n          <div class="carousel-quick-jump">\n            <label for="carousel-select">Ir a:</label>\n            <select\n              id="carousel-select"\n              .value=',"\n              @change=","\n            >\n              ","\n            </select>\n          </div>\n        </div>\n      </div>\n    "])),100*t,n.map((function(n){return e.renderGESGroup(n)})),(function(){return e.handleCarouselPrev()}),0===t,(function(){return e.handleCarouselNext()}),t>=a-1,t+1,a,n.map((function(n,a){return B(De||(De=y(['\n              <button\n                class="carousel-dot ','"\n                @click=','\n                aria-label="Ir a riesgo ','"\n              ></button>\n            '])),a===t?"active":"",(function(){return e.handleCarouselGoTo(a)}),a+1)})),t,(function(n){return e.handleCarouselGoTo(parseInt(n.target.value))}),n.map((function(e,n){return B(Pe||(Pe=y(['\n                <option value="','">\n                  ',"\n                </option>\n              "])),n,e.riesgo.nombre)})))}},{key:"renderGESGroup",value:function(e){var n=this,t=e.riesgo.nombre,a=Sn[t]||"#f0f0f0",o=this.state.gruposColapsados.has(t),r=e.ges,i=r.length,s=r.filter((function(e){return n.state.seleccionados.some((function(n){return n.id===e.id}))})).length,c=i>0&&s===i;return B(je||(je=y(['\n      <div class="ges-group" data-riesgo="','">\n        \x3c!-- Header del grupo --\x3e\n        <div class="ges-group__header" style="background-color: ','">\n          <div class="ges-group__header-left">\n            <button\n              class="ges-group__toggle"\n              @click=','\n              aria-label="'," grupo ",'"\n            >\n              <i class="fas fa-chevron-','"></i>\n            </button>\n\n            <h3 class="ges-group__title">\n              ','\n              <span class="ges-group__count">\n                (',"/",')\n              </span>\n            </h3>\n          </div>\n\n          <button\n            class="ges-group__select-all ','"\n            @click=','\n            title="','"\n          >\n            <i class="fas fa-','-circle"></i>\n            ',"\n          </button>\n        </div>\n\n        \x3c!-- Lista de GES del grupo --\x3e\n        ","\n      </div>\n    "])),t,a,(function(){return n.handleToggleGroup(t)}),o?"Expandir":"Colapsar",t,o?"right":"down",t,s,i,c?"active":"",(function(){return n.handleSelectAllInGroup(t,r)}),c?"Deseleccionar todos":"Seleccionar todos",c?"minus":"plus",c?"Deseleccionar todos":"Seleccionar todos",o?"":B(Re||(Re=y(['\n          <div class="ges-group__items">\n            ',"\n          </div>\n        "])),he(r,(function(e){return e.id}),(function(e){return n.renderGESItem(e,a)}))))}},{key:"renderGESItem",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#f0f0f0",a=this.state.seleccionados.some((function(n){return n.id===e.id})),o=this.state.catalogoRiesgos.find((function(n){return n.id===e.riesgo_id}));return B(qe||(qe=y(['\n      <label class="ges-item ','">\n        \x3c!-- 🎨 H2: Barra de color lateral (6px expandible a 8px en hover) --\x3e\n        <div class="ges-item__color-bar" style="background-color: ','"></div>\n\n        <input\n          type="checkbox"\n          class="ges-item__checkbox"\n          .checked=',"\n          @change=",'\n        />\n\n        <div class="ges-item__content">\n          <div class="ges-item__header">\n            <span class="ges-item__name">',"</span>\n            ","\n          </div>\n\n          ",'\n\n          <div class="ges-item__meta">\n            <span class="ges-item__category">\n              <i class="fas fa-tag"></i>\n              ',"\n            </span>\n          </div>\n        </div>\n\n        ","\n      </label>\n    "])),a?"selected":"",t,a,(function(t){return n.handleToggleGES(e,t)}),e.nombre,e.es_comun?B(Fe||(Fe=y(['\n              <span class="ges-item__badge">\n                <i class="fas fa-star"></i>\n                Común\n              </span>\n            ']))):"",e.descripcion?B(Ge||(Ge=y(['\n            <p class="ges-item__description">',"</p>\n          "])),e.descripcion):"",o?o.nombre:"Sin categoría",a?B(Oe||(Oe=y(['\n          <div class="ges-item__checkmark">\n            <i class="fas fa-check"></i>\n          </div>\n        ']))):"")}},{key:"renderFooter",value:function(){var e=this,n=this.state.seleccionados.length,t=this.state.gesDetallesCache.size;return B(Me||(Me=y(['\n      <div class="riesgo-selector__footer">\n        <div class="riesgo-selector__counter">\n          <i class="fas fa-check-circle"></i>\n          <span>\n            <strong>',"</strong> "," ","\n          </span>\n          ","\n        </div>\n\n        ","\n      </div>\n    "])),n,1===n?"riesgo":"riesgos",1===n?"seleccionado":"seleccionados",t>0?B(Be||(Be=y(['\n            <span class="cache-info" title="Detalles cargados en cache">\n              ('," con detalles)\n            </span>\n          "])),t):"",n>0?B(He||(He=y(['\n          <button class="wizard-btn wizard-btn-secondary" @click=','>\n            <i class="fas fa-times"></i>\n            Limpiar selección\n          </button>\n        '])),(function(){return e.handleClearSelection()})):"")}},{key:"handleToggleView",value:function(e){this.state.vistaComunes="comunes"===e,this.updateGESVisible(),this.renderComponent()}},{key:"handleFilterCategory",value:function(e){this.state.categoriaActiva=e,this.updateGESVisible(),this.renderComponent()}},{key:"handleToggleFiltros",value:function(){this.state.filtrosColapsados=!this.state.filtrosColapsados,this.renderComponent()}},{key:"handleSearch",value:function(e){var n=this,t=e.target.value;this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((function(){n.state.busqueda=t,n.updateGESVisible(),n.renderComponent()}),300)}},{key:"handleClearSearch",value:function(){this.state.busqueda="",this.updateGESVisible(),this.renderComponent()}},{key:"handleClearFilters",value:function(){this.state.categoriaActiva=null,this.state.busqueda="",this.state.vistaComunes=!0,this.updateGESVisible(),this.renderComponent()}},{key:"handleToggleAISuggestions",value:function(){this.state.showAISuggestions=!this.state.showAISuggestions,this.renderComponent()}},{key:"handleFilterByRiesgo",value:function(e){var n=this,t=this.state.catalogoRiesgos.find((function(n){return n.nombre===e||n.nombre.includes(e)}));t&&(this.state.categoriaActiva=t.id,console.log("🎯 Filtrando por riesgo: ".concat(t.nombre," (ID: ").concat(t.id,")")),this.updateGESVisible(),this.renderComponent(),setTimeout((function(){var e=n.container.querySelector(".ges-groups-carousel-wrapper");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}),100))}},{key:"handleToggleGES",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=this.state.seleccionados.some((function(n){return n.id===e.id}));if(t)this.state.seleccionados=this.state.seleccionados.filter((function(n){return n.id!==e.id}));else{var a=this.state.catalogoRiesgos.find((function(n){return n.id===e.riesgo_id})),o=We(We({},e),{},{categoria:a?a.nombre:""});this.state.seleccionados.push(o),this.loadGESDetails(e.id).catch((function(e){console.error("Error cargando detalles en background:",e)})),this.dispatchGESSelectedEvent(e,n)}this.options.onChange(this.state.seleccionados),this.renderComponent()}},{key:"dispatchGESSelectedEvent",value:function(e,n){var t,a,o=null==n||null===(t=n.target)||void 0===t||null===(a=t.closest)||void 0===a?void 0:a.call(t,".ges-item"),r=new CustomEvent("ges-selected",{bubbles:!0,detail:{ges:e,cargoIndex:this.options.cargoIndex,sourceElement:o}});this.container.dispatchEvent(r)}},{key:"handleClearSelection",value:function(){confirm("¿Estás seguro de limpiar toda la selección?")&&(this.state.seleccionados=[],this.options.onChange(this.state.seleccionados),this.renderComponent())}},{key:"getSelection",value:function(){return x(this.state.seleccionados)}},{key:"setSelection",value:function(e){this.state.seleccionados=x(e),this.renderComponent()}},{key:"getDetailsCache",value:function(){return this.state.gesDetallesCache}},{key:"groupGESByRiesgo",value:function(){var e=this,n=new Map;return this.state.gesVisible.forEach((function(t){var a=e.state.catalogoRiesgos.find((function(e){return e.id===t.riesgo_id})),o=a?a.nombre:"Sin categoría";n.has(o)||n.set(o,{riesgo:a||{nombre:"Sin categoría",id:null},ges:[]}),n.get(o).ges.push(t)})),Array.from(n.values()).sort((function(e,n){return e.riesgo.nombre.localeCompare(n.riesgo.nombre)}))}},{key:"handleToggleGroup",value:function(e){this.state.gruposColapsados.has(e)?this.state.gruposColapsados.delete(e):this.state.gruposColapsados.add(e),this.renderComponent()}},{key:"handleCarouselPrev",value:function(){this.state.carouselIndex>0&&(this.state.carouselIndex--,this.renderComponent())}},{key:"handleCarouselNext",value:function(){var e=this.groupGESByRiesgo();this.state.carouselIndex<e.length-1&&(this.state.carouselIndex++,this.renderComponent())}},{key:"handleCarouselGoTo",value:function(e){var n=this.groupGESByRiesgo();e>=0&&e<n.length&&(this.state.carouselIndex=e,this.renderComponent())}},{key:"handleSelectAllInGroup",value:function(e,n){var t=this,a=n.every((function(e){return t.state.seleccionados.some((function(n){return n.id===e.id}))}));if(a){var o=n.map((function(e){return e.id}));this.state.seleccionados=this.state.seleccionados.filter((function(e){return!o.includes(e.id)}))}else n.forEach((function(e){t.state.seleccionados.some((function(n){return n.id===e.id}))||(t.state.seleccionados.push(e),t.loadGESDetails(e.id).catch((function(e){console.error("Error cargando detalles en background:",e)})))}));this.options.onChange(this.state.seleccionados),this.renderComponent()}},{key:"destroy",value:function(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.container.innerHTML=""}}]);var e,n,t,a,o,i}();function An(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return _n(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_n(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,r=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw r}}}}function _n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}function Nn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function zn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Nn(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Nn(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Tn=function(){return p((function e(n){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(this,e),d(this,"handleCambiarFiltro",(function(e){t.isDestroyed||(t.filtroActivo=e,t.renderVistaHibrida())})),d(this,"handleCambiarAManual",(function(){t.isDestroyed||(t.modoVista="step-by-step",t.renderComponent())})),d(this,"handleValidarTodo",r(s().mark((function e(){var n,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})),!(n.length>0)){e.next=4;break}return alert("Debes revisar ".concat(n.length," riesgos antes de continuar.")),e.abrupt("return");case 4:console.log("[NivelesForm] Aplicando todas las sugerencias..."),a=s().mark((function e(){var n,a,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.sugerencias[o]).plantillaId||!n.nivelesSugeridos){e.next=12;break}if(a=t.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===n.gesId})),-1===a){e.next=12;break}return r=t.options.gesArray[a],(i=zn({},n.nivelesSugeridos)).NP=i.ND*i.NE,i.NR=i.NP*i.NC,t.options.state&&t.options.state.updateGESNiveles(t.options.cargoIndex,a,i),r.niveles=i,e.next=12,t.registrarAplicacion(n,i,i,!0);case 12:case"end":return e.stop()}}),e)})),o=0;case 7:if(!(o<t.sugerencias.length)){e.next=12;break}return e.delegateYield(a(),"t0",9);case 9:o++,e.next=7;break;case 12:t.options.onComplete();case 13:case"end":return e.stop()}}),e)})))),d(this,"handleEditarSugerencia",(function(e){var n=t.sugerencias[e],a=t.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===n.gesId}));if(-1!==a){if(n.nivelesSugeridos)t.options.gesArray[a].niveles=zn({},n.nivelesSugeridos);if(t.isDestroyed)return;t.currentGESIndex=a,t.modoVista="step-by-step",t.renderComponent(),t.scrollToTop()}})),d(this,"handleValidarSugerencia",function(){var e=r(s().mark((function e(n){var a,o,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=t.sugerencias[n]).validada=!a.validada,!(a.validada&&a.plantillaId&&a.nivelesSugeridos)){e.next=13;break}if(o=t.options.gesArray.findIndex((function(e){return(e.id_ges||e.idGes)===a.gesId})),-1===o){e.next=13;break}return r=t.options.gesArray[o],(i=zn({},a.nivelesSugeridos)).NP=i.ND*i.NE,i.NR=i.NP*i.NC,t.options.state&&t.options.state.updateGESNiveles(t.options.cargoIndex,o,i),r.niveles=i,e.next=13,t.registrarAplicacion(a,i,i,!0);case 13:t.renderVistaHibrida();case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),d(this,"handleSelectNivel",(function(e,n){if(!t.isDestroyed){console.log("[NivelesForm] Selecting ".concat(e," = ").concat(n));var a=t.options.gesArray[t.currentGESIndex];a.niveles||(a.niveles={ND:null,NE:null,NC:null,NP:null,NR:null,deficiencia:null,exposicion:null,consecuencia:null}),a.controles||(a.controles={fuente:"",medio:"",individuo:""});var o=zn(zn({},a.niveles),{},d({},e,n));null!==o.ND&&void 0!==o.ND&&null!==o.NE&&void 0!==o.NE&&(o.NP=o.ND*o.NE),null!==o.NP&&void 0!==o.NP&&null!==o.NC&&void 0!==o.NC&&(o.NR=o.NP*o.NC),"ND"===e?o.deficiencia={value:n}:"NE"===e?o.exposicion={value:n}:"NC"===e&&(o.consecuencia={value:n}),t.options.state&&t.options.state.updateGESNiveles(t.options.cargoIndex,t.currentGESIndex,o),a.niveles=o,t.options.onChange({action:"update-niveles",gesIndex:t.currentGESIndex,niveles:o}),console.log("[NivelesForm] Updated niveles:",o),t.renderComponent()}})),d(this,"handleControlChange",(function(e,n){if(!t.isDestroyed){console.log("[NivelesForm] Control change (debouncing): ".concat(e,' = "').concat(n.substring(0,30),'..."'));var a=t.options.gesArray[t.currentGESIndex];a.controles||(a.controles={fuente:"",medio:"",individuo:""}),a.controles[e]=n,t.controlChangeDebounceTimer&&clearTimeout(t.controlChangeDebounceTimer),t.controlChangeDebounceTimer=setTimeout((function(){console.log("[NivelesForm] Saving controls after debounce: ".concat(e)),t.options.state&&t.options.state.updateGESControles(t.options.cargoIndex,t.currentGESIndex,a.controles),t.options.onChange({action:"update-controles",gesIndex:t.currentGESIndex,controles:a.controles}),console.log("[NivelesForm] Controls saved successfully")}),t.controlChangeDebounceDelay)}})),d(this,"handleShowControlesHelp",(function(){alert("📋 MEDIDAS DE CONTROL - Jerarquía de Control según GTC-45\n\n✅ CONTROL EN LA FUENTE:\nActúa sobre el origen del peligro para eliminarlo o reducirlo.\nEjemplos:\n• Mantenimiento preventivo de maquinaria\n• Sustitución de materiales peligrosos por otros más seguros\n• Rediseño de procesos para eliminar riesgos\n• Instalación de guardas en equipos\n\n🏭 CONTROL EN EL MEDIO:\nActúa en el ambiente entre la fuente y el trabajador.\nEjemplos:\n• Ventilación adecuada y extracción de gases\n• Señalización de seguridad\n• Aislamiento acústico o térmico\n• Orden y aseo en áreas de trabajo\n\n👷 CONTROL EN EL INDIVIDUO:\nÚltima barrera de protección, actúa sobre el trabajador.\nEjemplos:\n• Uso de EPP (casco, guantes, tapones auditivos, gafas)\n• Capacitación y entrenamiento en seguridad\n• Rotación de personal\n• Pausas activas y exámenes médicos periódicos\n\n💡 Recuerda: La mejor estrategia es controlar en la FUENTE, luego en el MEDIO, y finalmente en el INDIVIDUO.")})),d(this,"handleLoadSugerenciasControles",function(){var e=r(s().mark((function e(n){var a,o,r,i,c,l,d,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("[NivelesForm] Cargando sugerencias para: ".concat(n.nombre)),e.next=4,fetch("/api/catalogo/ges?search=".concat(encodeURIComponent(n.nombre),"&limit=5"));case 4:return a=e.sent,e.next=7,a.json();case 7:if((o=e.sent).success&&o.data&&0!==o.data.length){e.next=11;break}return alert('No se encontraron sugerencias predefinidas para "'.concat(n.nombre,'" en la base de datos. Puedes ingresarlas manualmente.')),e.abrupt("return");case 11:if(r=o.data.find((function(e){return e.nombre.toLowerCase().trim()===n.nombre.toLowerCase().trim()})),r){e.next=15;break}return alert('No se encontró coincidencia exacta para "'.concat(n.nombre,'". Resultados similares: ').concat(o.data.map((function(e){return e.nombre})).join(", "))),e.abrupt("return");case 15:return e.next=17,fetch("/api/catalogo/ges/".concat(r.id));case 17:return i=e.sent,e.next=20,i.json();case 20:if((c=e.sent).success&&c.data){e.next=24;break}return alert('No se pudieron cargar los detalles para "'.concat(n.nombre,'".')),e.abrupt("return");case 24:if(l=c.data,d=l.medidas_intervencion){e.next=29;break}return alert('El GES "'.concat(n.nombre,'" no tiene medidas de intervención predefinidas.')),e.abrupt("return");case 29:u={fuente:d.eliminacion||"",medio:d.controles_ingenieria||"",individuo:d.controles_administrativos||""},t.options.gesArray[t.currentGESIndex].controles=u,t.options.state&&t.options.state.updateGESControles(t.options.cargoIndex,t.currentGESIndex,u),t.options.onChange({action:"update-controles",gesIndex:t.currentGESIndex,controles:u}),t.isDestroyed||t.renderComponent(),console.log("[NivelesForm] Sugerencias cargadas desde BD:",u),e.next=42;break;case 38:e.prev=38,e.t0=e.catch(0),console.error("[NivelesForm] Error al cargar sugerencias:",e.t0),t.isDestroyed||alert("Error al cargar sugerencias. Por favor, intenta nuevamente.");case 42:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(n){return e.apply(this,arguments)}}()),d(this,"handlePreviousGES",(function(){t.isDestroyed||t.isNavigating?console.log("[NivelesForm] Navigation blocked - destroyed or in progress"):t.currentGESIndex>0&&(t.isNavigating=!0,console.log("[NivelesForm] Navigating from GES ".concat(t.currentGESIndex," to ").concat(t.currentGESIndex-1)),t.currentGESIndex--,t.renderComponent(),t.scrollToTop(),setTimeout((function(){t.isNavigating=!1}),100))})),d(this,"handleNextGES",(function(){if(t.isDestroyed||t.isNavigating)console.log("[NivelesForm] Navigation blocked - destroyed or in progress");else{var e=t.options.gesArray[t.currentGESIndex];t.isGESComplete(e)?t.currentGESIndex<t.options.gesArray.length-1&&(t.isNavigating=!0,console.log("[NivelesForm] Navigating from GES ".concat(t.currentGESIndex," to ").concat(t.currentGESIndex+1)),t.currentGESIndex++,t.renderComponent(),t.scrollToTop(),setTimeout((function(){t.isNavigating=!1}),100)):alert('Por favor completa todos los niveles de riesgo (ND, NE, NC) para "'.concat(e.nombre,'" antes de continuar.'))}})),d(this,"handleComplete",(function(){if(!t.isDestroyed){console.log("[NivelesForm] handleComplete - Verificando completitud..."),console.log("[NivelesForm] gesArray:",t.options.gesArray);var e=t.options.gesArray.filter((function(e){var n=t.isGESComplete(e);return console.log('[NivelesForm] GES "'.concat(e.nombre,'":'),{niveles:e.niveles,isComplete:n}),!n}));if(e.length>0){var n=e.map((function(e){return'"'.concat(e.nombre,'"')})).join(", ");return console.error("[NivelesForm] GES incompletos:",n),void alert("Por favor completa los niveles de riesgo (ND, NE, NC) para: ".concat(n))}console.log("[NivelesForm] Todos los GES están completos. Llamando onComplete()"),t.options.onComplete()}})),d(this,"handleShowHelp",(function(e){var n={ND:'\n        <strong>Nivel de Deficiencia (ND):</strong>\n        <br><br>\n        Indica la magnitud de la relación entre el conjunto de peligros detectados y su relación causal directa con posibles incidentes.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>10 - Muy Alto:</strong> Se han detectado factores de riesgo significativos que determinan una muy alta probabilidad de generar incidentes.</li>\n          <li><strong>6 - Alto:</strong> Se han detectado factores de riesgo que pueden generar incidentes.</li>\n          <li><strong>2 - Medio:</strong> Se han detectado factores de riesgo de menor importancia.</li>\n          <li><strong>0 - Bajo:</strong> No se detectan anomalías destacables. El riesgo está controlado.</li>\n        </ul>\n      ',NE:'\n        <strong>Nivel de Exposición (NE):</strong>\n        <br><br>\n        Frecuencia con la que el trabajador está expuesto al peligro.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>10 - Continua:</strong> Exposición varias veces durante la jornada laboral con tiempos prolongados.</li>\n          <li><strong>6 - Frecuente:</strong> Exposición varias veces durante la jornada con tiempos cortos.</li>\n          <li><strong>3 - Ocasional:</strong> Exposición alguna vez durante la jornada con tiempo corto.</li>\n          <li><strong>1 - Esporádica:</strong> Exposición de forma irregular o muy ocasional.</li>\n        </ul>\n      ',NC:'\n        <strong>Nivel de Consecuencia (NC):</strong>\n        <br><br>\n        Consecuencia normalmente esperada si el riesgo se materializa.\n        <br><br>\n        <ul style="text-align: left; margin-top: 1rem;">\n          <li><strong>100 - Mortal:</strong> Consecuencias fatales, muerte de uno o más trabajadores.</li>\n          <li><strong>60 - Muy Grave:</strong> Incapacidad permanente parcial o invalidez.</li>\n          <li><strong>25 - Grave:</strong> Incapacidad temporal, lesiones con baja laboral.</li>\n          <li><strong>10 - Leve:</strong> Lesiones sin hospitalización, no requiere baja laboral.</li>\n        </ul>\n      '}[e]||"No hay ayuda disponible para este nivel.";t.showHelpModal(n)})),this.container="string"==typeof n?document.querySelector(n):n,!this.container)throw new Error("NivelesRiesgoForm: Container not found");this.options=zn({cargoIndex:a.cargoIndex||0,cargoNombre:a.cargoNombre||"",gesArray:a.gesArray||[],state:a.state||null,onChange:a.onChange||function(){},onComplete:a.onComplete||function(){}},a),this.currentGESIndex=0,this.isNavigating=!1,this.sugerencias=[],this.modoVista="loading",this.empresaId=1,this.controlChangeDebounceTimer=null,this.controlChangeDebounceDelay=1500,this.isDestroyed=!1,this.niveles={ND:[{value:1,label:"Bajo / N/A",description:"No se detectan deficiencias"},{value:2,label:"Medio",description:"Deficiencias moderadas"},{value:6,label:"Alto",description:"Deficiencias graves detectadas"},{value:10,label:"Muy Alto",description:"Deficiencias muy graves detectadas"}],NE:[{value:1,label:"Esporádica (EE)",description:"Irregularmente"},{value:2,label:"Ocasional (EO)",description:"Alguna vez durante la jornada, tiempo corto"},{value:3,label:"Frecuente (EF)",description:"Varias veces durante la jornada, tiempos cortos"},{value:4,label:"Continua (EC)",description:"Varias veces durante la jornada, tiempos prolongados"}],NC:[{value:10,label:"Leve",description:"Lesiones sin hospitalización"},{value:25,label:"Grave",description:"Incapacidad temporal"},{value:60,label:"Muy Grave",description:"Incapacidad permanente parcial o invalidez"},{value:100,label:"Mortal o Catastrófica",description:"Muerte(s)"}]},this.init()}),[{key:"init",value:(t=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDestroyed){e.next=2;break}return e.abrupt("return");case 2:if(0!==this.options.gesArray.length){e.next=5;break}return this.renderEmpty(),e.abrupt("return");case 5:return e.next=7,this.loadSugerencias();case 7:if(!this.isDestroyed){e.next=10;break}return console.log("[NivelesForm] Componente destruido durante init, abortando render"),e.abrupt("return");case 10:this.sugerencias.length>0?(this.modoVista="hybrid",this.renderVistaHibrida()):(this.modoVista="step-by-step",this.renderComponent());case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"loadSugerencias",value:(n=r(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("[NivelesForm] Cargando sugerencias de plantillas..."),n=this.options.gesArray.map((function(e){return{id_ges:e.id_ges||e.idGes,nombre:e.nombre,categoria:e.categoria,descripcion:e.descripcion}})),e.next=5,fetch("/api/plantillas-niveles/sugerir",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({empresa_id:this.empresaId,gesArray:n})});case 5:return t=e.sent,e.next=8,t.json();case 8:(a=e.sent).success?(this.sugerencias=a.sugerencias||[],console.log("[NivelesForm] ✅ ".concat(this.sugerencias.length," sugerencias cargadas")),console.log("[NivelesForm] Stats:",a.stats)):(console.warn("[NivelesForm] Error al cargar sugerencias:",a.message),this.sugerencias=[]),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("[NivelesForm] Error al cargar sugerencias:",e.t0),this.sugerencias=[];case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return n.apply(this,arguments)})},{key:"renderVistaHibrida",value:function(){var e=this;if(!this.isDestroyed&&this.container&&this.container.isConnected&&this.container.parentNode){var n=this.sugerencias.filter((function(e){return!e.requiereRevision&&e.plantillaId})),t=this.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})),a=B(Ve||(Ve=y(['\n      <div class="niveles-vista-hibrida">\n        \x3c!-- Header --\x3e\n        <div class="niveles-hibrida__header">\n          <h2>🧠 Configuración Inteligente de Niveles</h2>\n          <p class="niveles-hibrida__subtitle">\n            Hemos pre-configurado los niveles basándonos en plantillas de tu empresa.\n            Revisa y valida las sugerencias.\n          </p>\n        </div>\n\n        \x3c!-- Stats Cards --\x3e\n        <div class="niveles-hibrida__stats">\n          <div class="stat-card stat-card--success">\n            <i class="fas fa-check-circle"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">','</span>\n              <span class="stat-card__label">Auto-aprobables</span>\n            </div>\n          </div>\n          <div class="stat-card stat-card--warning">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">','</span>\n              <span class="stat-card__label">Requieren revisión</span>\n            </div>\n          </div>\n          <div class="stat-card stat-card--info">\n            <i class="fas fa-clock"></i>\n            <div class="stat-card__content">\n              <span class="stat-card__number">~',' min</span>\n              <span class="stat-card__label">Tiempo ahorrado</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Filter Tabs --\x3e\n        <div class="niveles-hibrida__filters">\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-list"></i>\n            Todas (',')\n          </button>\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-flag"></i>\n            Solo Revisión (',')\n          </button>\n          <button\n            class="filter-tab ','"\n            @click=','\n          >\n            <i class="fas fa-magic"></i>\n            Auto-aprobables (',')\n          </button>\n        </div>\n\n        \x3c!-- Tabla de Sugerencias --\x3e\n        <div class="niveles-hibrida__table-container">\n          <table class="niveles-hibrida__table">\n            <thead>\n              <tr>\n                <th>GES / Riesgo</th>\n                <th>Categoría</th>\n                <th>ND</th>\n                <th>NE</th>\n                <th>NC</th>\n                <th>NP</th>\n                <th>NR</th>\n                <th>Nivel</th>\n                <th>Confianza</th>\n                <th>Acciones</th>\n              </tr>\n            </thead>\n            <tbody>\n              ','\n            </tbody>\n          </table>\n        </div>\n\n        \x3c!-- Actions --\x3e\n        <div class="niveles-hibrida__actions">\n          <button\n            class="wizard-btn wizard-btn-secondary"\n            @click=','\n          >\n            <i class="fas fa-edit"></i>\n            Configurar Manualmente\n          </button>\n\n          <button\n            class="wizard-btn wizard-btn-success"\n            @click=',"\n            ?disabled=",'\n          >\n            <i class="fas fa-check-double"></i>\n            Validar Todo y Continuar\n          </button>\n        </div>\n\n        ',"\n      </div>\n    "])),n.length,t.length,Math.round(.5*this.sugerencias.length),"todas"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("todas")}),this.sugerencias.length,"revision"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("revision")}),t.length,"auto"===this.filtroActivo?"active":"",(function(){return e.handleCambiarFiltro("auto")}),n.length,this.getSugerenciasFiltradas().map((function(n,t){return e.templateFilaSugerencia(n,t)})),(function(){return e.handleCambiarAManual()}),(function(){return e.handleValidarTodo()}),t.length>0,t.length>0?B(Ue||(Ue=y(['\n          <div class="niveles-hibrida__help">\n            <i class="fas fa-info-circle"></i>\n            <p>\n              <strong>Atención:</strong> Hay '," riesgos que requieren revisión manual\n              (riesgos críticos o plantillas nuevas). Revisa cada uno antes de continuar.\n            </p>\n          </div>\n        "])),t.length):"");try{ie(a,this.container)}catch(e){console.error("[NivelesForm] Error en renderVistaHibrida:",e.message),this.isDestroyed=!0}}else console.log("[NivelesForm] renderVistaHibrida abortado - componente no válido")}},{key:"templateFilaSugerencia",value:function(e,n){var t,a,o,r=this,i=e.nivelesSugeridos||{},s=i.ND&&i.NE?i.ND*i.NE:null,c=s&&i.NC?s*i.NC:null,l=this.interpretarNR(c),d=e.requiereRevision?"fila-sugerencia fila-sugerencia--revision":e.plantillaId?"fila-sugerencia fila-sugerencia--auto":"fila-sugerencia fila-sugerencia--manual";return B(Je||(Je=y(['\n      <tr class="','">\n        <td class="td-ges">\n          <strong>',"</strong>\n          ",'\n        </td>\n        <td class="td-categoria">\n          <span class="categoria-badge">','</span>\n        </td>\n        <td class="td-nivel">','</td>\n        <td class="td-nivel">','</td>\n        <td class="td-nivel">','</td>\n        <td class="td-np">\n          <strong>','</strong>\n        </td>\n        <td class="td-nr">\n          <strong>','</strong>\n        </td>\n        <td class="td-interpretacion">\n          ','\n        </td>\n        <td class="td-confianza">\n          ','\n        </td>\n        <td class="td-acciones">\n          ',"\n        </td>\n      </tr>\n    "])),d,e.gesNombre,e.plantillaId?"":B(Ke||(Ke=y(['\n            <span class="badge badge--warning">Sin plantilla</span>\n          ']))),e.gesCategoria,null!==(t=i.ND)&&void 0!==t?t:"—",null!==(a=i.NE)&&void 0!==a?a:"—",null!==(o=i.NC)&&void 0!==o?o:"—",null!=s?s:"—",null!=c?c:"—",l.texto?B(Ye||(Ye=y(['\n            <span class="nivel-badge nivel-badge--','">\n              '," ","\n            </span>\n          "])),l.clase,l.emoji||"",l.texto):"—",e.plantillaId?B(Qe||(Qe=y(['\n            <div class="confianza-bar">\n              <div\n                class="confianza-bar__fill"\n                style="width: ','%"\n              ></div>\n              <span class="confianza-bar__text">',"%</span>\n            </div>\n          "])),(100*e.confianza).toFixed(0),(100*e.confianza).toFixed(0)):"—",e.plantillaId?B(Xe||(Xe=y(['\n            <button\n              class="btn-accion btn-accion--edit"\n              @click=','\n              title="Editar niveles"\n            >\n              <i class="fas fa-edit"></i>\n            </button>\n            <button\n              class="btn-accion btn-accion--check ','"\n              @click=','\n              title="','"\n            >\n              <i class="fas ','"></i>\n            </button>\n          '])),(function(){return r.handleEditarSugerencia(n)}),e.validada?"validada":"",(function(){return r.handleValidarSugerencia(n)}),e.validada?"Validado":"Validar",e.validada?"fa-check-circle":"fa-check"):B(Ze||(Ze=y(['\n            <button\n              class="btn-accion btn-accion--edit"\n              @click=','\n              title="Configurar manualmente"\n            >\n              <i class="fas fa-cog"></i>\n            </button>\n          '])),(function(){return r.handleEditarSugerencia(n)})))}},{key:"getSugerenciasFiltradas",value:function(){return this.filtroActivo&&"todas"!==this.filtroActivo?"revision"===this.filtroActivo?this.sugerencias.filter((function(e){return e.requiereRevision||!e.plantillaId})):"auto"===this.filtroActivo?this.sugerencias.filter((function(e){return!e.requiereRevision&&e.plantillaId})):this.sugerencias:this.sugerencias}},{key:"registrarAplicacion",value:(e=r(s().mark((function e(n,t,a,o){var r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/plantillas-niveles/aplicar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plantillaId:n.plantillaId,gesId:n.gesId,cargoId:this.options.cargoIndex,nivelesSugeridos:t,nivelesFinales:a,justificacionAjuste:o?null:"Ajuste manual del usuario"})});case 3:return r=e.sent,e.next=6,r.json();case 6:(i=e.sent).success?console.log("[NivelesForm] ✅ Aplicación registrada para aprendizaje"):console.warn("[NivelesForm] Error al registrar aplicación:",i.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("[NivelesForm] Error al registrar aplicación:",e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(n,t,a,o){return e.apply(this,arguments)})},{key:"renderComponent",value:function(){if(this.isDestroyed)console.log("[NivelesForm] Render abortado - componente destruido");else if(this.container)if(this.container.isConnected)if(this.container.parentNode){var e=this.options.gesArray[this.currentGESIndex],n=this.options.gesArray.length,t=B(en||(en=y(['\n      <div class="niveles-form">\n        ',"\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n    "])),this.templateCompactHeader(e,this.currentGESIndex+1,n),this.templateGESInfo(e),this.templateNivelSection("ND","Nivel de Deficiencia",e),this.templateNivelSection("NE","Nivel de Exposición",e),this.templateNivelSection("NC","Nivel de Consecuencia",e),this.templateControlesSection(e),this.templateCalculator(e),this.templateNavigation(this.currentGESIndex,n));try{ie(t,this.container)}catch(e){console.error("[NivelesForm] Error en lit-html render:",e.message),this.isDestroyed=!0}}else console.log("[NivelesForm] Render abortado - container sin parentNode");else console.log("[NivelesForm] Render abortado - container desconectado del DOM");else console.log("[NivelesForm] Render abortado - container es null")}},{key:"templateCompactHeader",value:function(e,n,t){var a=this,o=this.options.gesArray.filter((function(e){return a.isGESComplete(e)})).length,r=t>0?Math.round(o/t*100):0,i=2*Math.PI*22,s="".concat(r/100*i," ").concat(i);return B(nn||(nn=y(['\n      <div class="niveles-form__header-compact">\n        <div class="niveles-form__header-left">\n          <h2>\n            <i class="fas fa-chart-bar"></i>\n            Niveles y Controles\n          </h2>\n          <p class="cargo-info-inline">\n            <i class="fas fa-briefcase"></i>\n            <strong>',"</strong>\n            <span>• Riesgo "," de ",'</span>\n          </p>\n        </div>\n        \n        <div class="niveles-form__header-right">\n          <div class="niveles-form__progress-mini">\n            <div class="progress-circle">\n              <svg viewBox="0 0 50 50">\n                <circle class="track" cx="25" cy="25" r="22"></circle>\n                <circle class="fill" cx="25" cy="25" r="22" \n                  stroke-dasharray="','"></circle>\n              </svg>\n              <div class="progress-number">\n                <span>',"</span>\n                <small>/",'</small>\n              </div>\n            </div>\n            <div class="progress-label">\n              <strong>',"%</strong>\n              completado\n            </div>\n          </div>\n        </div>\n      </div>\n    "])),this.options.cargoNombre,n,t,s,o,t,r)}},{key:"templateHeader",value:function(e,n,t){return this.templateCompactHeader(e,n,t)}},{key:"templateProgressIndicator",value:function(){return""}},{key:"templateGESInfo",value:function(e){var n=this.isGESComplete(e);return B(tn||(tn=y(['\n      <div class="niveles-form__ges-card">\n        <div class="ges-card__header">\n          <h3 class="ges-card__name">\n            <i class="fas fa-exclamation-triangle"></i>\n            ',"\n          </h3>\n          ","\n        </div>\n        ",'\n        <div class="ges-card__meta">\n          <span class="ges-card__category">\n            <i class="fas fa-tag"></i>\n            ',"\n          </span>\n        </div>\n      </div>\n    "])),e.nombre,B(n?an||(an=y(['\n            <span class="ges-card__badge ges-card__badge--complete">\n              <i class="fas fa-check-circle"></i>\n              Completo\n            </span>\n          '])):on||(on=y(['\n            <span class="ges-card__badge ges-card__badge--incomplete">\n              <i class="fas fa-clock"></i>\n              Pendiente\n            </span>\n          ']))),e.descripcion?B(rn||(rn=y(['\n          <p class="ges-card__description">',"</p>\n        "])),e.descripcion):"",e.categoria||"Sin categoría")}},{key:"templateNivelSection",value:function(e,n,t){var a,o,r=this,i=this.niveles[e],s=null!==(a=null===(o=t.niveles)||void 0===o?void 0:o[e])&&void 0!==a?a:null;return B(sn||(sn=y(['\n      <div class="niveles-form__section">\n        <div class="nivel-section__header">\n          <h3 class="nivel-section__title">\n            <span class="nivel-badge">',"</span>\n            ",'\n          </h3>\n          <button\n            class="nivel-section__help"\n            @click=','\n            title="Ayuda sobre ','"\n          >\n            <i class="fas fa-question-circle"></i>\n          </button>\n        </div>\n\n        <div class="nivel-bar">\n          ',"\n        </div>\n      </div>\n    "])),e,n,(function(){return r.handleShowHelp(e)}),n,i.map((function(n){return r.templateNivelOption(e,n,s)})))}},{key:"templateNivelOption",value:function(e,n,t){var a=this,o=t===n.value,r=this.getNivelColor(e,n.value);return B(cn||(cn=y(['\n      <button\n        class="nivel-option ','"\n        data-value="','"\n        @click=','\n        style="--nivel-color: ','"\n        title="',": ",'"\n      >\n        <span class="nivel-option__label">','</span>\n        <span class="nivel-option__value">',"</span>\n        ","\n      </button>\n    "])),o?"nivel-option--selected":"",n.value,(function(){return a.handleSelectNivel(e,n.value)}),r,n.label,n.description,n.label,n.value,o?B(ln||(ln=y(['<span class="nivel-option__check"><i class="fas fa-check-circle"></i></span>']))):"")}},{key:"getNivelColor",value:function(e,n){var t,a=null===(t={ND:{1:"#4caf50",2:"#ffeb3b",6:"#ff9800",10:"#f44336"},NE:{1:"#4caf50",2:"#ffeb3b",3:"#ff9800",4:"#f44336"},NC:{10:"#4caf50",25:"#ffeb3b",60:"#ff9800",100:"#f44336"}}[e])||void 0===t?void 0:t[n];return console.log("🎨 getNivelColor(".concat(e,", ").concat(n,") = ").concat(a)),a||"#999"}},{key:"getNivelEmoji",value:function(e,n){var t;return(null===(t={ND:{0:"🟢",2:"🟡",6:"🟠",10:"🔴"},NE:{1:"🟢",2:"🟡",3:"🟠",4:"🔴"},NC:{10:"🟢",25:"🟡",60:"🟠",100:"🔴"}}[e])||void 0===t?void 0:t[n])||"⚪"}},{key:"findControlesFromOtherCargo",value:function(e){if(!this.options.state)return null;for(var n=this.options.state.getCargos(),t=(e.nombre||e.ges||"").trim().toLowerCase(),a=e.id_ges||e.idGes||e.id,o=0;o<n.length;o++)if(o!==this.options.cargoIndex){var r=n[o],i=r.gesSeleccionados||r.ges||[];if(Array.isArray(i)){var s,c=An(i);try{for(c.s();!(s=c.n()).done;){var l=s.value,d=l.id_ges||l.idGes||l.id,u=(l.nombre||l.ges||"").trim().toLowerCase();if((a&&d&&a===d||t&&u&&t===u)&&l.controles)if(l.controles.fuente||l.controles.medio||l.controles.individuo)return console.log('[NivelesForm] ✅ Autocompletando controles de "'.concat(e.nombre,'" desde cargo: ').concat(r.nombre)),zn({},l.controles)}}catch(e){c.e(e)}finally{c.f()}}}return null}},{key:"templateControlesSection",value:function(e){var n=this,t=null,a=!1;e.controles&&(e.controles.fuente||e.controles.medio||e.controles.individuo)||(t=this.findControlesFromOtherCargo(e))&&(e.controles={fuente:t.fuente||"",medio:t.medio||"",individuo:t.individuo||""},a=!0),e.controles||(e.controles={fuente:"",medio:"",individuo:""});var o=e.controles,r=o.fuente,i=void 0===r?"":r,s=o.medio,c=void 0===s?"":s,l=o.individuo,d=void 0===l?"":l;return B(dn||(dn=y(['\n      <div class="controles-section">\n        <div class="controles-section__header">\n          <h3 class="controles-section__title">\n            <i class="fas fa-shield-alt"></i>\n            Controles Existentes\n          </h3>\n          ','\n        </div>\n\n        <p class="controles-section__description">\n          Indique los controles que la empresa <strong>YA tiene implementados</strong> para este riesgo (GTC-45)\n        </p>\n\n        <div class="controles-grid">\n          \x3c!-- Control en la FUENTE --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-tools"></i>\n              Control en la FUENTE\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Mantenimiento preventivo de maquinaria, sustitución de materiales peligrosos..."\n              rows="3"\n              .value=',"\n              @input=",'\n            ></textarea>\n          </div>\n\n          \x3c!-- Control en el MEDIO --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-warehouse"></i>\n              Control en el MEDIO\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Ventilación adecuada, señalización de seguridad, aislamiento acústico..."\n              rows="3"\n              .value=',"\n              @input=",'\n            ></textarea>\n          </div>\n\n          \x3c!-- Control en el INDIVIDUO --\x3e\n          <div class="control-field">\n            <label class="control-field__label">\n              <i class="fas fa-user-shield"></i>\n              Control en el INDIVIDUO\n            </label>\n            <textarea\n              class="control-field__textarea"\n              placeholder="Ej: Uso de EPP (casco, guantes, tapones auditivos), capacitación en seguridad..."\n              rows="3"\n              .value=',"\n              @input=","\n            ></textarea>\n          </div>\n        </div>\n      </div>\n    "])),a?B(un||(un=y(['\n            <div class="autocompletado-badge">\n              <i class="fas fa-copy"></i>\n              Autocompletado desde otro cargo\n            </div>\n          ']))):"",i,(function(e){return n.handleControlChange("fuente",e.target.value)}),c,(function(e){return n.handleControlChange("medio",e.target.value)}),d,(function(e){return n.handleControlChange("individuo",e.target.value)}))}},{key:"templateCalculator",value:function(e){var n=e.niveles||{},t=n.ND,a=n.NE,o=n.NC,r=null!=t&&null!=a?t*a:null,i=null!==r&&null!=o?r*o:null,s=this.interpretarNP(r),c=this.interpretarNR(i);return B(gn||(gn=y(['\n      <div class="niveles-form__calculator">\n        <h3 class="calculator__title">\n          <i class="fas fa-calculator"></i>\n          Resultados del Cálculo\n        </h3>\n\n        <div class="calculator__grid">\n          \x3c!-- NP (Nivel de Probabilidad) --\x3e\n          <div class="calculator__result">\n            <div class="calculator__formula">\n              <span class="formula-label">NP</span>\n              <span class="formula-equation">=</span>\n              <span class="formula-part">ND (',')</span>\n              <span class="formula-operator">×</span>\n              <span class="formula-part">NE (',')</span>\n            </div>\n            <div class="calculator__value ','">\n              <span class="value-number">','</span>\n              <span class="value-label">Nivel de Probabilidad</span>\n            </div>\n            ','\n          </div>\n\n          \x3c!-- NR (Nivel de Riesgo) --\x3e\n          <div class="calculator__result">\n            <div class="calculator__formula">\n              <span class="formula-label">NR</span>\n              <span class="formula-equation">=</span>\n              <span class="formula-part">NP (',')</span>\n              <span class="formula-operator">×</span>\n              <span class="formula-part">NC (',')</span>\n            </div>\n            <div class="calculator__value ','">\n              <span class="value-number">','</span>\n              <span class="value-label">Nivel de Riesgo</span>\n            </div>\n            ',"\n          </div>\n        </div>\n      </div>\n    "])),null!=t?t:"?",null!=a?a:"?",s.clase,null!=r?r:"—",s.texto?B(pn||(pn=y(['\n              <div class="calculator__interpretation ','">\n                <i class="fas ','"></i>\n                <span>',"</span>\n              </div>\n            "])),s.clase,s.icono,s.texto):"",null!=r?r:"?",null!=o?o:"?",c.clase,null!=i?i:"—",c.texto?B(vn||(vn=y(['\n              <div class="calculator__interpretation ','">\n                <i class="fas ','"></i>\n                <div>\n                  <strong>',"</strong>\n                  <p>","</p>\n                </div>\n              </div>\n            "])),c.clase,c.icono,c.texto,c.descripcion):"")}},{key:"templateNavigation",value:function(e,n){var t=this,a=e>0,o=e<n-1,r=this.isGESComplete(this.options.gesArray[e]),i=this.areAllGESComplete(),s=this.getNextPendingCargoInfo(),c=!s.hasMoreCargos,l=s.allCargosComplete,d="Finalizar Configuración",u="fa-check";return!c&&i?(d="Siguiente: ".concat(s.nextCargoName),u="fa-arrow-right"):l&&(d="Terminar Configuración",u="fa-check-double"),B(fn||(fn=y(['\n      \x3c!-- Navegación tradicional (bottom sticky) --\x3e\n      <div class="niveles-form__navigation">\n        <button\n          class="wizard-btn wizard-btn-secondary"\n          ?disabled=',"\n          @click=",'\n        >\n          <i class="fas fa-chevron-left"></i>\n          Riesgo Anterior\n        </button>\n\n        <div class="navigation__info">\n          ',"\n        </div>\n\n        ","\n      </div>\n\n      \x3c!-- FAB Navigation (flotante - solo en desktop con más de 1 riesgo) --\x3e\n      ","\n    "])),!a,(function(){return t.handlePreviousGES()}),r?"":B(hn||(hn=y(['\n            <p class="navigation__warning">\n              <i class="fas fa-exclamation-circle"></i>\n              Completa los 3 niveles de riesgo (ND, NE, NC) para continuar\n            </p>\n          ']))),o?B(mn||(mn=y(['\n          <button\n            class="wizard-btn wizard-btn-primary"\n            ?disabled=',"\n            @click=",'\n          >\n            Siguiente Riesgo\n            <i class="fas fa-chevron-right"></i>\n          </button>\n        '])),!r,(function(){return t.handleNextGES()})):B(bn||(bn=y(['\n          <button\n            class="wizard-btn ','"\n            ?disabled=',"\n            @click=",'\n          >\n            <i class="fas ','"></i>\n            ',"\n          </button>\n        "])),l?"wizard-btn-success":"wizard-btn-primary",!i,(function(){return t.handleComplete()}),u,d),n>1?B(yn||(yn=y(['\n        <div class="wizard-fab-nav">\n          ',"\n\n          ","\n        </div>\n      "])),a?B(xn||(xn=y(['\n            <button\n              class="wizard-fab wizard-fab--secondary"\n              data-tooltip="Riesgo Anterior"\n              @click=','\n              aria-label="Ir al riesgo anterior"\n            >\n              <i class="fas fa-chevron-left"></i>\n            </button>\n          '])),(function(){return t.handlePreviousGES()})):"",o?B(wn||(wn=y(['\n            <button\n              class="wizard-fab"\n              data-tooltip="','"\n              ?disabled=',"\n              @click=",'\n              aria-label="Ir al siguiente riesgo"\n            >\n              <i class="fas fa-chevron-right"></i>\n              ',"\n            </button>\n          "])),r?"Siguiente Riesgo":"Completa este riesgo primero",!r,(function(){return t.handleNextGES()}),e+1<n?B(Cn||(Cn=y(['\n                <span class="wizard-fab__badge">',"</span>\n              "])),e+2):""):""):"")}},{key:"getNextPendingCargoInfo",value:function(){var e;if(!this.options.state)return{hasMoreCargos:!1,nextCargoName:"",allCargosComplete:!1};for(var n=this.options.state.getCargos(),t=this.options.cargoIndex,a=null,o=!0,r=0;r<n.length;r++){var i=n[r],s=i.gesSeleccionados||i.ges||[];!(s.length>0&&s.every((function(e){var n=e.niveles||{};return null!==n.ND&&void 0!==n.ND&&null!==n.NE&&void 0!==n.NE&&null!==n.NC&&void 0!==n.NC})))&&s.length>0&&(o=!1,r>t&&!a&&(a=i))}return{hasMoreCargos:null!==a,nextCargoName:(null===(e=a)||void 0===e?void 0:e.nombre)||"",allCargosComplete:o}}},{key:"showHelpModal",value:function(e){var n=document.createElement("div");n.className="niveles-help-modal",n.innerHTML='\n      <div class="help-modal__overlay"></div>\n      <div class="help-modal__content">\n        <button class="help-modal__close">\n          <i class="fas fa-times"></i>\n        </button>\n        <div class="help-modal__body">\n          '.concat(e,"\n        </div>\n      </div>\n    "),document.body.appendChild(n);var t=function(){return n.remove()};n.querySelector(".help-modal__overlay").addEventListener("click",t),n.querySelector(".help-modal__close").addEventListener("click",t)}},{key:"isGESComplete",value:function(e){var n=e.niveles||{},t=n.ND,a=n.NE,o=n.NC;return null!=t&&null!=a&&null!=o}},{key:"areAllGESComplete",value:function(){var e=this;return this.options.gesArray.every((function(n){return e.isGESComplete(n)}))}},{key:"interpretarNP",value:function(e){return null==e?{texto:"",clase:"",icono:"",descripcion:""}:e>=40?{texto:"Muy Alto",clase:"risk-muy-alto",icono:"fa-exclamation-triangle",descripcion:"Situación crítica. Corrección urgente."}:e>=20?{texto:"Alto",clase:"risk-alto",icono:"fa-exclamation-circle",descripcion:"Corregir y adoptar medidas de control."}:e>=8?{texto:"Medio",clase:"risk-medio",icono:"fa-info-circle",descripcion:"Mejorar si es posible."}:{texto:"Bajo",clase:"risk-bajo",icono:"fa-check-circle",descripcion:"Mantener las medidas de control existentes."}}},{key:"interpretarNR",value:function(e){return null==e?{texto:"",clase:"",icono:"",descripcion:""}:e>=600?{texto:"I - No Aceptable",clase:"risk-muy-alto",icono:"fa-ban",descripcion:"Situación crítica. Suspender actividades hasta controlar el riesgo."}:e>=150?{texto:"II - No Aceptable o Aceptable con Control",clase:"risk-alto",icono:"fa-exclamation-triangle",descripcion:"Intervención urgente. No iniciar actividad hasta reducir el riesgo."}:e>=40?{texto:"III - Mejorable",clase:"risk-medio",icono:"fa-tasks",descripcion:"Mejorar las medidas de control. Programar acciones de mejora."}:{texto:"IV - Aceptable",clase:"risk-bajo",icono:"fa-check-circle",descripcion:"Mantener las medidas de control actuales. Seguimiento periódico."}}},{key:"scrollToTop",value:function(){this.container.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"getCurrentGESIndex",value:function(){return this.currentGESIndex}},{key:"setCurrentGESIndex",value:function(e){this.isDestroyed||e>=0&&e<this.options.gesArray.length&&(this.currentGESIndex=e,this.renderComponent())}},{key:"updateGESArray",value:function(e){this.isDestroyed||(this.options.gesArray=e,this.currentGESIndex>=e.length&&(this.currentGESIndex=Math.max(0,e.length-1)),this.renderComponent())}},{key:"renderEmpty",value:function(){var e=this;if(!this.isDestroyed&&this.container&&this.container.isConnected&&this.container.parentNode){var n=B(En||(En=y(['\n      <div class="niveles-form__empty">\n        <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #ffeb3b; margin-bottom: 1rem;"></i>\n        <h3>No hay riesgos seleccionados</h3>\n        <p>Debes seleccionar al menos un riesgo en el paso anterior antes de configurar los niveles.</p>\n        <button\n          class="wizard-btn wizard-btn-secondary"\n          @click=','\n        >\n          <i class="fas fa-arrow-left"></i>\n          Volver a Selección de Riesgos\n        </button>\n      </div>\n    '])),(function(){return e.options.onChange({action:"go-back"})}));try{ie(n,this.container)}catch(e){console.error("[NivelesForm] Error en renderEmpty:",e.message),this.isDestroyed=!0}}else console.log("[NivelesForm] renderEmpty abortado - componente no válido")}},{key:"destroy",value:function(){console.log("[NivelesForm] Destroying component"),this.isDestroyed=!0,this.controlChangeDebounceTimer&&(clearTimeout(this.controlChangeDebounceTimer),this.controlChangeDebounceTimer=null),this.container&&this.container.isConnected&&(this.container.innerHTML="")}}]);var e,n,t}();var In=function(){return p((function e(n,t){u(this,e),this.container="string"==typeof n?document.querySelector(n):n,this.state=t,this.currentGesIndex=0,this.currentCargoIndex=0,this.container||console.error("[ControlesManager] Container not found")}),[{key:"render",value:function(){if(this.container){var e=this.state.getCargos();if(e&&0!==e.length){var n=e[this.currentCargoIndex];if(n&&n.ges&&0!==n.ges.length){var t=n.ges[this.currentGesIndex];t?(this.container.innerHTML=this.getHTML(e,n,t),this.attachEventListeners()):console.warn("[ControlesManager] No GES found at current index")}else this.renderNoRiesgos(n)}else this.renderEmptyState()}}},{key:"getHTML",value:function(e,n,t){var a=n.ges.length,o=Math.round((this.currentGesIndex+1)/a*100);return'\n      <div class="controles-form">\n        \x3c!-- Cargo Tabs --\x3e\n        '.concat(e.length>1?this.renderCargoTabs(e):"",'\n\n        \x3c!-- Header --\x3e\n        <div class="controles-header">\n          <div class="controles-header__info">\n            <h2 class="controles-header__title">Controles de Riesgo</h2>\n            <p class="controles-header__subtitle">\n              Define las medidas de control para: <strong>').concat(t.nombre||"Riesgo sin nombre",'</strong>\n            </p>\n            <p class="controles-header__cargo">\n              Cargo: <strong>').concat(n.nombre,'</strong>\n            </p>\n          </div>\n          <div class="controles-header__progress">\n            <div class="progress-circle">\n              <svg\n                viewBox="0 0 36 36"\n                class="circular-chart"\n                role="img"\n                aria-label="Progreso de GES: ').concat(this.currentGesIndex+1," de ").concat(a,'"\n              >\n                <path class="circle-bg"\n                  d="M18 2.0845\n                    a 15.9155 15.9155 0 0 1 0 31.831\n                    a 15.9155 15.9155 0 0 1 0 -31.831"\n                />\n                <path class="circle"\n                  stroke-dasharray="').concat(o,', 100"\n                  d="M18 2.0845\n                    a 15.9155 15.9155 0 0 1 0 31.831\n                    a 15.9155 15.9155 0 0 1 0 -31.831"\n                />\n              </svg>\n              <div class="progress-text" aria-hidden="true">\n                <span class="progress-number">').concat(this.currentGesIndex+1,'</span>\n                <span class="progress-total">/').concat(a,'</span>\n              </div>\n            </div>\n            <p class="progress-label">GES configurados</p>\n          </div>\n        </div>\n\n        \x3c!-- Controles Existentes (GTC-45) --\x3e\n        <div class="controles-existentes-section">\n          <div class="section-header">\n            <div class="section-header__left">\n              <i class="fas fa-shield-alt"></i>\n              <h3 class="section-title">Controles Existentes</h3>\n            </div>\n            <p class="section-description">\n              Indique los controles que la empresa <strong>YA tiene implementados</strong> para este riesgo según GTC-45\n            </p>\n          </div>\n\n          ').concat(this.renderControlesExistentesFields(t),'\n        </div>\n\n        \x3c!-- Medidas de Intervención (Sugerencias BD) --\x3e\n        <div class="medidas-intervencion-section">\n          <div class="section-header">\n            <div class="section-header__left">\n              <i class="fas fa-lightbulb"></i>\n              <h3 class="section-title">Medidas de Intervención Sugeridas</h3>\n            </div>\n            <button\n              class="wizard-btn-tertiary"\n              id="btn-cargar-sugerencias"\n              title="Cargar sugerencias desde la base de datos"\n              aria-label="Cargar sugerencias de medidas de intervención desde el catálogo">\n              <i class="fas fa-magic"></i>\n              Cargar Sugerencias desde BD\n            </button>\n          </div>\n          <p class="section-description">\n            Estas son las medidas que la empresa <strong>DEBERÍA implementar</strong> según la jerarquía de controles\n          </p>\n\n          <div class="controles-hierarchy">\n            ').concat(this.renderControlField(1,"eliminacion","Eliminación","fa-times-circle","Eliminar completamente la fuente del riesgo. Ejemplo: Eliminar proceso ruidoso, automatizar tarea peligrosa, realizar trabajos a nivel del suelo.",t),"\n\n            ").concat(this.renderControlField(2,"sustitucion","Sustitución","fa-exchange-alt","Reemplazar por algo menos peligroso. Ejemplo: Sustituir químico tóxico por alternativa más segura, usar plataformas elevadoras en lugar de andamios.",t),"\n\n            ").concat(this.renderControlField(3,"controlesIngenieria","Controles de Ingeniería","fa-cogs","Modificaciones físicas, señalización y diseño. Ejemplo: Cabinas insonorizadas, ventilación, guardas en maquinaria, señalización de seguridad, barandas.",t),"\n\n            ").concat(this.renderControlField(4,"controlesAdministrativos","Controles Administrativos","fa-clipboard-list","Procedimientos, permisos y capacitación. Ejemplo: Rotación de personal, pausas activas, permisos de trabajo, capacitaciones en SST, inspecciones periódicas.",t),'\n          </div>\n        </div>\n\n        \x3c!-- Hint --\x3e\n        <div class="wizard-hint info" style="margin-top: 2rem;">\n          <i class="fas fa-lightbulb"></i>\n          Los campos de control son opcionales. Puedes dejarlos vacíos si no aplican para este riesgo específico.\n        </div>\n\n        \x3c!-- Navigation --\x3e\n        <div class="controles-navigation">\n          ').concat(this.renderNavigationButtons(a),"\n        </div>\n      </div>\n    ")}},{key:"renderCargoTabs",value:function(e){var n=this;return'\n      <div class="wizard-tabs">\n        '.concat(e.map((function(e,t){return'\n          <button\n            class="wizard-tab '.concat(t===n.currentCargoIndex?"active":"",'"\n            data-cargo-index="').concat(t,'"\n          >\n            <i class="fas fa-user-tie"></i>\n            ').concat(e.nombre,"\n          </button>\n        ")})).join(""),"\n      </div>\n    ")}},{key:"renderControlesExistentesFields",value:function(e){this.state.getCargos()[this.currentCargoIndex];var n=e.controles||{};return'\n      <div class="controles-existentes-grid">\n        '.concat(this.renderControlExistenteField("fuente","Control en la Fuente","fa-exclamation-triangle","Ejemplo: Encerramiento del proceso ruidoso, guardas en maquinaria, aislamiento de cables eléctricos",n.fuente||""),"\n\n        ").concat(this.renderControlExistenteField("medio","Control en el Medio","fa-wind","Ejemplo: Ventilación general, extractores localizados, señalización de seguridad, barandas",n.medio||""),"\n\n        ").concat(this.renderControlExistenteField("individuo","Control en el Individuo","fa-user-shield","Ejemplo: Capacitación, EPP entregados, exámenes médicos periódicos, pausas activas",n.individuo||""),"\n      </div>\n    ")}},{key:"renderControlExistenteField",value:function(e,n,t,a,o){var r=o.length,i="control-existente-".concat(e,"-").concat(this.currentCargoIndex,"-").concat(this.currentGesIndex),s="".concat(i,"-char-count");return'\n      <div class="control-existente-group">\n        <div class="control-existente-header">\n          <i class="fas '.concat(t,'"></i>\n          <label for="').concat(i,'" class="control-existente-title">').concat(n,'</label>\n        </div>\n        <div class="control-existente-body">\n          <textarea\n            id="').concat(i,'"\n            class="control-existente-textarea ').concat(o?"filled":"",'"\n            data-control-existente="').concat(e,'"\n            placeholder="').concat(a,'"\n            maxlength="500"\n            rows="3"\n            aria-label="').concat(n,": ").concat(a,'"\n            aria-describedby="').concat(s,'"\n          >').concat(o,'</textarea>\n          <span class="control-char-count" id="').concat(s,'" aria-live="polite" aria-atomic="true">\n            <span class="char-current">').concat(r,"</span> / 500\n          </span>\n        </div>\n      </div>\n    ")}},{key:"renderControlField",value:function(e,n,t,a,o,r){this.state.getCargos()[this.currentCargoIndex];var i=(r.controles||{})[n]||"",s=i.length,c="control-".concat(n,"-").concat(this.currentCargoIndex,"-").concat(this.currentGesIndex),l="".concat(c,"-char-count");return'\n      <div class="control-group" data-level="'.concat(e,'">\n        <div class="control-header">\n          <div class="control-header__left">\n            <span class="control-number" aria-hidden="true">').concat(e,'</span>\n            <i class="fas ').concat(a,' control-icon" aria-hidden="true"></i>\n            <label for="').concat(c,'" class="control-title">').concat(t,'</label>\n          </div>\n          <span class="control-char-count" id="').concat(l,'" aria-live="polite" aria-atomic="true">\n            <span class="char-current">').concat(s,'</span> / 500 caracteres\n          </span>\n        </div>\n        <div class="control-body">\n          <textarea\n            id="').concat(c,'"\n            class="control-textarea ').concat(i?"filled":"",'"\n            data-control-type="').concat(n,'"\n            placeholder="').concat(o,'"\n            maxlength="500"\n            rows="3"\n            aria-label="').concat(t,": ").concat(o,'"\n            aria-describedby="').concat(l,'"\n          >').concat(i,"</textarea>\n        </div>\n      </div>\n    ")}},{key:"renderNavigationButtons",value:function(e){var n=0===this.currentGesIndex,t=this.currentGesIndex===e-1;return'\n      \x3c!-- Navegación tradicional --\x3e\n      <button\n        class="btn-wizard btn-wizard--secondary"\n        id="btn-ges-anterior"\n        '.concat(n?"disabled":"",'\n      >\n        <i class="fas fa-arrow-left"></i>\n        GES Anterior\n      </button>\n\n      <div class="controles-navigation__center">\n        ').concat(t?'\n          <button class="btn-wizard btn-wizard--success" id="btn-finalizar-controles">\n            Finalizar Controles\n            <i class="fas fa-check"></i>\n          </button>\n        ':'\n          <button class="btn-wizard btn-wizard--primary" id="btn-ges-siguiente">\n            Siguiente GES\n            <i class="fas fa-arrow-right"></i>\n          </button>\n        ','\n      </div>\n\n      <button class="btn-wizard btn-wizard--tertiary" id="btn-saltar-ges">\n        Saltar\n        <i class="fas fa-step-forward"></i>\n      </button>\n\n      \x3c!-- FAB Navigation (solo si hay más de 1 GES) --\x3e\n      ').concat(e>1?'\n        <div class="wizard-fab-nav">\n          '.concat(n?"":'\n            <button\n              class="wizard-fab wizard-fab--secondary"\n              id="fab-ges-anterior"\n              data-tooltip="GES Anterior"\n              aria-label="Ir al GES anterior"\n            >\n              <i class="fas fa-chevron-left"></i>\n            </button>\n          ',"\n\n          ").concat(t?"":'\n            <button\n              class="wizard-fab"\n              id="fab-ges-siguiente"\n              data-tooltip="Siguiente GES"\n              aria-label="Ir al siguiente GES"\n            >\n              <i class="fas fa-chevron-right"></i>\n              <span class="wizard-fab__badge">'.concat(this.currentGesIndex+2,"</span>\n            </button>\n          "),"\n        </div>\n      "):"","\n    ")}},{key:"renderEmptyState",value:function(){this.container.innerHTML='\n      <div class="wizard-empty-state">\n        <i class="fas fa-briefcase"></i>\n        <h3>No hay cargos creados</h3>\n        <p>Necesitas crear al menos un cargo para definir controles de riesgo.</p>\n        <button class="btn-wizard btn-wizard--primary" onclick="window.history.back()">\n          <i class="fas fa-arrow-left"></i>\n          Volver\n        </button>\n      </div>\n    '}},{key:"renderNoRiesgos",value:function(e){this.container.innerHTML='\n      <div class="wizard-empty-state">\n        <i class="fas fa-exclamation-triangle"></i>\n        <h3>Sin riesgos seleccionados</h3>\n        <p>El cargo <strong>'.concat(e.nombre,'</strong> no tiene riesgos (GES) seleccionados.</p>\n        <button class="btn-wizard btn-wizard--primary" onclick="window.history.back()">\n          <i class="fas fa-arrow-left"></i>\n          Volver a seleccionar riesgos\n        </button>\n      </div>\n    ')}},{key:"attachEventListeners",value:function(){var e=this;if(this.container){this.container.querySelectorAll("[data-cargo-index]").forEach((function(n){n.addEventListener("click",(function(n){var t=parseInt(n.currentTarget.dataset.cargoIndex,10);t!==e.currentCargoIndex&&(e.saveCurrentControles(),e.switchCargo(t))}))})),this.container.querySelectorAll(".control-existente-textarea").forEach((function(n){n.addEventListener("input",(function(n){e.updateCharCountExistente(n.target)})),n.addEventListener("blur",(function(){e.saveCurrentControles()}))})),this.container.querySelectorAll(".control-textarea").forEach((function(n){n.addEventListener("input",(function(n){e.updateCharCount(n.target)})),n.addEventListener("blur",(function(){e.saveCurrentControles()}))}));var n=this.container.querySelector("#btn-cargar-sugerencias");n&&n.addEventListener("click",(function(){e.handleLoadSugerencias()}));var t=this.container.querySelector("#btn-ges-anterior"),a=this.container.querySelector("#btn-ges-siguiente"),o=this.container.querySelector("#btn-finalizar-controles"),r=this.container.querySelector("#btn-saltar-ges");t&&t.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesAnterior()})),a&&a.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesSiguiente()})),o&&o.addEventListener("click",(function(){e.saveCurrentControles(),e.finalizarControles()})),r&&r.addEventListener("click",(function(){e.saveCurrentControles(),e.saltarGes()}));var i=this.container.querySelector("#fab-ges-anterior"),s=this.container.querySelector("#fab-ges-siguiente");i&&i.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesAnterior()})),s&&s.addEventListener("click",(function(){e.saveCurrentControles(),e.navegarGesSiguiente()}))}}},{key:"updateCharCountExistente",value:function(e){var n=e.closest(".control-existente-group");if(n){var t=e.value.length,a=n.querySelector(".char-current"),o=n.querySelector(".control-char-count");a&&(a.textContent=t),t>0?e.classList.add("filled"):e.classList.remove("filled"),o&&(o.classList.remove("warning","danger"),t>=400&&t<490?o.classList.add("warning"):t>=490&&o.classList.add("danger"))}}},{key:"updateCharCount",value:function(e){var n=e.closest(".control-group");if(n){var t=e.value.length,a=n.querySelector(".char-current"),o=n.querySelector(".control-char-count");a&&(a.textContent=t),t>0?e.classList.add("filled"):e.classList.remove("filled"),o&&(o.classList.remove("warning","danger"),t>=400&&t<490?o.classList.add("warning"):t>=490&&o.classList.add("danger"))}}},{key:"saveCurrentControles",value:function(){if(this.container){var e=this.state.getCargos()[this.currentCargoIndex];if(e)if(e.ges[this.currentGesIndex]){var n={};this.container.querySelectorAll(".control-existente-textarea").forEach((function(e){var t=e.dataset.controlExistente;n[t]=e.value.trim()})),this.container.querySelectorAll(".control-textarea").forEach((function(e){var t=e.dataset.controlType;n[t]=e.value.trim()})),console.log("[ControlesManager] Saving controles:",{cargoIndex:this.currentCargoIndex,gesIndex:this.currentGesIndex,controles:n}),this.state.updateGESControles(this.currentCargoIndex,this.currentGesIndex,n)}}}},{key:"switchCargo",value:function(e){var n=this.state.getCargos();e<0||e>=n.length||(this.currentCargoIndex=e,this.currentGesIndex=0,this.render(),console.log("[ControlesManager] Switched to cargo ".concat(e)))}},{key:"navegarGesAnterior",value:function(){var e=this;if(this.currentGesIndex>0){var n=this.container.querySelector(".controles-hierarchy");n&&n.classList.add("ges-transition-exit"),setTimeout((function(){e.currentGesIndex--,e.render(),e.scrollToTop();var n=e.container.querySelector(".controles-hierarchy");n&&n.classList.add("ges-transition-enter")}),300)}}},{key:"navegarGesSiguiente",value:function(){var e=this,n=this.state.getCargos()[this.currentCargoIndex].ges.length;if(this.currentGesIndex<n-1){var t=this.container.querySelector(".controles-hierarchy");t&&t.classList.add("ges-transition-exit"),setTimeout((function(){e.currentGesIndex++,e.render(),e.scrollToTop();var n=e.container.querySelector(".controles-hierarchy");n&&n.classList.add("ges-transition-enter")}),300)}}},{key:"saltarGes",value:function(){this.navegarGesSiguiente()}},{key:"finalizarControles",value:function(){console.log("[ControlesManager] Finalizando controles...");var e=new CustomEvent("controles:completed",{bubbles:!0,detail:{cargoIndex:this.currentCargoIndex,gesIndex:this.currentGesIndex}});this.container.dispatchEvent(e)}},{key:"scrollToTop",value:function(){this.container&&this.container.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"getCompletionStats",value:function(){var e=this.state.getCargos(),n=0,t=0;return e.forEach((function(e){e.ges&&e.ges.forEach((function(e){n++;var a=e.controles||{};Object.values(a).some((function(e){return e&&e.trim().length>0}))&&t++}))})),{totalGES:n,gesWithControles:t,percentage:n>0?Math.round(t/n*100):0}}},{key:"showToast",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;document.querySelectorAll(".toast-notification").forEach((function(e){return e.remove()}));var a=document.createElement("div");a.className="toast-notification ".concat(n),a.setAttribute("role","alert"),a.setAttribute("aria-live","polite");var o={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};a.innerHTML='\n      <i class="'.concat(o[n]||o.info,'"></i>\n      <span class="toast-message">').concat(e,'</span>\n      <button class="toast-close" aria-label="Cerrar notificación">\n        <i class="fas fa-times"></i>\n      </button>\n    '),document.body.appendChild(a),a.querySelector(".toast-close").addEventListener("click",(function(){a.classList.add("hiding"),setTimeout((function(){return a.remove()}),300)})),setTimeout((function(){document.body.contains(a)&&(a.classList.add("hiding"),setTimeout((function(){return a.remove()}),300))}),t)}},{key:"handleLoadSugerencias",value:(e=r(s().mark((function e(){var n,t,a,o,r,i,c,l,d,u,g,p,v,f,h,m,b=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.container.querySelector("#btn-cargar-sugerencias")){e.next=3;break}return e.abrupt("return");case 3:if(e.prev=3,t=this.state.getCargos(),a=t[this.currentCargoIndex]){e.next=8;break}return e.abrupt("return");case 8:if(o=a.ges[this.currentGesIndex]){e.next=11;break}return e.abrupt("return");case 11:return r=o.nombre,console.log("[ControlesManager] Cargando sugerencias para: ".concat(r)),n.disabled=!0,n.classList.add("wizard-btn-loading"),n.setAttribute("aria-busy","true"),i=n.innerHTML,e.next=19,fetch("/api/catalogo/ges?search=".concat(encodeURIComponent(r),"&limit=5"));case 19:return c=e.sent,e.next=22,c.json();case 22:if((l=e.sent).success&&l.data&&0!==l.data.length){e.next=30;break}return this.showToast('No se encontraron sugerencias predefinidas para "'.concat(r,'". Puedes ingresarlas manualmente.'),"warning",6e3),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,e.abrupt("return");case 30:if(d=l.data.find((function(e){return e.nombre.toLowerCase().trim()===r.toLowerCase().trim()})),d){e.next=38;break}return this.showToast('No se encontró coincidencia exacta para "'.concat(r,'"'),"warning",6e3),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,e.abrupt("return");case 38:return e.next=40,fetch("/api/catalogo/ges/".concat(d.id));case 40:return u=e.sent,e.next=43,u.json();case 43:if((g=e.sent).success&&g.data){e.next=51;break}return this.showToast('No se pudieron cargar los detalles para "'.concat(r,'"'),"error"),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,e.abrupt("return");case 51:if(p=g.data,v=p.medidas_intervencion){e.next=60;break}return this.showToast('El GES "'.concat(r,'" no tiene medidas de intervención predefinidas'),"warning"),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,e.abrupt("return");case 60:f=this.container.querySelectorAll(".control-textarea"),h=0,f.forEach((function(e){var n="";switch(e.dataset.controlType){case"eliminacion":n=v.eliminacion||"";break;case"sustitucion":n=v.sustitucion||"";break;case"controlesIngenieria":n=v.controles_ingenieria||"";break;case"controlesAdministrativos":n=v.controles_administrativos||""}if(n){var t=e.closest(".control-group");e.value=n,e.classList.add("filled"),b.updateCharCount(e),t&&(t.style.animation="none",setTimeout((function(){t.style.animation="fieldHighlight 0.6s ease-out"}),10)),h++}})),this.saveCurrentControles(),n.disabled=!1,n.classList.remove("wizard-btn-loading"),n.setAttribute("aria-busy","false"),n.innerHTML=i,h>0?this.showToast("✓ Se cargaron ".concat(h," medidas de intervención exitosamente"),"success"):this.showToast("No se encontraron medidas predefinidas para este GES","info"),console.log("[ControlesManager] Sugerencias cargadas desde BD"),e.next=78;break;case 72:e.prev=72,e.t0=e.catch(3),console.error("[ControlesManager] Error al cargar sugerencias:",e.t0),(m=this.container.querySelector("#btn-cargar-sugerencias"))&&(m.disabled=!1,m.classList.remove("wizard-btn-loading"),m.setAttribute("aria-busy","false")),this.showToast("Error al cargar sugerencias. Por favor, intenta nuevamente.","error");case 78:case"end":return e.stop()}}),e,this,[[3,72]])}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){this.container&&(this.container.innerHTML="")}}]);var e}(),Ln=o(8491);function Dn(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.placement,o=void 0===a?"bottom":a,i=t.offset,c=void 0===i?8:i,l=t.closeOnClickOutside,d=void 0===l||l,u=t.closeOnEscape,g=void 0===u||u,p=document.createElement("div");p.className="floating-popover",p.setAttribute("role","dialog"),"string"==typeof n?p.innerHTML=n:p.appendChild(n);var v=!1,f=null;function h(){return m.apply(this,arguments)}function m(){return m=r(s().mark((function n(){var t,a,r,i;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(v){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,(0,Ln.computePosition)(e,p,{placement:o,middleware:[(0,Ln.offset)(c),(0,Ln.flip)(),(0,Ln.shift)({padding:10}),(0,Ln.size)({apply:function(e){var n=e.availableWidth,t=e.availableHeight,a=e.elements;Object.assign(a.floating.style,{maxWidth:"".concat(n,"px"),maxHeight:"".concat(t,"px")})}})]});case 4:t=n.sent,a=t.x,r=t.y,i=t.placement,Object.assign(p.style,{left:"".concat(a,"px"),top:"".concat(r,"px")}),p.setAttribute("data-placement",i);case 10:case"end":return n.stop()}}),n)}))),m.apply(this,arguments)}function b(){v||(v=!0,document.body.appendChild(p),f=(0,Ln.autoUpdate)(e,p,h),h(),requestAnimationFrame((function(){p.classList.add("floating-popover--visible")})),d&&setTimeout((function(){document.addEventListener("click",x)}),0),g&&document.addEventListener("keydown",w))}function y(){v&&(v=!1,p.classList.remove("floating-popover--visible"),f&&(f(),f=null),document.removeEventListener("click",x),document.removeEventListener("keydown",w),setTimeout((function(){!v&&p.parentNode&&p.parentNode.removeChild(p)}),200))}function x(n){p.contains(n.target)||e.contains(n.target)||y()}function w(e){"Escape"===e.key&&y()}return{show:b,hide:y,destroy:function(){f&&(f(),f=null),document.removeEventListener("click",x),document.removeEventListener("keydown",w),p.parentNode&&p.parentNode.removeChild(p),v=!1},toggle:function(){return v?y():b()},element:p}}function Pn(e,n,t){var a=document.createElement("div");a.className="wizard-resume-modal",a.setAttribute("role","dialog"),a.setAttribute("aria-modal","true"),a.setAttribute("aria-labelledby","modal-title");var o={"info-basica":"Información Básica",cargos:"Cargos",riesgos:"Riesgos por Cargo",niveles:"Niveles de Riesgo",controles:"Controles de Seguridad",resumen:"Resumen"}[e]||e;a.innerHTML='\n    <div class="modal-overlay" aria-hidden="true"></div>\n    <div class="modal-content">\n      <div class="modal-icon">\n        <i class="fas fa-save"></i>\n      </div>\n      <h3 class="modal-title" id="modal-title">Sesión guardada encontrada</h3>\n      <p class="modal-message">\n        Tienes un progreso guardado en el paso\n        <strong>"'.concat(o,'"</strong>\n      </p>\n      <p class="modal-subtitle">\n        ¿Deseas continuar donde lo dejaste o empezar de nuevo?\n      </p>\n      <div class="modal-actions">\n        <button class="btn-continue cta-button" type="button">\n          <i class="fas fa-play"></i>\n          <span>Continuar</span>\n        </button>\n        <button class="btn-new cta-button-1" type="button">\n          <i class="fas fa-refresh"></i>\n          <span>Empezar de Nuevo</span>\n        </button>\n      </div>\n    </div>\n  ');var r=a.querySelector(".btn-continue"),i=a.querySelector(".btn-new"),s=a.querySelector(".modal-overlay"),c=function(){a.classList.add("modal-closing"),setTimeout((function(){a.remove(),document.body.style.overflow=""}),300)};return r.addEventListener("click",(function(){c(),n()})),i.addEventListener("click",(function(){c(),t()})),s.addEventListener("click",c),a.addEventListener("keydown",(function(e){if("Escape"===e.key&&c(),"Tab"===e.key){var n=a.querySelectorAll("button"),t=n[0],o=n[n.length-1];e.shiftKey&&document.activeElement===t?(e.preventDefault(),o.focus()):e.shiftKey||document.activeElement!==o||(e.preventDefault(),t.focus())}})),document.body.style.overflow="hidden",document.body.appendChild(a),requestAnimationFrame((function(){a.classList.add("modal-visible"),r.focus()})),a}function jn(e){var n=e.title,t=void 0===n?"¿Estás seguro?":n,a=e.message,o=void 0===a?"":a,r=e.confirmText,i=void 0===r?"Confirmar":r,s=e.cancelText,c=void 0===s?"Cancelar":s,l=e.type,d=void 0===l?"info":l,u=e.onConfirm,g=void 0===u?function(){}:u,p=e.onCancel,v=void 0===p?function(){}:p,f=document.createElement("div");f.className="wizard-confirm-modal",f.setAttribute("role","alertdialog"),f.setAttribute("aria-modal","true"),f.setAttribute("aria-labelledby","confirm-modal-title");var h={info:"fa-info-circle",success:"fa-check-circle",warning:"fa-exclamation-triangle",danger:"fa-exclamation-circle"},m=h[d]||h.info;f.innerHTML='\n    <div class="modal-overlay" aria-hidden="true"></div>\n    <div class="modal-content modal-content--'.concat(d,'">\n      <div class="modal-icon modal-icon--').concat(d,'">\n        <i class="fas ').concat(m,'"></i>\n      </div>\n      <h3 class="modal-title" id="confirm-modal-title">').concat(t,"</h3>\n      ").concat(o?'<p class="modal-message">'.concat(o,"</p>"):"",'\n      <div class="modal-actions">\n        <button class="btn-cancel cta-button-1" type="button">\n          <span>').concat(c,'</span>\n        </button>\n        <button class="btn-confirm cta-button btn-confirm--').concat(d,'" type="button">\n          <span>').concat(i,"</span>\n        </button>\n      </div>\n    </div>\n  ");var b=f.querySelector(".btn-confirm"),y=f.querySelector(".btn-cancel"),x=f.querySelector(".modal-overlay"),w=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];f.classList.add("modal-closing"),setTimeout((function(){f.remove(),document.body.style.overflow=""}),300),e?g():v()};return b.addEventListener("click",(function(){return w(!0)})),y.addEventListener("click",(function(){return w(!1)})),x.addEventListener("click",(function(){return w(!1)})),f.addEventListener("keydown",(function(e){"Escape"===e.key&&w(!1)})),document.body.style.overflow="hidden",document.body.appendChild(f),requestAnimationFrame((function(){f.classList.add("modal-visible"),b.focus()})),f}function Rn(e){var n=e.message,t=void 0===n?"":n,a=e.type,o=void 0===a?"info":a,r=e.duration,i=void 0===r?3e3:r,s=document.createElement("div");s.className="wizard-toast wizard-toast--".concat(o),s.setAttribute("role","alert"),s.setAttribute("aria-live","polite");var c={info:"fa-info-circle",success:"fa-check-circle",warning:"fa-exclamation-triangle",danger:"fa-times-circle"},l=c[o]||c.info;s.innerHTML='\n    <div class="toast-icon">\n      <i class="fas '.concat(l,'"></i>\n    </div>\n    <div class="toast-message">').concat(t,'</div>\n    <button class="toast-close" type="button" aria-label="Cerrar notificación">\n      <i class="fas fa-times"></i>\n    </button>\n  ');var d=function(){s.classList.add("toast-closing"),setTimeout((function(){return s.remove()}),300)};s.querySelector(".toast-close").addEventListener("click",d);var u=document.querySelector(".wizard-toast-container");return u||((u=document.createElement("div")).className="wizard-toast-container",u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),document.body.appendChild(u)),u.appendChild(s),requestAnimationFrame((function(){return s.classList.add("toast-visible")})),i>0&&setTimeout(d,i),s}var qn=function(){return p((function e(n){u(this,e),this.state=n,this.currentPopover=null,this.currentCargoIndex=null}),[{key:"showEditPopover",value:function(e,n,t){var a=this;console.log("[CargoEditor] showEditPopover called",{referenceElement:e,cargoIndex:n}),this.currentPopover&&(console.log("[CargoEditor] Closing existing popover"),this.currentPopover.hide(),this.currentPopover.destroy(),this.currentPopover=null,this.currentCargoIndex=null),this.currentCargoIndex=n;var o=this.state.getCargo(n);if(o){console.log("[CargoEditor] Creating popover for cargo:",o);var r=this.createPopoverContent(o,n);console.log("[CargoEditor] Creating popover with Floating UI..."),this.currentPopover=Dn(e,r,{placement:"bottom",offset:8,closeOnClickOutside:!1,closeOnEscape:!0}),this.currentPopover.element.classList.add("floating-popover--cargo-edit"),console.log("[CargoEditor] Showing popover..."),this.currentPopover.show(),console.log("[CargoEditor] Popover shown, element:",this.currentPopover.element),console.log("[CargoEditor] Popover in DOM:",document.body.contains(this.currentPopover.element)),this.attachEventListeners(n,t),setTimeout((function(){var e=a.currentPopover.element.querySelector("#edit-cargo-nombre");e?(console.log("[CargoEditor] Focusing first input"),e.focus()):console.error("[CargoEditor] First input not found!")}),100)}else console.error("[CargoEditor] Cargo not found:",n)}},{key:"createPopoverContent",value:function(e,n){var t=document.createElement("div"),a=[{name:"tareasRutinarias",icon:"fa-repeat",label:"Tareas repetitivas",severity:"warning",hint:"Puede requerir pausas activas y rotación de tareas"},{name:"conduceVehiculo",icon:"fa-car",label:"Conduce vehículo",severity:"warning",hint:"Requiere licencia de conducción vigente"},{name:"manipulaAlimentos",icon:"fa-utensils",label:"Manipula alimentos",severity:"danger",hint:"Requiere certificado de manipulación de alimentos vigente"},{name:"trabajaAlturas",icon:"fa-arrow-up",label:"Trabaja en alturas",severity:"danger",hint:"Requiere certificado de trabajo en alturas y EPP especializado"},{name:"trabajaEspaciosConfinados",icon:"fa-door-closed",label:"Espacios confinados",severity:"danger",hint:"Requiere permiso de trabajo y monitor de gases continuo"}].map((function(n){return'\n      <div class="toggle-group toggle-group--'.concat(n.severity,'">\n        <div class="toggle-header">\n          <div class="toggle-label-wrapper">\n            <i class="fas ').concat(n.icon," toggle-icon toggle-icon--").concat(n.severity,'"></i>\n            <span class="toggle-label">').concat(n.label,'</span>\n          </div>\n          <div class="wizard-switch wizard-switch--').concat(n.severity,'">\n            <input\n              type="checkbox"\n              name="').concat(n.name,'"\n              id="edit-cargo-').concat(n.name,'"\n              ').concat(e[n.name]?"checked":"",'\n            />\n            <span class="slider"></span>\n          </div>\n        </div>\n        <div class="toggle-hint">\n          <i class="fas fa-info-circle"></i>\n          ').concat(n.hint,"\n        </div>\n      </div>\n    ")})).join("");return t.innerHTML='\n      <div class="floating-popover__header">\n        <h3>Editar Cargo</h3>\n        <div class="floating-popover__header-actions">\n          <button type="button" class="btn btn--primary btn--compact" data-action="save-edit">\n            <i class="fas fa-save"></i> Guardar\n          </button>\n          <button class="floating-popover__close" data-action="close-edit">\n            &times;\n          </button>\n        </div>\n      </div>\n      <div class="floating-popover__body floating-popover__body--two-cols">\n        <form id="edit-cargo-form" class="cargo-edit-form">\n          \x3c!-- Columna Izquierda: Información Básica --\x3e\n          <div class="floating-popover__col floating-popover__col--basic">\n            <div class="form-group">\n              <label for="edit-cargo-nombre">\n                Nombre del Cargo <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-nombre"\n                name="nombre"\n                class="form-input"\n                value="'.concat(e.nombre,'"\n                placeholder="Ej: Operario de Producción"\n                required\n                minlength="3"\n                maxlength="100"\n              />\n              <span class="error-message" id="error-nombre"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-numPersonas">\n                Número de Trabajadores <span class="required">*</span>\n              </label>\n              <input\n                type="number"\n                id="edit-cargo-numPersonas"\n                name="numPersonas"\n                class="form-input"\n                value="').concat(e.numPersonas,'"\n                min="1"\n                max="9999"\n                required\n              />\n              <span class="error-message" id="error-numPersonas"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-area">\n                Área en la empresa <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-area"\n                name="area"\n                class="form-input"\n                value="').concat(e.area||"",'"\n                placeholder="Ej: Producción, Administración, Ventas"\n                required\n                maxlength="100"\n              />\n              <span class="error-message" id="error-area"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-zona">\n                Zona o lugar <span class="required">*</span>\n              </label>\n              <input\n                type="text"\n                id="edit-cargo-zona"\n                name="zona"\n                class="form-input"\n                value="').concat(e.zona||"",'"\n                placeholder="Ej: Planta 1, Oficina central, Bodega 3"\n                required\n                maxlength="100"\n              />\n              <span class="error-message" id="error-zona"></span>\n            </div>\n\n            <div class="form-group">\n              <label for="edit-cargo-descripcion">\n                Descripción (opcional)\n              </label>\n              <textarea\n                id="edit-cargo-descripcion"\n                name="descripcion"\n                class="form-input"\n                placeholder="Descripción breve de las funciones del cargo..."\n                rows="4"\n                maxlength="500"\n              >').concat(e.descripcion||"",'</textarea>\n              <span class="form-hint">').concat((e.descripcion||"").length,'/500 caracteres</span>\n            </div>\n          </div>\n\n          \x3c!-- Columna Derecha: Características Especiales --\x3e\n          <div class="floating-popover__col floating-popover__col--toggles">\n            <div class="form-group">\n              <label class="form-label-section">\n                <i class="fas fa-shield-alt"></i>\n                Características especiales\n              </label>\n              <div class="toggles-grid-modern">\n                ').concat(a,"\n              </div>\n            </div>\n          </div>\n        </form>\n      </div>\n    "),t}},{key:"attachEventListeners",value:function(e,n){var t=this,a=this.currentPopover.element;a.querySelector('[data-action="close-edit"]').addEventListener("click",(function(){return t.closePopover()}));var o=a.querySelector('[data-action="save-edit"]');o.addEventListener("click",(function(){return t.handleSave(e,n)}));var r=a.querySelector("#edit-cargo-descripcion"),i=a.querySelector(".form-hint");r.addEventListener("input",(function(e){i.textContent="".concat(e.target.value.length,"/500 caracteres")})),a.querySelector("#edit-cargo-nombre").addEventListener("input",(function(){return t.validateField("nombre",e)})),a.querySelector("#edit-cargo-numPersonas").addEventListener("input",(function(){return t.validateField("numPersonas",e)})),a.querySelector("#edit-cargo-area").addEventListener("input",(function(){return t.validateField("area",e)})),a.querySelector("#edit-cargo-zona").addEventListener("input",(function(){return t.validateField("zona",e)})),a.addEventListener("keydown",(function(e){"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),o.click())}))}},{key:"validateField",value:function(e,n){var t=this.currentPopover.element,a=t.querySelector("#edit-cargo-".concat(e)),o=t.querySelector("#error-".concat(e));if(!a||!o)return!0;var r=a.value.trim(),i="";if("nombre"===e)r.length<3?i="El nombre debe tener al menos 3 caracteres":this.state.isCargoNameUnique(r,n)||(i="Ya existe un cargo con ese nombre");else if("numPersonas"===e){var s=parseInt(r,10);(isNaN(s)||s<1)&&(i="Debe haber al menos 1 persona")}else"area"===e?r.length<2&&(i="El área debe tener al menos 2 caracteres"):"zona"===e&&r.length<2&&(i="La zona debe tener al menos 2 caracteres");return i?(o.textContent=i,o.style.display="block",a.classList.add("input-error"),!1):(o.textContent="",o.style.display="none",a.classList.remove("input-error"),!0)}},{key:"validateForm",value:function(e){var n=this.validateField("nombre",e),t=this.validateField("numPersonas",e),a=this.validateField("area",e),o=this.validateField("zona",e);return n&&t&&a&&o}},{key:"handleSave",value:(e=r(s().mark((function e(n,t){var a,o,r,i,c,l,d,u,g,p,v,f,h,m,b=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.validateForm(n)){e.next=3;break}return console.log("[CargoEditor] Validation failed"),e.abrupt("return");case 3:if(a=this.currentPopover.element,(o=a.querySelector('[data-action="save-edit"]')).disabled=!0,o.innerHTML='<i class="fas fa-spinner fa-spin"></i> Guardando...',e.prev=7,r=a.querySelector("#edit-cargo-nombre").value.trim(),i=parseInt(a.querySelector("#edit-cargo-numPersonas").value,10),c=a.querySelector("#edit-cargo-area").value.trim(),l=a.querySelector("#edit-cargo-zona").value.trim(),d=a.querySelector("#edit-cargo-descripcion").value.trim(),u=a.querySelector("#edit-cargo-tareasRutinarias").checked,g=a.querySelector("#edit-cargo-manipulaAlimentos").checked,p=a.querySelector("#edit-cargo-trabajaAlturas").checked,v=a.querySelector("#edit-cargo-trabajaEspaciosConfinados").checked,f=a.querySelector("#edit-cargo-conduceVehiculo").checked,(h=this.state.updateCargo(n,{nombre:r,numPersonas:i,area:c,zona:l,descripcion:d,tareasRutinarias:u,manipulaAlimentos:g,trabajaAlturas:p,trabajaEspaciosConfinados:v,conduceVehiculo:f})).success){e.next=21;break}throw new Error(h.error);case 21:console.log("[CargoEditor] Cargo updated successfully",{nombre:r,numPersonas:i,descripcion:d,tareasRutinarias:u,manipulaAlimentos:g,trabajaAlturas:p,trabajaEspaciosConfinados:v,conduceVehiculo:f}),m=o.innerHTML,o.innerHTML='<i class="fas fa-check"></i> Guardado',o.classList.add("btn--success"),o.disabled=!0,setTimeout((function(){o.innerHTML=m,o.classList.remove("btn--success"),o.disabled=!1,b.closePopover(),setTimeout((function(){t&&t(n)}),50)}),800),e.next=35;break;case 29:e.prev=29,e.t0=e.catch(7),console.error("[CargoEditor] Error saving cargo:",e.t0),Rn({message:"Error al guardar: ".concat(e.t0.message),type:"danger",duration:5e3}),o.disabled=!1,o.innerHTML='<i class="fas fa-save"></i> Guardar';case 35:case"end":return e.stop()}}),e,this,[[7,29]])}))),function(n,t){return e.apply(this,arguments)})},{key:"closePopover",value:function(){var e=this;this.currentPopover&&(this.currentPopover.hide(),setTimeout((function(){e.currentPopover&&(e.currentPopover.destroy(),e.currentPopover=null,e.currentCargoIndex=null)}),250))}},{key:"destroy",value:function(){this.closePopover()}}]);var e}(),Fn=function(){return p((function e(n){u(this,e),this.button=n,this.tooltip=null,this.arrowElement=null,this.isShowing=!1,window.innerWidth>768&&!("ontouchstart"in window)&&this.init()}),[{key:"init",value:function(){var e=this;this.button.addEventListener("mouseenter",(function(){return e.show()})),this.button.addEventListener("mouseleave",(function(){return e.hide()})),this.button.addEventListener("focus",(function(){return e.show()})),this.button.addEventListener("blur",(function(){return e.hide()}))}},{key:"show",value:(n=r(s().mark((function e(){var n,t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.button.dataset.keyboardShortcut)&&!this.isShowing){e.next=3;break}return e.abrupt("return");case 3:return this.isShowing=!0,this.tooltip=document.createElement("div"),this.tooltip.className="floating-tooltip floating-tooltip--keyboard",this.tooltip.setAttribute("role","tooltip"),this.tooltip.innerHTML='\n      <div class="tooltip-content">\n        <i class="fas fa-keyboard"></i>\n        <span>'.concat(n,'</span>\n      </div>\n      <div class="floating-tooltip__arrow"></div>\n    '),document.body.appendChild(this.tooltip),this.arrowElement=this.tooltip.querySelector(".floating-tooltip__arrow"),e.next=12,this.updatePosition();case 12:requestAnimationFrame((function(){t.tooltip&&t.tooltip.classList.add("floating-tooltip--visible")}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updatePosition",value:(e=r(s().mark((function e(){var n,t,a,o,r,i,c,l,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tooltip&&this.button){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,Ln.computePosition)(this.button,this.tooltip,{placement:"top",middleware:[(0,Ln.offset)(8),(0,Ln.flip)(),(0,Ln.shift)({padding:5}),(0,Ln.arrow)({element:this.arrowElement})]});case 4:n=e.sent,t=n.x,a=n.y,o=n.placement,r=n.middlewareData,Object.assign(this.tooltip.style,{left:"".concat(t,"px"),top:"".concat(a,"px")}),r.arrow&&(i=r.arrow,c=i.x,l=i.y,u={top:"bottom",right:"left",bottom:"top",left:"right"}[o.split("-")[0]],Object.assign(this.arrowElement.style,d({left:null!=c?"".concat(c,"px"):"",top:null!=l?"".concat(l,"px"):"",right:"",bottom:""},u,"-4px")));case 11:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"hide",value:function(){var e=this;this.tooltip&&(this.isShowing=!1,this.tooltip.classList.remove("floating-tooltip--visible"),setTimeout((function(){e.tooltip&&e.tooltip.parentNode&&(e.tooltip.remove(),e.tooltip=null,e.arrowElement=null)}),200))}},{key:"destroy",value:function(){this.hide()}}]);var e,n}();function Gn(e){Array.isArray(e)&&(e.forEach((function(e){return e.destroy()})),console.log("🗑️  Keyboard tooltips destroyed (".concat(e.length," instances)")))}function On(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Mn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?On(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):On(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Bn=function(){return p((function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(u(this,e),this.container=document.querySelector(n),!this.container)throw new Error("Container not found: ".concat(n));this.state=t||b(),this.unsubscribe=null,this.currentStepComponent=null,this.riesgoSelectors={},this.nivelesForm=null,this.controlesManager=null,this.cargoEditor=new qn(this.state),this.previousStep=null,this.carouselIndex=0,this.fabCleanup=null,this.keyboardHandler=null,this.keyboardTooltips=null,this.selfManagedSteps=new Set(["info-basica","cargos","riesgos","niveles"]),this.steps=[{id:"info-basica",title:"Información Básica",description:"Comencemos con los datos de tu empresa",icon:"fas fa-building",component:this.renderInfoBasica.bind(this)},{id:"cargos",title:"Cargos",description:"Agrega los puestos de trabajo de tu empresa",icon:"fas fa-users",component:this.renderCargos.bind(this)},{id:"riesgos",title:"Riesgos por Cargo",description:"Selecciona los riesgos (GES) para cada cargo",icon:"fas fa-exclamation-triangle",component:this.renderRiesgos.bind(this)},{id:"niveles",title:"Niveles y Controles",description:"Configura niveles de riesgo (ND, NE, NC) y controles existentes",icon:"fas fa-chart-bar",component:this.renderNiveles.bind(this)},{id:"resumen",title:"Resumen y Envío",description:"Revisa y genera tus documentos",icon:"fas fa-check-circle",component:this.renderResumen.bind(this)}],console.log("[WizardCore] Initialized with",this.steps.length,"steps")}),[{key:"init",value:function(){var e=this;console.log("[WizardCore] Starting initialization..."),this.unsubscribe=this.state.subscribe((function(n){var t=n.currentStep;return t!==e.previousStep?(console.log("[WizardCore] Step changed:",e.previousStep,"->",t),"niveles"===e.previousStep&&"niveles"!==t&&(console.log("[WizardCore] Saliendo de niveles, limpiando cache"),e.cleanupNivelesFormCache()),e.previousStep=t,void e.render()):e.selfManagedSteps.has(t)?(console.log("[WizardCore] State updated for self-managed step, updating context bar only"),void e.updateContextBar()):(console.log("[WizardCore] State updated for template step, re-rendering"),void e.render())})),this.keyboardHandler=this.handleKeyboardShortcuts.bind(this),document.addEventListener("keydown",this.keyboardHandler),this.previousStep=this.state.getCurrentStep(),this.render(),console.log("[WizardCore] Initialization complete")}},{key:"destroy",value:function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.keyboardTooltips&&(Gn(this.keyboardTooltips),this.keyboardTooltips=null),this.cleanupNivelesFormCache(),console.log("[WizardCore] Destroyed")}},{key:"cleanupNivelesFormCache",value:function(){this.nivelesFormCache&&(Object.values(this.nivelesFormCache).forEach((function(e){e&&"function"==typeof e.destroy&&e.destroy()})),this.nivelesFormCache={}),this.nivelesForm=null}},{key:"handleKeyboardShortcuts",value:function(e){var n=document.activeElement;if(!(n&&("INPUT"===n.tagName||"TEXTAREA"===n.tagName||"SELECT"===n.tagName||n.isContentEditable))&&!document.querySelector(".wizard-modal")){var t=this.state.getCurrentStep();return"Enter"!==e.key||e.shiftKey?"Enter"===e.key&&e.shiftKey?(e.preventDefault(),console.log("[WizardCore] Keyboard shortcut: Shift+Enter → Previous"),void this.handleBack()):void 0:(e.preventDefault(),console.log("[WizardCore] Keyboard shortcut: Enter → Next"),void this.handleNext(t))}}},{key:"forceRender",value:function(){console.log("[WizardCore] Forcing re-render"),this.render()}},{key:"render",value:function(){var e=this.state.getCurrentStep(),n=this.steps.find((function(n){return n.id===e}));if(!n)return console.error("[WizardCore] Unknown step:",e),void(this.container.innerHTML=this.renderError("Paso desconocido"));console.log("[WizardCore] Rendering step:",e),this.container.innerHTML="";var t=document.createElement("div");t.className="wizard-wrapper";var a=document.createElement("div");a.className="wizard-header";var o=this.renderBrandingHeader();a.appendChild(o);var r=this.renderUnifiedProgressBar(e);a.appendChild(r),t.appendChild(a);var i=this.renderComicBubble();t.appendChild(i);var s=document.createElement("div");s.className="wizard-content",s.innerHTML=n.component(),t.appendChild(s);var c=this.renderNavigation(e);t.appendChild(c),this.container.appendChild(t),this.attachEventListeners(e)}},{key:"calculateRemainingTime",value:function(e){for(var n={"info-basica":3,cargos:5,riesgos:8,niveles:6,controles:4,resumen:2},t=0,a=e+1;a<this.steps.length;a++){t+=n[this.steps[a].id]||3}return t}},{key:"renderBrandingHeader",value:function(){var e=document.createElement("div");return e.className="wizard-branding-header",e.innerHTML='\n      <div class="wizard-branding-content">\n        <div class="wizard-logo">\n          <a href="../index.html" aria-label="Volver al inicio">\n            <img src="../assets/images/logo_negro_vectores.svg"\n                 alt="Genesys Medicina Laboral"\n                 loading="eager">\n          </a>\n        </div>\n        <div class="wizard-title-group">\n          <h1 class="wizard-title">\n            <i class="fas fa-clipboard-list"></i>\n            Asistente de Matriz de Riesgos\n          </h1>\n          <p class="wizard-subtitle">\n            Genera tu matriz profesional en 6 pasos sencillos\n          </p>\n        </div>\n      </div>\n      <div class="wizard-header-actions">\n        <button id="btn-import-json" class="wizard-import-btn" type="button" title="Importar datos desde JSON">\n          <i class="fas fa-file-import"></i>\n          <span>Importar JSON</span>\n        </button>\n      </div>\n    ',e}},{key:"renderUnifiedProgressBar",value:function(e){var n=this.steps.findIndex((function(n){return n.id===e})),t=(n+1)/this.steps.length*100,a=(this.state.data.formData,(this.state.data.formData.cargos||[]).reduce((function(e,n){var t;return e+((null===(t=n.ges)||void 0===t?void 0:t.length)||0)}),0),document.createElement("div"));return a.className="wizard-progress-unified",a.id="wizard-progress-unified",a.innerHTML='\n      <div class="wizard-progress-unified-content">\n\n        \x3c!-- Left: Spacer (botón "Volver" removido - ya hay botones "Anterior") --\x3e\n        <div class="progress-left">\n          <div class="progress-spacer"></div>\n        </div>\n\n        \x3c!-- Center: Step Dots + Progress Bar --\x3e\n        <div class="progress-center">\n          <div class="wizard-progress-steps">\n            '.concat(this.steps.map((function(e,t){var a="wizard-progress-step";return t<n&&(a+=" completed"),t===n&&(a+=" active"),'\n                <div class="'.concat(a,'"\n                     data-step="').concat(e.id,'"\n                     role="button"\n                     tabindex="0"\n                     aria-label="').concat(e.title).concat(t<n?" - Completado":t===n?" - Paso actual":"",'"\n                     title="').concat(e.title,'">\n                  <i class="').concat(e.icon,'"></i>\n                  <span class="step-tooltip">').concat(e.title,"</span>\n                </div>\n              ")})).join(""),'\n          </div>\n\n          <div class="wizard-progress-bar-track">\n            <div class="wizard-progress-bar-fill"\n                 style="width: ').concat(t,'%"\n                 role="progressbar"\n                 aria-valuenow="').concat(t,'"\n                 aria-valuemin="0"\n                 aria-valuemax="100"\n                 aria-label="Progreso: ').concat(Math.round(t),'%">\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Right: Placeholder (comic bubble ahora es fixed) --\x3e\n        <div class="progress-right">\n          \x3c!-- Espacio reservado para balance visual --\x3e\n        </div>\n\n      </div>\n    '),a}},{key:"renderComicBubble",value:function(){var e=this.state.data.formData,n=this.state.data.formData.cargos||[],t=n.reduce((function(e,n){var t;return e+((null===(t=n.ges)||void 0===t?void 0:t.length)||0)}),0),a=n.reduce((function(e,n){return e+(parseInt(n.numPersonas)||0)}),0),o=document.getElementById("wizard-comic-bubble");if(o){var r=o.querySelector(".company-name");r&&e.nombreEmpresa&&(r.textContent=e.nombreEmpresa);var i=o.querySelectorAll(".stat-value");return i.length>=3&&(i[0].textContent=n.length,i[1].textContent=a,i[2].textContent=t),o}return(o=document.createElement("div")).className="wizard-comic-bubble",o.id="wizard-comic-bubble",o.innerHTML='\n      <div class="comic-bubble-content">\n        '.concat(e.nombreEmpresa?'\n          <div class="comic-bubble-company">\n            <i class="fas fa-building"></i>\n            <span class="company-name">'.concat(e.nombreEmpresa,"</span>\n          </div>\n        "):"",'\n\n        <div class="comic-bubble-stats">\n          <div class="stat-item">\n            <i class="fas fa-user-tie"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(n.length,'</span>\n              <span class="stat-label">Cargos</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-users"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(a,'</span>\n              <span class="stat-label">Trabajadores</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(t,'</span>\n              <span class="stat-label">Riesgos</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Cola SVG triángulo simple con punta hacia abajo (sin borde superior) --\x3e\n      <svg class="comic-bubble-tail" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Triángulo relleno --\x3e\n        <polygon points="0,0 20,0 10,15" fill="#ffffff"/>\n        \x3c!-- Bordes laterales (sin la línea superior) --\x3e\n        <line x1="0" y1="0" x2="10" y2="15" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round"/>\n        <line x1="20" y1="0" x2="10" y2="15" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round"/>\n      </svg>\n    '),o}},{key:"renderProgressBar",value:function(e){return console.warn("[WizardCore] renderProgressBar is deprecated, use renderUnifiedProgressBar"),this.renderUnifiedProgressBar(e)}},{key:"renderContextBar",value:function(){var e=this.state.data.formData,n=this.state.data.formData.cargos||[],t=n.reduce((function(e,n){var t;return e+((null===(t=n.ges)||void 0===t?void 0:t.length)||0)}),0),a=document.createElement("div");return a.className="wizard-context-bar",a.id="wizard-context-bar",a.innerHTML='\n      <div class="context-bar-content" id="wizard-context-content">\n        '.concat(e.nombreEmpresa?'\n          <div class="context-item context-item--empresa">\n            <i class="fas fa-building"></i>\n            <div class="context-item-info">\n              <span class="context-item-label">Empresa</span>\n              <span class="context-item-value">'.concat(e.nombreEmpresa,"</span>\n            </div>\n          </div>\n        "):"",'\n\n        <div class="context-item context-item--cargos">\n          <i class="fas fa-users"></i>\n          <div class="context-item-info">\n            <span class="context-item-label">Cargos</span>\n            <span class="context-item-value">').concat(n.length,'</span>\n          </div>\n        </div>\n\n        <div class="context-item context-item--riesgos">\n          <i class="fas fa-exclamation-triangle"></i>\n          <div class="context-item-info">\n            <span class="context-item-label">Riesgos</span>\n            <span class="context-item-value">').concat(t,"</span>\n          </div>\n        </div>\n      </div>\n    "),a}},{key:"updateContextBar",value:function(){var e=document.getElementById("wizard-comic-bubble");if(e){var n=this.state.data.formData,t=this.state.data.formData.cargos||[],a=t.reduce((function(e,n){var t;return e+((null===(t=n.ges)||void 0===t?void 0:t.length)||0)}),0),o=t.reduce((function(e,n){return e+(parseInt(n.numPersonas)||0)}),0),r=e.querySelector(".comic-bubble-content");r&&(r.innerHTML="\n        ".concat(n.nombreEmpresa?'\n          <div class="comic-bubble-company">\n            <i class="fas fa-building"></i>\n            <span class="company-name">'.concat(n.nombreEmpresa,"</span>\n          </div>\n        "):"",'\n\n        <div class="comic-bubble-stats">\n          <div class="stat-item">\n            <i class="fas fa-user-tie"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(t.length,'</span>\n              <span class="stat-label">Cargos</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-users"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(o,'</span>\n              <span class="stat-label">Trabajadores</span>\n            </div>\n          </div>\n\n          <div class="stat-item">\n            <i class="fas fa-exclamation-triangle"></i>\n            <div class="stat-content">\n              <span class="stat-value">').concat(a,'</span>\n              <span class="stat-label">Riesgos</span>\n            </div>\n          </div>\n        </div>\n      '),e.classList.add("bounce-update"),setTimeout((function(){e.classList.remove("bounce-update")}),500)),console.log("[WizardCore] Comic bubble updated:",{cargos:t.length,riesgos:a})}else console.warn("[WizardCore] Comic bubble not found in DOM, skipping update")}},{key:"renderNavigation",value:function(e){var n=this,t=this.steps.findIndex((function(n){return n.id===e})),a=0===t,o=t===this.steps.length-1,r=document.createElement("div");return r.className="wizard-navigation",r.innerHTML="\n      ".concat(a?"":'\n        <button class="wizard-btn wizard-btn-back"\n                data-action="back"\n                data-keyboard-shortcut="Shift + Enter">\n          <i class="fas fa-arrow-left"></i>\n          Anterior\n        </button>\n      ','\n\n      <button class="wizard-btn wizard-btn-next"\n              data-action="next"\n              data-keyboard-shortcut="Enter">\n        ').concat(o?"Generar Documentos":"Siguiente","\n        ").concat(o?'<i class="fas fa-paper-plane"></i>':'<i class="fas fa-arrow-right"></i>',"\n      </button>\n    "),setTimeout((function(){var e,t;n.keyboardTooltips&&Gn(n.keyboardTooltips),n.keyboardTooltips=(e=document.querySelectorAll("[data-keyboard-shortcut]"),t=[],e.forEach((function(e){var n=new Fn(e);t.push(n)})),console.log("✅ Keyboard tooltips initialized for ".concat(e.length," buttons")),t)}),0),r}},{key:"renderError",value:function(e){return'\n      <div class="wizard-error">\n        <div class="error-content">\n          <strong>Error</strong>\n          <p>'.concat(e,"</p>\n        </div>\n      </div>\n    ")}},{key:"renderInfoBasica",value:function(){var e,n=this.state.data.formData,t=this.state.data.catalogos;return'\n      <div class="wizard-step" data-step="info-basica">\n        <div class="wizard-step-header">\n          <h2>\n            <i class="fas fa-building wizard-icon wizard-icon--primary"></i>\n            Información Básica de tu Empresa\n          </h2>\n          <p>Comencemos con los datos esenciales de tu organización</p>\n        </div>\n\n        <div class="wizard-form">\n          \x3c!-- Grid de 2 columnas en desktop, 1 en mobile --\x3e\n          <div class="wizard-form-grid">\n            \x3c!-- Nombre (ancho completo) --\x3e\n            <div class="form-group form-group--full-width">\n              <label for="nombreEmpresa" class="form-label-with-help">\n                <span class="form-label-text">Nombre de la Empresa *</span>\n                <button type="button" class="wizard-help-button"\n                  data-tooltip="Nombre legal completo de la empresa"\n                  data-tooltip-placement="right"\n                  aria-label="Ayuda">\n                  <i class="fas fa-question-circle"></i>\n                </button>\n              </label>\n              <input\n                type="text"\n                id="nombreEmpresa"\n                name="nombreEmpresa"\n                value="'.concat(n.nombreEmpresa||"",'"\n                placeholder="Ej: Constructora XYZ S.A.S."\n                required\n              />\n            </div>\n\n            \x3c!-- NIT --\x3e\n            <div class="form-group">\n              <label for="nit">NIT *</label>\n              <input\n                type="text"\n                id="nit"\n                name="nit"\n                value="').concat(n.nit||"",'"\n                placeholder="Ej: 900123456"\n                pattern="[0-9]{9,10}"\n                aria-describedby="hint-nit"\n                required\n              />\n              <div class="wizard-hint" id="hint-nit">\n                <i class="fas fa-info-circle"></i>\n                Solo números, entre 9 y 10 dígitos\n              </div>\n            </div>\n\n            \x3c!-- Email --\x3e\n            <div class="form-group">\n              <label for="email">Email de Contacto *</label>\n              <input\n                type="email"\n                id="email"\n                name="email"\n                value="').concat(n.email||"",'"\n                placeholder="contacto@empresa.com"\n                required\n              />\n            </div>\n\n            \x3c!-- Sector Económico con UX mejorada --\x3e\n            <div class="form-group form-group--sector-animated ').concat(n.ciiuSeccion?"sector-selected":"",'" id="sector-container">\n              \n              \x3c!-- Estado inicial: Solo dropdown de sector --\x3e\n              <div class="sector-initial ').concat(n.ciiuSeccion?"hidden":"",'" id="sector-initial">\n                <label for="ciiuSeccion" class="form-label-with-help">\n                  <span class="form-label-text">Sector Económico *</span>\n                  <button type="button" class="wizard-help-button"\n                    data-tooltip="Clasificación CIIU según la DIAN"\n                    data-tooltip-placement="right"\n                    aria-label="Ayuda">\n                    <i class="fas fa-question-circle"></i>\n                  </button>\n                </label>\n                <select\n                  id="ciiuSeccion"\n                  name="ciiuSeccion"\n                  class="wizard-enhanced-select wizard-select-sector"\n                  aria-describedby="hint-ciiu-seccion"\n                  required>\n                  <option value="">Selecciona tu sector económico...</option>\n                  ').concat((t.ciiuSecciones||[]).map((function(e){return'\n                    <option value="'.concat(e.codigo,'" ').concat(n.ciiuSeccion===e.codigo?"selected":"",">\n                      ").concat(e.nombre,"\n                    </option>\n                  ")})).join(""),'\n                </select>\n                <div class="wizard-hint" id="hint-ciiu-seccion">\n                  <i class="fas fa-info-circle"></i>\n                  Categoría principal según clasificación DIAN\n                </div>\n              </div>\n\n              \x3c!-- Estado después de seleccionar: Sector como badge editable + Dropdown actividad --\x3e\n              <div class="sector-selected-view ').concat(n.ciiuSeccion?"":"hidden",'" id="sector-selected-view">\n                \x3c!-- Badge del sector seleccionado --\x3e\n                <div class="sector-badge" id="sector-badge">\n                  <span class="sector-badge-label">Sector:</span>\n                  <span class="sector-badge-value" id="sector-badge-value">\n                    ').concat(n.ciiuSeccion&&(null===(e=(t.ciiuSecciones||[]).find((function(e){return e.codigo===n.ciiuSeccion})))||void 0===e?void 0:e.nombre)||"",'\n                  </span>\n                  <button type="button" class="sector-edit-btn" id="sector-edit-btn" title="Cambiar sector">\n                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>\n                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>\n                    </svg>\n                  </button>\n                </div>\n\n                \x3c!-- Dropdown de Actividad Económica --\x3e\n                <div class="activity-dropdown-container">\n                  <label for="ciiuDivision" class="form-label-with-help">\n                    <span class="form-label-text">Actividad Económica *</span>\n                    <button type="button" class="wizard-help-button"\n                      data-tooltip="Actividad específica dentro del sector"\n                      data-tooltip-placement="right"\n                      aria-label="Ayuda">\n                      <i class="fas fa-question-circle"></i>\n                    </button>\n                  </label>\n                  <select\n                    id="ciiuDivision"\n                    name="ciiuDivision"\n                    class="wizard-enhanced-select wizard-select-activity"\n                    aria-describedby="hint-ciiu-division"\n                    required>\n                    <option value="">Selecciona tu actividad económica...</option>\n                    \x3c!-- Opciones cargadas dinámicamente --\x3e\n                  </select>\n                  <div class="wizard-hint" id="hint-ciiu-division">\n                    <i class="fas fa-info-circle"></i>\n                    Actividad específica de tu empresa\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Ciudad (con datalist desde BD) --\x3e\n            <div class="form-group">\n              <label for="ciudad">Ciudad *</label>\n              <input\n                type="text"\n                id="ciudad"\n                name="ciudad"\n                list="ciudades-datalist"\n                value="').concat(n.ciudad||"",'"\n                placeholder="Ej: Bogotá"\n                autocomplete="off"\n                required\n              />\n              <datalist id="ciudades-datalist">\n                ').concat((t.ciudades||[]).map((function(e){return'\n                  <option value="'.concat(e.nombre,'" data-departamento="').concat(e.departamento,'">\n                ')})).join(""),'\n              </datalist>\n              <div class="wizard-hint">\n                <i class="fas fa-info-circle"></i>\n                Escribe para buscar tu ciudad\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ')}},{key:"renderCargoCharacteristics",value:function(e){var n=[];return e.tareasRutinarias&&n.push({icon:"fas fa-repeat",label:"Tareas repetitivas",type:"warning"}),e.conduceVehiculo&&n.push({icon:"fas fa-car",label:"Conduce vehículo",type:"warning"}),e.manipulaAlimentos&&n.push({icon:"fas fa-utensils",label:"Manipula alimentos",type:"danger"}),e.trabajaAlturas&&n.push({icon:"fas fa-arrow-up",label:"Trabajo en alturas",type:"danger"}),e.trabajaEspaciosConfinados&&n.push({icon:"fas fa-door-closed",label:"Espacios confinados",type:"danger"}),0===n.length?"":'\n      <div class="cargo-characteristics">\n        '.concat(n.map((function(e){return'\n          <span class="cargo-badge cargo-badge--'.concat(e.type,'">\n            <i class="').concat(e.icon,'"></i>\n            ').concat(e.label,"\n          </span>\n        ")})).join(""),"\n      </div>\n    ")}},{key:"renderCargos",value:function(){var e=this,n=this.state.getCargos(),t=this.carouselIndex||0;return'\n      <div class="wizard-step" data-step="cargos">\n        <h2>Cargos de tu Empresa</h2>\n        <p>Agrega los puestos de trabajo que deseas evaluar</p>\n\n        '.concat(0===n.length?'\n          <div class="wizard-form">\n            <div class="wizard-hint" style="margin-bottom: 3rem;">\n              <i class="fas fa-info-circle"></i>\n              Aún no has agregado ningún cargo\n            </div>\n            <button class="wizard-btn wizard-btn-primary wizard-btn-add-first" data-action="add-cargo" style="display: block; margin: 0 auto; padding: 2rem 4rem; font-size: 1.8rem;">\n              <i class="fas fa-plus" style="margin-right: 1rem;"></i>\n              Agrega acá tu primer cargo\n            </button>\n          </div>\n        ':'\n          \x3c!-- Navigation arrows - OUTSIDE wizard-form --\x3e\n          <button class="carousel-nav carousel-nav--prev" data-action="carousel-prev" '.concat(0===t?"disabled":"",'>\n            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n              <path d="M15 18l-6-6 6-6"/>\n            </svg>\n          </button>\n\n          <button class="carousel-nav carousel-nav--next" data-action="carousel-next" ').concat(t>=n.length-1?"disabled":"",'>\n            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n              <path d="M9 6l6 6-6 6"/>\n            </svg>\n          </button>\n\n          <div class="wizard-form">\n            <div class="cargos-list">\n              \x3c!-- Carousel track --\x3e\n              <div class="cargos-carousel" style="transform: translateX(calc(-').concat(100*t,"% - ").concat(2*t,'rem))">\n                ').concat(n.map((function(n,t){var a;return'\n                  <div class="cargo-card" data-cargo-index="'.concat(t,'">\n                    ').concat(n.area?'<div class="cargo-area">'.concat(n.area,"</div>"):"",'\n                    <div class="cargo-card-header">\n                      <h3>').concat(n.nombre,'</h3>\n                      <div class="cargo-actions">\n                        <button class="btn-icon" data-action="edit-cargo" data-index="').concat(t,'" title="Editar cargo">\n                          <i class="fas fa-edit"></i>\n                        </button>\n                        <button class="btn-icon btn-icon--danger" data-action="remove-cargo" data-index="').concat(t,'" title="Eliminar cargo">\n                          <i class="fas fa-trash"></i>\n                        </button>\n                      </div>\n                    </div>\n                    <div class="cargo-card-body">\n                      \x3c!-- Scrollable description with max height --\x3e\n                      <div class="cargo-description-scroll">\n                        <p>').concat(n.descripcion||"Sin descripción","</p>\n                      </div>\n\n                      \x3c!-- Special characteristics badges --\x3e\n                      ").concat(e.renderCargoCharacteristics(n),'\n\n                      <div class="cargo-meta">\n                        <span><i class="fas fa-user"></i> ').concat(n.numPersonas,' persona(s)</span>\n                        <span><i class="fas fa-exclamation-triangle"></i> ').concat((null===(a=n.gesSeleccionados)||void 0===a?void 0:a.length)||0," riesgo(s)</span>\n                        ").concat(n.zona?'<span><i class="fas fa-map-marker-alt"></i> '.concat(n.zona,"</span>"):"","\n                      </div>\n                    </div>\n                  </div>\n                ")})).join(""),'\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Carousel dots indicator - OUTSIDE wizard-form --\x3e\n          <div class="carousel-dots">\n            ').concat(n.map((function(e,n){return'\n              <button\n                class="carousel-dot '.concat(n===t?"active":"",'"\n                data-action="carousel-goto"\n                data-index="').concat(n,'"\n                aria-label="Ir a cargo ').concat(n+1,'"\n              ></button>\n            ')})).join(""),"\n          </div>\n        "),'\n\n        \x3c!-- FAB (Floating Action Button) - Visible solo cuando hay cargos --\x3e\n        <button\n          class="fab ').concat(0===n.length?"fab--hidden":"",'"\n          data-action="add-cargo"\n          aria-label="Agregar un nuevo cargo"\n        >\n          <span class="fab-text">Agregar un nuevo cargo</span>\n          <svg class="fab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            \x3c!-- Worker icon --\x3e\n            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="white"/>\n            \x3c!-- Plus icon (small, top-right) --\x3e\n            <circle cx="18" cy="6" r="5" fill="white"/>\n            <path d="M18 4v4m-2-2h4" stroke="#5dc4af" stroke-width="1.5" stroke-linecap="round"/>\n          </svg>\n        </button>\n        \x3c!-- Tooltip nativo usando title attribute (eliminado fab-tooltip custom) --\x3e\n\n        \x3c!-- Modal para agregar cargo (hidden by default) --\x3e\n          <div id="modal-add-cargo" class="wizard-modal" style="display: none;">\n            <div class="wizard-modal-content wizard-modal-content--two-cols">\n              <div class="wizard-modal-header">\n                <h3 id="modal-title-cargo">Agregar Nuevo Cargo</h3>\n                <div class="wizard-modal-header-actions">\n                  <button class="wizard-btn wizard-btn-primary wizard-btn-compact" data-action="save-cargo">\n                    <i class="fas fa-save"></i>\n                    Guardar\n                  </button>\n                  <button class="btn-close" data-action="close-modal">\n                    <i class="fas fa-times"></i>\n                  </button>\n                </div>\n              </div>\n              <div class="wizard-modal-body wizard-modal-body--two-cols">\n                \x3c!-- Columna Izquierda: Información Básica --\x3e\n                <div class="wizard-modal-col wizard-modal-col--basic">\n                  <div class="form-group">\n                    <label for="cargo-nombre">Nombre del Cargo *</label>\n                    <input\n                      type="text"\n                      id="cargo-nombre"\n                      placeholder="Ej: Operario de Construcción"\n                      required\n                    />\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-descripcion">Descripción (opcional)</label>\n                    <textarea\n                      id="cargo-descripcion"\n                      rows="4"\n                      placeholder="Breve descripción de las funciones del cargo"\n                    ></textarea>\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-num-personas">Número de Personas *</label>\n                    <input\n                      type="number"\n                      id="cargo-num-personas"\n                      min="1"\n                      value="1"\n                      required\n                    />\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-area">Área o Departamento del Cargo *</label>\n                    <input\n                      type="text"\n                      id="cargo-area"\n                      list="areas-list"\n                      placeholder="Ej: Producción, Administración, etc."\n                      required\n                    />\n                    <datalist id="areas-list">\n                      <option value="Producción">\n                      <option value="Administración">\n                      <option value="Logística">\n                      <option value="Ventas">\n                      <option value="Mantenimiento">\n                      <option value="Calidad">\n                      <option value="Operaciones">\n                      <option value="Recursos Humanos">\n                      <option value="Contabilidad">\n                      <option value="Sistemas">\n                      <option value="Finanzas">\n                      <option value="Compras">\n                      <option value="Almacén">\n                    </datalist>\n                  </div>\n                  <div class="form-group">\n                    <label for="cargo-zona">Zona/Lugar de Trabajo *</label>\n                    <input\n                      type="text"\n                      id="cargo-zona"\n                      placeholder="Ej: Planta 1, Oficina Principal, Bodega A"\n                      required\n                    />\n                  </div>\n                </div>\n\n                \x3c!-- Columna Derecha: Características Especiales --\x3e\n                <div class="wizard-modal-col wizard-modal-col--toggles">\n                  <div class="form-group">\n                  <label class="form-label-section">\n                    <i class="fas fa-shield-alt"></i>\n                    Características Especiales\n                  </label>\n                  <div class="toggles-grid-modern">\n                    \x3c!-- Warning toggles (amarillo) --\x3e\n                    <div class="toggle-group toggle-group--warning">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-repeat toggle-icon toggle-icon--warning"></i>\n                          <span class="toggle-label">Tareas repetitivas</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--warning">\n                          <input type="checkbox" id="cargo-tareasRutinarias" name="tareasRutinarias" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Puede requerir pausas activas y rotación de tareas\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--warning">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-car toggle-icon toggle-icon--warning"></i>\n                          <span class="toggle-label">Conduce vehículo</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--warning">\n                          <input type="checkbox" id="cargo-conduceVehiculo" name="conduceVehiculo" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere licencia de conducción vigente\n                      </div>\n                    </div>\n\n                    \x3c!-- Danger toggles (rojo) --\x3e\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-utensils toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Manipula alimentos</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-manipulaAlimentos" name="manipulaAlimentos" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere certificado de manipulación de alimentos vigente\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-arrow-up toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Trabaja en alturas</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-trabajaAlturas" name="trabajaAlturas" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere certificado de trabajo en alturas y EPP especializado\n                      </div>\n                    </div>\n\n                    <div class="toggle-group toggle-group--danger">\n                      <div class="toggle-header">\n                        <div class="toggle-label-wrapper">\n                          <i class="fas fa-door-closed toggle-icon toggle-icon--danger"></i>\n                          <span class="toggle-label">Espacios confinados</span>\n                        </div>\n                        <div class="wizard-switch wizard-switch--danger">\n                          <input type="checkbox" id="cargo-trabajaEspaciosConfinados" name="trabajaEspaciosConfinados" />\n                          <span class="slider"></span>\n                        </div>\n                      </div>\n                      <div class="toggle-hint">\n                        <i class="fas fa-info-circle"></i>\n                        Requiere permiso de trabajo y monitor de gases continuo\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n      </div>\n    ')}},{key:"renderRiesgos",value:function(){var e=this.state.getCargos();return 0===e.length?'\n        <div class="wizard-step" data-step="riesgos">\n          <div class="wizard-hint" style="margin-top: 5rem;">\n            <i class="fas fa-exclamation-triangle"></i>\n            Debes agregar al menos un cargo antes de seleccionar riesgos.\n          </div>\n        </div>\n      ':1===e.length?'\n        <div class="wizard-step" data-step="riesgos">\n          <div id="riesgo-selector-0" class="riesgo-selector-container"></div>\n        </div>\n      ':'\n      <div class="wizard-step" data-step="riesgos">\n        <h2>Riesgos por Cargo</h2>\n        <p>Selecciona los riesgos para cada uno de tus cargos usando las pestañas</p>\n\n        \x3c!-- P0-3: ARIA attributes para accesibilidad + P1-2: Wrapper para scroll indicators --\x3e\n        <div class="cargo-tabs-wrapper">\n          <div class="cargo-tabs" role="tablist" aria-label="Lista de cargos">\n            '.concat(e.map((function(e,n){var t,a=(null===(t=e.ges)||void 0===t?void 0:t.length)||0,o=a>0;return'\n                <button\n                  class="cargo-tab '.concat(0===n?"active":"",'"\n                  role="tab"\n                  id="cargo-tab-').concat(n,'"\n                  aria-selected="').concat(0===n,'"\n                  aria-controls="cargo-panel-').concat(n,'"\n                  tabindex="').concat(0===n?0:-1,'"\n                  data-action="switch-cargo-tab"\n                  data-cargo-index="').concat(n,'"\n                  data-has-risks="').concat(o,'"\n                  data-cargo-name="').concat(e.nombre,'"\n                >\n                  <span class="cargo-name">').concat(e.nombre,'</span>\n                  <span class="cargo-count" aria-label="').concat(a," ").concat(1===a?"riesgo seleccionado":"riesgos seleccionados",'">\n                    ').concat(a,"\n                  </span>\n                </button>\n              ")})).join(""),'\n          </div>\n        </div>\n\n        \x3c!-- P0-3: Selector containers con role="tabpanel" --\x3e\n        ').concat(e.map((function(e,n){return'\n          <div\n            id="riesgo-selector-'.concat(n,'"\n            class="riesgo-selector-container"\n            role="tabpanel"\n            aria-labelledby="cargo-tab-').concat(n,'"\n            tabindex="0"\n            style="').concat(0===n?"":"display: none;",'"\n          ></div>\n        ')})).join(""),"\n      </div>\n    ")}},{key:"renderNiveles",value:function(){var e=this.state.getCargos(),n='\n      <div class="wizard-step" data-step="niveles">\n    ';return e.length>1&&(n+='\n        <div class="niveles-cargo-tabs">\n          '.concat(e.map((function(e,n){var t=e.gesSeleccionados||e.ges||[],a=t.length,o=t.filter((function(e){var n=e.niveles||{};return null!==n.ND&&void 0!==n.ND&&null!==n.NE&&void 0!==n.NE&&null!==n.NC&&void 0!==n.NC})).length,r=a>0&&o===a,i=r?"fa-check-circle completed":"fa-circle";return'\n              <button\n                class="niveles-cargo-tab '.concat(0===n?"active":""," ").concat(r?"completed":"",'"\n                data-action="switch-cargo-niveles"\n                data-cargo-index="').concat(n,'"\n                data-cargo-name="').concat(e.nombre,'"\n              >\n                <i class="fas ').concat(i,' cargo-status-icon"></i>\n                <span class="cargo-tab__name">').concat(e.nombre,'</span>\n                <span class="cargo-tab__count">').concat(o,"/").concat(a,"</span>\n              </button>\n            ")})).join(""),"\n        </div>\n      ")),e.forEach((function(e,t){n+='\n        <div\n          id="niveles-container-'.concat(t,'"\n          class="niveles-cargo-container"\n          style="').concat(0===t?"":"display: none;",'"\n        ></div>\n      ')})),n+="</div>",n+='\n      <div id="niveles-cargo-tooltip" class="niveles-cargo-tooltip" role="tooltip">\n        <div class="niveles-cargo-tooltip__header">\n          <i class="fas fa-briefcase"></i>\n          <span id="tooltip-cargo-name">Cargo</span>\n          <span class="tooltip-stats" id="tooltip-stats">0/0</span>\n        </div>\n        <div class="niveles-cargo-tooltip__divider"></div>\n        <div class="niveles-cargo-tooltip__body">\n          <span class="niveles-cargo-tooltip__label">Riesgos (GES)</span>\n          <ul class="niveles-cargo-tooltip__list" id="tooltip-ges-list">\n          </ul>\n        </div>\n      </div>\n    '}},{key:"renderControles",value:function(){var e=this;console.log("[WizardCore] Rendering controles step with ControlesManager");return setTimeout((function(){e.initControlesManager()}),0),'\n      <div class="wizard-step" data-step="controles">\n        <div id="controles-container"></div>\n      </div>\n    '}},{key:"initControlesManager",value:function(){var e=this,n=document.getElementById("controles-container");n?(this.controlesManager&&this.controlesManager.destroy(),this.controlesManager=new In("#controles-container",this.state),this.controlesManager.render(),n.addEventListener("controles:completed",(function(n){console.log("[WizardCore] Controles completed",n.detail),e.avanzarPaso()})),console.log("[WizardCore] ControlesManager initialized")):console.error("[WizardCore] controles-container not found")}},{key:"avanzarPaso",value:function(){var e=this.state.getCurrentStep(),n=this.steps.findIndex((function(n){return n.id===e}));if(n<this.steps.length-1){var t=this.steps[n+1];console.log("[WizardCore] Avanzando de ".concat(e," a ").concat(t.id)),this.state.setCurrentStep(t.id)}else console.warn("[WizardCore] Ya estás en el último paso")}},{key:"renderResumen",value:function(){var e=this.state.data.formData,n=this.state.getCargos(),t=this.state.getAnalytics(),a=n.reduce((function(e,n){var t;return e+((null===(t=n.gesSeleccionados)||void 0===t?void 0:t.length)||0)}),0),o=n.reduce((function(e,n){return e+(parseInt(n.numPersonas)||0)}),0),r=0,i=0;return n.forEach((function(e){e.gesSeleccionados.forEach((function(e){e.niveles&&null!==e.niveles.NR&&r++,e.controles&&Object.values(e.controles).some((function(e){return e&&e.trim()}))&&i++}))})),'\n      <div class="wizard-step" data-step="resumen">\n        <div class="resumen-header">\n          <h2><i class="fas fa-check-circle"></i> Resumen Final</h2>\n          <p>Revisa la información antes de generar tus documentos</p>\n        </div>\n\n        <div class="resumen-container">\n          \x3c!-- Información Básica --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-building"></i> Información de la Empresa</h3>\n            <div class="resumen-details">\n              <div class="detail-item">\n                <span class="detail-label">Empresa:</span>\n                <span class="detail-value">'.concat(e.nombreEmpresa||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">NIT:</span>\n                <span class="detail-value">').concat(e.nit||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">Email:</span>\n                <span class="detail-value">').concat(e.email||"Sin especificar",'</span>\n              </div>\n              <div class="detail-item">\n                <span class="detail-label">Sector Económico:</span>\n                <span class="detail-value">').concat(e.sector||"Sin especificar",'</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Cargos Summary --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-users"></i> Cargos Definidos (').concat(n.length,')</h3>\n            <div class="cargos-list">\n              ').concat(n.map((function(e,n){var t;return'\n                <div class="cargo-item">\n                  <div class="cargo-header">\n                    <span class="cargo-number">'.concat(n+1,"</span>\n                    <strong>").concat(e.nombre,'</strong>\n                  </div>\n                  <div class="cargo-stats">\n                    <span><i class="fas fa-user"></i> ').concat(e.numPersonas,' persona(s)</span>\n                    <span><i class="fas fa-exclamation-triangle"></i> ').concat((null===(t=e.gesSeleccionados)||void 0===t?void 0:t.length)||0," riesgo(s)</span>\n                  </div>\n                </div>\n              ")})).join(""),'\n            </div>\n          </div>\n\n          \x3c!-- Estadísticas Globales --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-chart-bar"></i> Estadísticas del Análisis</h3>\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-users"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(n.length,'</div>\n                  <div class="stat-label">Cargos</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-user-friends"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(o,'</div>\n                  <div class="stat-label">Personas</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(a,'</div>\n                  <div class="stat-label">Riesgos (GES)</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-calculator"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(r,'</div>\n                  <div class="stat-label">Niveles Configurados</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-shield-alt"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(i,'</div>\n                  <div class="stat-label">Controles Definidos</div>\n                </div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-icon"><i class="fas fa-clock"></i></div>\n                <div class="stat-content">\n                  <div class="stat-value">').concat(Math.floor(t.totalTime/1e3/60),'</div>\n                  <div class="stat-label">Minutos</div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Documentos que se generarán --\x3e\n          <div class="resumen-section">\n            <h3><i class="fas fa-file-alt"></i> Documentos que se Generarán</h3>\n            <div class="documentos-list">\n              <div class="documento-item">\n                <i class="fas fa-file-excel documento-icon excel"></i>\n                <div class="documento-info">\n                  <strong>Matriz de Riesgos Profesionales</strong>\n                  <span>Archivo Excel con análisis completo de todos los riesgos</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Profesiograma</strong>\n                  <span>PDF con perfil profesional y requisitos de cada cargo</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Perfil de Cargo</strong>\n                  <span>PDF detallado de competencias y responsabilidades</span>\n                </div>\n              </div>\n              <div class="documento-item">\n                <i class="fas fa-file-pdf documento-icon pdf"></i>\n                <div class="documento-info">\n                  <strong>Cotización de Exámenes</strong>\n                  <span>PDF con precios y detalles de exámenes médicos ocupacionales</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Info Box --\x3e\n          <div class="wizard-hint info">\n            <i class="fas fa-info-circle"></i>\n            <div>\n              <strong>¿Qué sucede al generar documentos?</strong>\n              <p>Los documentos se generarán de forma asíncrona en nuestros servidores. Recibirás los links de descarga cuando estén listos (usualmente en 1-2 minutos).</p>\n            </div>\n          </div>\n\n          \x3c!-- Submit Section --\x3e\n          <div id="submit-section" class="submit-section">\n            <button id="btn-generar-documentos" class="btn-wizard btn-wizard--primary btn-large">\n              <i class="fas fa-rocket"></i>\n              Generar Documentos\n            </button>\n            <button class="btn-wizard btn-wizard--secondary" data-action="back">\n              <i class="fas fa-arrow-left"></i>\n              Volver a Controles\n            </button>\n          </div>\n\n          \x3c!-- Progress/Results Section (hidden initially) --\x3e\n          <div id="generation-status" class="generation-status" style="display: none;">\n            \x3c!-- Will be populated dynamically --\x3e\n          </div>\n        </div>\n      </div>\n    ')}},{key:"attachResumenListeners",value:function(){var e=this,n=this.container.querySelector("#btn-generar-documentos");n&&n.addEventListener("click",(function(){e.handleGenerarDocumentos()}))}},{key:"handleGenerarDocumentos",value:(g=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[WizardCore] 🚀 handleGenerarDocumentos iniciado"),this.showRegistrationModal();case 2:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"showRegistrationModal",value:function(){var e=this,n=this.state.exportForSubmission().userData,t='\n      <div id="registration-modal" class="wizard-modal" style="display: block;">\n        <div class="wizard-modal-content" style="max-width: 500px;">\n          <div class="wizard-modal-header">\n            <h3 style="margin: 0; color: #383d47;">\n              <i class="fas fa-user-check" style="color: #5dc4af; margin-right: 8px;"></i>\n              Completa tu Registro\n            </h3>\n            <button type="button" class="btn-close" id="close-registration-modal" aria-label="Cerrar">\n              <i class="fas fa-times"></i>\n            </button>\n          </div>\n\n          <div class="wizard-modal-body">\n            <p style="margin-bottom: 24px; color: #666; font-size: 14px;">\n              Para generar tus documentos, necesitamos algunos datos adicionales:\n            </p>\n\n            <form id="registration-form">\n              \x3c!-- Pre-filled company data (readonly) --\x3e\n              <div style="margin-bottom: 20px;">\n                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Nombre de la Empresa\n                </label>\n                <input\n                  type="text"\n                  value="'.concat(n.nombreEmpresa||"",'"\n                  readonly\n                  style="background: #f5f5f5; cursor: not-allowed;"\n                />\n              </div>\n\n              <div style="margin-bottom: 20px;">\n                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  NIT\n                </label>\n                <input\n                  type="text"\n                  value="').concat(n.nit||"",'"\n                  readonly\n                  style="background: #f5f5f5; cursor: not-allowed;"\n                />\n              </div>\n\n              \x3c!-- User data fields (required) --\x3e\n              <div style="margin-bottom: 20px;">\n                <label for="modal-email" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Correo Electrónico *\n                </label>\n                <input\n                  type="email"\n                  id="modal-email"\n                  name="email"\n                  placeholder="contacto@empresa.com"\n                  required\n                  autocomplete="email"\n                />\n              </div>\n\n              <div style="margin-bottom: 20px;">\n                <label for="modal-password" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Contraseña *\n                </label>\n                <input\n                  type="password"\n                  id="modal-password"\n                  name="password"\n                  placeholder="Mínimo 6 caracteres"\n                  required\n                  minlength="6"\n                  autocomplete="new-password"\n                />\n                <small style="display: block; margin-top: 4px; color: #666; font-size: 12px;">\n                  Usarás este correo y contraseña para acceder a tus documentos\n                </small>\n              </div>\n\n              <div style="margin-bottom: 24px;">\n                <label for="modal-nombre" style="display: block; font-weight: 600; margin-bottom: 8px; color: #383d47;">\n                  Nombre del Contacto\n                </label>\n                <input\n                  type="text"\n                  id="modal-nombre"\n                  name="nombre"\n                  placeholder="Ej: Juan Pérez"\n                  autocomplete="name"\n                />\n              </div>\n\n              <div id="modal-error" style="display: none; padding: 12px; background: #fee; border: 1px solid #fcc; border-radius: 8px; margin-bottom: 16px; color: #c33; font-size: 14px;">\n              </div>\n\n              <button type="submit" class="wizard-btn-primary wizard-btn-full submit-modal-btn">\n                <i class="fas fa-paper-plane"></i>\n                Registrar y Generar Documentos\n              </button>\n            </form>\n          </div>\n        </div>\n      </div>\n    '),a=document.createElement("div");a.innerHTML=t,document.body.appendChild(a);var o=document.getElementById("registration-modal"),i=document.getElementById("close-registration-modal"),c=document.getElementById("registration-form");i.addEventListener("click",(function(){document.body.removeChild(a)})),o.addEventListener("click",(function(e){e.target===o&&document.body.removeChild(a)})),c.addEventListener("submit",function(){var t=r(s().mark((function t(o){var r,i,l,d,u,g,p,v,f,h,m;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o.preventDefault(),console.log("[WizardCore] 📋 Formulario de registro enviado"),(d=document.getElementById("modal-error"))&&(d.style.display="none"),u={nombreEmpresa:n.nombreEmpresa,nit:n.nit,email:(null===(r=document.getElementById("modal-email"))||void 0===r?void 0:r.value.trim())||"",password:(null===(i=document.getElementById("modal-password"))||void 0===i?void 0:i.value)||"",nombre:(null===(l=document.getElementById("modal-nombre"))||void 0===l?void 0:l.value.trim())||null},console.log("[WizardCore] 👤 Datos del usuario:",u),u.email&&u.password&&u.nombreEmpresa&&u.nit){t.next=9;break}return d&&(d.textContent="Por favor completa todos los campos requeridos (*)",d.style.display="block"),t.abrupt("return");case 9:return g=c.querySelector(".submit-modal-btn"),p=(null==g?void 0:g.textContent)||"Registrar",g&&(g.disabled=!0,g.innerHTML='<i class="fas fa-spinner fa-spin"></i> Registrando...'),t.prev=12,console.log("[WizardCore] 📤 Enviando al backend..."),v=e.state.exportForSubmission(),f={formData:v.formData,userData:u},console.log("[WizardCore] 📦 Payload completo:",f),t.next=19,fetch("/api/flujo-ia/registrar-y-generar",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(f)});case 19:return h=t.sent,t.next=22,h.json();case 22:if(m=t.sent,console.log("[WizardCore] 📥 Respuesta:",m),h.ok&&m.success){t.next=26;break}throw new Error(m.message||"Error ".concat(h.status));case 26:if(console.log("[WizardCore] ✅ Registro exitoso"),document.body.removeChild(a),localStorage.removeItem("wizardState"),!m.documentToken){t.next=34;break}console.log("[WizardCore] Redirigiendo a resultados.html?token="+m.documentToken),window.location.href="../pages/resultados.html?token=".concat(m.documentToken),t.next=35;break;case 34:throw new Error("El backend no devolvió un documentToken");case 35:t.next=42;break;case 37:t.prev=37,t.t0=t.catch(12),console.error("[WizardCore] ❌ Error:",t.t0),d&&(d.textContent="Error: ".concat(t.t0.message),d.style.display="block"),g&&(g.disabled=!1,g.innerHTML=p);case 42:case"end":return t.stop()}}),t,null,[[12,37]])})));return function(e){return t.apply(this,arguments)}}())}},{key:"startPollingStatus",value:function(e,n){var t=this;this.pollingToken=e,this.pollingInterval=setInterval(r(s().mark((function n(){var a,o;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("/api/solicitud/".concat(e,"/estado"));case 3:return a=n.sent,n.next=6,a.json();case 6:if(o=n.sent,a.ok){n.next=9;break}throw new Error(o.message||"Error al obtener estado");case 9:console.log("[WizardCore] Status update:",o),t.updateStatusUI(o),"completado"!==o.estado&&"error"!==o.estado||t.stopPolling(),n.next=19;break;case 14:n.prev=14,n.t0=n.catch(0),console.error("[WizardCore] Error polling status:",n.t0),t.stopPolling(),t.updateStatusUI({estado:"error",mensaje:"Error al verificar estado. Recarga la página para continuar."});case 19:case"end":return n.stop()}}),n,null,[[0,14]])}))),3e3)}},{key:"stopPolling",value:function(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}},{key:"updateStatusUI",value:function(e){var n=this,t=this.container.querySelector("#generation-status");if(t){var a=e.estado,o=e.progreso,r=e.mensaje,i=e.previewUrls,s='\n      <div class="status-container">\n    ';"procesando"===a?s+='\n        <div class="status-header processing">\n          <i class="fas fa-spinner fa-spin"></i>\n          <h3>Generando Documentos...</h3>\n        </div>\n        <div class="progress-bar">\n          <div class="progress-fill" style="width: '.concat(o||0,'%"></div>\n        </div>\n        <p class="status-message">').concat(r||"Procesando tu solicitud...",'</p>\n        <p class="status-hint">Esto puede tomar 1-2 minutos. No cierres esta página.</p>\n      '):"completado"===a?s+='\n        <div class="status-header success">\n          <i class="fas fa-check-circle"></i>\n          <h3>¡Documentos Generados Exitosamente!</h3>\n        </div>\n        <p class="status-message">Tus documentos están listos para descargar:</p>\n        <div class="documentos-download">\n          '.concat(null!=i&&i.matriz?'\n            <a href="'.concat(i.matriz,'" target="_blank" class="download-card excel">\n              <i class="fas fa-file-excel"></i>\n              <span>Matriz de Riesgos (Excel)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=i&&i.profesiograma?'\n            <a href="'.concat(i.profesiograma,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Profesiograma (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=i&&i.perfil?'\n            <a href="'.concat(i.perfil,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Perfil de Cargo (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"","\n          ").concat(null!=i&&i.cotizacion?'\n            <a href="'.concat(i.cotizacion,'" target="_blank" class="download-card pdf">\n              <i class="fas fa-file-pdf"></i>\n              <span>Cotización (PDF)</span>\n              <i class="fas fa-download"></i>\n            </a>\n          '):"",'\n        </div>\n        <div class="wizard-hint success">\n          <i class="fas fa-check"></i>\n          Los documentos también fueron enviados a tu email: ').concat(this.state.data.formData.email,'\n        </div>\n        <button id="btn-nueva-solicitud" class="btn-wizard btn-wizard--primary">\n          <i class="fas fa-plus"></i>\n          Nueva Solicitud\n        </button>\n      '):"error"===a&&(s+='\n        <div class="status-header error">\n          <i class="fas fa-times-circle"></i>\n          <h3>Error al Generar Documentos</h3>\n        </div>\n        <p class="status-message error">'.concat(r||"Ocurrió un error inesperado.",'</p>\n        <div class="wizard-hint error">\n          <i class="fas fa-exclamation-triangle"></i>\n          Por favor contacta a soporte técnico o intenta de nuevo.\n        </div>\n        <button id="btn-reintentar" class="btn-wizard btn-wizard--primary">\n          <i class="fas fa-redo"></i>\n          Reintentar\n        </button>\n      ')),s+="</div>",t.innerHTML=s;var c=t.querySelector("#btn-nueva-solicitud");c&&c.addEventListener("click",(function(){n.state.clearStorage(),window.location.reload()}));var l=t.querySelector("#btn-reintentar");l&&l.addEventListener("click",(function(){t.style.display="none",n.container.querySelector("#submit-section").style.display="block"}))}}},{key:"attachEventListeners",value:function(e){var n=this,t=this.container.querySelector('[data-action="back"]'),a=this.container.querySelector('[data-action="next"]');switch(t&&t.addEventListener("click",(function(){return n.handleBack()})),a&&a.addEventListener("click",(function(){return n.handleNext(e)})),e){case"info-basica":this.attachInfoBasicaListeners();break;case"cargos":this.attachCargosListeners();break;case"riesgos":this.attachRiesgosListeners();break;case"niveles":this.attachNivelesListeners();break;case"controles":break;case"resumen":this.attachResumenListeners()}}},{key:"showFieldError",value:function(e,n){if(e){e.classList.add("input-error"),e.setAttribute("aria-invalid","true"),this.clearFieldError(e);var t=document.createElement("div");t.className="field-error",t.setAttribute("role","alert"),t.setAttribute("aria-live","polite"),t.innerHTML='\n      <i class="fas fa-exclamation-circle"></i>\n      <span>'.concat(n,"</span>\n    "),e.parentElement.appendChild(t);var a="error-".concat(e.id||e.name);t.id=a,e.setAttribute("aria-describedby",a)}}},{key:"clearFieldError",value:function(e){if(e){e.classList.remove("input-error"),e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby");var n=e.parentElement.querySelector(".field-error");n&&n.remove()}}},{key:"attachInfoBasicaListeners",value:function(){var e=this;this.container.querySelectorAll("#nombreEmpresa, #nit, #email, #ciiuSeccion, #ciiuDivision, #telefono, #direccion, #ciudad").forEach((function(n){n.addEventListener("input",(function(n){e.state.updateBasicInfo(n.target.name,n.target.value,!0),e.clearFieldError(n.target)})),n.addEventListener("blur",(function(n){var t=n.target.name,a=n.target.value,o=e.state.validateSingleField(t,a);o?e.showFieldError(n.target,o):e.clearFieldError(n.target),e.state.updateBasicInfo(t,a,!0)}))})),this.setupSectorAnimatedDropdown()}},{key:"setupSectorAnimatedDropdown",value:function(){var e=this,n=this.container.querySelector("#sector-container"),t=this.container.querySelector("#sector-initial"),a=this.container.querySelector("#sector-selected-view"),o=this.container.querySelector("#ciiuSeccion"),i=this.container.querySelector("#ciiuDivision"),c=this.container.querySelector("#sector-badge-value"),l=this.container.querySelector("#sector-edit-btn");if(o&&i){o.addEventListener("change",function(){var o=r(s().mark((function o(r){var l,d,u;return s().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(l=r.target.value){o.next=3;break}return o.abrupt("return");case 3:return e.state.updateBasicInfo("ciiuDivision","",!0),e.state.updateBasicInfo("sector","",!0),i&&(i.innerHTML='<option value="">Cargando actividades...</option>',i.value=""),e.state.updateBasicInfo("ciiuSeccion",l,!0),d=r.target.options[r.target.selectedIndex],u=d.text,c&&(c.textContent=u),t&&a&&(t.style.opacity="0",t.style.transform="translateY(-10px)",setTimeout((function(){t.classList.add("hidden"),a.classList.remove("hidden"),a.style.opacity="0",a.style.transform="translateY(10px)",requestAnimationFrame((function(){a.style.transition="all 0.3s ease-out",a.style.opacity="1",a.style.transform="translateY(0)"}))}),200)),n&&n.classList.add("sector-selected"),o.next=14,e.loadCIIUDivisiones(l,i);case 14:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}()),l&&l.addEventListener("click",(function(){console.log("[WizardCore] 🔄 Resetting sector selection"),e.state.updateBasicInfo("ciiuSeccion","",!0),e.state.updateBasicInfo("ciiuDivision","",!0),e.state.updateBasicInfo("sector","",!0),a&&t&&(a.style.opacity="0",a.style.transform="translateY(10px)",setTimeout((function(){a.classList.add("hidden"),t.classList.remove("hidden"),o&&(o.value=""),i&&(i.innerHTML='<option value="">Selecciona tu actividad económica...</option>',i.value="",i.disabled=!1),t.style.opacity="0",t.style.transform="translateY(-10px)",requestAnimationFrame((function(){t.style.transition="all 0.3s ease-out",t.style.opacity="1",t.style.transform="translateY(0)"}))}),200)),n&&n.classList.remove("sector-selected")})),i.addEventListener("change",(function(n){e.state.updateBasicInfo("ciiuDivision",n.target.value,!0),e.state.updateBasicInfo("sector",n.target.value,!0)}));var d=this.state.data.formData.ciiuSeccion,u=this.state.data.formData.ciiuDivision;d&&this.loadCIIUDivisiones(d,i).then((function(){u&&(i.value=u)}))}}},{key:"loadCIIUDivisiones",value:(d=r(s().mark((function e(n,t){var a,o,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return console.log("[WizardCore] 🔄 Loading divisions for sector: ".concat(n)),t.innerHTML='<option value="">Cargando actividades...</option>',t.value="",t.disabled=!0,e.prev=6,e.next=9,fetch("/api/catalogo/ciiu/secciones/".concat(n,"/divisiones?_t=").concat(Date.now()));case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error cargando actividades: ".concat(a.status));case 12:return e.next=14,a.json();case 14:o=e.sent,r=o.data||[],console.log("[WizardCore] 📦 Received ".concat(r.length," divisions for sector ").concat(n,":"),r.slice(0,3).map((function(e){return e.nombre}))),t.innerHTML='\n        <option value="">Selecciona tu actividad económica...</option>\n        '.concat(r.map((function(e){return'\n          <option value="'.concat(e.codigo,'">').concat(e.nombre,"</option>\n        ")})).join(""),"\n      "),t.value="",t.disabled=!1,t._dropdownApi&&"function"==typeof t._dropdownApi.refresh&&(t._dropdownApi.refresh(),console.log("[WizardCore] 🔄 Refreshed enhanced dropdown for activities")),console.log("[WizardCore] ✅ Loaded ".concat(r.length," activities for sector ").concat(n)),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(6),console.error("[WizardCore] ❌ Error loading CIIU divisions:",e.t0),t.innerHTML='<option value="">Error cargando actividades</option>',t.disabled=!0;case 29:case"end":return e.stop()}}),e,null,[[6,24]])}))),function(e,n){return d.apply(this,arguments)})},{key:"positionFAB",value:(l=r(s().mark((function e(){var n,t,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.container.querySelector(".fab"),t=this.container.querySelector(".wizard-form"),n&&t){e.next=4;break}return e.abrupt("return");case 4:return this.fabCleanup&&(this.fabCleanup(),this.fabCleanup=null),a=function(){var e=r(s().mark((function e(){var a,o,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Ln.computePosition)(t,n,{placement:"right-end",middleware:[(0,Ln.offset)(24),(0,Ln.shift)({padding:10})]});case 2:a=e.sent,o=a.x,r=a.y,Object.assign(n.style,{position:"absolute",left:"".concat(o,"px"),top:"".concat(r,"px")});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=8,a();case 8:o=function(){return a()},window.addEventListener("scroll",o),window.addEventListener("resize",o),this.fabCleanup=function(){window.removeEventListener("scroll",o),window.removeEventListener("resize",o)};case 12:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"attachCargosListeners",value:function(){var e=this,n=this.container.querySelector('[data-action="add-cargo"]');n&&n.addEventListener("click",(function(){return e.showAddCargoModal()})),this.positionFAB();var t=this.container.querySelector('[data-action="carousel-prev"]'),a=this.container.querySelector('[data-action="carousel-next"]');t&&t.addEventListener("click",(function(){return e.handleCarouselPrev()})),a&&a.addEventListener("click",(function(){return e.handleCarouselNext()})),this.container.querySelectorAll('[data-action="carousel-goto"]').forEach((function(n){n.addEventListener("click",(function(n){var t=parseInt(n.currentTarget.dataset.index);e.handleCarouselGoto(t)}))}));var o=this.container.querySelectorAll('[data-action="edit-cargo"]');console.log("[WizardCore] Found edit buttons:",o.length),o.forEach((function(n){n.addEventListener("click",(function(n){console.log("[WizardCore] Edit button clicked!");var t=parseInt(n.currentTarget.dataset.index);e.handleEditCargo(n.currentTarget,t)}))})),this.container.querySelectorAll('[data-action="remove-cargo"]').forEach((function(n){n.addEventListener("click",(function(n){var t=parseInt(n.currentTarget.dataset.index);e.handleRemoveCargo(t)}))})),this.container.querySelectorAll('[data-action="close-modal"]').forEach((function(n){n.addEventListener("click",(function(){return e.hideAddCargoModal()}))}));var r=this.container.querySelector('[data-action="save-cargo"]');r&&r.addEventListener("click",(function(){return e.handleSaveCargo()}))}},{key:"updateCarouselPosition",value:function(){var e=this,n=this.container.querySelector(".cargos-carousel");n&&(n.style.transform="translateX(calc(-".concat(100*this.carouselIndex,"% - ").concat(2*this.carouselIndex,"rem))")),this.container.querySelectorAll(".carousel-dot").forEach((function(n,t){t===e.carouselIndex?n.classList.add("active"):n.classList.remove("active")}));var t=this.container.querySelector('[data-action="carousel-prev"]'),a=this.container.querySelector('[data-action="carousel-next"]'),o=this.state.getCargos();t&&(t.disabled=0===this.carouselIndex),a&&(a.disabled=this.carouselIndex>=o.length-1)}},{key:"handleCarouselPrev",value:function(){this.state.getCargos();this.carouselIndex>0&&(this.carouselIndex--,this.updateCarouselPosition())}},{key:"handleCarouselNext",value:function(){var e=this.state.getCargos();this.carouselIndex<e.length-1&&(this.carouselIndex++,this.updateCarouselPosition())}},{key:"handleCarouselGoto",value:function(e){var n=this.state.getCargos();e>=0&&e<n.length&&(this.carouselIndex=e,this.updateCarouselPosition())}},{key:"attachRiesgosListeners",value:function(){var e,n,t=this,a=this.state.getCargos(),o=this.state.data.catalogos;console.log("[WizardCore] Initializing RiesgoSelector for",a.length,"cargo(s)"),console.log("[WizardCore] Available GES:",(null===(e=o.riesgos)||void 0===e?void 0:e.length)||0),console.log("[WizardCore] Available categories:",(null===(n=o.categorias)||void 0===n?void 0:n.length)||0),a.forEach((function(e,n){var a=t.container.querySelector("#riesgo-selector-".concat(n));if(a){t.riesgoSelectors[n]&&t.riesgoSelectors[n].destroy();var r=(o.riesgos||[]).map((function(e){return Mn(Mn({},e),{},{categoria:t.getCategoryName(e.id_riesgo||e.riesgo_id,o.categorias)})}));t.riesgoSelectors[n]=new kn(a,{cargoIndex:n,cargoNombre:e.nombre,sector:t.state.data.sector||null,catalogoGES:r,catalogoRiesgos:o.categorias||[],seleccionados:e.gesSeleccionados||[],onChange:function(e){return t.handleGESChange(n,e)}}),a.addEventListener("ges-selected",(function(e){var n=e.detail,a=n.cargoIndex,o=n.sourceElement;o&&t.animateGESToCargoTab(o,a)})),console.log("[WizardCore] ✅ RiesgoSelector #".concat(n,' initialized for cargo "').concat(e.nombre,'"'))}else console.warn("[WizardCore] Container #riesgo-selector-".concat(n," not found"))}));var r=this.container.querySelectorAll('[data-action="switch-cargo-tab"]');r.forEach((function(e){e.addEventListener("click",(function(e){var n=parseInt(e.currentTarget.dataset.cargoIndex);t.switchCargoTab(n)})),e.addEventListener("keydown",(function(e){t.handleTabKeydown(e,r)})),e.addEventListener("mouseenter",(function(e){t.showCargoTooltip(e.currentTarget)})),e.addEventListener("mouseleave",(function(){t.hideCargoTooltip()}))})),this.setupScrollIndicators()}},{key:"handleTabKeydown",value:function(e,n){var t=Array.from(n),a=t.findIndex((function(n){return n===e.target})),o=a;switch(e.key){case"ArrowLeft":o=(a-1+t.length)%t.length;break;case"ArrowRight":o=(a+1)%t.length;break;case"Home":o=0;break;case"End":o=t.length-1;break;default:return}e.preventDefault(),t[o].click(),t[o].focus()}},{key:"setupScrollIndicators",value:function(){var e=this.container.querySelector(".cargo-tabs-wrapper"),n=this.container.querySelector(".cargo-tabs");if(n&&e){var t=function(){var t=n.scrollLeft>10,a=n.scrollLeft<n.scrollWidth-n.clientWidth-10;e.classList.toggle("has-scroll-left",t),e.classList.toggle("has-scroll-right",a)};n.addEventListener("scroll",t),window.addEventListener("resize",t),t()}}},{key:"getCategoryName",value:function(e,n){if(!n||!Array.isArray(n))return"Sin categoría";var t=n.find((function(n){return n.id===e}));return t?t.nombre:"Sin categoría"}},{key:"getCategoriesFromGES",value:function(e){var n=new Map;return e.forEach((function(e){var t=e.id_riesgo||e.riesgo_id;n.has(t)||n.set(t,{id:t,nombre:e.categoria||"Categoría ".concat(t)})})),Array.from(n.values())}},{key:"handleGESChange",value:function(e,n){var t=this.state.getCargo(e);if(t){var a=n.map((function(e){return{idGes:e.id,nombre:e.nombre,categoria:e.categoria||"",niveles:{ND:null,NE:null,NC:null,NP:null,NR:null},controles:{eliminacion:"",sustitucion:"",ingenieria:"",administrativos:"",epp:""}}}));this.state.updateCargo(e,Mn(Mn({},t),{},{ges:a,gesSeleccionados:a})),console.log("[WizardCore] Updated cargo ".concat(e," with ").concat(n.length," GES")),this.updateCargoCards()}}},{key:"updateCargoCards",value:function(){var e=this.state.getCargos();this.container.querySelectorAll(".cargo-card").forEach((function(n,t){var a=e[t];if(a){var o=n.querySelector(".cargo-card-header h3");o&&(o.textContent=a.nombre);var r=n.querySelector(".cargo-card-body > p");r&&(r.textContent=a.descripcion||"Sin descripción");var i=n.querySelector(".cargo-meta span:first-child");i&&(i.innerHTML='<i class="fas fa-user"></i> '.concat(a.numPersonas," persona").concat(1!==a.numPersonas?"s":""));var s=n.querySelector(".cargo-meta span:last-child");if(s){var c,l=(null===(c=a.gesSeleccionados)||void 0===c?void 0:c.length)||0;s.innerHTML='<i class="fas fa-exclamation-triangle"></i> '.concat(l," riesgo").concat(1!==l?"s":"")}}})),this.container.querySelectorAll(".cargo-tabs .cargo-tab").forEach((function(n,t){var a=e[t];if(a){var o=n.querySelector(".cargo-name");o&&(o.textContent=a.cargoName||a.nombre||"Cargo ".concat(t+1));var r=n.querySelector(".cargo-count");if(r){var i,s,c=(null===(i=a.gesSeleccionados)||void 0===i?void 0:i.length)||(null===(s=a.ges)||void 0===s?void 0:s.length)||0;r.textContent=c,r.classList.add("pulse-update"),setTimeout((function(){return r.classList.remove("pulse-update")}),400),n.setAttribute("data-has-risks",c>0?"true":"false")}}})),this.container.querySelectorAll(".niveles-cargo-tabs .niveles-cargo-tab").forEach((function(n,t){var a=e[t];if(a){var o=Array.from(n.childNodes).find((function(e){return e.nodeType===Node.TEXT_NODE}));o&&(o.textContent=a.nombre);var r=n.querySelector(".cargo-tab__count");if(r){var i,s=(null===(i=a.gesSeleccionados)||void 0===i?void 0:i.length)||0;r.textContent="".concat(s," GES")}}})),this.container.querySelectorAll(".cargo-item").forEach((function(n,t){var a=e[t];if(a){var o=n.querySelector(".cargo-stats span:last-child");if(o){var r,i=(null===(r=a.gesSeleccionados)||void 0===r?void 0:r.length)||0;o.innerHTML='<i class="fas fa-exclamation-triangle"></i> '.concat(i," riesgo").concat(1!==i?"s":"")}}})),console.log("[WizardCore] Cargo cards and tabs updated")}},{key:"switchCargoTab",value:function(e){this.container.querySelectorAll(".cargo-tab").forEach((function(n,t){t===e?(n.classList.add("active"),n.setAttribute("aria-selected","true"),n.setAttribute("tabindex","0")):(n.classList.remove("active"),n.setAttribute("aria-selected","false"),n.setAttribute("tabindex","-1"))})),this.container.querySelectorAll(".riesgo-selector-container").forEach((function(n,t){n.style.display=t===e?"":"none"}))}},{key:"getCategoryColor",value:function(e){return{Mecánico:"#3498db",Eléctrico:"#f39c12",Físico:"#9b59b6",Químico:"#e74c3c",Biológico:"#2ecc71",Ergonómico:"#1abc9c",Biomecánico:"#1abc9c",Psicosocial:"#e67e22","Factores Humanos":"#ffa726",Locativo:"#34495e",Natural:"#8e44ad",Seguridad:"#c0392b","Otros Riesgos":"#95a5a6","Saneamiento Básico":"#16a085","Salud Pública":"#27ae60",Comunes:"#5dc4af"}[e]||"#95a5a6"}},{key:"attachNivelesListeners",value:function(){var e=this;this.state.getCargos().length>0&&this.initializeNivelesForm(0),this.container.querySelectorAll('[data-action="switch-cargo-niveles"]').forEach((function(n){n.addEventListener("click",(function(n){var t=parseInt(n.currentTarget.dataset.cargoIndex);e.switchCargoNivelesTab(t)})),n.addEventListener("mouseenter",(function(n){e.showNivelesCargoTooltip(n.currentTarget)})),n.addEventListener("mouseleave",(function(){e.hideNivelesCargoTooltip()}))}))}},{key:"showNivelesCargoTooltip",value:function(e){var n=document.getElementById("niveles-cargo-tooltip");if(n){var t=parseInt(e.dataset.cargoIndex),a=this.state.getCargo(t);if(a){var o=a.gesSeleccionados||a.ges||[],r=document.getElementById("tooltip-cargo-name"),i=document.getElementById("tooltip-stats"),s=document.getElementById("tooltip-ges-list");r&&(r.textContent=a.nombre);var c=o.filter((function(e){var n=e.niveles||{};return null!==n.ND&&void 0!==n.ND&&null!==n.NE&&void 0!==n.NE&&null!==n.NC&&void 0!==n.NC})).length;if(i&&(i.textContent="".concat(c,"/").concat(o.length)),s&&(s.innerHTML=o.map((function(e){var n=e.niveles||{},t=null!==n.ND&&void 0!==n.ND&&null!==n.NE&&void 0!==n.NE&&null!==n.NC&&void 0!==n.NC,a=t?"completed":"pending",o=t?"fa-check":"fa-circle",r="";if(t&&n.NR){var i=n.NR,s="risk-bajo",c="IV";i>=600?(s="risk-muy-alto",c="I"):i>=150?(s="risk-alto",c="II"):i>=40&&(s="risk-medio",c="III"),r='<span class="item-level '.concat(s,'">').concat(c,"</span>")}return'\n          <li class="niveles-cargo-tooltip__item">\n            <span class="item-status '.concat(a,'">\n              <i class="fas ').concat(o,'"></i>\n            </span>\n            <span class="item-name">').concat(e.nombre,"</span>\n            ").concat(r,"\n          </li>\n        ")})).join("")),n.classList.add("visible"),void 0!==Ln.computePosition)(0,Ln.computePosition)(e,n,{placement:"bottom",middleware:[(0,Ln.offset)(8),(0,Ln.shift)({padding:8})]}).then((function(e){var t=e.x,a=e.y;n.style.left="".concat(t,"px"),n.style.top="".concat(a,"px")}));else{var l=e.getBoundingClientRect();n.style.left="".concat(l.left,"px"),n.style.top="".concat(l.bottom+8,"px")}}}}},{key:"hideNivelesCargoTooltip",value:function(){var e=document.getElementById("niveles-cargo-tooltip");e&&e.classList.remove("visible")}},{key:"initializeNivelesForm",value:function(e){var n=this;console.log("[WizardCore] initializeNivelesForm(".concat(e,")"));var t=this.state.getCargo(e);if(t){var a=this.container.querySelector("#niveles-container-".concat(e));if(a)if(this.nivelesFormCache||(this.nivelesFormCache={}),this.nivelesFormCache[e]){console.log("[WizardCore] Reutilizando form existente para cargo ".concat(e)),this.nivelesForm=this.nivelesFormCache[e];var o=t.gesSeleccionados||t.ges||[];this.nivelesForm.updateGESArray(o)}else{var r=t.gesSeleccionados||t.ges||[];console.log('[WizardCore] Creando nuevo NivelesForm para cargo "'.concat(t.nombre,'" con ').concat(r.length," GES"));var i=new Tn(a,{cargoIndex:e,cargoNombre:t.nombre,gesArray:r,state:this.state,onChange:function(t){return n.handleNivelesChange(e,t)},onComplete:function(){return n.handleNivelesComplete(e)}});this.nivelesFormCache[e]=i,this.nivelesForm=i}else console.error("[WizardCore] Container niveles-container-".concat(e," no encontrado"))}else console.error("[WizardCore] Cargo ".concat(e," no encontrado"))}},{key:"handleNivelesChange",value:function(e,n){"update-niveles"===n.action?(console.log("[WizardCore] Niveles updated for cargo ".concat(e,", GES ").concat(n.gesIndex)),this.updateNivelesCargoTabIndicators()):"go-back"===n.action&&this.state.setCurrentStep("riesgos")}},{key:"updateNivelesCargoTabIndicators",value:function(){var e=this.state.getCargos();this.container.querySelectorAll(".niveles-cargo-tab").forEach((function(n,t){if(!(t>=e.length)){var a=e[t],o=a.gesSeleccionados||a.ges||[],r=o.filter((function(e){var n=e.niveles||{};return null!==n.ND&&void 0!==n.ND&&null!==n.NE&&void 0!==n.NE&&null!==n.NC&&void 0!==n.NC})).length,i=o.length>0&&r===o.length,s=n.querySelector(".cargo-tab__count");s&&(s.textContent="".concat(r,"/").concat(o.length));var c=n.querySelector(".cargo-status-icon");c&&(i?(c.classList.remove("fa-circle"),c.classList.add("fa-check-circle","completed")):(c.classList.remove("fa-check-circle","completed"),c.classList.add("fa-circle"))),i?n.classList.add("completed"):n.classList.remove("completed")}}))}},{key:"handleNivelesComplete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;console.log("[WizardCore] handleNivelesComplete for cargo ".concat(e));for(var n=this.state.getCargos(),t=-1,a=e+1;a<n.length;a++){var o=n[a],r=o.gesSeleccionados||o.ges||[];if(r.length>0)if(r.some((function(e){var n=e.niveles||{};return null===n.ND||void 0===n.ND||null===n.NE||void 0===n.NE||null===n.NC||void 0===n.NC}))){t=a;break}}-1!==t?(console.log("[WizardCore] Switching to next pending cargo: ".concat(t)),this.switchCargoNivelesTab(t)):(console.log("[WizardCore] All cargos completed, proceeding to next step"),this.handleNext("niveles"))}},{key:"switchCargoNivelesTab",value:function(e){var n=this;console.log("[WizardCore] switchCargoNivelesTab(".concat(e,")")),this.container.querySelectorAll(".niveles-cargo-tab").forEach((function(n,t){t===e?n.classList.add("active"):n.classList.remove("active")})),this.container.querySelectorAll(".niveles-cargo-container").forEach((function(n,t){n.style.display=t===e?"":"none"})),setTimeout((function(){n.initializeNivelesForm(e)}),0)}},{key:"handleBack",value:function(){var e=this,n=this.steps.findIndex((function(n){return n.id===e.state.getCurrentStep()}));if(n>0){var t=this.steps[n-1];this.state.setCurrentStep(t.id)}}},{key:"migrateNivelesData",value:function(){var e=this.state.getCargos(),n=!1;e.forEach((function(e,t){e.ges&&e.ges.forEach((function(e,a){var o=e.niveles;o&&(null===o.ND||void 0===o.ND||o.deficiencia||(console.log("[WizardCore] Migrando niveles para cargo ".concat(t,", GES ").concat(a,":"),e.nombre),o.deficiencia={value:o.ND},o.exposicion={value:o.NE},o.consecuencia={value:o.NC},n=!0))}))})),n&&(console.log("[WizardCore] Datos de niveles migrados, guardando..."),this.state.notify())}},{key:"handleNext",value:(i=r(s().mark((function e(n){var t,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("niveles"===n&&this.migrateNivelesData(),t=this.state.validateStep(n),!(Object.keys(t).length>0)){e.next=6;break}return console.error("[WizardCore] Validation errors:",t),this.showValidationErrors(t),e.abrupt("return");case 6:if("riesgos"!==n){e.next=12;break}return e.next=9,this.validateRiesgosStep();case 9:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:if("resumen"!==n){e.next=15;break}return this.handleSubmit(),e.abrupt("return");case 15:if("riesgos"!==n){e.next=18;break}return e.next=18,this.preloadGESDetails();case 18:a=this.steps.findIndex((function(e){return e.id===n})),a<this.steps.length-1&&(o=this.steps[a+1],this.state.setCurrentStep(o.id));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"validateRiesgosStep",value:(a=r(s().mark((function e(){var n,t,a,o,r,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.getCargos(),t=n.map((function(e){var n;return{nombre:e.nombre,count:(null===(n=e.ges)||void 0===n?void 0:n.length)||0}})),0!==(a=t.reduce((function(e,n){return e+n.count}),0))){e.next=7;break}return e.next=6,jn({title:"Debes seleccionar al menos un riesgo",message:'\n          <div style="text-align: left; line-height: 1.6;">\n            <p>No has seleccionado ningún riesgo para los cargos de tu empresa.</p>\n            <p><strong>¿Por qué es importante?</strong></p>\n            <ul style="margin-left: 1.5rem;">\n              <li>La matriz de riesgos es requerida por la normativa SST colombiana</li>\n              <li>Te ayuda a identificar y controlar peligros en el lugar de trabajo</li>\n              <li>Es necesaria para generar el profesiograma y perfil de cargo</li>\n            </ul>\n          </div>\n        ',confirmText:"Entendido, seleccionaré riesgos",showCancelButton:!1,type:"error",icon:"fa-exclamation-triangle"});case 6:return e.abrupt("return",!1);case 7:if(!(a/n.length<3)){e.next=21;break}return o=t.filter((function(e){return 0===e.count})).map((function(e){return e.nombre})),r=t.filter((function(e){return e.count>0&&e.count<3})).map((function(e){return"".concat(e.nombre," (").concat(e.count," ").concat(1===e.count?"riesgo":"riesgos",")")})),i='<div style="text-align: left; line-height: 1.6;">',i+="<p>Has seleccionado <strong>".concat(a," ").concat(1===a?"riesgo":"riesgos","</strong> en total.</p>"),o.length>0&&(i+="<p><strong>Cargos sin riesgos:</strong></p>",i+='<ul style="margin-left: 1.5rem;">',o.forEach((function(e){i+="<li>".concat(e,"</li>")})),i+="</ul>"),r.length>0&&(i+="<p><strong>Cargos con pocos riesgos:</strong></p>",i+='<ul style="margin-left: 1.5rem;">',r.forEach((function(e){i+="<li>".concat(e,"</li>")})),i+="</ul>"),i+="<p>Se recomienda seleccionar al menos <strong>3-5 riesgos por cargo</strong> para una evaluación completa.</p>",i+="</div>",e.next=19,jn({title:"¿Continuar con esta selección?",message:i,confirmText:"Sí, continuar de todas formas",cancelText:"Volver a revisar riesgos",type:"warning",icon:"fa-exclamation-circle"});case 19:return c=e.sent,e.abrupt("return",c);case 21:return e.abrupt("return",!0);case 22:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"preloadGESDetails",value:(t=r(s().mark((function e(){var n,t,a,o,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[WizardCore] 🔄 Precargando detalles de GES seleccionados..."),n=performance.now(),t=this.container.querySelector('[data-action="next"]'),a=t?t.innerHTML:"",e.prev=4,t&&(t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Cargando detalles...'),0!==(o=Object.values(this.riesgoSelectors).filter((function(e){return e&&"function"==typeof e.preloadSelectedDetails})).map((function(e){return e.preloadSelectedDetails()}))).length){e.next=10;break}return console.log("[WizardCore] No hay selectores activos para precargar"),e.abrupt("return");case 10:return e.next=12,Promise.all(o);case 12:r=Math.round(performance.now()-n),console.log("[WizardCore] ✅ Precarga completada en ".concat(r,"ms")),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),console.error("[WizardCore] ❌ Error en precarga de detalles:",e.t0);case 19:return e.prev=19,t&&(t.disabled=!1,t.innerHTML=a),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(){return t.apply(this,arguments)})},{key:"showValidationErrors",value:function(e){var n=Object.values(e).join("<br>"),t=document.createElement("div");t.className="wizard-error",t.innerHTML='\n      <div class="error-content">\n        <strong>Por favor corrige los siguientes errores:</strong>\n        <p>'.concat(n,"</p>\n      </div>\n    ");var a=this.container.querySelector(".wizard-error");a&&a.remove(),this.container.appendChild(t),setTimeout((function(){return t.remove()}),5e3)}},{key:"showAddCargoModal",value:function(){var e=this,n=this.container.querySelector("#modal-add-cargo");if(n){this.previousFocusedElement=document.activeElement,n.style.display="flex",n.setAttribute("aria-modal","true"),n.setAttribute("role","dialog"),n.setAttribute("aria-labelledby","modal-title-cargo"),this.initialCargoFormState=this.getCargoFormState();var t=n.querySelector("#cargo-nombre");t&&requestAnimationFrame((function(){t.focus()})),this.setupModalFocusTrap(n),this.modalEscapeHandler=function(n){"Escape"===n.key&&(n.preventDefault(),e.hideAddCargoModal())},document.addEventListener("keydown",this.modalEscapeHandler)}}},{key:"setupModalFocusTrap",value:function(e){var n=["input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]",'[tabindex]:not([tabindex="-1"])'].join(", ");this.modalFocusTrapHandler=function(t){if("Tab"===t.key){var a=Array.from(e.querySelectorAll(n)),o=a[0],r=a[a.length-1];t.shiftKey?document.activeElement===o&&(t.preventDefault(),r.focus()):document.activeElement===r&&(t.preventDefault(),o.focus())}},e.addEventListener("keydown",this.modalFocusTrapHandler)}},{key:"getCargoFormState",value:function(){var e,n,t,a,o,r,i,s,c,l;return{nombre:(null===(e=this.container.querySelector("#cargo-nombre"))||void 0===e?void 0:e.value)||"",descripcion:(null===(n=this.container.querySelector("#cargo-descripcion"))||void 0===n?void 0:n.value)||"",numPersonas:(null===(t=this.container.querySelector("#cargo-num-personas"))||void 0===t?void 0:t.value)||"1",area:(null===(a=this.container.querySelector("#cargo-area"))||void 0===a?void 0:a.value)||"",zona:(null===(o=this.container.querySelector("#cargo-zona"))||void 0===o?void 0:o.value)||"",tareasRutinarias:(null===(r=this.container.querySelector("#cargo-tareasRutinarias"))||void 0===r?void 0:r.checked)||!1,manipulaAlimentos:(null===(i=this.container.querySelector("#cargo-manipulaAlimentos"))||void 0===i?void 0:i.checked)||!1,trabajaAlturas:(null===(s=this.container.querySelector("#cargo-trabajaAlturas"))||void 0===s?void 0:s.checked)||!1,trabajaEspaciosConfinados:(null===(c=this.container.querySelector("#cargo-trabajaEspaciosConfinados"))||void 0===c?void 0:c.checked)||!1,conduceVehiculo:(null===(l=this.container.querySelector("#cargo-conduceVehiculo"))||void 0===l?void 0:l.checked)||!1}}},{key:"hasCargoFormChanges",value:function(){if(!this.initialCargoFormState)return!1;var e=this.getCargoFormState();return e.nombre!==this.initialCargoFormState.nombre||e.descripcion!==this.initialCargoFormState.descripcion||e.numPersonas!==this.initialCargoFormState.numPersonas||e.tareasRutinarias!==this.initialCargoFormState.tareasRutinarias||e.manipulaAlimentos!==this.initialCargoFormState.manipulaAlimentos||e.trabajaAlturas!==this.initialCargoFormState.trabajaAlturas||e.trabajaEspaciosConfinados!==this.initialCargoFormState.trabajaEspaciosConfinados||e.conduceVehiculo!==this.initialCargoFormState.conduceVehiculo}},{key:"hideAddCargoModal",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!this.hasCargoFormChanges()?this.forceCloseAddCargoModal():jn({title:"Cambios sin guardar",message:"¿Deseas salir sin guardar este cargo?",confirmText:"Salir sin Guardar",cancelText:"Continuar Editando",type:"warning",onConfirm:function(){e.forceCloseAddCargoModal()},onCancel:function(){}})}},{key:"forceCloseAddCargoModal",value:function(){var e=this.container.querySelector("#modal-add-cargo");e&&(e.style.display="none",e.removeAttribute("aria-modal"),e.removeAttribute("role"),e.removeAttribute("aria-labelledby"),this.modalEscapeHandler&&(document.removeEventListener("keydown",this.modalEscapeHandler),this.modalEscapeHandler=null),this.modalFocusTrapHandler&&(e.removeEventListener("keydown",this.modalFocusTrapHandler),this.modalFocusTrapHandler=null),this.previousFocusedElement&&this.previousFocusedElement.focus&&(this.previousFocusedElement.focus(),this.previousFocusedElement=null),this.container.querySelector("#cargo-nombre").value="",this.container.querySelector("#cargo-descripcion").value="",this.container.querySelector("#cargo-num-personas").value="1",this.container.querySelector("#cargo-area").value="",this.container.querySelector("#cargo-zona").value="",this.container.querySelector("#cargo-tareasRutinarias").checked=!1,this.container.querySelector("#cargo-manipulaAlimentos").checked=!1,this.container.querySelector("#cargo-trabajaAlturas").checked=!1,this.container.querySelector("#cargo-trabajaEspaciosConfinados").checked=!1,this.container.querySelector("#cargo-conduceVehiculo").checked=!1,this.initialCargoFormState=null)}},{key:"handleSaveCargo",value:function(){var e,n,t,a,o,r=this,i=this.container.querySelector("#cargo-nombre").value.trim(),s=this.container.querySelector("#cargo-descripcion").value.trim(),c=parseInt(this.container.querySelector("#cargo-num-personas").value),l=this.container.querySelector("#cargo-area").value.trim(),d=this.container.querySelector("#cargo-zona").value.trim(),u=(null===(e=this.container.querySelector("#cargo-tareasRutinarias"))||void 0===e?void 0:e.checked)||!1,g=(null===(n=this.container.querySelector("#cargo-manipulaAlimentos"))||void 0===n?void 0:n.checked)||!1,p=(null===(t=this.container.querySelector("#cargo-trabajaAlturas"))||void 0===t?void 0:t.checked)||!1,v=(null===(a=this.container.querySelector("#cargo-trabajaEspaciosConfinados"))||void 0===a?void 0:a.checked)||!1,f=(null===(o=this.container.querySelector("#cargo-conduceVehiculo"))||void 0===o?void 0:o.checked)||!1;if(i&&!(c<1)&&l&&d){var h=0===this.state.getCargos().length;this.state.addCargo({nombre:i,descripcion:s,numPersonas:c,area:l,zona:d,tareasRutinarias:u,manipulaAlimentos:g,trabajaAlturas:p,trabajaEspaciosConfinados:v,conduceVehiculo:f}),this.hideAddCargoModal(!0),h?(this.forceRender(),requestAnimationFrame((function(){requestAnimationFrame((function(){r.triggerFABBounce()}))}))):this.forceRender()}else alert("Por favor completa todos los campos requeridos")}},{key:"handleRemoveCargo",value:function(e){var n=this.state.getCargo(e);confirm('¿Estás seguro de eliminar el cargo "'.concat(n.nombre,'"?'))&&(this.state.removeCargo(e),this.forceRender())}},{key:"handleEditCargo",value:function(e,n){var t=this;console.log("[WizardCore] Opening edit popover for cargo:",n),this.cargoEditor.showEditPopover(e,n,(function(e){console.log("[WizardCore] Cargo updated successfully:",e),t.updateCargoCards()}))}},{key:"triggerFABBounce",value:function(){var e=this.container.querySelector(".fab");e?(console.log("[WizardCore] ✨ Triggering FAB bounce animation"),e.classList.remove("fab--hidden"),e.classList.add("fab--bounce-in"),setTimeout((function(){e.classList.remove("fab--bounce-in"),console.log("[WizardCore] ✓ FAB bounce animation completed")}),800)):console.warn("[WizardCore] FAB not found for bounce animation")}},{key:"handleSubmit",value:(n=r(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[WizardCore] Submitting wizard..."),e.prev=1,this.showLoading("Generando documentos..."),n=this.state.exportForSubmission(),e.next=6,fetch("/api/solicitudes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 6:if((t=e.sent).ok){e.next=9;break}throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText));case 9:return e.next=11,t.json();case 11:a=e.sent,console.log("[WizardCore] Submission successful:",a),this.state.clearStorage(),window.location.href="/pages/resultados.html?token=".concat(a.token),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),console.error("[WizardCore] Submission error:",e.t0),this.showError("Error al generar documentos. Por favor intenta de nuevo.");case 21:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(){return n.apply(this,arguments)})},{key:"showLoading",value:function(e){var n=document.createElement("div");n.className="wizard-loading-overlay",n.innerHTML='\n      <div class="wizard-loading">\n        <div class="wizard-loading__spinner"></div>\n        <p class="wizard-loading__text">'.concat(e,"</p>\n      </div>\n    "),document.body.appendChild(n)}},{key:"showError",value:function(e){alert(e)}},{key:"showCargoTooltip",value:(e=r(s().mark((function e(n){var t,a,r,i,l,d,u,g,p,v,f,h,m,b,y,x;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hideCargoTooltip(),t=parseInt(n.dataset.cargoIndex),a=n.dataset.cargoName,r=this.state.getCargos(),i=r[t]){e.next=7;break}return e.abrupt("return");case 7:if(0!==(l=i.gesSeleccionados||i.ges||[]).length){e.next=10;break}return e.abrupt("return");case 10:return(d=document.createElement("div")).className="cargo-tooltip",d.id="cargo-tooltip-floating",d.setAttribute("role","tooltip"),u=l.map((function(e){var n="string"==typeof e?e:e.nombre||e.name||"GES",t="object"===c(e)&&(e.categoria||e.riesgo)||"";return'\n        <li class="cargo-tooltip__item">\n          <i class="fas fa-shield-alt"></i>\n          <span>'.concat(n,"</span>\n          ").concat(t?"<small>".concat(t,"</small>"):"","\n        </li>\n      ")})).join(""),d.innerHTML='\n      <div class="cargo-tooltip__header">\n        <i class="fas fa-briefcase"></i>\n        <span>'.concat(a,'</span>\n      </div>\n      <div class="cargo-tooltip__divider"></div>\n      <div class="cargo-tooltip__body">\n        <p class="cargo-tooltip__label">Riesgos Seleccionados (').concat(l.length,')</p>\n        <ul class="cargo-tooltip__list">\n          ').concat(u,"\n        </ul>\n      </div>\n    "),document.body.appendChild(d),e.prev=17,e.next=20,Promise.resolve().then(o.bind(o,8491));case 20:return g=e.sent,p=g.computePosition,v=g.flip,f=g.shift,h=g.offset,e.next=27,p(n,d,{placement:"bottom",middleware:[h(10),v(),f({padding:8})]});case 27:m=e.sent,b=m.x,y=m.y,Object.assign(d.style,{left:"".concat(b,"px"),top:"".concat(y,"px")}),requestAnimationFrame((function(){d.classList.add("visible")})),e.next=41;break;case 34:e.prev=34,e.t0=e.catch(17),console.warn("[WizardCore] Error positioning tooltip:",e.t0),x=n.getBoundingClientRect(),d.style.left="".concat(x.left,"px"),d.style.top="".concat(x.bottom+10,"px"),d.classList.add("visible");case 41:case"end":return e.stop()}}),e,this,[[17,34]])}))),function(n){return e.apply(this,arguments)})},{key:"hideCargoTooltip",value:function(){var e=document.getElementById("cargo-tooltip-floating");e&&(e.classList.remove("visible"),setTimeout((function(){e.remove()}),200))}},{key:"animateGESToCargoTab",value:function(e,n){var t=this.container.querySelector('[data-cargo-index="'.concat(n,'"]'));if(t&&e){var a=e.getBoundingClientRect(),o=t.getBoundingClientRect(),r=document.createElement("div");r.className="ges-flying",r.innerHTML='<i class="fas fa-shield-alt"></i>',Object.assign(r.style,{position:"fixed",left:"".concat(a.left+a.width/2,"px"),top:"".concat(a.top+a.height/2,"px"),zIndex:"10000"}),document.body.appendChild(r);var i=o.left+o.width-25,s=o.top+o.height/2;requestAnimationFrame((function(){r.style.transition="all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)",r.style.left="".concat(i,"px"),r.style.top="".concat(s,"px"),r.style.transform="scale(0.3)",r.style.opacity="0.5"})),setTimeout((function(){var e=t.querySelector(".cargo-count");e&&(e.classList.add("pulse-animation"),setTimeout((function(){e.classList.remove("pulse-animation")}),600))}),400),setTimeout((function(){r.remove()}),600)}}}]);var e,n,t,a,i,l,d,g}(),Hn=null,$n=null;function Wn(){return Vn.apply(this,arguments)}function Vn(){return Vn=r(s().mark((function e(){var n,t,a,r,i,c=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>0&&void 0!==c[0]?c[0]:3,t=c.length>1&&void 0!==c[1]?c[1]:100,!(Hn&&Hn.length>0)){e.next=5;break}return console.log("[SectorLoader] ✓ Returning cached SECTORES_ECONOMICOS:",Hn.length),e.abrupt("return",Hn);case 5:a=s().mark((function e(){var a,r,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.e(786).then(o.bind(o,7405));case 3:if(a=e.sent,!((r=a.SECTORES_ECONOMICOS)&&r.length>0)){e.next=9;break}return Hn=r,console.log("[SectorLoader] ✓ Loaded SECTORES_ECONOMICOS on attempt ".concat(i+1,":"),r.length),e.abrupt("return",{v:r});case 9:console.warn("[SectorLoader] Attempt ".concat(i+1,": SECTORES_ECONOMICOS empty or undefined")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("[SectorLoader] Attempt ".concat(i+1," failed:"),e.t0);case 15:if(!(i<n-1)){e.next=20;break}return c=t*Math.pow(2,i),console.log("[SectorLoader] Waiting ".concat(c,"ms before retry...")),e.next=20,new Promise((function(e){return setTimeout(e,c)}));case 20:case"end":return e.stop()}}),e,null,[[0,12]])})),i=0;case 7:if(!(i<n)){e.next=15;break}return e.delegateYield(a(),"t0",9);case 9:if(!(r=e.t0)){e.next=12;break}return e.abrupt("return",r.v);case 12:i++,e.next=7;break;case 15:return console.error("[SectorLoader] ❌ Failed to load SECTORES_ECONOMICOS after",n,"attempts"),e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e)}))),Vn.apply(this,arguments)}function Un(){return Jn.apply(this,arguments)}function Jn(){return Jn=r(s().mark((function e(){var n,t,a,r,i=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>0&&void 0!==i[0]?i[0]:3,!($n&&$n.length>0)){e.next=3;break}return e.abrupt("return",$n);case 3:t=s().mark((function e(t){var a,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.e(786).then(o.bind(o,7405));case 3:if(a=e.sent,!(r=a.getCiudadesSimple)){e.next=11;break}if(!((i=r())&&i.length>0)){e.next=11;break}return $n=i,console.log("[SectorLoader] ✓ Loaded ciudades on attempt ".concat(t+1,":"),i.length),e.abrupt("return",{v:i});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("[SectorLoader] Ciudades attempt ".concat(t+1," failed:"),e.t0);case 16:if(!(t<n-1)){e.next=19;break}return e.next=19,new Promise((function(e){return setTimeout(e,100*Math.pow(2,t))}));case 19:case"end":return e.stop()}}),e,null,[[0,13]])})),r=0;case 5:if(!(r<n)){e.next=13;break}return e.delegateYield(t(r),"t0",7);case 7:if(!(a=e.t0)){e.next=10;break}return e.abrupt("return",a.v);case 10:r++,e.next=5;break;case 13:return console.error("[SectorLoader] ❌ Failed to load ciudades"),e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e)}))),Jn.apply(this,arguments)}function Kn(){return Yn.apply(this,arguments)}function Yn(){return(Yn=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[SectorLoader] Preloading catalogos..."),e.next=3,Promise.all([Wn(),Un()]);case 3:console.log("[SectorLoader] ✓ Catalogos preloaded successfully");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qn(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.content,a=void 0===t?"":t,o=n.placement,i=void 0===o?"top":o,c=n.offsetDistance,l=void 0===c?8:c,d=n.trigger,u=void 0===d?"hover":d,g=document.createElement("div");g.className="wizard-help-tooltip",g.setAttribute("role","tooltip"),g.innerHTML=a,g.style.position="absolute",g.style.top="0",g.style.left="0";var p=!1;function v(){return f.apply(this,arguments)}function f(){return f=r(s().mark((function n(){var t,a,o,r;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,Ln.computePosition)(e,g,{placement:i,middleware:[(0,Ln.offset)(l),(0,Ln.flip)(),(0,Ln.shift)({padding:8})]});case 2:t=n.sent,a=t.x,o=t.y,r=t.placement,Object.assign(g.style,{left:"".concat(a,"px"),top:"".concat(o,"px")}),g.setAttribute("data-popper-placement",r);case 8:case"end":return n.stop()}}),n)}))),f.apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return(m=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=2;break}return e.abrupt("return");case 2:return document.body.appendChild(g),e.next=5,v();case 5:requestAnimationFrame((function(){g.setAttribute("data-show",""),p=!0}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){p&&(g.removeAttribute("data-show"),p=!1,setTimeout((function(){g.parentElement&&!p&&g.remove()}),150))}function y(e){e.stopPropagation(),p?b():h()}function x(n){g.contains(n.target)||e.contains(n.target)||b()}return"hover"===u?(e.addEventListener("mouseenter",h),e.addEventListener("mouseleave",b),e.addEventListener("focus",h),e.addEventListener("blur",b)):"click"===u?(e.addEventListener("click",y),document.addEventListener("click",x)):"focus"===u&&(e.addEventListener("focus",h),e.addEventListener("blur",b)),{show:h,hide:b,destroy:function(){b(),"hover"===u?(e.removeEventListener("mouseenter",h),e.removeEventListener("mouseleave",b)):"click"===u?(e.removeEventListener("click",y),document.removeEventListener("click",x)):"focus"===u&&(e.removeEventListener("focus",h),e.removeEventListener("blur",b))},update:v}}function Xn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[data-tooltip]",n=document.querySelectorAll(e),t=[];return n.forEach((function(e){if(!e.hasAttribute("data-tooltip-initialized")){var n=e.getAttribute("data-tooltip"),a=e.getAttribute("data-tooltip-placement")||"top",o=e.getAttribute("data-tooltip-trigger")||"hover";if(n){var r=Qn(e,{content:n,placement:a,trigger:o});e.setAttribute("data-tooltip-initialized","true"),t.push(r)}}})),t.length>0&&console.log("[Tooltips] Initialized ".concat(t.length," tooltips")),t}function Zn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".wizard-enhanced-select",n=document.querySelectorAll(e),t=[];return n.forEach((function(e){if(!e.hasAttribute("data-dropdown-initialized")){var n=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.searchable,a=void 0===t||t,o=n.placeholder,i=void 0===o?e.getAttribute("placeholder")||"Seleccionar...":o,c=n.onChange,l=void 0===c?function(){}:c,d=Array.from(e.options).filter((function(e){return""!==e.value})).map((function(e){return{value:e.value,label:e.textContent,selected:e.selected}})),u=document.createElement("div");u.className="wizard-dropdown";var g=document.createElement("button");g.type="button",g.className="wizard-dropdown-trigger",g.setAttribute("aria-haspopup","listbox"),g.setAttribute("aria-expanded","false");var p=d.find((function(e){return e.selected})),v=document.createElement("span");v.textContent=p?p.label:i;var f=document.createElement("i");f.className="fas fa-chevron-down chevron",g.appendChild(v),g.appendChild(f);var h=document.createElement("div");h.className="wizard-dropdown-panel",h.setAttribute("role","listbox"),h.style.position="absolute",h.style.top="0",h.style.left="0";var m=null;if(a){var b=document.createElement("div");b.className="wizard-dropdown-search",(m=document.createElement("input")).type="text",m.placeholder="Buscar...",m.setAttribute("aria-label","Buscar opciones"),b.appendChild(m),h.appendChild(b)}var y=document.createElement("ul");y.className="wizard-dropdown-options";var w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;if(y.innerHTML="",0===e.length){var n=document.createElement("div");return n.className="wizard-dropdown-empty",n.textContent="No se encontraron resultados",void y.appendChild(n)}e.forEach((function(e){var n=document.createElement("li");n.className="wizard-dropdown-option",n.setAttribute("role","option"),n.setAttribute("data-value",e.value),n.textContent=e.label,n.tabIndex=0,e.selected&&n.setAttribute("aria-selected","true"),n.addEventListener("click",(function(){z(e)})),n.addEventListener("keydown",(function(n){"Enter"!==n.key&&" "!==n.key||(n.preventDefault(),z(e))})),y.appendChild(n)}))};w(),h.appendChild(y),u.appendChild(g),document.body.appendChild(h),e.style.display="none",e.parentElement.insertBefore(u,e);var C=!1,E=p?p.value:"";function S(){return k.apply(this,arguments)}function k(){return k=r(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Ln.computePosition)(g,h,{placement:"bottom-start",middleware:[(0,Ln.flip)(),(0,Ln.shift)({padding:8}),(0,Ln.size)({apply:function(e){var n=e.availableHeight,t=e.elements;Object.assign(t.floating.style,{maxHeight:"".concat(Math.min(n-16,300),"px")})}})]});case 2:n=e.sent,t=n.x,a=n.y,Object.assign(h.style,{left:"".concat(t,"px"),top:"".concat(a,"px"),width:"".concat(g.offsetWidth,"px")});case 6:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function A(){return _.apply(this,arguments)}function _(){return(_=r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!C){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,S();case 4:h.setAttribute("data-show",""),g.setAttribute("aria-expanded","true"),C=!0,m&&setTimeout((function(){return m.focus()}),50);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){C&&(h.removeAttribute("data-show"),g.setAttribute("aria-expanded","false"),C=!1,m&&(m.value="",w()))}function z(n){E=n.value,v.textContent=n.label,e.value=n.value;var t=new Event("change",{bubbles:!0}),a=new Event("input",{bubbles:!0});e.dispatchEvent(a),e.dispatchEvent(t),y.querySelectorAll("[aria-selected]").forEach((function(e){e.removeAttribute("aria-selected")}));var o=y.querySelector('[data-value="'.concat(n.value,'"]'));o&&o.setAttribute("aria-selected","true"),l(n.value,n.label),N()}g.addEventListener("click",(function(){C?N():A()})),m&&(m.addEventListener("input",(function(e){var n=e.target.value.toLowerCase().trim();if(n){var t=d.filter((function(e){return e.label.toLowerCase().includes(n)}));w(t)}else w()})),m.addEventListener("keydown",(function(e){if("Enter"===e.key){e.preventDefault();var n=y.querySelectorAll(".wizard-dropdown-option");1===n.length&&n[0].click()}}))),document.addEventListener("click",(function(e){u.contains(e.target)||h.contains(e.target)||N()})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&C&&(N(),g.focus())}));var T={open:A,close:N,getValue:function(){return E},setValue:function(e){var n=d.find((function(n){return n.value===e}));n&&z(n)},refresh:function(){var n=Array.from(e.options).filter((function(e){return""!==e.value})).map((function(e){return{value:e.value,label:e.textContent,selected:e.selected}}));d.length=0,d.push.apply(d,x(n)),w();var t=n.find((function(e){return e.selected}));t?(v.textContent=t.label,E=t.value):(v.textContent=i,E=""),console.log("[Dropdown] Refreshed with ".concat(n.length," options"))},destroy:function(){h.remove(),u.remove(),e.style.display="",delete e._dropdownApi}};return e._dropdownApi=T,T}(e,{searchable:!1!==e.hasAttribute("data-searchable")});e.setAttribute("data-dropdown-initialized","true"),t.push(n)}})),t.length>0&&console.log("[Dropdowns] Initialized ".concat(t.length," enhanced dropdowns")),t}function et(){return nt.apply(this,arguments)}function nt(){return(nt=r(s().mark((function e(){var n,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[Wizard Riesgos] Initializing..."),n=b(),console.log("[Wizard Riesgos] Current state:",n.data),"info-basica"===(t=n.getCurrentStep())){e.next=8;break}return at(),Pn(t,r(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[Wizard Riesgos] Resuming from step:",t),tt("Cargando asistente..."),e.next=4,Kn();case 4:return e.next=6,rt(n);case 6:new Bn("#wizard-container",n).init(),ot(),at();case 10:case"end":return e.stop()}}),e)}))),(function(){n.clearStorage(),console.log("[Wizard Riesgos] Session cleared, starting fresh"),window.location.reload()})),e.abrupt("return");case 8:return tt("Cargando catálogos..."),e.prev=9,e.next=12,Kn();case 12:return e.next=14,rt(n);case 14:new Bn("#wizard-container",n).init(),ot(),console.log("[Wizard Riesgos] Initialized successfully with Floating-UI enhancements"),at(),e.next=27;break;case 21:e.prev=21,e.t0=e.catch(9),console.error("[Wizard Riesgos] Error during initialization:",e.t0),at(),(a=document.getElementById("wizard-container"))&&(a.innerHTML='\n        <div class="wizard-error">\n          <i class="fas fa-exclamation-triangle"></i>\n          <h3>Error al cargar el asistente</h3>\n          <p>No se pudieron cargar los catálogos necesarios. Por favor, recarga la página.</p>\n          <button onclick="window.location.reload()" class="btn-primary">\n            <i class="fas fa-redo"></i> Recargar página\n          </button>\n        </div>\n      ');case 27:case"end":return e.stop()}}),e,null,[[9,21]])})))).apply(this,arguments)}function tt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Cargando asistente...",n=document.querySelector(".wizard-loading"),t=document.querySelector(".wizard-loading__text");n&&t&&(t.textContent=e,n.style.display="flex")}function at(){var e=document.querySelector(".wizard-loading");e&&(e.style.display="none")}function ot(){var e=null,n=new MutationObserver((function(){e&&clearTimeout(e),e=setTimeout((function(){n.disconnect(),Xn("[data-tooltip]"),Zn(".wizard-enhanced-select");var e=document.querySelector("#wizard-container");e&&n.observe(e,{childList:!0,subtree:!0})}),50)})),t=document.querySelector("#wizard-container");t&&n.observe(t,{childList:!0,subtree:!0}),setTimeout((function(){Xn("[data-tooltip]"),Zn(".wizard-enhanced-select")}),100)}function rt(e){return it.apply(this,arguments)}function it(){return(it=r(s().mark((function e(n){var a,o,r,i,c,l,d,u,g,p,v,f,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("[Wizard Riesgos] Loading catalogos from new API..."),a={riesgos:[],categorias:[],sectores:[],ciiuSecciones:[],ciudades:[]},e.next=5,Promise.all([fetch("/api/catalogo/ges?limit=200"),fetch("/api/catalogo/riesgos"),fetch("/api/catalogo/sectores"),fetch("/api/catalogo/ciiu/secciones"),fetch("/api/catalogo/ciudades")]);case 5:if(o=e.sent,r=t(o,5),i=r[0],c=r[1],l=r[2],d=r[3],u=r[4],!i.ok){e.next=20;break}return e.next=15,i.json();case 15:g=e.sent,a.riesgos=g.data||[],console.log("[Wizard Riesgos] ✅ Loaded ".concat(a.riesgos.length," GES from catalog API")),e.next=21;break;case 20:console.error("[Wizard Riesgos] ❌ Error loading GES:",i.statusText);case 21:if(!c.ok){e.next=29;break}return e.next=24,c.json();case 24:p=e.sent,a.categorias=p.data||[],console.log("[Wizard Riesgos] ✅ Loaded ".concat(a.categorias.length," risk categories")),e.next=30;break;case 29:console.error("[Wizard Riesgos] ❌ Error loading categories:",c.statusText);case 30:if(!l.ok){e.next=38;break}return e.next=33,l.json();case 33:v=e.sent,a.sectores=v.data||[],console.log("[Wizard Riesgos] ✅ Loaded ".concat(a.sectores.length," sectors")),e.next=39;break;case 38:console.error("[Wizard Riesgos] ❌ Error loading sectors:",l.statusText);case 39:if(!d.ok){e.next=47;break}return e.next=42,d.json();case 42:f=e.sent,a.ciiuSecciones=f.data||[],console.log("[Wizard Riesgos] ✅ Loaded ".concat(a.ciiuSecciones.length," CIIU sections")),e.next=48;break;case 47:console.error("[Wizard Riesgos] ❌ Error loading CIIU sections:",d.statusText);case 48:if(!u.ok){e.next=56;break}return e.next=51,u.json();case 51:h=e.sent,a.ciudades=h.data||[],console.log("[Wizard Riesgos] ✅ Loaded ".concat(a.ciudades.length," cities")),e.next=57;break;case 56:console.error("[Wizard Riesgos] ❌ Error loading cities:",u.statusText);case 57:n.setCatalogos(a),console.log("[Wizard Riesgos] 🎯 All catalogos loaded successfully"),e.next=64;break;case 61:e.prev=61,e.t0=e.catch(0),console.error("[Wizard Riesgos] ❌ Error loading catalogos:",e.t0);case 64:case"end":return e.stop()}}),e,null,[[0,61]])})))).apply(this,arguments)}function st(){var e=document.getElementById("import-json-modal"),n=null==e?void 0:e.querySelector(".wizard-modal__backdrop"),t=null==e?void 0:e.querySelector(".wizard-modal__close"),a=document.getElementById("btn-cancel-import"),o=document.getElementById("btn-confirm-import"),i=document.getElementById("import-file-input"),c=document.getElementById("import-dropzone"),l=document.getElementById("import-preview"),d=document.getElementById("import-preview-content"),u=document.getElementById("import-warnings"),g=document.getElementById("import-warnings-list");if(e){var p=null;document.addEventListener("click",(function(n){n.target.closest("#btn-import-json")&&(e.hidden=!1,document.body.style.overflow="hidden",f())}));var v=function(){e.hidden=!0,document.body.style.overflow="",f()};null==n||n.addEventListener("click",v),null==t||t.addEventListener("click",v),null==a||a.addEventListener("click",v);var f=function(){p=null,i.value="",l.hidden=!0,u.hidden=!0,o.disabled=!0,c.classList.remove("wizard-import-dropzone--dragover")};c.addEventListener("dragover",(function(e){e.preventDefault(),c.classList.add("wizard-import-dropzone--dragover")})),c.addEventListener("dragleave",(function(){c.classList.remove("wizard-import-dropzone--dragover")})),c.addEventListener("drop",(function(e){e.preventDefault(),c.classList.remove("wizard-import-dropzone--dragover");var n=e.dataTransfer.files[0];n&&"application/json"===n.type&&h(n)})),c.addEventListener("click",(function(){return i.click()})),i.addEventListener("change",(function(e){var n=e.target.files[0];n&&h(n)}));var h=function(){var e=r(s().mark((function e(n){var t,a,r,i,c,u,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.text();case 3:if(t=e.sent,(a=JSON.parse(t)).formData||a.cargos||a.userData){e.next=7;break}throw new Error("El archivo no tiene la estructura esperada (userData/formData)");case 7:p=a,r=a.userData||a,i=a.formData||a,c=i.cargos||[],u='<div class="preview-items">',r.nombreEmpresa&&(u+='\n          <div class="preview-item">\n            <span class="preview-label">Empresa:</span>\n            <span class="preview-value">'.concat(r.nombreEmpresa,"</span>\n          </div>\n        ")),r.nit&&(u+='\n          <div class="preview-item">\n            <span class="preview-label">NIT:</span>\n            <span class="preview-value">'.concat(r.nit,"</span>\n          </div>\n        ")),c.length>0&&(u+='\n          <div class="preview-item">\n            <span class="preview-label">Cargos:</span>\n            <span class="preview-value">'.concat(c.length," cargo(s)</span>\n          </div>\n        "),g=c.reduce((function(e,n){return e+(n.gesSeleccionados||n.ges||[]).length}),0),u+='\n          <div class="preview-item">\n            <span class="preview-label">Riesgos:</span>\n            <span class="preview-value">'.concat(g," GES en total</span>\n          </div>\n        "),u+='<div class="preview-cargos">',c.forEach((function(e){var n=e.cargoName||e.nombre||"Sin nombre",t=(e.gesSeleccionados||e.ges||[]).length;u+='\n            <div class="preview-cargo">\n              <span class="cargo-name">'.concat(n,'</span>\n              <span class="cargo-ges-count">').concat(t," riesgos</span>\n            </div>\n          ")})),u+="</div>"),u+="</div>",d.innerHTML=u,l.hidden=!1,o.disabled=!1,e.next=26;break;case 21:e.prev=21,e.t0=e.catch(0),console.error("[Import JSON] Error processing file:",e.t0),alert("Error al procesar el archivo: "+e.t0.message),f();case 26:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(n){return e.apply(this,arguments)}}();o.addEventListener("click",(function(){if(p){var e=b().importFromJSON(p);e.success?(e.warnings&&e.warnings.length>0&&(g.innerHTML=e.warnings.map((function(e){return"<li>".concat(e,"</li>")})).join(""),u.hidden=!1),alert("".concat(e.message,"\n\nCargos importados: ").concat(e.cargosImportados,"\nRiesgos importados: ").concat(e.gesImportados)),v(),window.location.reload()):alert("Error: "+e.message)}})),console.log("[Import JSON] Initialized")}else console.log("[Import JSON] Modal not found, skipping initialization")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){et(),st()})):(et(),st())})()})();