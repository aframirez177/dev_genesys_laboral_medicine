/*! For license information please see dashboard.bundle.js.LICENSE.txt */
(()=>{var e={7763:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>N,getFirmaState:()=>M,initFirmaDigitalUploader:()=>u,tieneFirmaConfigurada:()=>O});var a=t(9394),i=t(4467),r=t(467),o=t(4756),s=t.n(o);function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}var l="/api/medico/firma",d={tieneFirma:!1,firma:null,isLoading:!1,isDragging:!1,error:null,validationErrors:[]};function u(e,n){var t=document.getElementById(e);t?(d.authToken=n,function(e){e.innerHTML='\n        <div class="firma-uploader">\n            <div class="firma-uploader__header">\n                <h3 class="firma-uploader__title">\n                    <i data-lucide="pen-tool"></i>\n                    Mi Firma Digital\n                </h3>\n                <p class="firma-uploader__description">\n                    Suba su firma en formato PNG con fondo transparente.\n                    Esta firma se incorporará en los documentos que genere.\n                </p>\n            </div>\n\n            <div class="firma-uploader__content">\n                \x3c!-- Área de preview o dropzone --\x3e\n                <div id="firma-preview-area" class="firma-uploader__preview-area">\n                    '.concat(p(),'\n                </div>\n\n                \x3c!-- Mensajes de error --\x3e\n                <div id="firma-errors" class="firma-uploader__errors" style="display: none;"></div>\n\n                \x3c!-- Información de ayuda --\x3e\n                <div class="firma-uploader__help">\n                    <button type="button" class="firma-uploader__help-toggle" id="firma-help-toggle">\n                        <i data-lucide="help-circle"></i>\n                        ¿Cómo crear una firma con fondo transparente?\n                    </button>\n                    <div class="firma-uploader__help-content" id="firma-help-content" style="display: none;">\n                        <div class="firma-uploader__help-steps">\n                            <div class="help-step">\n                                <span class="help-step__number">1</span>\n                                <div class="help-step__content">\n                                    <strong>Firme en papel blanco</strong>\n                                    <p>Use un bolígrafo de tinta oscura (negro o azul) y firme sobre papel blanco liso.</p>\n                                </div>\n                            </div>\n                            <div class="help-step">\n                                <span class="help-step__number">2</span>\n                                <div class="help-step__content">\n                                    <strong>Fotografíe o escanee</strong>\n                                    <p>Tome una foto con buena iluminación o escanee la firma a alta resolución.</p>\n                                </div>\n                            </div>\n                            <div class="help-step">\n                                <span class="help-step__number">3</span>\n                                <div class="help-step__content">\n                                    <strong>Quite el fondo</strong>\n                                    <p>Use herramientas como <a href="https://www.remove.bg/es" target="_blank" rel="noopener">remove.bg</a>\n                                    o el editor de imágenes de su preferencia para eliminar el fondo blanco.</p>\n                                </div>\n                            </div>\n                            <div class="help-step">\n                                <span class="help-step__number">4</span>\n                                <div class="help-step__content">\n                                    <strong>Guarde como PNG</strong>\n                                    <p>Es importante guardar en formato PNG para mantener la transparencia.</p>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="firma-uploader__requirements">\n                            <h4>Requisitos técnicos:</h4>\n                            <ul>\n                                <li><i data-lucide="check"></i> Formato: PNG con transparencia</li>\n                                <li><i data-lucide="check"></i> Tamaño máximo: 500 KB</li>\n                                <li><i data-lucide="check"></i> Dimensiones mínimas: 100 x 30 píxeles</li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '),function(e){var n=e.querySelector("#firma-help-toggle"),t=e.querySelector("#firma-help-content");n&&t&&n.addEventListener("click",(function(){var e="none"!==t.style.display;t.style.display=e?"none":"block",n.classList.toggle("active",!e)}));m(e),g(e)}(e),window.lucide&&window.lucide.createIcons()}(t),function(e){E.apply(this,arguments)}(t)):console.error("Container #".concat(e," not found"))}function p(){return d.isLoading?'\n            <div class="firma-uploader__loading">\n                <div class="spinner"></div>\n                <span>Cargando...</span>\n            </div>\n        ':d.tieneFirma&&d.firma?'\n            <div class="firma-uploader__preview">\n                <div class="firma-uploader__preview-image checkered-bg">\n                    <img src="'.concat(d.firma.url,'" alt="Mi firma digital" id="firma-image">\n                </div>\n                <div class="firma-uploader__preview-info">\n                    <span class="firma-uploader__preview-dimensions">\n                        ').concat(d.firma.width," x ").concat(d.firma.height,' px\n                    </span>\n                    <span class="firma-uploader__preview-size">\n                        ').concat(I(d.firma.size),'\n                    </span>\n                </div>\n                <div class="firma-uploader__preview-actions">\n                    <button type="button" class="btn btn--outline btn--sm" id="btn-cambiar-firma">\n                        <i data-lucide="refresh-cw"></i>\n                        Cambiar firma\n                    </button>\n                    <button type="button" class="btn btn--danger btn--sm" id="btn-eliminar-firma">\n                        <i data-lucide="trash-2"></i>\n                        Eliminar\n                    </button>\n                </div>\n            </div>\n        '):'\n        <div class="firma-uploader__dropzone '.concat(d.isDragging?"dragging":"",'" id="firma-dropzone">\n            <div class="firma-uploader__dropzone-content">\n                <i data-lucide="upload-cloud" class="firma-uploader__dropzone-icon"></i>\n                <p class="firma-uploader__dropzone-text">\n                    Arrastre su firma aquí o\n                </p>\n                <button type="button" class="btn btn--primary btn--sm" id="btn-seleccionar-firma">\n                    Seleccionar archivo\n                </button>\n                <span class="firma-uploader__dropzone-formats">\n                    PNG con transparencia • Máx. 500KB\n                </span>\n            </div>\n            <input type="file" id="firma-file-input" accept="image/png" style="display: none;">\n        </div>\n    ')}function m(e){var n=e.querySelector("#firma-dropzone"),t=e.querySelector("#firma-file-input"),a=e.querySelector("#btn-seleccionar-firma");n&&(a&&a.addEventListener("click",(function(e){e.stopPropagation(),null==t||t.click()})),n.addEventListener("click",(function(e){(e.target===n||e.target.closest(".firma-uploader__dropzone-content")&&!e.target.closest("button"))&&(null==t||t.click())})),["dragenter","dragover"].forEach((function(e){n.addEventListener(e,(function(e){e.preventDefault(),e.stopPropagation(),d.isDragging=!0,n.classList.add("dragging")}))})),["dragleave","drop"].forEach((function(e){n.addEventListener(e,(function(e){e.preventDefault(),e.stopPropagation(),d.isDragging=!1,n.classList.remove("dragging")}))})),n.addEventListener("drop",(function(n){var t,a=null===(t=n.dataTransfer)||void 0===t?void 0:t.files;(null==a?void 0:a.length)>0&&v(a[0],e)})),t&&t.addEventListener("change",(function(n){var t,a=null===(t=n.target.files)||void 0===t?void 0:t[0];a&&v(a,e)})))}function g(e){var n=e.querySelector("#btn-cambiar-firma"),t=e.querySelector("#btn-eliminar-firma");n&&n.addEventListener("click",(function(){d.tieneFirma=!1,d.firma=null,k(e)})),t&&t.addEventListener("click",(function(){confirm("¿Está seguro de eliminar su firma digital?")&&function(e){w.apply(this,arguments)}(e)}))}function v(e,n){return h.apply(this,arguments)}function h(){return(h=(0,r.A)(s().mark((function e(n,t){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.validationErrors=[],C(t),e.next=4,f(n);case 4:if((a=e.sent).valid){e.next=8;break}return A(t,a.errors),e.abrupt("return");case 8:return e.next=10,x(n,t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return b.apply(this,arguments)}function b(){return(b=(0,r.A)(s().mark((function e(n){var t,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],"image/png"!==n.type&&t.push("El archivo debe ser formato PNG"),n.size>512e3&&t.push("El archivo es muy grande. Máximo 500KB (actual: ".concat(I(n.size),")")),e.prev=4,e.next=7,y(n);case 7:(i=e.sent).valid||t.push.apply(t,(0,a.A)(i.errors)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t.push("No se pudo leer el archivo de imagen");case 14:return e.abrupt("return",{valid:0===t.length,errors:t});case 15:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}function y(e){return new Promise((function(n){var t=new Image,a=document.createElement("canvas"),i=a.getContext("2d");t.onload=function(){var e=[];(t.width<100||t.height<30)&&e.push("La imagen es muy pequeña. Mínimo 100x30 píxeles (actual: ".concat(t.width,"x").concat(t.height,")")),a.width=t.width,a.height=t.height,i.drawImage(t,0,0);try{for(var r=i.getImageData(0,0,a.width,a.height).data,o=!1,s=3;s<r.length;s+=4)if(r[s]<255){o=!0;break}o||e.push("La imagen no tiene fondo transparente. Debe tener canal alpha.")}catch(e){console.warn("Could not validate transparency:",e)}URL.revokeObjectURL(t.src),n({valid:0===e.length,errors:e})},t.onerror=function(){URL.revokeObjectURL(t.src),n({valid:!1,errors:["El archivo no es una imagen válida"]})},t.src=URL.createObjectURL(e)}))}function x(e,n){return _.apply(this,arguments)}function _(){return(_=(0,r.A)(s().mark((function e(n,t){var a,i,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.isLoading=!0,k(t),e.prev=2,(a=new FormData).append("firma",n),e.next=7,fetch(l,{method:"POST",headers:{Authorization:"Bearer ".concat(d.authToken)},body:a});case 7:return i=e.sent,e.next=10,i.json();case 10:if(r=e.sent,i.ok){e.next=13;break}throw new Error(r.message||"Error subiendo firma");case 13:d.tieneFirma=!0,d.firma=r.firma,d.error=null,S("Firma subida exitosamente","success"),window.dispatchEvent(new CustomEvent("firmaDigitalActualizada",{detail:{tieneFirma:!0,firma:r.firma}})),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(2),console.error("Error subiendo firma:",e.t0),A(t,[e.t0.message]);case 24:return e.prev=24,d.isLoading=!1,k(t),e.finish(24);case 28:case"end":return e.stop()}}),e,null,[[2,20,24,28]])})))).apply(this,arguments)}function w(){return(w=(0,r.A)(s().mark((function e(n){var t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.isLoading=!0,k(n),e.prev=2,e.next=5,fetch(l,{method:"DELETE",headers:{Authorization:"Bearer ".concat(d.authToken),"Content-Type":"application/json"}});case 5:return t=e.sent,e.next=8,t.json();case 8:if(a=e.sent,t.ok){e.next=11;break}throw new Error(a.message||"Error eliminando firma");case 11:d.tieneFirma=!1,d.firma=null,d.error=null,S("Firma eliminada","success"),window.dispatchEvent(new CustomEvent("firmaDigitalActualizada",{detail:{tieneFirma:!1,firma:null}})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(2),console.error("Error eliminando firma:",e.t0),A(n,[e.t0.message]);case 22:return e.prev=22,d.isLoading=!1,k(n),e.finish(22);case 26:case"end":return e.stop()}}),e,null,[[2,18,22,26]])})))).apply(this,arguments)}function E(){return(E=(0,r.A)(s().mark((function e(n){var t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.isLoading=!0,k(n),e.prev=2,e.next=5,fetch(l,{method:"GET",headers:{Authorization:"Bearer ".concat(d.authToken),"Content-Type":"application/json"}});case 5:return t=e.sent,e.next=8,t.json();case 8:if(a=e.sent,t.ok){e.next=11;break}throw new Error(a.message||"Error obteniendo firma");case 11:d.tieneFirma=a.tieneFirma,d.firma=a.firma,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),console.error("Error cargando firma:",e.t0);case 18:return e.prev=18,d.isLoading=!1,k(n),e.finish(18);case 22:case"end":return e.stop()}}),e,null,[[2,15,18,22]])})))).apply(this,arguments)}function k(e){var n=e.querySelector("#firma-preview-area");n&&(n.innerHTML=p(),m(e),g(e),window.lucide&&window.lucide.createIcons())}function A(e,n){var t=e.querySelector("#firma-errors");t&&(t.innerHTML=n.map((function(e){return'\n            <div class="firma-uploader__error">\n                <i data-lucide="alert-circle"></i>\n                <span>'.concat(e,"</span>\n            </div>\n        ")})).join(""),t.style.display="block",window.lucide&&window.lucide.createIcons())}function C(e){var n=e.querySelector("#firma-errors");n&&(n.style.display="none",n.innerHTML="")}function S(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=document.querySelector(".firma-toast");t||((t=document.createElement("div")).className="firma-toast",document.body.appendChild(t)),t.textContent=e,t.className="firma-toast firma-toast--".concat(n," firma-toast--visible"),setTimeout((function(){t.classList.remove("firma-toast--visible")}),3e3)}function I(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}function M(){return function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){(0,i.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},d)}function O(){return d.tieneFirma}const N={initFirmaDigitalUploader:u,getFirmaState:M,tieneFirmaConfigurada:O}},4633:(e,n,t)=>{var a=t(3738).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var n,t={},r=Object.prototype,o=r.hasOwnProperty,s=Object.defineProperty||function(e,n,t){e[n]=t.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function p(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{p({},"")}catch(n){p=function(e,n,t){return e[n]=t}}function m(e,n,t,a){var i=n&&n.prototype instanceof x?n:x,r=Object.create(i.prototype),o=new L(a||[]);return s(r,"_invoke",{value:M(e,t,o)}),r}function g(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var v="suspendedStart",h="suspendedYield",f="executing",b="completed",y={};function x(){}function _(){}function w(){}var E={};p(E,l,(function(){return this}));var k=Object.getPrototypeOf,A=k&&k(k(z([])));A&&A!==r&&o.call(A,l)&&(E=A);var C=w.prototype=x.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(n){p(e,n,(function(e){return this._invoke(n,e)}))}))}function I(e,n){function t(i,r,s,c){var l=g(e[i],e,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==a(u)&&o.call(u,"__await")?n.resolve(u.__await).then((function(e){t("next",e,s,c)}),(function(e){t("throw",e,s,c)})):n.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return t("throw",e,s,c)}))}c(l.arg)}var i;s(this,"_invoke",{value:function(e,a){function r(){return new n((function(n,i){t(e,a,n,i)}))}return i=i?i.then(r,r):r()}})}function M(e,t,a){var i=v;return function(r,o){if(i===f)throw Error("Generator is already running");if(i===b){if("throw"===r)throw o;return{value:n,done:!0}}for(a.method=r,a.arg=o;;){var s=a.delegate;if(s){var c=O(s,a);if(c){if(c===y)continue;return c}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(i===v)throw i=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);i=f;var l=g(e,t,a);if("normal"===l.type){if(i=a.done?b:h,l.arg===y)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(i=b,a.method="throw",a.arg=l.arg)}}}function O(e,t){var a=t.method,i=e.iterator[a];if(i===n)return t.delegate=null,"throw"===a&&e.iterator.return&&(t.method="return",t.arg=n,O(e,t),"throw"===t.method)||"return"!==a&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+a+"' method")),y;var r=g(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,y;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,y):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function N(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function P(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function z(e){if(e||""===e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(o.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=n,t.done=!0,t};return r.next=r}}throw new TypeError(a(e)+" is not iterable")}return _.prototype=w,s(C,"constructor",{value:w,configurable:!0}),s(w,"constructor",{value:_,configurable:!0}),_.displayName=p(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===_||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,p(e,u,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},S(I.prototype),p(I.prototype,d,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,a,i,r){void 0===r&&(r=Promise);var o=new I(m(e,n,a,i),r);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(C),p(C,u,"Generator"),p(C,l,(function(){return this})),p(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var n=Object(e),t=[];for(var a in n)t.push(a);return t.reverse(),function e(){for(;t.length;){var a=t.pop();if(a in n)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=z,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(a,i){return s.type="throw",s.arg=e,t.next=a,i&&(t.method="next",t.arg=n),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],s=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var c=o.call(r,"catchLoc"),l=o.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=n,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(r)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),y},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),P(t),y}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var a=t.completion;if("throw"===a.type){var i=a.arg;P(t)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:z(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=n),y}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3738:e=>{function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},4756:(e,n,t)=>{var a=t(4633)();e.exports=a;try{regeneratorRuntime=a}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}},3145:(e,n,t)=>{"use strict";function a(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}t.d(n,{A:()=>a})},4243:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var a=t(3145);function i(e){if(Array.isArray(e))return(0,a.A)(e)}},467:(e,n,t)=>{"use strict";function a(e,n,t,a,i,r,o){try{var s=e[r](o),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(a,i)}function i(e){return function(){var n=this,t=arguments;return new Promise((function(i,r){var o=e.apply(n,t);function s(e){a(o,i,r,s,c,"next",e)}function c(e){a(o,i,r,s,c,"throw",e)}s(void 0)}))}}t.d(n,{A:()=>i})},4467:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var a=t(9922);function i(e,n,t){return(n=(0,a.A)(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}},3893:(e,n,t)=>{"use strict";function a(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}t.d(n,{A:()=>a})},519:(e,n,t)=>{"use strict";function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}t.d(n,{A:()=>a})},9394:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(4243),i=t(3893),r=t(7800),o=t(519);function s(e){return(0,a.A)(e)||(0,i.A)(e)||(0,r.A)(e)||(0,o.A)()}},2327:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var a=t(2284);function i(e,n){if("object"!=(0,a.A)(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n||"default");if("object"!=(0,a.A)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}},9922:(e,n,t)=>{"use strict";t.d(n,{A:()=>r});var a=t(2284),i=t(2327);function r(e){var n=(0,i.A)(e,"string");return"symbol"==(0,a.A)(n)?n:n+""}},2284:(e,n,t)=>{"use strict";function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.d(n,{A:()=>a})},7800:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var a=t(3145);function i(e,n){if(e){if("string"==typeof e)return(0,a.A)(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?(0,a.A)(e,n):void 0}}}},n={};function t(a){var i=n[a];if(void 0!==i)return i.exports;var r=n[a]={exports:{}};return e[a](r,r.exports,t),r.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=t(7800);function n(n,t){return function(e){if(Array.isArray(e))return e}(n)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,i,r,o,s=[],c=!0,l=!1;try{if(r=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(a=r.call(t)).done)&&(s.push(a.value),s.length!==n);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(n,t)||(0,e.A)(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var a=t(4467),i=t(467);function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o=t(9922);function s(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(0,o.A)(a.key),a)}}function c(e,n,t){return n&&s(e.prototype,n),t&&s(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var l=t(4756),d=t.n(l);function u(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}var p=t(9394);const m=globalThis,g=m.trustedTypes,v=g?g.createPolicy("lit-html",{createHTML:e=>e}):void 0,h="$lit$",f=`lit$${Math.random().toFixed(9).slice(2)}$`,b="?"+f,y=`<${b}>`,x=document,_=()=>x.createComment(""),w=e=>null===e||"object"!=typeof e&&"function"!=typeof e,E=Array.isArray,k=e=>E(e)||"function"==typeof e?.[Symbol.iterator],A="[ \t\n\f\r]",C=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,S=/-->/g,I=/>/g,M=RegExp(`>|${A}(?:([^\\s"'>=/]+)(${A}*=${A}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),O=/'/g,N=/"/g,P=/^(?:script|style|textarea|title)$/i,L=e=>(n,...t)=>({_$litType$:e,strings:n,values:t}),z=L(1),R=(L(2),L(3),Symbol.for("lit-noChange")),T=Symbol.for("lit-nothing"),j=new WeakMap,D=x.createTreeWalker(x,129);function B(e,n){if(!E(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==v?v.createHTML(n):n}const H=(e,n)=>{const t=e.length-1,a=[];let i,r=2===n?"<svg>":3===n?"<math>":"",o=C;for(let n=0;n<t;n++){const t=e[n];let s,c,l=-1,d=0;for(;d<t.length&&(o.lastIndex=d,c=o.exec(t),null!==c);)d=o.lastIndex,o===C?"!--"===c[1]?o=S:void 0!==c[1]?o=I:void 0!==c[2]?(P.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=M):void 0!==c[3]&&(o=M):o===M?">"===c[0]?(o=i??C,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,s=c[1],o=void 0===c[3]?M:'"'===c[3]?N:O):o===N||o===O?o=M:o===S||o===I?o=C:(o=M,i=void 0);const u=o===M&&e[n+1].startsWith("/>")?" ":"";r+=o===C?t+y:l>=0?(a.push(s),t.slice(0,l)+h+t.slice(l)+f+u):t+f+(-2===l?n:u)}return[B(e,r+(e[t]||"<?>")+(2===n?"</svg>":3===n?"</math>":"")),a]};class U{constructor({strings:e,_$litType$:n},t){let a;this.parts=[];let i=0,r=0;const o=e.length-1,s=this.parts,[c,l]=H(e,n);if(this.el=U.createElement(c,t),D.currentNode=this.el.content,2===n||3===n){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(a=D.nextNode())&&s.length<o;){if(1===a.nodeType){if(a.hasAttributes())for(const e of a.getAttributeNames())if(e.endsWith(h)){const n=l[r++],t=a.getAttribute(e).split(f),o=/([.?@])?(.*)/.exec(n);s.push({type:1,index:i,name:o[2],strings:t,ctor:"."===o[1]?V:"?"===o[1]?J:"@"===o[1]?W:G}),a.removeAttribute(e)}else e.startsWith(f)&&(s.push({type:6,index:i}),a.removeAttribute(e));if(P.test(a.tagName)){const e=a.textContent.split(f),n=e.length-1;if(n>0){a.textContent=g?g.emptyScript:"";for(let t=0;t<n;t++)a.append(e[t],_()),D.nextNode(),s.push({type:2,index:++i});a.append(e[n],_())}}}else if(8===a.nodeType)if(a.data===b)s.push({type:2,index:i});else{let e=-1;for(;-1!==(e=a.data.indexOf(f,e+1));)s.push({type:7,index:i}),e+=f.length-1}i++}}static createElement(e,n){const t=x.createElement("template");return t.innerHTML=e,t}}function q(e,n,t=e,a){if(n===R)return n;let i=void 0!==a?t._$Co?.[a]:t._$Cl;const r=w(n)?void 0:n._$litDirective$;return i?.constructor!==r&&(i?._$AO?.(!1),void 0===r?i=void 0:(i=new r(e),i._$AT(e,t,a)),void 0!==a?(t._$Co??=[])[a]=i:t._$Cl=i),void 0!==i&&(n=q(e,i._$AS(e,n.values),i,a)),n}class F{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:n},parts:t}=this._$AD,a=(e?.creationScope??x).importNode(n,!0);D.currentNode=a;let i=D.nextNode(),r=0,o=0,s=t[0];for(;void 0!==s;){if(r===s.index){let n;2===s.type?n=new $(i,i.nextSibling,this,e):1===s.type?n=new s.ctor(i,s.name,s.strings,this,e):6===s.type&&(n=new X(i,this,e)),this._$AV.push(n),s=t[++o]}r!==s?.index&&(i=D.nextNode(),r++)}return D.currentNode=x,a}p(e){let n=0;for(const t of this._$AV)void 0!==t&&(void 0!==t.strings?(t._$AI(e,t,n),n+=t.strings.length-2):t._$AI(e[n])),n++}}class ${get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,n,t,a){this.type=2,this._$AH=T,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=t,this.options=a,this._$Cv=a?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return void 0!==n&&11===e?.nodeType&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=q(this,e,n),w(e)?e===T||null==e||""===e?(this._$AH!==T&&this._$AR(),this._$AH=T):e!==this._$AH&&e!==R&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):k(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==T&&w(this._$AH)?this._$AA.nextSibling.data=e:this.T(x.createTextNode(e)),this._$AH=e}$(e){const{values:n,_$litType$:t}=e,a="number"==typeof t?this._$AC(e):(void 0===t.el&&(t.el=U.createElement(B(t.h,t.h[0]),this.options)),t);if(this._$AH?._$AD===a)this._$AH.p(n);else{const e=new F(a,this),t=e.u(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let n=j.get(e.strings);return void 0===n&&j.set(e.strings,n=new U(e)),n}k(e){E(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let t,a=0;for(const i of e)a===n.length?n.push(t=new $(this.O(_()),this.O(_()),this,this.options)):t=n[a],t._$AI(i),a++;a<n.length&&(this._$AR(t&&t._$AB.nextSibling,a),n.length=a)}_$AR(e=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class G{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,n,t,a,i){this.type=1,this._$AH=T,this._$AN=void 0,this.element=e,this.name=n,this._$AM=a,this.options=i,t.length>2||""!==t[0]||""!==t[1]?(this._$AH=Array(t.length-1).fill(new String),this.strings=t):this._$AH=T}_$AI(e,n=this,t,a){const i=this.strings;let r=!1;if(void 0===i)e=q(this,e,n,0),r=!w(e)||e!==this._$AH&&e!==R,r&&(this._$AH=e);else{const a=e;let o,s;for(e=i[0],o=0;o<i.length-1;o++)s=q(this,a[t+o],n,o),s===R&&(s=this._$AH[o]),r||=!w(s)||s!==this._$AH[o],s===T?e=T:e!==T&&(e+=(s??"")+i[o+1]),this._$AH[o]=s}r&&!a&&this.j(e)}j(e){e===T?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class V extends G{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===T?void 0:e}}class J extends G{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==T)}}class W extends G{constructor(e,n,t,a,i){super(e,n,t,a,i),this.type=5}_$AI(e,n=this){if((e=q(this,e,n,0)??T)===R)return;const t=this._$AH,a=e===T&&t!==T||e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive,i=e!==T&&(t===T||a);a&&this.element.removeEventListener(this.name,this,t),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class X{constructor(e,n,t){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=t}get _$AU(){return this._$AM._$AU}_$AI(e){q(this,e)}}const Z=m.litHtmlPolyfillSupport;Z?.(U,$),(m.litHtmlVersions??=[]).push("3.3.1");var K,Y,Q,ee,ne,te,ae,ie,re,oe,se,ce,le,de,ue,pe,me,ge,ve,he,fe,be,ye,xe,_e,we,Ee,ke,Ae,Ce,Se,Ie,Me,Oe,Ne,Pe,Le;function ze(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Re(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ze(Object(t),!0).forEach((function(n){(0,a.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ze(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Te=function(){return c((function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.options=Re({mode:n.mode||"create",cargoId:n.cargoId||null,cargoData:n.cargoData||null,empresaId:n.empresaId||null,onSave:n.onSave||function(){},onCancel:n.onCancel||function(){}},n),this.state={currentStep:0,totalSteps:5,loading:!1,error:null,cargo:{nombre:"",area:"",zona:"",descripcion:"",numPersonas:1,tareasRutinarias:!1,trabajaAlturas:!1,manipulaAlimentos:!1,conduceVehiculo:!1,trabajaEspaciosConfinados:!1,riesgosSeleccionados:[],niveles:{},controles:{}},pendingApprovals:[],originalNiveles:{},originalControles:{},catalogoGES:[],catalogoRiesgos:[],existingAreas:[],existingZonas:[]},this.steps=[{id:"info",title:"Información Básica",icon:"user"},{id:"riesgos",title:"Selección de Riesgos",icon:"alert-triangle"},{id:"niveles",title:"Niveles de Riesgo",icon:"sliders"},{id:"controles",title:"Controles",icon:"shield"},{id:"resumen",title:"Resumen",icon:"check-circle"}],this.niveles={ND:[{value:1,label:"Bajo / N/A",color:"#10b981"},{value:2,label:"Medio",color:"#84cc16"},{value:6,label:"Alto",color:"#f59e0b"},{value:10,label:"Muy Alto",color:"#ef4444"}],NE:[{value:1,label:"Esporádica",color:"#10b981"},{value:2,label:"Ocasional",color:"#84cc16"},{value:3,label:"Frecuente",color:"#f59e0b"},{value:4,label:"Continua",color:"#ef4444"}],NC:[{value:10,label:"Leve",color:"#10b981"},{value:25,label:"Grave",color:"#f59e0b"},{value:60,label:"Muy Grave",color:"#f97316"},{value:100,label:"Mortal",color:"#ef4444"}]},this.modalElement=null,this.init()}),[{key:"init",value:(o=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"edit"===this.options.mode&&this.options.cargoData&&this.loadCargoData(this.options.cargoData),e.next=3,this.loadCatalogos();case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"loadCargoData",value:function(e){this.state.cargo=Re(Re({},this.state.cargo),{},{nombre:e.nombre||e.nombre_cargo||"",area:e.area||"",zona:e.zona||"",descripcion:e.descripcion||e.descripcion_tareas||e.descripcionTareas||"",numPersonas:e.numPersonas||e.num_trabajadores||1,tareasRutinarias:e.tareasRutinarias||e.tareas_rutinarias||!1,trabajaAlturas:e.trabajaAlturas||e.trabaja_alturas||!1,manipulaAlimentos:e.manipulaAlimentos||e.manipula_alimentos||!1,conduceVehiculo:e.conduceVehiculo||e.conduce_vehiculo||!1,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados||e.trabaja_espacios_confinados||!1,riesgosSeleccionados:e.gesSeleccionados||e.riesgos||e.riesgosSeleccionados||[],niveles:e.niveles||{},controles:e.controles||{}}),this.state.originalNiveles=JSON.parse(JSON.stringify(this.state.cargo.niveles)),this.state.originalControles=JSON.parse(JSON.stringify(this.state.cargo.controles))}},{key:"loadCatalogos",value:(a=(0,i.A)(d().mark((function e(){var n,t,a,i,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/catalogo/ges");case 3:if(!(n=e.sent).ok){e.next=9;break}return e.next=7,n.json();case 7:t=e.sent,this.state.catalogoGES=t.data||t||[];case 9:if(!this.options.empresaId){e.next=20;break}return e.next=12,fetch("/api/cargos/empresa/".concat(this.options.empresaId));case 12:if(!(a=e.sent).ok){e.next=20;break}return e.next=16,a.json();case 16:i=e.sent,r=i.cargos||[],this.state.existingAreas=(0,p.A)(new Set(r.map((function(e){return e.area})).filter(Boolean))),this.state.existingZonas=(0,p.A)(new Set(r.map((function(e){return e.zona})).filter(Boolean)));case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),console.error("[CargoMiniWizard] Error loading catalogs:",e.t0);case 25:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(){return a.apply(this,arguments)})},{key:"show",value:function(){var e=this;this.modalElement=document.createElement("div"),this.modalElement.className="cargo-mini-wizard-overlay",this.modalElement.innerHTML='\n      <div class="cargo-mini-wizard-modal">\n        <div class="cargo-mini-wizard-content" id="cargo-mini-wizard-content">\n        </div>\n      </div>\n    ',document.body.appendChild(this.modalElement),document.body.style.overflow="hidden",this.renderContent(),this.modalElement.addEventListener("click",(function(n){n.target===e.modalElement&&e.handleCancel()})),this.escapeHandler=function(n){"Escape"===n.key&&e.handleCancel()},document.addEventListener("keydown",this.escapeHandler)}},{key:"hide",value:function(){this.modalElement&&(document.body.removeChild(this.modalElement),document.body.style.overflow="",this.modalElement=null),this.escapeHandler&&document.removeEventListener("keydown",this.escapeHandler)}},{key:"renderContent",value:function(){var e=this,n=document.getElementById("cargo-mini-wizard-content");n&&(((e,n,t)=>{const a=t?.renderBefore??n;let i=a._$litPart$;if(void 0===i){const e=t?.renderBefore??null;a._$litPart$=i=new $(n.insertBefore(_(),e),e,void 0,t??{})}i._$AI(e)})(z(K||(K=u(['\n      \x3c!-- Header --\x3e\n      <div class="mini-wizard__header">\n        <div class="mini-wizard__header-left">\n          <h2 class="mini-wizard__title">\n            ','\n          </h2>\n          <p class="mini-wizard__subtitle">\n            ','\n          </p>\n        </div>\n        <button class="mini-wizard__close" @click=','>\n          <i data-lucide="x"></i>\n        </button>\n      </div>\n\n      \x3c!-- Progress Steps --\x3e\n      <div class="mini-wizard__progress">\n        ','\n      </div>\n\n      \x3c!-- Content --\x3e\n      <div class="mini-wizard__body">\n        ','\n      </div>\n\n      \x3c!-- Footer --\x3e\n      <div class="mini-wizard__footer">\n        <div class="mini-wizard__footer-left">\n          ','\n        </div>\n        <div class="mini-wizard__footer-right">\n          <button class="btn btn--ghost" @click=',">\n            Cancelar\n          </button>\n          ","\n        </div>\n      </div>\n    "])),"edit"===this.options.mode?"Editar Cargo":"Nuevo Cargo",this.steps[this.state.currentStep].title,(function(){return e.handleCancel()}),this.steps.map((function(n,t){return z(Y||(Y=u(['\n          <div class="mini-wizard__step '," ",'">\n            <div class="mini-wizard__step-icon">\n              <i data-lucide="','"></i>\n            </div>\n            <span class="mini-wizard__step-label">',"</span>\n          </div>\n        "])),t===e.state.currentStep?"active":"",t<e.state.currentStep?"completed":"",n.icon,n.title)})),this.renderCurrentStep(),this.state.currentStep>0?z(Q||(Q=u(['\n            <button class="btn btn--outline" @click=','>\n              <i data-lucide="arrow-left"></i>\n              Anterior\n            </button>\n          '])),(function(){return e.goToPreviousStep()})):"",(function(){return e.handleCancel()}),this.state.currentStep<this.state.totalSteps-1?z(ee||(ee=u(['\n            <button class="btn btn--primary" @click=','>\n              Siguiente\n              <i data-lucide="arrow-right"></i>\n            </button>\n          '])),(function(){return e.goToNextStep()})):z(ne||(ne=u(['\n            <button class="btn btn--primary" @click=','>\n              <i data-lucide="save"></i>\n              ',"\n            </button>\n          "])),(function(){return e.handleSave()}),"edit"===this.options.mode?"Guardar Cambios":"Crear Cargo")),n),window.lucide&&window.lucide.createIcons())}},{key:"renderCurrentStep",value:function(){switch(this.state.currentStep){case 0:return this.renderInfoStep();case 1:return this.renderRiesgosStep();case 2:return this.renderNivelesStep();case 3:return this.renderControlesStep();case 4:return this.renderResumenStep();default:return z(te||(te=u(["<p>Paso no encontrado</p>"])))}}},{key:"renderInfoStep",value:function(){var e=this,n=this.state.cargo;return z(ae||(ae=u(['\n      <div class="mini-wizard__step-content">\n        <div class="mini-wizard__form-grid">\n          \x3c!-- Columna izquierda: Campos básicos --\x3e\n          <div class="mini-wizard__form-col">\n            <div class="form-group">\n              <label class="form-label">Nombre del Cargo <span class="required">*</span></label>\n              <input\n                type="text"\n                class="form-input"\n                .value=',"\n                @input=",'\n                placeholder="Ej: Operario de Producción"\n                required\n              />\n            </div>\n\n            <div class="form-group">\n              <label class="form-label">Área <span class="required">*</span></label>\n              <input\n                type="text"\n                class="form-input"\n                list="areas-list"\n                .value=',"\n                @input=",'\n                placeholder="Ej: Producción, Administración"\n              />\n              <datalist id="areas-list">\n                ','\n              </datalist>\n            </div>\n\n            <div class="form-group">\n              <label class="form-label">Zona o Lugar <span class="required">*</span></label>\n              <input\n                type="text"\n                class="form-input"\n                list="zonas-list"\n                .value=',"\n                @input=",'\n                placeholder="Ej: Planta 1, Oficina central"\n              />\n              <datalist id="zonas-list">\n                ','\n              </datalist>\n            </div>\n\n            <div class="form-group">\n              <label class="form-label">Número de Trabajadores <span class="required">*</span></label>\n              <input\n                type="number"\n                class="form-input"\n                .value=',"\n                @input=",'\n                min="1"\n                max="9999"\n              />\n            </div>\n\n            <div class="form-group">\n              <label class="form-label">Descripción</label>\n              <textarea\n                class="form-input form-textarea"\n                .value=',"\n                @input=",'\n                placeholder="Descripción de las funciones del cargo..."\n                rows="4"\n              ></textarea>\n            </div>\n          </div>\n\n          \x3c!-- Columna derecha: Toggles especiales --\x3e\n          <div class="mini-wizard__form-col">\n            <label class="form-label form-label--section">\n              <i data-lucide="shield"></i>\n              Características Especiales\n            </label>\n            <div class="toggles-grid">\n              ',"\n            </div>\n          </div>\n        </div>\n      </div>\n    "])),n.nombre,(function(n){return e.updateCargo("nombre",n.target.value)}),n.area,(function(n){return e.updateCargo("area",n.target.value)}),this.state.existingAreas.map((function(e){return z(ie||(ie=u(['<option value="','">'])),e)})),n.zona,(function(n){return e.updateCargo("zona",n.target.value)}),this.state.existingZonas.map((function(e){return z(re||(re=u(['<option value="','">'])),e)})),n.numPersonas,(function(n){return e.updateCargo("numPersonas",parseInt(n.target.value)||1)}),n.descripcion,(function(n){return e.updateCargo("descripcion",n.target.value)}),[{name:"tareasRutinarias",label:"Tareas repetitivas",icon:"repeat",severity:"warning"},{name:"conduceVehiculo",label:"Conduce vehículo",icon:"car",severity:"warning"},{name:"manipulaAlimentos",label:"Manipula alimentos",icon:"utensils",severity:"danger"},{name:"trabajaAlturas",label:"Trabaja en alturas",icon:"arrow-up",severity:"danger"},{name:"trabajaEspaciosConfinados",label:"Espacios confinados",icon:"door-closed",severity:"danger"}].map((function(t){return z(oe||(oe=u(['\n                <div class="toggle-item toggle-item--','">\n                  <div class="toggle-item__info">\n                    <i data-lucide="','" class="toggle-item__icon"></i>\n                    <span class="toggle-item__label">','</span>\n                  </div>\n                  <label class="toggle-switch toggle-switch--','">\n                    <input\n                      type="checkbox"\n                      .checked=',"\n                      @change=",'\n                    />\n                    <span class="toggle-switch__slider"></span>\n                  </label>\n                </div>\n              '])),t.severity,t.icon,t.label,t.severity,n[t.name],(function(n){return e.updateCargo(t.name,n.target.checked)}))})))}},{key:"renderRiesgosStep",value:function(){var e=this,t=this.state.catalogoGES.reduce((function(e,n){var t=n.riesgo_nombre||n.categoria||n.riesgo||"Otros";return e[t]||(e[t]=[]),e[t].push(n),e}),{}),a=this.state.cargo.riesgosSeleccionados.map((function(e){return e.id_ges||e.idGes||e.id}));return this.state.expandedCategories||(this.state.expandedCategories={}),z(se||(se=u(['\n      <div class="mini-wizard__step-content mini-wizard__step-content--riesgos">\n        <div class="riesgos-header">\n          <p>Selecciona los riesgos asociados a este cargo</p>\n          <span class="riesgos-count">\n            ',' seleccionados\n          </span>\n        </div>\n\n        <div class="riesgos-grid">\n          ',"\n        </div>\n      </div>\n    "])),a.length,Object.entries(t).map((function(t){var i=n(t,2),r=i[0],o=i[1],s=e.state.expandedCategories[r],c=s?o:o.slice(0,10);return z(ce||(ce=u(['\n              <div class="riesgos-category">\n                <div class="riesgos-category__header">\n                  <span class="riesgos-category__name">','</span>\n                  <span class="riesgos-category__count">','</span>\n                </div>\n                <div class="riesgos-category__items">\n                  ',"\n                  ","\n                </div>\n              </div>\n            "])),r,o.length,c.map((function(n){var t=n.id_ges||n.idGes||n.id,i=a.includes(t);return z(le||(le=u(['\n                      <div\n                        class="riesgo-chip ','"\n                        @click=','\n                      >\n                        <span class="riesgo-chip__name">',"</span>\n                        ","\n                      </div>\n                    "])),i?"selected":"",(function(){return e.toggleRiesgo(n)}),n.nombre,i?z(de||(de=u(['<i data-lucide="check"></i>']))):"")})),o.length>10?z(ue||(ue=u(['\n                    <button\n                      class="riesgo-chip riesgo-chip--toggle"\n                      @click=',"\n                    >\n                      ","\n                    </button>\n                  "])),(function(){return e.toggleCategoryExpanded(r)}),s?z(pe||(pe=u(['<i data-lucide="chevron-up"></i> Mostrar menos']))):z(me||(me=u(['<i data-lucide="chevron-down"></i> +'," más"])),o.length-10)):"")})))}},{key:"renderNivelesStep",value:function(){var e=this,n=this.state.cargo.riesgosSeleccionados;return 0===n.length?z(ge||(ge=u(['\n        <div class="mini-wizard__empty">\n          <i data-lucide="alert-circle"></i>\n          <p>No hay riesgos seleccionados</p>\n          <span>Vuelve al paso anterior para seleccionar riesgos</span>\n        </div>\n      ']))):z(ve||(ve=u(['\n      <div class="mini-wizard__step-content">\n        ','\n\n        <div class="niveles-list">\n          ',"\n        </div>\n      </div>\n    "])),"edit"===this.options.mode?z(he||(he=u(['\n          <div class="approval-warning">\n            <i data-lucide="alert-triangle"></i>\n            <div>\n              <strong>Cambios en niveles requieren aprobación</strong>\n              <p>Las modificaciones en los niveles de riesgo serán marcadas para revisión antes de aplicarse.</p>\n            </div>\n          </div>\n        ']))):"",n.map((function(n,t){return e.renderNivelItem(n,t)})))}},{key:"renderNivelItem",value:function(e,n){var t=this,a=e.id_ges||e.idGes||e.id,i=this.state.cargo.niveles[a]||{ND:1,NE:1,NC:10},r=i.ND*i.NE,o=r*i.NC,s=this.getNRInfo(o);return z(fe||(fe=u(['\n      <div class="nivel-item">\n        <div class="nivel-item__header">\n          <span class="nivel-item__name">','</span>\n          <span class="nivel-item__badge nivel-item__badge--','">\n            NR: '," (",')\n          </span>\n        </div>\n\n        <div class="nivel-item__selectors">\n          \x3c!-- ND --\x3e\n          <div class="nivel-selector">\n            <label>ND (Deficiencia)</label>\n            <div class="nivel-buttons">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- NE --\x3e\n          <div class="nivel-selector">\n            <label>NE (Exposición)</label>\n            <div class="nivel-buttons">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- NC --\x3e\n          <div class="nivel-selector">\n            <label>NC (Consecuencia)</label>\n            <div class="nivel-buttons">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- Calculated values --\x3e\n          <div class="nivel-calculated">\n            <div class="nivel-calc-item">\n              <span class="nivel-calc-label">NP</span>\n              <span class="nivel-calc-value">','</span>\n            </div>\n            <div class="nivel-calc-item nivel-calc-item--nr" style="--nr-color: ','">\n              <span class="nivel-calc-label">NR</span>\n              <span class="nivel-calc-value">',"</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    "])),e.nombre,s.level,o,s.label,this.niveles.ND.map((function(e){return z(be||(be=u(['\n                <button\n                  type="button"\n                  class="nivel-btn ','"\n                  style="--nivel-color: ','"\n                  @click=',"\n                >\n                  ","\n                </button>\n              "])),i.ND===e.value?"active":"",e.color,(function(){return t.updateNivel(a,"ND",e.value)}),e.value)})),this.niveles.NE.map((function(e){return z(ye||(ye=u(['\n                <button\n                  type="button"\n                  class="nivel-btn ','"\n                  style="--nivel-color: ','"\n                  @click=',"\n                >\n                  ","\n                </button>\n              "])),i.NE===e.value?"active":"",e.color,(function(){return t.updateNivel(a,"NE",e.value)}),e.value)})),this.niveles.NC.map((function(e){return z(xe||(xe=u(['\n                <button\n                  type="button"\n                  class="nivel-btn ','"\n                  style="--nivel-color: ','"\n                  @click=',"\n                >\n                  ","\n                </button>\n              "])),i.NC===e.value?"active":"",e.color,(function(){return t.updateNivel(a,"NC",e.value)}),e.value)})),r,s.color,o)}},{key:"renderControlesStep",value:function(){var e=this,n=this.state.cargo.riesgosSeleccionados;return 0===n.length?z(_e||(_e=u(['\n        <div class="mini-wizard__empty">\n          <i data-lucide="alert-circle"></i>\n          <p>No hay riesgos seleccionados</p>\n        </div>\n      ']))):z(we||(we=u(['\n      <div class="mini-wizard__step-content">\n        ','\n\n        <div class="controles-list">\n          ',"\n        </div>\n      </div>\n    "])),"edit"===this.options.mode?z(Ee||(Ee=u(['\n          <div class="approval-warning">\n            <i data-lucide="alert-triangle"></i>\n            <div>\n              <strong>Cambios en controles requieren aprobación</strong>\n              <p>Las modificaciones en los controles serán marcadas para revisión antes de aplicarse.</p>\n            </div>\n          </div>\n        ']))):"",n.map((function(n,t){return e.renderControlItem(n,t)})))}},{key:"renderControlItem",value:function(e,n){var t=this,a=e.id_ges||e.idGes||e.id,i=this.state.cargo.controles[a]||{fuente:"",medio:"",individuo:""};return z(ke||(ke=u(['\n      <div class="control-item">\n        <div class="control-item__header">\n          <span class="control-item__name">','</span>\n        </div>\n\n        <div class="control-item__fields">\n          <div class="form-group">\n            <label class="form-label">Control en la Fuente</label>\n            <textarea\n              class="form-input form-textarea form-textarea--sm"\n              .value=',"\n              @input=",'\n              placeholder="Ej: Aislamiento acústico, guardas de protección..."\n              rows="2"\n            ></textarea>\n          </div>\n\n          <div class="form-group">\n            <label class="form-label">Control en el Medio</label>\n            <textarea\n              class="form-input form-textarea form-textarea--sm"\n              .value=',"\n              @input=",'\n              placeholder="Ej: Señalización, ventilación, iluminación..."\n              rows="2"\n            ></textarea>\n          </div>\n\n          <div class="form-group">\n            <label class="form-label">Control en el Individuo</label>\n            <textarea\n              class="form-input form-textarea form-textarea--sm"\n              .value=',"\n              @input=",'\n              placeholder="Ej: EPP, capacitación, pausas activas..."\n              rows="2"\n            ></textarea>\n          </div>\n        </div>\n      </div>\n    '])),e.nombre,i.fuente,(function(e){return t.updateControl(a,"fuente",e.target.value)}),i.medio,(function(e){return t.updateControl(a,"medio",e.target.value)}),i.individuo,(function(e){return t.updateControl(a,"individuo",e.target.value)}))}},{key:"renderResumenStep",value:function(){var e=this,n=this.state.cargo,t=this.checkPendingApprovals();return z(Ae||(Ae=u(['\n      <div class="mini-wizard__step-content">\n        ','\n\n        <div class="resumen-grid">\n          \x3c!-- Info básica --\x3e\n          <div class="resumen-section">\n            <h3 class="resumen-section__title">\n              <i data-lucide="user"></i>\n              Información del Cargo\n            </h3>\n            <div class="resumen-section__content">\n              <div class="resumen-item">\n                <span class="resumen-item__label">Nombre:</span>\n                <span class="resumen-item__value">','</span>\n              </div>\n              <div class="resumen-item">\n                <span class="resumen-item__label">Área:</span>\n                <span class="resumen-item__value">','</span>\n              </div>\n              <div class="resumen-item">\n                <span class="resumen-item__label">Zona:</span>\n                <span class="resumen-item__value">','</span>\n              </div>\n              <div class="resumen-item">\n                <span class="resumen-item__label">Trabajadores:</span>\n                <span class="resumen-item__value">','</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Características especiales --\x3e\n          <div class="resumen-section">\n            <h3 class="resumen-section__title">\n              <i data-lucide="shield"></i>\n              Características Especiales\n            </h3>\n            <div class="resumen-section__content">\n              <div class="resumen-toggles">\n                ',"\n                ","\n                ","\n                ","\n                ","\n                ",'\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Riesgos --\x3e\n          <div class="resumen-section resumen-section--full">\n            <h3 class="resumen-section__title">\n              <i data-lucide="alert-triangle"></i>\n              Riesgos Seleccionados (',')\n            </h3>\n            <div class="resumen-section__content">\n              <div class="resumen-riesgos">\n                ',"\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    "])),t?z(Ce||(Ce=u(['\n          <div class="approval-pending-banner">\n            <i data-lucide="clock"></i>\n            <div>\n              <strong>Cambios pendientes de aprobación</strong>\n              <p>Algunos cambios en niveles y/o controles requieren verificación con la empresa antes de aplicarse.</p>\n            </div>\n          </div>\n        ']))):"",n.nombre||"-",n.area||"-",n.zona||"-",n.numPersonas,n.trabajaAlturas?z(Se||(Se=u(['<span class="resumen-toggle resumen-toggle--danger">Alturas</span>']))):"",n.manipulaAlimentos?z(Ie||(Ie=u(['<span class="resumen-toggle resumen-toggle--danger">Alimentos</span>']))):"",n.conduceVehiculo?z(Me||(Me=u(['<span class="resumen-toggle resumen-toggle--warning">Vehículo</span>']))):"",n.trabajaEspaciosConfinados?z(Oe||(Oe=u(['<span class="resumen-toggle resumen-toggle--danger">Espacios Confinados</span>']))):"",n.tareasRutinarias?z(Ne||(Ne=u(['<span class="resumen-toggle resumen-toggle--warning">Tareas Rutinarias</span>']))):"",n.trabajaAlturas||n.manipulaAlimentos||n.conduceVehiculo||n.trabajaEspaciosConfinados||n.tareasRutinarias?"":z(Pe||(Pe=u(['<span class="resumen-toggle resumen-toggle--none">Ninguna</span>']))),n.riesgosSeleccionados.length,n.riesgosSeleccionados.map((function(t){var a=t.id_ges||t.idGes||t.id,i=n.niveles[a]||{ND:1,NE:1,NC:10},r=i.ND*i.NE*i.NC,o=e.getNRInfo(r);return z(Le||(Le=u(['\n                    <div class="resumen-riesgo">\n                      <span class="resumen-riesgo__name">','</span>\n                      <span class="resumen-riesgo__nr" style="background: ','">\n                        NR: ',"\n                      </span>\n                    </div>\n                  "])),t.nombre,o.color,r)})))}},{key:"updateCargo",value:function(e,n){this.state.cargo[e]=n,this.renderContent()}},{key:"toggleRiesgo",value:function(e){var n=e.id_ges||e.idGes||e.id,t=this.state.cargo.riesgosSeleccionados,a=t.findIndex((function(e){return(e.id_ges||e.idGes||e.id)===n}));a>=0?(t.splice(a,1),delete this.state.cargo.niveles[n],delete this.state.cargo.controles[n]):(t.push(e),this.state.cargo.niveles[n]={ND:1,NE:1,NC:10},this.state.cargo.controles[n]={fuente:"",medio:"",individuo:""}),this.renderContent()}},{key:"toggleCategoryExpanded",value:function(e){this.state.expandedCategories||(this.state.expandedCategories={}),this.state.expandedCategories[e]=!this.state.expandedCategories[e],this.renderContent()}},{key:"updateNivel",value:function(e,n,t){this.state.cargo.niveles[e]||(this.state.cargo.niveles[e]={ND:1,NE:1,NC:10}),this.state.cargo.niveles[e][n]=t,"edit"===this.options.mode&&this.checkNivelApprovalNeeded(e,n,t),this.renderContent()}},{key:"updateControl",value:function(e,n,t){this.state.cargo.controles[e]||(this.state.cargo.controles[e]={fuente:"",medio:"",individuo:""}),this.state.cargo.controles[e][n]=t,"edit"===this.options.mode&&this.checkControlApprovalNeeded(e,n,t)}},{key:"checkNivelApprovalNeeded",value:function(e,n,t){var a=this.state.originalNiveles[e];if(a&&a[n]!==t){var i="nivel_".concat(e,"_").concat(n);this.state.pendingApprovals.includes(i)||this.state.pendingApprovals.push(i)}}},{key:"checkControlApprovalNeeded",value:function(e,n,t){var a=this.state.originalControles[e];if(a&&a[n]!==t){var i="control_".concat(e,"_").concat(n);this.state.pendingApprovals.includes(i)||this.state.pendingApprovals.push(i)}}},{key:"checkPendingApprovals",value:function(){return this.state.pendingApprovals.length>0}},{key:"goToNextStep",value:function(){this.validateCurrentStep()&&this.state.currentStep<this.state.totalSteps-1&&(this.state.currentStep++,this.renderContent())}},{key:"goToPreviousStep",value:function(){this.state.currentStep>0&&(this.state.currentStep--,this.renderContent())}},{key:"validateCurrentStep",value:function(){var e=this.state.cargo;switch(this.state.currentStep){case 0:return!e.nombre||e.nombre.length<3?(alert("El nombre del cargo debe tener al menos 3 caracteres"),!1):e.area?!!e.zona||(alert("La zona es requerida"),!1):(alert("El área es requerida"),!1);case 1:return 0!==e.riesgosSeleccionados.length||(alert("Debes seleccionar al menos un riesgo"),!1);default:return!0}}},{key:"handleSave",value:(t=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkPendingApprovals()){e.next=6;break}return e.next=3,this.showApprovalModal();case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return this.state.loading=!0,this.renderContent(),e.prev=8,e.next=11,this.options.onSave(Re(Re({},this.state.cargo),{},{pendingApprovals:this.state.pendingApprovals,mode:this.options.mode,cargoId:this.options.cargoId}));case 11:this.hide(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(8),console.error("[CargoMiniWizard] Error saving:",e.t0),alert("Error al guardar: "+e.t0.message);case 18:return e.prev=18,this.state.loading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[8,14,18,21]])}))),function(){return t.apply(this,arguments)})},{key:"handleCancel",value:function(){this.options.onCancel(),this.hide()}},{key:"showApprovalModal",value:(e=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=document.createElement("div");n.className="approval-modal-overlay",n.innerHTML='\n        <div class="approval-modal">\n          <div class="approval-modal__icon">\n            <i data-lucide="alert-triangle"></i>\n          </div>\n          <h3 class="approval-modal__title">Cambios Requieren Aprobación</h3>\n          <p class="approval-modal__message">\n            Has modificado niveles de riesgo y/o controles existentes.\n            Estos cambios deben ser verificados con la empresa antes de aplicarse.\n          </p>\n          <p class="approval-modal__submessage">\n            Los cambios quedarán en estado "Pendiente de aprobación" hasta que sean revisados.\n          </p>\n          <div class="approval-modal__actions">\n            <button class="btn btn--ghost" id="approval-cancel">Cancelar</button>\n            <button class="btn btn--primary" id="approval-confirm">\n              <i data-lucide="clock"></i>\n              Enviar para Aprobación\n            </button>\n          </div>\n        </div>\n      ',document.body.appendChild(n),window.lucide&&window.lucide.createIcons(),n.querySelector("#approval-cancel").addEventListener("click",(function(){document.body.removeChild(n),e(!1)})),n.querySelector("#approval-confirm").addEventListener("click",(function(){document.body.removeChild(n),e(!0)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})},{key:"getNRInfo",value:function(e){return e<=20?{level:"i",label:"Nivel I",color:"#10b981"}:e<=120?{level:"ii",label:"Nivel II",color:"#84cc16"}:e<=500?{level:"iii",label:"Nivel III",color:"#f59e0b"}:e<=1e3?{level:"iv",label:"Nivel IV",color:"#f97316"}:{level:"v",label:"Nivel V",color:"#ef4444"}}}]);var e,t,a,o}();function je(e){return new Te(e)}var De=function(){return c((function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"matriz-dashboard-container";r(this,e),this.container=document.getElementById(n),this.data=null,this.filteredData=null,this.sortConfig={column:null,direction:"asc"},this.searchTerm="",this.filters={nivel:"",cargo:"",tipo:""},this.documento=null}),[{key:"init",value:(n=(0,i.A)(d().mark((function e(n){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("🔵 [MATRIZ] Initializing component with data:",n),this.container){e.next=4;break}return console.error("🔴 [MATRIZ] Container not found"),e.abrupt("return");case 4:this.data=this.processAPIData(n),this.filteredData=(0,p.A)(this.data),this.documento=n.documento||null,this.render(),this.attachEventListeners(),window.lucide&&window.lucide.createIcons();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"processAPIData",value:function(e){if(!e||!e.categorias)return[];var n=[];return Object.values(e.categorias).forEach((function(e){e.peligros.forEach((function(t){n.push({id:t.id,cargo:t.cargo,area:t.area,tipo:e.nombre,descripcion:t.descripcion,nd:t.niveles.nd,ne:t.niveles.ne,nc:t.niveles.nc,np:t.niveles.np,nr:t.niveles.nr,nrNivel:t.niveles.nrNivel,niveles:t.niveles,interpretacion:t.interpretacion,controles:t.controles,controlesExistentes:t.controlesExistentes,tieneControlesExistentes:t.tieneControlesExistentes,requiereAccionUrgente:t.requiereAccionUrgente,sugerenciasIA:t.sugerenciasIA})}))})),console.log("🟢 [MATRIZ] Processed risks:",n.length),n}},{key:"calculateMetrics",value:function(){var e={total:this.data.length,critical:this.data.filter((function(e){return"V"===e.nrNivel})).length,high:this.data.filter((function(e){return"IV"===e.nrNivel})).length,medium:this.data.filter((function(e){return"III"===e.nrNivel})).length,low:this.data.filter((function(e){return"II"===e.nrNivel||"I"===e.nrNivel})).length};return e}},{key:"getFilterOptions",value:function(){return{cargos:(0,p.A)(new Set(this.data.map((function(e){return e.cargo})))).sort(),tipos:(0,p.A)(new Set(this.data.map((function(e){return e.tipo})))).sort(),niveles:["I","II","III","IV","V"]}}},{key:"render",value:function(){var e=this,n=this.calculateMetrics(),t=this.getFilterOptions();this.container.innerHTML='\n            \x3c!-- Metrics Cards --\x3e\n            <div class="matriz-metrics-grid">\n                '.concat(this.renderMetricCard("Total de Peligros",n.total,"layout-grid",""),"\n                ").concat(this.renderMetricCard("Nivel V - Crítico",n.critical,"alert-octagon","critical"),"\n                ").concat(this.renderMetricCard("Nivel IV - Alto",n.high,"alert-triangle","high"),"\n                ").concat(this.renderMetricCard("Nivel III - Moderado",n.medium,"alert-circle","medium"),"\n                ").concat(this.renderMetricCard("Nivel I-II - Aceptable",n.low,"check-circle","low"),'\n            </div>\n\n            \x3c!-- Toolbar: Search & Filters --\x3e\n            <div class="matriz-toolbar">\n                <div class="matriz-search">\n                    <i data-lucide="search" class="matriz-search__icon"></i>\n                    <input\n                        type="text"\n                        class="matriz-search__input"\n                        placeholder="Buscar por descripción, cargo o área..."\n                        id="matriz-search-input"\n                        value="').concat(this.searchTerm,'"\n                    />\n                </div>\n\n                <div class="matriz-filters">\n                    <div class="filter-dropdown">\n                        <select id="filter-nivel">\n                            <option value="">Todos los niveles</option>\n                            ').concat(t.niveles.map((function(n){return'\n                                <option value="'.concat(n,'" ').concat(e.filters.nivel===n?"selected":"",">\n                                    Nivel ").concat(n,"\n                                </option>\n                            ")})).join(""),'\n                        </select>\n                    </div>\n\n                    <div class="filter-dropdown">\n                        <select id="filter-cargo">\n                            <option value="">Todos los cargos</option>\n                            ').concat(t.cargos.map((function(n){return'\n                                <option value="'.concat(n,'" ').concat(e.filters.cargo===n?"selected":"",">\n                                    ").concat(n,"\n                                </option>\n                            ")})).join(""),'\n                        </select>\n                    </div>\n\n                    <div class="filter-dropdown">\n                        <select id="filter-tipo">\n                            <option value="">Todos los tipos</option>\n                            ').concat(t.tipos.map((function(n){return'\n                                <option value="'.concat(n,'" ').concat(e.filters.tipo===n?"selected":"",">\n                                    ").concat(n,"\n                                </option>\n                            ")})).join(""),'\n                        </select>\n                    </div>\n                </div>\n\n                <div class="matriz-actions">\n                    <button class="btn btn--icon" id="btn-reset-filters" title="Limpiar filtros">\n                        <i data-lucide="rotate-ccw"></i>\n                    </button>\n                </div>\n            </div>\n\n            \x3c!-- Table Container --\x3e\n            <div class="matriz-table-container">\n                ').concat(this.renderTable(),'\n            </div>\n\n            \x3c!-- Results Count --\x3e\n            <div class="matriz-results-count">\n                Mostrando <strong>').concat(this.filteredData.length,"</strong> de <strong>").concat(this.data.length,"</strong> peligros\n            </div>\n        "),window.lucide&&window.lucide.createIcons()}},{key:"renderMetricCard",value:function(e,n,t,a){return'\n            <div class="metric-card '.concat(a?"metric-card--".concat(a):"",'">\n                <div class="metric-card__icon">\n                    <i data-lucide="').concat(t,'"></i>\n                </div>\n                <div class="metric-card__value">').concat(n,'</div>\n                <div class="metric-card__label">').concat(e,"</div>\n            </div>\n        ")}},{key:"renderTable",value:function(){var e=this;return 0===this.filteredData.length?this.renderEmptyState():'\n            <table class="matriz-table">\n                <thead>\n                    <tr>\n                        '.concat(this.renderTableHeader("cargo","Cargo"),"\n                        ").concat(this.renderTableHeader("area","Área"),"\n                        ").concat(this.renderTableHeader("tipo","Tipo de Riesgo"),"\n                        ").concat(this.renderTableHeader("descripcion","Descripción del Peligro"),"\n                        ").concat(this.renderTableHeader("nd","ND"),"\n                        ").concat(this.renderTableHeader("ne","NE"),"\n                        ").concat(this.renderTableHeader("nc","NC"),"\n                        ").concat(this.renderTableHeader("np","NP"),"\n                        ").concat(this.renderTableHeader("nr","NR"),"\n                        <th>Nivel</th>\n                        <th>Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ").concat(this.filteredData.map((function(n){return e.renderTableRow(n)})).join(""),"\n                </tbody>\n            </table>\n        ")}},{key:"renderTableHeader",value:function(e,n){var t=this.sortConfig.column===e?"sorted-".concat(this.sortConfig.direction):"";return'\n            <th class="sortable '.concat(t,'" data-column="').concat(e,'">\n                ').concat(n,"\n            </th>\n        ")}},{key:"renderTableRow",value:function(e){return'\n            <tr class="row-expandable" data-risk-id="'.concat(e.id,'">\n                <td class="cell-cargo">').concat(e.cargo,"</td>\n                <td>").concat(e.area||"N/A",'</td>\n                <td>\n                    <span class="risk-badge risk-badge--tipo">').concat(e.tipo,'</span>\n                </td>\n                <td class="cell-riesgo">').concat(e.descripcion,'</td>\n                <td class="cell-nr">').concat(e.nd,'</td>\n                <td class="cell-nr">').concat(e.ne,'</td>\n                <td class="cell-nr">').concat(e.nc,'</td>\n                <td class="cell-nr">').concat(e.np,'</td>\n                <td class="cell-nr"><strong>').concat(e.nr,"</strong></td>\n                <td>\n                    ").concat(this.renderNRBadge(e.nrNivel),'\n                </td>\n                <td>\n                    <button class="btn btn--icon btn--sm" data-action="expand" data-risk-id="').concat(e.id,'">\n                        <i data-lucide="chevron-down"></i>\n                    </button>\n                </td>\n            </tr>\n            <tr class="risk-details" id="details-').concat(e.id,'">\n                <td colspan="11">\n                    <div class="risk-details-content">\n                        ').concat(this.renderRiskDetails(e),"\n                    </div>\n                </td>\n            </tr>\n        ")}},{key:"renderNRBadge",value:function(e){var n=e.toLowerCase();return'<span class="risk-badge risk-badge--nr risk-badge--nr-'.concat(n,'">Nivel ').concat(e,"</span>")}},{key:"renderRiskDetails",value:function(e){var n,t,a,i,r,o,s,c,l,d,u,p,m,g,v,h,f=e.requiereAccionUrgente||"V"===e.nrNivel||"IV"===e.nrNivel||e.np&&e.np>=10,b=this.isControlEmpty(null===(n=e.controlesExistentes)||void 0===n?void 0:n.fuente),y=this.isControlEmpty(null===(t=e.controlesExistentes)||void 0===t?void 0:t.medio),x=this.isControlEmpty(null===(a=e.controlesExistentes)||void 0===a?void 0:a.individuo),_=this.getRiskLevelIcon(e.nrNivel),w=(e.nrNivel||"iii").toLowerCase();return'\n            <div class="risk-expanded-panel">\n                \x3c!-- FILA 1: Interpretación + Controles Existentes --\x3e\n                <div class="risk-panel-row risk-panel-row--primary">\n                    \x3c!-- Columna 1: Interpretación del Riesgo --\x3e\n                    <div class="risk-panel-card risk-panel-card--interpretation">\n                        <div class="risk-panel-card__header">\n                            <div class="risk-level-indicator risk-level-indicator--'.concat(w,'">\n                                ').concat(_,'\n                            </div>\n                            <div class="risk-panel-card__title">\n                                <span class="label">Interpretación del Riesgo</span>\n                                <span class="level-badge level-badge--').concat(w,'">\n                                    Nivel ').concat(e.nrNivel||"N/A",'\n                                </span>\n                            </div>\n                        </div>\n                        <div class="risk-panel-card__body">\n                            <p class="interpretation-meaning">\n                                <strong>').concat((null===(i=e.interpretacion)||void 0===i?void 0:i.significado)||"Sin interpretación",'</strong>\n                            </p>\n                            <p class="interpretation-action">\n                                ').concat((null===(r=e.interpretacion)||void 0===r?void 0:r.accion)||"",'\n                            </p>\n                        </div>\n                    </div>\n\n                    \x3c!-- Columna 2: Control en Fuente --\x3e\n                    <div class="risk-panel-card risk-panel-card--control ').concat(b&&f?"risk-panel-card--warning":"",'">\n                        ').concat(b&&f?'\n                            <div class="control-warning-float">\n                                <i data-lucide="alert-triangle"></i>\n                                <span>Sin control</span>\n                            </div>\n                        ':"",'\n                        <div class="risk-panel-card__header">\n                            <i data-lucide="target" class="control-icon"></i>\n                            <span class="risk-panel-card__title">Fuente</span>\n                        </div>\n                        <div class="risk-panel-card__body">\n                            ').concat(this.renderControlContent(null===(o=e.controlesExistentes)||void 0===o?void 0:o.fuente),'\n                        </div>\n                    </div>\n\n                    \x3c!-- Columna 3: Control en Medio --\x3e\n                    <div class="risk-panel-card risk-panel-card--control ').concat(y&&f?"risk-panel-card--warning":"",'">\n                        ').concat(y&&f?'\n                            <div class="control-warning-float">\n                                <i data-lucide="alert-triangle"></i>\n                                <span>Sin control</span>\n                            </div>\n                        ':"",'\n                        <div class="risk-panel-card__header">\n                            <i data-lucide="layers" class="control-icon"></i>\n                            <span class="risk-panel-card__title">Medio</span>\n                        </div>\n                        <div class="risk-panel-card__body">\n                            ').concat(this.renderControlContent(null===(s=e.controlesExistentes)||void 0===s?void 0:s.medio),'\n                        </div>\n                    </div>\n\n                    \x3c!-- Columna 4: Control en Individuo --\x3e\n                    <div class="risk-panel-card risk-panel-card--control ').concat(x&&f?"risk-panel-card--warning":"",'">\n                        ').concat(x&&f?'\n                            <div class="control-warning-float">\n                                <i data-lucide="alert-triangle"></i>\n                                <span>Sin control</span>\n                            </div>\n                        ':"",'\n                        <div class="risk-panel-card__header">\n                            <i data-lucide="user-check" class="control-icon"></i>\n                            <span class="risk-panel-card__title">Individuo</span>\n                        </div>\n                        <div class="risk-panel-card__body">\n                            ').concat(this.renderControlContent(null===(c=e.controlesExistentes)||void 0===c?void 0:c.individuo),"\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Botón de Sugerencias IA (si hay riesgo alto) --\x3e\n                ").concat(f&&e.sugerenciasIA?'\n                    <div class="risk-panel-suggestions-bar">\n                        <button class="btn-suggestions" data-risk-id="'.concat(e.id,'">\n                            <i data-lucide="lightbulb"></i>\n                            <span>Ver sugerencias para reducir este riesgo</span>\n                            <i data-lucide="chevron-right" class="arrow"></i>\n                        </button>\n                    </div>\n\n                    \x3c!-- Tooltip de sugerencias (position: fixed) --\x3e\n                    <div class="sugerencias-ia-tooltip" id="sugerencias-').concat(e.id,'">\n                        <div class="sugerencias-ia-tooltip__header">\n                            <i data-lucide="sparkles"></i>\n                            <span>Sugerencias para reducir el riesgo</span>\n                        </div>\n                        <div class="sugerencias-ia-tooltip__body">\n                            ').concat(null!==(l=e.sugerenciasIA.fuente)&&void 0!==l&&l.length?'\n                                <div class="sugerencia-grupo">\n                                    <span class="sugerencia-label">En la Fuente</span>\n                                    <ul>'.concat(e.sugerenciasIA.fuente.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"</ul>\n                                </div>\n                            "):"","\n                            ").concat(null!==(d=e.sugerenciasIA.medio)&&void 0!==d&&d.length?'\n                                <div class="sugerencia-grupo">\n                                    <span class="sugerencia-label">En el Medio</span>\n                                    <ul>'.concat(e.sugerenciasIA.medio.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"</ul>\n                                </div>\n                            "):"","\n                            ").concat(null!==(u=e.sugerenciasIA.individuo)&&void 0!==u&&u.length?'\n                                <div class="sugerencia-grupo">\n                                    <span class="sugerencia-label">En el Individuo</span>\n                                    <ul>'.concat(e.sugerenciasIA.individuo.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"</ul>\n                                </div>\n                            "):"","\n                        </div>\n                    </div>\n                "):"","\n\n                \x3c!-- FILA 2: Medidas de Intervención Sugeridas --\x3e\n                ").concat(this.hasControlesSugeridos(e)?'\n                    <div class="risk-panel-row risk-panel-row--controls">\n                        <div class="risk-panel-section-header">\n                            <i data-lucide="shield-check"></i>\n                            <span>Medidas de Intervención Sugeridas (ISO 45001)</span>\n                        </div>\n                        <div class="risk-panel-controls-grid">\n                            '.concat(this.renderControlSugerido(null===(p=e.controles)||void 0===p?void 0:p.eliminacion,"Eliminación",1,"eliminacion"),"\n                            ").concat(this.renderControlSugerido(null===(m=e.controles)||void 0===m?void 0:m.sustitucion,"Sustitución",2,"sustitucion"),"\n                            ").concat(this.renderControlSugerido(null===(g=e.controles)||void 0===g?void 0:g.epp,"EPP",3,"epp"),"\n                            ").concat(this.renderControlSugerido(null===(v=e.controles)||void 0===v?void 0:v.ingenieria,"Controles de Ingeniería",4,"ingenieria"),"\n                            ").concat(this.renderControlSugerido(null===(h=e.controles)||void 0===h?void 0:h.administrativos,"Controles Administrativos",5,"administrativos"),"\n                        </div>\n                    </div>\n                "):"","\n            </div>\n        ")}},{key:"isControlEmpty",value:function(e){if(!e)return!0;var n=(Array.isArray(e)?e:[e]).filter((function(e){return e&&"string"==typeof e&&e.trim()}));return 0===n.length}},{key:"getRiskLevelIcon",value:function(e){var n={V:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                    <line x1="12" y1="9" x2="12" y2="13"></line>\n                    <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                  </svg>',IV:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                    <line x1="12" y1="9" x2="12" y2="13"></line>\n                    <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                  </svg>',III:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                     <circle cx="12" cy="12" r="10"></circle>\n                     <line x1="12" y1="8" x2="12" y2="12"></line>\n                     <line x1="12" y1="16" x2="12.01" y2="16"></line>\n                   </svg>',II:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <circle cx="12" cy="12" r="10"></circle>\n                    <line x1="12" y1="16" x2="12" y2="12"></line>\n                    <line x1="12" y1="8" x2="12.01" y2="8"></line>\n                  </svg>',I:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                   <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>\n                   <polyline points="22 4 12 14.01 9 11.01"></polyline>\n                 </svg>'};return n[e]||n.III}},{key:"renderControlContent",value:function(e){if(!e)return'<p class="control-empty">No especificado</p>';var n=(Array.isArray(e)?e:[e]).filter((function(e){return e&&"string"==typeof e&&e.trim()}));return 0===n.length?'<p class="control-empty">No especificado</p>':'\n            <ul class="control-list">\n                '.concat(n.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"\n            </ul>\n        ")}},{key:"hasControlesSugeridos",value:function(e){var n,t,a,i,r;return e.controles&&((null===(n=e.controles.eliminacion)||void 0===n?void 0:n.length)>0||(null===(t=e.controles.sustitucion)||void 0===t?void 0:t.length)>0||(null===(a=e.controles.ingenieria)||void 0===a?void 0:a.length)>0||(null===(i=e.controles.administrativos)||void 0===i?void 0:i.length)>0||(null===(r=e.controles.epp)||void 0===r?void 0:r.length)>0)}},{key:"renderControlSugerido",value:function(e,n,t,a){if(!e||0===e.length)return"";var i=(Array.isArray(e)?e:[e]).filter((function(e){return e&&"string"==typeof e&&e.trim()}));return 0===i.length?"":'\n            <div class="control-sugerido control-sugerido--'.concat(a,'">\n                <div class="control-sugerido__header">\n                    <span class="control-sugerido__badge">').concat(t,'</span>\n                    <span class="control-sugerido__title">').concat(n,'</span>\n                </div>\n                <ul class="control-sugerido__list">\n                    ').concat(i.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"\n                </ul>\n            </div>\n        ")}},{key:"attachTooltipEventListeners",value:function(){var e=this;this.container.querySelectorAll(".btn-suggestions").forEach((function(n){var t=n.dataset.riskId,a=document.getElementById("sugerencias-".concat(t));a&&n.addEventListener("click",(function(t){t.stopPropagation(),e.container.querySelectorAll(".sugerencias-ia-tooltip.active").forEach((function(e){e!==a&&e.classList.remove("active")})),e.positionTooltip(n,a),a.classList.toggle("active")}))})),document.addEventListener("click",(function(n){n.target.closest(".btn-suggestions")||n.target.closest(".sugerencias-ia-tooltip")||e.container.querySelectorAll(".sugerencias-ia-tooltip.active").forEach((function(e){e.classList.remove("active")}))}));var n=this.container.querySelector(".matriz-table-container");n&&n.addEventListener("scroll",(function(){e.container.querySelectorAll(".sugerencias-ia-tooltip.active").forEach((function(n){var t=n.id.replace("sugerencias-",""),a=e.container.querySelector('.btn-suggestions[data-risk-id="'.concat(t,'"]'));a&&e.positionTooltip(a,n)}))}))}},{key:"positionTooltip",value:function(e,n){var t=e.getBoundingClientRect(),a=window.innerWidth,i=window.innerHeight,r=t.right+12;r+380>a-20&&(r=t.left-380-12),r<20&&(r=Math.max(20,(a-380)/2));var o=t.top;o+400>i-20&&(o=i-400-20),o<20&&(o=20),n.style.left="".concat(r,"px"),n.style.top="".concat(o,"px")}},{key:"renderEmptyState",value:function(){return'\n            <div class="matriz-empty-state">\n                <div class="matriz-empty-state__icon">\n                    <i data-lucide="search-x"></i>\n                </div>\n                <h3 class="matriz-empty-state__title">No se encontraron peligros</h3>\n                <p class="matriz-empty-state__description">\n                    '.concat(this.searchTerm||Object.values(this.filters).some((function(e){return e}))?"Intenta ajustar los filtros de búsqueda":"Aún no hay peligros identificados en la matriz","\n                </p>\n                ").concat(this.searchTerm||Object.values(this.filters).some((function(e){return e}))?'\n                    <button class="btn btn--outline" id="btn-clear-search">\n                        <i data-lucide="rotate-ccw"></i>\n                        Limpiar búsqueda\n                    </button>\n                ':"","\n            </div>\n        ")}},{key:"attachEventListeners",value:function(){var e=this,n=document.getElementById("matriz-search-input");n&&n.addEventListener("input",(function(n){e.searchTerm=n.target.value.toLowerCase(),e.applyFilters()})),["nivel","cargo","tipo"].forEach((function(n){var t=document.getElementById("filter-".concat(n));t&&t.addEventListener("change",(function(t){e.filters[n]=t.target.value,e.applyFilters()}))}));var t=document.getElementById("btn-reset-filters");t&&t.addEventListener("click",(function(){return e.resetFilters()})),this.container.querySelectorAll("th.sortable").forEach((function(n){n.addEventListener("click",(function(n){var t=n.currentTarget.dataset.column;e.sortTable(t)}))})),this.container.querySelectorAll('[data-action="expand"]').forEach((function(n){n.addEventListener("click",(function(n){n.stopPropagation();var t=n.currentTarget.dataset.riskId;e.toggleRowDetails(t,n.currentTarget)}))}));var a=document.getElementById("btn-clear-search");a&&a.addEventListener("click",(function(){return e.resetFilters()})),this.attachTooltipEventListeners()}},{key:"applyFilters",value:function(){var e=this;this.filteredData=this.data.filter((function(n){if(e.searchTerm&&!"".concat(n.descripcion," ").concat(n.cargo," ").concat(n.area).toLowerCase().includes(e.searchTerm))return!1;return(!e.filters.nivel||n.nrNivel===e.filters.nivel)&&((!e.filters.cargo||n.cargo===e.filters.cargo)&&(!e.filters.tipo||n.tipo===e.filters.tipo))}));var n=this.container.querySelector(".matriz-table-container");n&&(n.innerHTML=this.renderTable(),this.attachTableEventListeners());var t=this.container.querySelector(".matriz-results-count");t&&(t.innerHTML="Mostrando <strong>".concat(this.filteredData.length,"</strong> de <strong>").concat(this.data.length,"</strong> peligros")),window.lucide&&window.lucide.createIcons()}},{key:"resetFilters",value:function(){this.searchTerm="",this.filters={nivel:"",cargo:"",tipo:""},this.sortConfig={column:null,direction:"asc"},this.render(),this.attachEventListeners()}},{key:"exportExcel",value:(e=(0,i.A)(d().mark((function e(){var n,t,a,i,r,o,s,c;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.documento&&this.documento.excelUrl){e.next=4;break}return console.error("No Excel URL available"),alert("No hay archivo Excel disponible para descargar"),e.abrupt("return");case 4:if(n=document.getElementById("btn-export-matriz-excel")){e.next=7;break}return e.abrupt("return");case 7:return t=n.innerHTML,n.disabled=!0,n.innerHTML='<i data-lucide="loader-2" class="animate-spin"></i> <span>Descargando...</span>',window.lucide&&window.lucide.createIcons(),e.prev=11,e.next=14,fetch(this.documento.excelUrl);case 14:if((a=e.sent).ok){e.next=17;break}throw new Error("Error al descargar el archivo");case 17:return e.next=19,a.blob();case 19:i=e.sent,r=window.URL.createObjectURL(i),(o=document.createElement("a")).href=r,s=this.documento.excelUrl.split("/"),c=s[s.length-1]||"Matriz_GTC45.xlsx",o.download=c,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(r),o.remove(),e.next=36;break;case 32:e.prev=32,e.t0=e.catch(11),console.error("Error exporting matriz:",e.t0),alert("Error al descargar el archivo Excel. Intente de nuevo.");case 36:return e.prev=36,n.disabled=!1,n.innerHTML=t,window.lucide&&window.lucide.createIcons(),e.finish(36);case 41:case"end":return e.stop()}}),e,this,[[11,32,36,41]])}))),function(){return e.apply(this,arguments)})},{key:"sortTable",value:function(e){var n=this;this.sortConfig.column===e?this.sortConfig.direction="asc"===this.sortConfig.direction?"desc":"asc":(this.sortConfig.column=e,this.sortConfig.direction="asc"),this.filteredData.sort((function(t,a){var i=t[e],r=a[e];return["nd","ne","nc","np","nr"].includes(e)?(i=Number(i),r=Number(r)):(i=String(i||"").toLowerCase(),r=String(r||"").toLowerCase()),i<r?"asc"===n.sortConfig.direction?-1:1:i>r?"asc"===n.sortConfig.direction?1:-1:0}));var t=this.container.querySelector(".matriz-table-container");t&&(t.innerHTML=this.renderTable(),this.attachTableEventListeners()),window.lucide&&window.lucide.createIcons()}},{key:"toggleRowDetails",value:function(e,n){var t=this.container.querySelector(".matriz-table-container");if(t){var a=t.querySelector("#details-".concat(e));if(!a)return console.error("Details row not found for risk:",e),void console.log("Available detail rows:",t.querySelectorAll(".risk-details"));var i=a.classList.contains("expanded");if(i?a.classList.remove("expanded"):a.classList.add("expanded"),n){var r=i?"chevron-down":"chevron-up";n.innerHTML='<i data-lucide="'.concat(r,'"></i>'),window.lucide&&window.lucide.createIcons()}}else console.error("Table container not found")}},{key:"attachTableEventListeners",value:function(){var e=this;this.container.querySelectorAll("th.sortable").forEach((function(n){n.addEventListener("click",(function(n){var t=n.currentTarget.dataset.column;e.sortTable(t)}))})),this.container.querySelectorAll('[data-action="expand"]').forEach((function(n){n.addEventListener("click",(function(n){n.stopPropagation();var t=n.currentTarget.dataset.riskId;e.toggleRowDetails(t,n.currentTarget)}))}));var n=document.getElementById("btn-clear-search");n&&n.addEventListener("click",(function(){return e.resetFilters()})),this.attachTooltipEventListeners()}}]);var e,n}();const Be=De;var He=t(2284),Ue=t(7763);function qe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}var Fe=function(){return c((function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,e),this.container=document.getElementById(n),!this.container)throw new Error("Container #".concat(n," not found"));this.options=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?qe(Object(t),!0).forEach((function(n){(0,a.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qe(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({columns:t.columns||[],data:t.data||[],pageSize:t.pageSize||10,searchable:!1!==t.searchable,sortable:!1!==t.sortable,actions:t.actions||[],onRowClick:t.onRowClick||null,emptyMessage:t.emptyMessage||"No hay datos para mostrar",loadingMessage:t.loadingMessage||"Cargando..."},t),this.currentPage=1,this.searchQuery="",this.sortColumn=null,this.sortDirection="asc",this.isLoading=!1,this.init()}),[{key:"init",value:function(){this.render(),this.attachEventListeners()}},{key:"setLoading",value:function(e){this.isLoading=e,this.render()}},{key:"setData",value:function(e){this.options.data=e,this.currentPage=1,this.render()}},{key:"getProcessedData",value:function(){var e=this,n=(0,p.A)(this.options.data);if(this.searchQuery){var t=this.searchQuery.toLowerCase();n=n.filter((function(n){return e.options.columns.some((function(a){var i=e.getCellValue(n,a.field);return i&&i.toString().toLowerCase().includes(t)}))}))}if(this.sortColumn){var a=this.options.columns.find((function(n){return n.field===e.sortColumn}));n.sort((function(n,t){var i=e.getCellValue(n,e.sortColumn),r=e.getCellValue(t,e.sortColumn);return null==i?1:null==r?-1:a.comparator?a.comparator(i,r)*("asc"===e.sortDirection?1:-1):i<r?"asc"===e.sortDirection?-1:1:i>r?"asc"===e.sortDirection?1:-1:0}))}return n}},{key:"getPaginatedData",value:function(){var e=this.getProcessedData(),n=(this.currentPage-1)*this.options.pageSize,t=n+this.options.pageSize;return e.slice(n,t)}},{key:"getCellValue",value:function(e,n){return n.split(".").reduce((function(e,n){return null==e?void 0:e[n]}),e)}},{key:"render",value:function(){var e=this.getProcessedData(),n=this.getPaginatedData(),t=Math.ceil(e.length/this.options.pageSize);this.container.innerHTML='\n            <div class="datatable">\n                '.concat(this.renderToolbar(e.length),"\n                ").concat(this.isLoading?this.renderLoading():this.renderTable(n),"\n                ").concat(!this.isLoading&&e.length>0?this.renderPagination(t):"","\n            </div>\n        ")}},{key:"renderToolbar",value:function(e){return this.options.searchable||this.options.toolbar?'\n            <div class="datatable__toolbar">\n                '.concat(this.options.searchable?'\n                    <div class="datatable__search">\n                        <input\n                            type="text"\n                            class="datatable__search-input"\n                            placeholder="Buscar..."\n                            value="'.concat(this.searchQuery,'">\n                        <i data-lucide="search"></i>\n                    </div>\n                '):"",'\n                <div class="datatable__info">\n                    ').concat(e," registro(s)\n                </div>\n                ").concat(this.options.toolbar?this.options.toolbar():"","\n            </div>\n        "):""}},{key:"renderLoading",value:function(){return'\n            <div class="datatable__loading">\n                <div class="spinner"></div>\n                <p>'.concat(this.options.loadingMessage,"</p>\n            </div>\n        ")}},{key:"renderTable",value:function(e){var n=this;return 0===e.length?'\n                <div class="datatable__empty">\n                    <i data-lucide="inbox"></i>\n                    <p>'.concat(this.options.emptyMessage,"</p>\n                </div>\n            "):'\n            <div class="datatable__wrapper">\n                <table class="datatable__table">\n                    <thead>\n                        <tr>\n                            '.concat(this.options.columns.map((function(e){return n.renderHeaderCell(e)})).join(""),"\n                            ").concat(this.options.actions.length>0?'<th class="datatable__th datatable__th--actions">Acciones</th>':"","\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ").concat(e.map((function(e,t){return n.renderRow(e,t)})).join(""),"\n                    </tbody>\n                </table>\n            </div>\n        ")}},{key:"renderHeaderCell",value:function(e){var n=this.options.sortable&&!1!==e.sortable,t=this.sortColumn===e.field,a=t?"asc"===this.sortDirection?"chevron-up":"chevron-down":"chevrons-up-down";return'\n            <th class="datatable__th '.concat(n?"datatable__th--sortable":""," ").concat(t?"datatable__th--sorted":"",'"\n                data-field="').concat(e.field,'"\n                style="').concat(e.width?"width: ".concat(e.width):"",'">\n                <div class="datatable__th-content">\n                    <span>').concat(e.label,"</span>\n                    ").concat(n?'<i data-lucide="'.concat(a,'" class="datatable__sort-icon"></i>'):"","\n                </div>\n            </th>\n        ")}},{key:"renderRow",value:function(e,n){var t=this,a="function"==typeof this.options.onRowClick;return'\n            <tr class="datatable__tr '.concat(a?"datatable__tr--clickable":"",'"\n                data-index="').concat(n,'">\n                ').concat(this.options.columns.map((function(n){return t.renderCell(e,n)})).join(""),"\n                ").concat(this.options.actions.length>0?this.renderActionsCell(e,n):"","\n            </tr>\n        ")}},{key:"renderCell",value:function(e,n){var t=this.getCellValue(e,n.field),a=n.render?n.render(t,e):null!=t?t:"";return'\n            <td class="datatable__td" data-field="'.concat(n.field,'">\n                ').concat(a,"\n            </td>\n        ")}},{key:"renderActionsCell",value:function(e,n){return'\n            <td class="datatable__td datatable__td--actions">\n                <div class="datatable__actions">\n                    '.concat(this.options.actions.map((function(e){return'\n                        <button\n                            class="datatable__action-btn"\n                            data-action="'.concat(e.name,'"\n                            data-index="').concat(n,'"\n                            title="').concat(e.label,'">\n                            <i data-lucide="').concat(e.icon,'"></i>\n                        </button>\n                    ')})).join(""),"\n                </div>\n            </td>\n        ")}},{key:"renderPagination",value:function(e){var n=this;if(e<=1)return"";var t=Math.max(1,this.currentPage-Math.floor(2.5)),a=Math.min(e,t+5-1);a-t<4&&(t=Math.max(1,a-5+1));for(var i=[],r=t;r<=a;r++)i.push(r);return'\n            <div class="datatable__pagination">\n                <button\n                    class="datatable__page-btn"\n                    data-page="'.concat(this.currentPage-1,'"\n                    ').concat(1===this.currentPage?"disabled":"",'>\n                    <i data-lucide="chevron-left"></i>\n                </button>\n\n                ').concat(t>1?'\n                    <button class="datatable__page-btn" data-page="1">1</button>\n                    '.concat(t>2?'<span class="datatable__ellipsis">...</span>':"","\n                "):"","\n\n                ").concat(i.map((function(e){return'\n                    <button\n                        class="datatable__page-btn '.concat(e===n.currentPage?"datatable__page-btn--active":"",'"\n                        data-page="').concat(e,'">\n                        ').concat(e,"\n                    </button>\n                ")})).join(""),"\n\n                ").concat(a<e?"\n                    ".concat(a<e-1?'<span class="datatable__ellipsis">...</span>':"",'\n                    <button class="datatable__page-btn" data-page="').concat(e,'">').concat(e,"</button>\n                "):"",'\n\n                <button\n                    class="datatable__page-btn"\n                    data-page="').concat(this.currentPage+1,'"\n                    ').concat(this.currentPage===e?"disabled":"",'>\n                    <i data-lucide="chevron-right"></i>\n                </button>\n            </div>\n        ')}},{key:"attachEventListeners",value:function(){var e=this;this.container.addEventListener("input",(function(n){n.target.matches(".datatable__search-input")&&(e.searchQuery=n.target.value,e.currentPage=1,e.render(),e.refreshLucide())})),this.container.addEventListener("click",(function(n){var t=n.target.closest(".datatable__th--sortable");if(t){var a=t.dataset.field;return e.sortColumn===a?e.sortDirection="asc"===e.sortDirection?"desc":"asc":(e.sortColumn=a,e.sortDirection="asc"),e.render(),void e.refreshLucide()}var i=n.target.closest(".datatable__page-btn");if(i&&!i.disabled)return e.currentPage=parseInt(i.dataset.page),e.render(),void e.refreshLucide();var r=n.target.closest(".datatable__action-btn");if(r){var o=r.dataset.action,s=parseInt(r.dataset.index),c=e.getPaginatedData()[s],l=e.options.actions.find((function(e){return e.name===o}));l&&l.handler&&l.handler(c,s)}else{var d=n.target.closest(".datatable__tr--clickable");if(d&&!n.target.closest(".datatable__action-btn")){var u=parseInt(d.dataset.index),p=e.getPaginatedData()[u];e.options.onRowClick&&e.options.onRowClick(p,u)}}}))}},{key:"refreshLucide",value:function(){window.lucide&&window.lucide.createIcons()}},{key:"destroy",value:function(){this.container.innerHTML=""}}])}();const $e=Fe;function Ge(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}var Ve=function(){return c((function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.options=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ge(Object(t),!0).forEach((function(n){(0,a.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ge(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({id:n.id||"modal-".concat(Date.now()),title:n.title||"",content:n.content||"",size:n.size||"medium",closeOnBackdrop:!1!==n.closeOnBackdrop,closeOnEsc:!1!==n.closeOnEsc,showCloseButton:!1!==n.showCloseButton,buttons:n.buttons||[],onOpen:n.onOpen||null,onClose:n.onClose||null,onConfirmClose:n.onConfirmClose||null},n),this.isOpen=!1,this.isDirty=!1,this.element=null,this.previousFocus=null,this.create()}),[{key:"create",value:function(){var e=this;this.backdrop=document.createElement("div"),this.backdrop.className="modal-backdrop",this.backdrop.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(45,50,56,0.6);z-index:9998;display:none;",document.body.appendChild(this.backdrop),this.element=document.createElement("div"),this.element.id=this.options.id,this.element.className="modal modal--".concat(this.options.size),this.element.setAttribute("role","dialog"),this.element.setAttribute("aria-modal","true"),this.element.setAttribute("aria-labelledby","".concat(this.options.id,"-title")),this.element.style.display="none",this.element.innerHTML='\n            <div class="modal__header">\n                <h2 class="modal__title" id="'.concat(this.options.id,'-title">').concat(this.options.title,"</h2>\n                ").concat(this.options.showCloseButton?'\n                    <button class="modal__close" aria-label="Cerrar modal">\n                        <i data-lucide="x"></i>\n                    </button>\n                ':"",'\n            </div>\n            <div class="modal__body">\n                ').concat(this.options.content,"\n            </div>\n            ").concat(this.options.buttons.length>0?'\n                <div class="modal__footer">\n                    '.concat(this.options.buttons.map((function(n){return e.renderButton(n)})).join(""),"\n                </div>\n            "):"","\n        "),document.body.appendChild(this.element),this.attachEventListeners(),this.refreshLucide()}},{key:"renderButton",value:function(e){return'\n            <button\n                class="btn '.concat(e.className||"btn--outline",'"\n                data-action="').concat(e.action,'"\n                ').concat(e.disabled?"disabled":"",">\n                ").concat(e.icon?'<i data-lucide="'.concat(e.icon,'"></i>'):"","\n                ").concat(e.label,"\n            </button>\n        ")}},{key:"open",value:function(){var e=this;if(!this.isOpen){this.previousFocus=document.activeElement,this.backdrop.style.display="block",this.element.style.display="block",setTimeout((function(){e.element.classList.add("open")}),10);var n=this.element.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');n&&n.focus(),document.body.style.overflow="hidden",this.isOpen=!0,this.options.onOpen&&this.options.onOpen(this)}}},{key:"close",value:(e=(0,i.A)(d().mark((function e(){var n,t=this,a=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>0&&void 0!==a[0]&&a[0],this.isOpen){e.next=3;break}return e.abrupt("return");case 3:if(n||!this.isDirty||!this.options.onConfirmClose){e.next=9;break}return e.next=6,this.options.onConfirmClose(this);case 6:if(e.sent){e.next=9;break}return e.abrupt("return");case 9:this.element.classList.remove("open"),setTimeout((function(){t.element.style.display="none",t.backdrop.style.display="none",document.body.style.overflow="",t.previousFocus&&t.previousFocus.focus(),t.isOpen=!1,t.options.onClose&&t.options.onClose(t)}),300);case 11:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"setContent",value:function(e){var n=this.element.querySelector(".modal__body");n&&(n.innerHTML=e,this.refreshLucide())}},{key:"setTitle",value:function(e){var n=this.element.querySelector(".modal__title");n&&(n.textContent=e)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"attachEventListeners",value:function(){var e=this;if(this.options.showCloseButton){var n=this.element.querySelector(".modal__close");n&&n.addEventListener("click",(function(){return e.close()}))}if(this.options.closeOnBackdrop){var t=this.element.querySelector(".modal__backdrop");t&&t.addEventListener("click",(function(){return e.close()}))}this.options.closeOnEsc&&(this.escHandler=function(n){"Escape"===n.key&&e.isOpen&&e.close()},document.addEventListener("keydown",this.escHandler)),this.element.addEventListener("click",(function(n){var t=n.target.closest("[data-action]");if(t){var a=t.dataset.action,i=e.options.buttons.find((function(e){return e.action===a}));i&&i.handler&&i.handler(e)}})),this.element.addEventListener("keydown",(function(n){"Tab"===n.key&&e.trapFocus(n)}))}},{key:"trapFocus",value:function(e){var n=this.element.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),t=n[0],a=n[n.length-1];e.shiftKey?document.activeElement===t&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),t.focus())}},{key:"refreshLucide",value:function(){window.lucide&&window.lucide.createIcons()}},{key:"destroy",value:function(){this.isOpen&&this.close(!0),this.escHandler&&document.removeEventListener("keydown",this.escHandler),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null}}]);var e}();Ve.confirm=function(e){return new Promise((function(n){var t=new Ve({title:e.title||"Confirmar",content:e.message||"¿Está seguro?",size:"small",buttons:[{label:e.cancelLabel||"Cancelar",className:"btn--outline",action:"cancel",handler:function(e){e.close(),n(!1)}},{label:e.confirmLabel||"Confirmar",className:e.danger?"btn--danger":"btn--primary",action:"confirm",handler:function(e){e.close(),n(!0)}}],onClose:function(){t.destroy()}});t.open()}))},Ve.alert=function(e){return new Promise((function(n){var t=new Ve({title:e.title||"Aviso",content:e.message||"",size:"small",buttons:[{label:e.buttonLabel||"Aceptar",className:"btn--primary",action:"ok",handler:function(e){e.close(),n()}}],onClose:function(){t.destroy()}});t.open()}))};const Je=Ve;var We="/api",Xe={ADMIN_GENESYS:"admin_genesys",MEDICO_OCUPACIONAL:"medico_ocupacional",EMPRESA:"empresa"},Ze={user:null,rol:null,token:null,empresaSeleccionada:null,data:{empresas:[],medicos:[],pagos:[],auditoria:[]}};function Ke(){return Ye.apply(this,arguments)}function Ye(){return(Ye=(0,i.A)(d().mark((function e(){var n,t,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Inicializando dashboard multi-rol..."),n=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),t=localStorage.getItem("genesys_user")||sessionStorage.getItem("genesys_user"),n){e.next=7;break}return console.warn("[MultiRol] No hay token, redirigiendo a login..."),window.location.href="/pages/login.html",e.abrupt("return");case 7:if(t){e.next=10;break}return console.warn("[MultiRol] No hay usuario en localStorage, pero hay token. Continuando..."),e.abrupt("return");case 10:return e.prev=10,Ze.token=n,Ze.user=JSON.parse(t),Ze.rol=Ze.user.rol||"empresa",console.log("[MultiRol] Usuario:",Ze.user.full_name),console.log("[MultiRol] Rol:",Ze.rol),console.log("[MultiRol] 🔄 Ejecutando configureRoleBasedUI..."),e.next=19,Qe();case 19:console.log("[MultiRol] ✅ configureRoleBasedUI completado"),console.log("[MultiRol] 🔄 Ejecutando configureSidebarForRole...");try{an(),console.log("[MultiRol] ✅ configureSidebarForRole completado")}catch(e){console.error("[MultiRol] ❌ Error en configureSidebarForRole:",e)}return console.log("[MultiRol] 🔄 Ejecutando loadInitialDataForRole..."),e.next=25,rn();case 25:if(console.log("[MultiRol] ✅ loadInitialDataForRole completado"),un(),a=window.location.hash.replace("#","")||"home",!window.multiRolPageHandlers||!window.multiRolPageHandlers[a]){e.next=32;break}return console.log("[MultiRol] 🔄 Cargando datos de página actual:",a),e.next=32,window.multiRolPageHandlers[a]();case 32:window.addEventListener("firmaDigitalActualizada",(function(e){var n;console.log("[MultiRol] 📝 Firma digital actualizada:",e.detail),Ze.data.tieneFirma=e.detail.tieneFirma,Ze.data.firma=e.detail.firma;var t=null===(n=document.querySelector('.dashboard-page[style*="display: block"]'))||void 0===n?void 0:n.id;"page-home"===t&&Ze.rol===Xe.MEDICO_OCUPACIONAL&&(console.log("[MultiRol] Re-renderizando dashboard médico..."),fn()),"page-config"===t&&Ze.rol===Xe.MEDICO_OCUPACIONAL&&(console.log("[MultiRol] Re-renderizando config médico..."),Kn())})),window.addEventListener("empresaSeleccionada",(function(e){console.log("[MultiRol] 🏢 Empresa seleccionada:",e.detail);var n=e.detail,t=n.empresaId;n.empresa;if(Ze.rol===Xe.MEDICO_OCUPACIONAL&&t){var a=document.getElementById("select-empresa-profesiograma");a&&a.value!==t&&(a.value=t);var i=document.getElementById("page-profesiograma");i&&"none"!==i.style.display&&(console.log("[MultiRol] Cargando profesiograma automáticamente para empresa:",t),Gn(t))}})),e.next=40;break;case 36:e.prev=36,e.t0=e.catch(10),console.error("[MultiRol] Error inicializando:",e.t0),at("Error cargando dashboard","error");case 40:case"end":return e.stop()}}),e,null,[[10,36]])})))).apply(this,arguments)}function Qe(){return en.apply(this,arguments)}function en(){return(en=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ze.rol,nn(Ze.user,n),document.querySelectorAll("[data-role-visible]").forEach((function(e){var t=e.dataset.roleVisible.split(",");e.style.display=t.includes(n)?"":"none"})),document.body.classList.remove("rol-admin","rol-medico","rol-empresa"),document.body.classList.add("rol-".concat(n.replace("_","-")));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nn(e,n){var t=document.getElementById("user-name"),i=document.getElementById("user-role"),r=document.getElementById("company-info"),o=document.getElementById("company-name"),s=document.querySelector(".header-company-info__details");if(t&&(t.textContent=e.full_name||e.email),i){var c=(0,a.A)((0,a.A)((0,a.A)({},Xe.ADMIN_GENESYS,"Administrador Genesys"),Xe.MEDICO_OCUPACIONAL,"Médico Ocupacional"),Xe.EMPRESA,"Usuario Empresa");i.textContent=c[n]||n}r&&(n===Xe.ADMIN_GENESYS?r.innerHTML='\n                <div class="header-company-info__main">\n                    <span class="header-company-info__name">Genesys Laboral Medicine</span>\n                </div>\n            ':n===Xe.MEDICO_OCUPACIONAL?(r.innerHTML='\n                <div class="header-company-info__main" style="display:flex;align-items:center;gap:12px">\n                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity:0.7">\n                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>\n                        <polyline points="9 22 9 12 15 12 15 22"></polyline>\n                    </svg>\n                    <select id="header-empresa-selector" class="header-empresa-select" style="\n                        background: rgba(255,255,255,0.1);\n                        border: 1px solid rgba(255,255,255,0.2);\n                        border-radius: 8px;\n                        padding: 8px 32px 8px 12px;\n                        font-size: 14px;\n                        font-weight: 500;\n                        color: inherit;\n                        cursor: pointer;\n                        min-width: 200px;\n                        appearance: none;\n                        background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>\');\n                        background-repeat: no-repeat;\n                        background-position: right 8px center;\n                    ">\n                        <option value="">Seleccionar empresa...</option>\n                    </select>\n                </div>\n                <div class="header-company-info__details" id="empresa-details" style="display:none;margin-top:4px">\n                    <span class="header-company-info__item" id="empresa-nit-header">\n                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>\n                        <span id="empresa-nit-value">-</span>\n                    </span>\n                    <span class="header-company-info__item" id="empresa-ciudad-header">\n                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>\n                        <span id="empresa-ciudad-value">-</span>\n                    </span>\n                </div>\n            ',setTimeout((function(){return function(){var e=document.getElementById("header-empresa-selector");if(!e)return;var n=Ze.data.empresas||[];e.innerHTML='\n        <option value="">Seleccionar empresa...</option>\n        '.concat(n.map((function(e){return'\n            <option value="'.concat(e.empresa_id,'" data-nit="').concat(e.nit,'" data-ciudad="').concat(e.ciudad||"N/A",'">\n                ').concat(e.nombre_legal,"\n            </option>\n        ")})).join(""),"\n    "),Ze.empresaSeleccionada&&(e.value=Ze.empresaSeleccionada,tn(Ze.empresaSeleccionada));e.addEventListener("change",(function(e){var t=e.target.value;if(Ze.empresaSeleccionada=t,t)tn(t),window.dispatchEvent(new CustomEvent("empresaSeleccionada",{detail:{empresaId:t,empresa:n.find((function(e){return e.empresa_id==t}))}}));else{var a=document.getElementById("empresa-details");a&&(a.style.display="none")}}))}()}),100)):(o&&(o.textContent=e.company_name||"Mi Empresa"),s&&(s.style.display="flex")))}function tn(e){var n=(Ze.data.empresas||[]).find((function(n){return n.empresa_id==e})),t=document.getElementById("empresa-details"),a=document.getElementById("empresa-nit-value"),i=document.getElementById("empresa-ciudad-value");n&&t&&(t.style.display="flex",a&&(a.textContent=n.nit||"-"),i&&(i.textContent=n.ciudad||"Sin ciudad"))}function an(){var e=Ze.rol;console.log("[MultiRol] Configurando sidebar para rol:",e);var n=document.getElementById("sidebar");if(n){var t=(0,a.A)((0,a.A)((0,a.A)({},Xe.ADMIN_GENESYS,{visible:["home","admin-empresas","admin-medicos","admin-pagos","admin-auditoria","config"],hidden:["mapa-org","cargos","matriz","profesiograma","examenes","documentos","inteligencia","estadisticas","sve","psicosocial","panel-medico"]}),Xe.MEDICO_OCUPACIONAL,{visible:["home","profesiograma","examenes","documentos","config"],hidden:["mapa-org","cargos","matriz","inteligencia","estadisticas","sve","psicosocial","admin-empresas","admin-medicos","admin-pagos","admin-auditoria"]}),Xe.EMPRESA,{visible:["home","mapa-org","cargos","matriz","profesiograma","examenes","documentos","inteligencia","estadisticas","sve","psicosocial","panel-medico","config"],hidden:["admin-empresas","admin-medicos","admin-pagos","admin-auditoria"]}),i=t[e]||t[Xe.EMPRESA],r=n.querySelectorAll(".sidebar-nav__item[data-page]"),o=0,s=0;console.log("[MultiRol] Encontrados",r.length,"items de navegación"),r.forEach((function(e){var n=e.dataset.page,t=e.parentElement;n&&i.hidden.includes(n)?(t.style.display="none",s++,console.log("[MultiRol] Ocultando pestaña:",n)):(t.style.display="",o++,console.log("[MultiRol] Mostrando pestaña:",n))})),console.log("[MultiRol] Sidebar configurado: ".concat(o," pestañas visibles, ").concat(s," ocultas"))}else console.warn("[MultiRol] Sidebar no encontrado")}function rn(){return on.apply(this,arguments)}function on(){return(on=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ze.rol,Ze.token,e.prev=1,e.t0=n,e.next=e.t0===Xe.ADMIN_GENESYS?5:e.t0===Xe.MEDICO_OCUPACIONAL?8:11;break;case 5:return e.next=7,sn();case 7:return e.abrupt("break",12);case 8:return e.next=10,ln();case 10:case 11:return e.abrupt("break",12);case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(1),console.error("[MultiRol] Error cargando datos iniciales:",e.t1);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function sn(){return cn.apply(this,arguments)}function cn(){return(cn=(0,i.A)(d().mark((function e(){var t,a,i,r,o,s,c,l,u,p;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ze.token,e.prev=1,e.next=4,Promise.all([fetch("".concat(We,"/admin/empresas?limit=10"),{headers:{Authorization:"Bearer ".concat(t)}}),fetch("".concat(We,"/admin/medicos"),{headers:{Authorization:"Bearer ".concat(t)}}),fetch("".concat(We,"/admin/pagos?estado=pendiente&limit=10"),{headers:{Authorization:"Bearer ".concat(t)}})]);case 4:if(a=e.sent,i=n(a,3),r=i[0],o=i[1],s=i[2],!r.ok){e.next=14;break}return e.next=12,r.json();case 12:c=e.sent,Ze.data.empresas=c.empresas||[];case 14:if(!o.ok){e.next=19;break}return e.next=17,o.json();case 17:l=e.sent,Ze.data.medicos=l.medicos||[];case 19:if(!s.ok){e.next=25;break}return e.next=22,s.json();case 22:p=e.sent,Ze.data.pagos=p.pagos||[],Ze.data.pagosPendientes=(null===(u=p.pagination)||void 0===u?void 0:u.total)||0;case 25:return console.log("[MultiRol] Datos admin cargados"),e.next=28,pn();case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(1),console.error("[MultiRol] Error cargando datos admin:",e.t0);case 33:case"end":return e.stop()}}),e,null,[[1,30]])})))).apply(this,arguments)}function ln(){return dn.apply(this,arguments)}function dn(){return(dn=(0,i.A)(d().mark((function e(){var t,a,i,r,o,s,c;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ze.token,e.prev=1,e.next=4,Promise.all([fetch("".concat(We,"/medico/empresas"),{headers:{Authorization:"Bearer ".concat(t)}}),fetch("".concat(We,"/medico/firma"),{headers:{Authorization:"Bearer ".concat(t)}})]);case 4:if(a=e.sent,i=n(a,2),r=i[0],o=i[1],!r.ok){e.next=13;break}return e.next=11,r.json();case 11:s=e.sent,Ze.data.empresas=s.empresas||[];case 13:if(!o.ok){e.next=19;break}return e.next=16,o.json();case 16:c=e.sent,Ze.data.firma=c.firma,Ze.data.tieneFirma=c.tieneFirma;case 19:return console.log("[MultiRol] Datos médico cargados"),e.next=22,fn();case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(1),console.error("[MultiRol] Error cargando datos médico:",e.t0);case 27:case"end":return e.stop()}}),e,null,[[1,24]])})))).apply(this,arguments)}function un(){var e=Ze.rol;window.multiRolPageHandlers={"admin-home":xn,"admin-empresas":kn,"admin-medicos":Cn,"admin-pagos":In,"admin-auditoria":Nn,"admin-config":Tn,"medico-home":Dn,"medico-empresas":Un,"medico-profesiograma":Fn,"medico-examenes":Jn,"medico-firma":Xn,"medico-config":Kn},e===Xe.MEDICO_OCUPACIONAL?(window.multiRolPageHandlers.config=Kn,window.multiRolPageHandlers.profesiograma=Fn,console.log("[MultiRol] Handlers de config y profesiograma sobrescritos para médico")):e===Xe.ADMIN_GENESYS&&(window.multiRolPageHandlers.config=Tn,console.log("[MultiRol] Handler de config sobrescrito para admin"))}function pn(){return mn.apply(this,arguments)}function mn(){return mn=(0,i.A)(d().mark((function e(){var n,t,a,i,r,o,s,c,l,u,p,m,g;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Renderizando dashboard admin..."),n=document.querySelector("#page-home")){e.next=5;break}return console.warn("[MultiRol] No se encontró la página home"),e.abrupt("return");case 5:t=Ze.data,a=t.empresas,i=void 0===a?[]:a,r=t.medicos,o=void 0===r?[]:r,s=t.pagos,c=void 0===s?[]:s,l=t.pagosPendientes,u=void 0===l?0:l,p=i.length,m=o.length,g=i.filter((function(e){return"activo"===e.status})).length,n.innerHTML='\n        <div class="page-header">\n            <h1 class="page-header__title">Panel de Administración Genesys</h1>\n            <div class="page-header__meta">\n                <div class="live-indicator">\n                    <span class="live-indicator__dot"></span>\n                    <span>Sistema en línea</span>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Estadísticas principales --\x3e\n        <div class="dashboard-grid dashboard-grid--cols-4">\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="building-2"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">'.concat(p,'</div>\n                    <div class="metric-label">Empresas Registradas</div>\n                    <div class="metric-sublabel">\n                        <span style="color: #4caf50;">').concat(g,'</span> activas\n                    </div>\n                </div>\n            </div>\n\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="user-cog"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">').concat(m,'</div>\n                    <div class="metric-label">Médicos Ocupacionales</div>\n                    <div class="metric-sublabel">Registrados en el sistema</div>\n                </div>\n            </div>\n\n            <div class="card card--metric card--warning">\n                <div class="card__icon">\n                    <i data-lucide="credit-card"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value metric-value--warning">').concat(u,'</div>\n                    <div class="metric-label">Pagos Pendientes</div>\n                    <div class="metric-sublabel">Requieren revisión</div>\n                </div>\n            </div>\n\n            <div class="card card--metric card--success">\n                <div class="card__icon">\n                    <i data-lucide="activity"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value metric-value--success">100%</div>\n                    <div class="metric-label">Sistema Operativo</div>\n                    <div class="metric-sublabel">Todos los servicios OK</div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Sección de accesos rápidos --\x3e\n        <div class="dashboard-grid dashboard-grid--cols-2" style="margin-top: 2.4rem;">\n            <div class="card card--link" data-navigate="admin-empresas">\n                <div class="card__header">\n                    <h3 class="card__title">Gestión de Empresas</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Administra todas las empresas registradas en el sistema\n                    </p>\n                    ').concat(gn(i.slice(0,3)),'\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="admin-medicos">\n                <div class="card__header">\n                    <h3 class="card__title">Gestión de Médicos</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Administra médicos ocupacionales y sus asignaciones\n                    </p>\n                    ').concat(vn(o.slice(0,3)),'\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="admin-pagos">\n                <div class="card__header">\n                    <h3 class="card__title">Pagos Manuales</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Revisa y aprueba pagos pendientes de validación\n                    </p>\n                    ').concat(hn(c.slice(0,3)),'\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="admin-auditoria">\n                <div class="card__header">\n                    <h3 class="card__title">Auditoría del Sistema</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Consulta logs y actividad del sistema\n                    </p>\n                    <div style="padding: 1.6rem; background: #f8f9fa; border-radius: 8px; text-align: center;">\n                        <i data-lucide="shield-check" style="width: 32px; height: 32px; color: #5dc4af;"></i>\n                        <p style="margin-top: 0.8rem; font-size: 1.3rem; color: #666;">\n                            Sistema monitoreado 24/7\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '),window.lucide&&window.lucide.createIcons(),n.querySelectorAll("[data-navigate]").forEach((function(e){e.style.cursor="pointer",e.addEventListener("click",(function(e){var n=e.currentTarget.dataset.navigate;console.log("[MultiRol] Navegando a:",n);var t=document.querySelector('[data-page="'.concat(n,'"]'));t&&t.click()}))}));case 12:case"end":return e.stop()}}),e)}))),mn.apply(this,arguments)}function gn(e){return e&&0!==e.length?'\n        <ul style="list-style: none; padding: 0; margin: 0;">\n            '.concat(e.map((function(e){return'\n                <li style="padding: 1rem 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">\n                    <div>\n                        <div style="font-weight: 500; color: #2d3238; font-size: 1.4rem;">'.concat(e.nombre_legal||"Sin nombre",'</div>\n                        <div style="font-size: 1.2rem; color: #999;">').concat(e.ciudad||"Sin ciudad",'</div>\n                    </div>\n                    <span class="badge ').concat("activo"===e.status?"badge--success":"badge--secondary",'" style="font-size: 1.1rem;">\n                        ').concat(e.status||"inactivo","\n                    </span>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p style="color: #999; font-size: 1.3rem; text-align: center;">No hay empresas registradas</p>'}function vn(e){return e&&0!==e.length?'\n        <ul style="list-style: none; padding: 0; margin: 0;">\n            '.concat(e.map((function(e){return'\n                <li style="padding: 1rem 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">\n                    <div>\n                        <div style="font-weight: 500; color: #2d3238; font-size: 1.4rem;">'.concat(e.full_name||e.email,'</div>\n                        <div style="font-size: 1.2rem; color: #999;">Licencia: ').concat(e.licencia_sst||"N/A","</div>\n                    </div>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p style="color: #999; font-size: 1.3rem; text-align: center;">No hay médicos registrados</p>'}function hn(e){return e&&0!==e.length?'\n        <ul style="list-style: none; padding: 0; margin: 0;">\n            '.concat(e.map((function(e){return'\n                <li style="padding: 1rem 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">\n                    <div>\n                        <div style="font-weight: 500; color: #2d3238; font-size: 1.4rem;">'.concat(e.empresa_nombre||"Empresa",'</div>\n                        <div style="font-size: 1.2rem; color: #999;">$').concat((e.monto||0).toLocaleString("es-CO"),'</div>\n                    </div>\n                    <span class="badge badge--warning" style="font-size: 1.1rem;">Pendiente</span>\n                </li>\n            ')})).join(""),"\n        </ul>\n    "):'<p style="color: #999; font-size: 1.3rem; text-align: center;">No hay pagos pendientes</p>'}function fn(){return bn.apply(this,arguments)}function bn(){return bn=(0,i.A)(d().mark((function e(){var n,t,a,i,r,o,s,c,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Renderizando dashboard médico..."),n=document.querySelector("#page-home")){e.next=5;break}return console.warn("[MultiRol] No se encontró la página home"),e.abrupt("return");case 5:t=Ze.data,a=t.empresas,i=void 0===a?[]:a,t.firma,r=t.tieneFirma,o=void 0!==r&&r,s=Ze.user,c=i.length,l=i.filter((function(e){return"activo"===e.status||"activa"===e.status})).length,n.innerHTML='\n        <div class="page-header">\n            <h1 class="page-header__title">Panel Médico Ocupacional</h1>\n            <div class="page-header__meta">\n                <div class="live-indicator">\n                    <span class="live-indicator__dot"></span>\n                    <span>Dr(a). '.concat(s.full_name||s.email,"</span>\n                </div>\n                ").concat(s.licencia_sst?'<span style="margin-left: 1.6rem;">Licencia SST: '.concat(s.licencia_sst,"</span>"):"","\n            </div>\n        </div>\n\n        \x3c!-- Alerta de firma digital --\x3e\n        ").concat(o?"":'\n            <div class="card card--warning" style="margin-bottom: 2.4rem;">\n                <div class="card__body" style="display: flex; align-items: center; gap: 1.6rem;">\n                    <i data-lucide="alert-triangle" style="width: 32px; height: 32px; color: #ff9800;"></i>\n                    <div style="flex: 1;">\n                        <h3 style="margin: 0 0 0.4rem 0; font-size: 1.6rem; color: #2d3238;">Firma Digital Pendiente</h3>\n                        <p style="margin: 0; color: #666; font-size: 1.4rem;">\n                            Para poder firmar profesiogramas y documentos médicos, necesitas configurar tu firma digital.\n                        </p>\n                    </div>\n                    <button class="btn btn--primary" onclick="document.querySelector(\'[data-page=config]\').click()">\n                        <i data-lucide="pen-tool"></i>\n                        Configurar Firma\n                    </button>\n                </div>\n            </div>\n        ','\n\n        \x3c!-- Estadísticas principales --\x3e\n        <div class="dashboard-grid dashboard-grid--cols-4">\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="building-2"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">').concat(c,'</div>\n                    <div class="metric-label">Empresas Asignadas</div>\n                    <div class="metric-sublabel">\n                        <span style="color: #4caf50;">').concat(l,'</span> activas\n                    </div>\n                </div>\n            </div>\n\n            <div class="card card--metric ').concat(o?"card--success":"card--warning",'">\n                <div class="card__icon">\n                    <i data-lucide="').concat(o?"check-circle":"pen-tool",'"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value ').concat(o?"metric-value--success":"metric-value--warning",'">\n                        ').concat(o?"✓":"!",'\n                    </div>\n                    <div class="metric-label">Firma Digital</div>\n                    <div class="metric-sublabel">').concat(o?"Configurada":"Pendiente",'</div>\n                </div>\n            </div>\n\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="file-text"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">0</div>\n                    <div class="metric-label">Profesiogramas</div>\n                    <div class="metric-sublabel">Pendientes de firma</div>\n                </div>\n            </div>\n\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="clipboard-list"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">0</div>\n                    <div class="metric-label">Exámenes</div>\n                    <div class="metric-sublabel">Próximos a vencer</div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Accesos rápidos --\x3e\n        <div class="dashboard-grid dashboard-grid--cols-2" style="margin-top: 2.4rem;">\n            <div class="card card--link" data-navigate="profesiograma">\n                <div class="card__header">\n                    <h3 class="card__title">Profesiogramas</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Revisa y firma profesiogramas de las empresas asignadas\n                    </p>\n                    <div style="padding: 1.6rem; background: #f8f9fa; border-radius: 8px; text-align: center;">\n                        <i data-lucide="file-text" style="width: 32px; height: 32px; color: #5dc4af;"></i>\n                        <p style="margin-top: 0.8rem; font-size: 1.3rem; color: #666;">\n                            ').concat(c," empresa").concat(1!==c?"s":""," asignada").concat(1!==c?"s":"",'\n                        </p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="examenes">\n                <div class="card__header">\n                    <h3 class="card__title">Exámenes Médicos</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Gestiona exámenes ocupacionales de trabajadores\n                    </p>\n                    <div style="padding: 1.6rem; background: #f8f9fa; border-radius: 8px; text-align: center;">\n                        <i data-lucide="clipboard-list" style="width: 32px; height: 32px; color: #5dc4af;"></i>\n                        <p style="margin-top: 0.8rem; font-size: 1.3rem; color: #666;">\n                            Vigila vencimientos y recomendaciones\n                        </p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Empresas Asignadas</h3>\n                </div>\n                <div class="card__body">\n                    ').concat(yn(i.slice(0,5)),'\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="config">\n                <div class="card__header">\n                    <h3 class="card__title">Mi Perfil</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <div style="display: flex; flex-direction: column; gap: 1.2rem;">\n                        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: 6px;">\n                            <span style="color: #666; font-size: 1.3rem;">Nombre</span>\n                            <span style="font-weight: 500; font-size: 1.3rem;">').concat(s.full_name||"No configurado",'</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: 6px;">\n                            <span style="color: #666; font-size: 1.3rem;">Email</span>\n                            <span style="font-weight: 500; font-size: 1.3rem;">').concat(s.email,'</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: 6px;">\n                            <span style="color: #666; font-size: 1.3rem;">Licencia SST</span>\n                            <span style="font-weight: 500; font-size: 1.3rem;">').concat(s.licencia_sst||"No configurada",'</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: 6px;">\n                            <span style="color: #666; font-size: 1.3rem;">Firma Digital</span>\n                            <span class="badge ').concat(o?"badge--success":"badge--warning",'" style="font-size: 1.1rem;">\n                                ').concat(o?"Configurada":"Pendiente","\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    "),window.lucide&&window.lucide.createIcons(),n.querySelectorAll("[data-navigate]").forEach((function(e){e.style.cursor="pointer",e.addEventListener("click",(function(e){var n=e.currentTarget.dataset.navigate;console.log("[MultiRol] Navegando a:",n);var t=document.querySelector('[data-page="'.concat(n,'"]'));t&&t.click()}))}));case 12:case"end":return e.stop()}}),e)}))),bn.apply(this,arguments)}function yn(e){return e&&0!==e.length?'\n        <ul style="list-style: none; padding: 0; margin: 0;">\n            '.concat(e.map((function(e){return'\n                <li style="padding: 1rem 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">\n                    <div>\n                        <div style="font-weight: 500; color: #2d3238; font-size: 1.4rem;">'.concat(e.nombre_legal||"Sin nombre",'</div>\n                        <div style="font-size: 1.2rem; color: #999;">').concat(e.ciudad||"Sin ciudad"," · ").concat(e.nit||"Sin NIT",'</div>\n                    </div>\n                    <span class="badge ').concat("activo"===e.status||"activa"===e.status?"badge--success":"badge--secondary",'" style="font-size: 1.1rem;">\n                        ').concat(e.status||"inactivo","\n                    </span>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p style="color: #999; font-size: 1.3rem; text-align: center;">No tienes empresas asignadas</p>'}function xn(){return _n.apply(this,arguments)}function _n(){return(_n=(0,i.A)(d().mark((function e(){var n,t,a,i,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Home..."),n=document.querySelector('[data-page="admin-home"]')){e.next=4;break}return e.abrupt("return");case 4:t=Ze.data,a=t.empresas,i=t.medicos,r=t.pagos,n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Dashboard Administrador</h1>\n            <p class="dashboard-page__subtitle">Vista general del sistema Genesys</p>\n        </div>\n\n        <div class="stats-grid stats-grid--4">\n            <div class="card card--stat">\n                <div class="card__icon-small"><i data-lucide="building-2"></i></div>\n                <div class="stat-value stat-value--primary">'.concat(a.length,'</div>\n                <div class="stat-label">Empresas Activas</div>\n            </div>\n            <div class="card card--stat">\n                <div class="card__icon-small"><i data-lucide="stethoscope"></i></div>\n                <div class="stat-value stat-value--info">').concat(i.length,'</div>\n                <div class="stat-label">Médicos Registrados</div>\n            </div>\n            <div class="card card--stat card--warning">\n                <div class="card__icon-small"><i data-lucide="clock"></i></div>\n                <div class="stat-value stat-value--warning">').concat(r.length,'</div>\n                <div class="stat-label">Pagos Pendientes</div>\n            </div>\n            <div class="card card--stat card--success">\n                <div class="card__icon-small"><i data-lucide="check-circle"></i></div>\n                <div class="stat-value stat-value--success">98%</div>\n                <div class="stat-label">Uptime Sistema</div>\n            </div>\n        </div>\n\n        <div class="cards-grid cards-grid--2 mt-6">\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Pagos Pendientes</h3>\n                    <a href="#admin-pagos" class="btn btn--ghost btn--sm">Ver todos</a>\n                </div>\n                <div class="card__body" id="admin-pagos-preview">\n                    ').concat(wn(r),'\n                </div>\n            </div>\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Últimas Empresas</h3>\n                    <a href="#admin-empresas" class="btn btn--ghost btn--sm">Ver todas</a>\n                </div>\n                <div class="card__body" id="admin-empresas-preview">\n                    ').concat(En(a),"\n                </div>\n            </div>\n        </div>\n    "),window.lucide&&window.lucide.createIcons();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wn(e){return e.length?'\n        <ul class="list list--simple">\n            '.concat(e.slice(0,5).map((function(e){return'\n                <li class="list__item">\n                    <div class="list__content">\n                        <span class="list__title">'.concat(e.empresa_nombre||"Empresa",'</span>\n                        <span class="list__subtitle">$').concat(tt(e.monto),'</span>\n                    </div>\n                    <span class="badge badge--warning">').concat(e.estado,"</span>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p class="text-muted text-center">No hay pagos pendientes</p>'}function En(e){return e.length?'\n        <ul class="list list--simple">\n            '.concat(e.slice(0,5).map((function(e){return'\n                <li class="list__item">\n                    <div class="list__content">\n                        <span class="list__title">'.concat(e.nombre_legal,'</span>\n                        <span class="list__subtitle">').concat(e.ciudad||"Sin ciudad",'</span>\n                    </div>\n                    <span class="badge ').concat("activa"===e.status?"badge--success":"badge--warning",'">').concat(e.status,"</span>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p class="text-muted text-center">No hay empresas registradas</p>'}function kn(){return An.apply(this,arguments)}function An(){return(An=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Empresas..."),n=document.querySelector("#page-admin-empresas")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-admin-empresas"),e.abrupt("return");case 5:n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Gestión de Empresas</h1>\n            <p class="dashboard-page__subtitle">Administrar empresas clientes de Genesys</p>\n        </div>\n\n        <div id="empresas-table-container"></div>\n    ',new $e("empresas-table-container",{columns:[{field:"nombre_legal",label:"Empresa",render:function(e,n){return'\n                    <div class="table__cell-main">'.concat(e,'</div>\n                    <div class="table__cell-sub">').concat(n.email||"","</div>\n                ")}},{field:"nit",label:"NIT"},{field:"ciudad",label:"Ciudad",render:function(e){return e||"-"}},{field:"medicos_asignados",label:"Médicos",render:function(e){return e||0}},{field:"status",label:"Estado",render:function(e){return'<span class="badge '.concat((n=e,{activa:"badge--success",suspendida:"badge--danger",pendiente:"badge--warning"}[n]||"badge--info"),'">').concat(e,"</span>");var n}}],data:Ze.data.empresas,actions:[{name:"ver",label:"Ver detalle",icon:"eye",handler:function(e){it(e)}},{name:"editar",label:"Editar",icon:"edit-2",handler:function(e){console.log("[MultiRol] Editar empresa:",e);try{ot(e)}catch(e){console.error("[MultiRol] ERROR al abrir modal:",e)}}}],pageSize:10,searchable:!0,sortable:!0,emptyMessage:"No hay empresas registradas"}),window.lucide&&window.lucide.createIcons();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cn(){return Sn.apply(this,arguments)}function Sn(){return(Sn=(0,i.A)(d().mark((function e(){var n,t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Médicos..."),t=document.querySelector("#page-admin-medicos")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-admin-medicos"),e.abrupt("return");case 5:t.innerHTML='\n        <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem;">\n            <div>\n                <h1 class="dashboard-page__title">Gestión de Médicos</h1>\n                <p class="dashboard-page__subtitle">Médicos ocupacionales registrados en el sistema</p>\n            </div>\n            <button class="btn btn--primary" id="btn-nuevo-medico">\n                <i data-lucide="plus"></i>\n                Nuevo Médico\n            </button>\n        </div>\n\n        <div id="medicos-table-container"></div>\n    ',new $e("medicos-table-container",{columns:[{field:"full_name",label:"Médico",render:function(e,n){return'\n                    <div class="table__cell-main">'.concat(e,'</div>\n                    <div class="table__cell-sub">').concat(n.email,"</div>\n                ")}},{field:"licencia_sst",label:"Licencia SST",render:function(e){return e||"Sin licencia"}},{field:"empresas_asignadas",label:"Empresas",render:function(e){return e||0}},{field:"firma_url",label:"Firma",render:function(e){return e?'<span class="badge badge--success">Configurada</span>':'<span class="badge badge--warning">Pendiente</span>'}}],data:Ze.data.medicos,actions:[{name:"ver",label:"Ver detalle",icon:"eye",handler:function(e){console.log("[MultiRol] Ver médico:",e),rt(e)}},{name:"asignar",label:"Asignar empresas",icon:"link",handler:function(e){console.log("[MultiRol] Asignar empresas a médico:",e),st(e)}}],pageSize:10,searchable:!0,sortable:!0,emptyMessage:"No hay médicos registrados"}),window.lucide&&window.lucide.createIcons(),null===(n=document.getElementById("btn-nuevo-medico"))||void 0===n||n.addEventListener("click",(function(){console.log("[MultiRol] Nuevo médico")}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function In(){return Mn.apply(this,arguments)}function Mn(){return(Mn=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Pagos..."),n=document.querySelector("#page-admin-pagos")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-admin-pagos"),e.abrupt("return");case 5:n.innerHTML='\n        <div class="page-header">\n            <h1 class="dashboard-page__title">Gestión de Pagos</h1>\n            <p class="dashboard-page__subtitle">Pagos manuales pendientes de aprobación</p>\n        </div>\n\n        <div class="tabs mb-6">\n            <button class="tab active" data-tab="pendientes">Pendientes</button>\n            <button class="tab" data-tab="aprobados">Aprobados</button>\n            <button class="tab" data-tab="rechazados">Rechazados</button>\n        </div>\n\n        <div class="card">\n            <div class="card__body" id="pagos-content">\n                '.concat(On(Ze.data.pagos),"\n            </div>\n        </div>\n    "),window.lucide&&window.lucide.createIcons();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function On(e){return e.length?'\n        <table class="table">\n            <thead>\n                <tr>\n                    <th>Empresa</th>\n                    <th>Monto</th>\n                    <th>Referencia</th>\n                    <th>Fecha</th>\n                    <th>Comprobante</th>\n                    <th>Acciones</th>\n                </tr>\n            </thead>\n            <tbody>\n                '.concat(e.map((function(e){return"\n                    <tr>\n                        <td>".concat(e.empresa_nombre||"N/A",'</td>\n                        <td class="font-semibold">$').concat(tt(e.monto),"</td>\n                        <td>").concat(e.referencia_pago||"-","</td>\n                        <td>").concat((n=e.created_at,n?new Date(n).toLocaleDateString("es-CO"):"-"),"</td>\n                        <td>\n                            ").concat(e.comprobante_url?'<a href="'.concat(e.comprobante_url,'" target="_blank" class="btn btn--ghost btn--sm">\n                                    <i data-lucide="file-image"></i> Ver\n                                   </a>'):"-",'\n                        </td>\n                        <td>\n                            <div class="table__actions">\n                                <button class="btn btn--success btn--sm" data-action="aprobar" data-id="').concat(e.id,'">\n                                    <i data-lucide="check"></i> Aprobar\n                                </button>\n                                <button class="btn btn--danger btn--sm" data-action="rechazar" data-id="').concat(e.id,'">\n                                    <i data-lucide="x"></i> Rechazar\n                                </button>\n                            </div>\n                        </td>\n                    </tr>\n                ');var n})).join(""),"\n            </tbody>\n        </table>\n    "):'\n            <div class="empty-state">\n                <i data-lucide="check-circle" class="empty-state__icon"></i>\n                <h3 class="empty-state__title">Sin pagos pendientes</h3>\n                <p class="empty-state__description">No hay pagos manuales esperando aprobación</p>\n            </div>\n        '}function Nn(){return Pn.apply(this,arguments)}function Pn(){return(Pn=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Auditoría..."),n=document.querySelector("#page-admin-auditoria")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-admin-auditoria"),e.abrupt("return");case 5:return n.innerHTML='\n        <div class="page-header">\n            <h1 class="dashboard-page__title">Log de Auditoría</h1>\n            <p class="dashboard-page__subtitle">Registro de todas las acciones del sistema</p>\n        </div>\n\n        <div class="filters-bar">\n            <div class="header-search--inline">\n                <i data-lucide="search" class="header-search__icon"></i>\n                <input type="text" placeholder="Buscar en auditoría..." id="search-auditoria">\n            </div>\n            <select class="select" id="filter-accion">\n                <option value="">Todas las acciones</option>\n                <option value="crear_medico">Crear médico</option>\n                <option value="aprobar_pago">Aprobar pago</option>\n                <option value="subir_firma">Subir firma</option>\n            </select>\n            <button class="btn btn--outline" id="btn-exportar-auditoria">\n                <i data-lucide="download"></i>\n                Exportar\n            </button>\n        </div>\n\n        <div class="card">\n            <div class="card__body" id="auditoria-content">\n                <p class="text-center text-muted">Cargando registros de auditoría...</p>\n            </div>\n        </div>\n    ',window.lucide&&window.lucide.createIcons(),e.next=9,Ln();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ln(){return zn.apply(this,arguments)}function zn(){return(zn=(0,i.A)(d().mark((function e(){var n,t,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(We,"/admin/auditoria?limit=50"),{headers:{Authorization:"Bearer ".concat(Ze.token)}});case 3:if(!(n=e.sent).ok){e.next=10;break}return e.next=7,n.json();case 7:t=e.sent,(a=document.getElementById("auditoria-content"))&&(a.innerHTML=Rn(t.registros||[]),window.lucide&&window.lucide.createIcons());case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("[MultiRol] Error cargando auditoría:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function Rn(e){return e.length?'\n        <table class="table table--compact">\n            <thead>\n                <tr>\n                    <th>Fecha</th>\n                    <th>Usuario</th>\n                    <th>Acción</th>\n                    <th>Recurso</th>\n                    <th>IP</th>\n                </tr>\n            </thead>\n            <tbody>\n                '.concat(e.map((function(e){return"\n                    <tr>\n                        <td>".concat((n=e.created_at,n?new Date(n).toLocaleString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"),"</td>\n                        <td>").concat(e.user_name||"Sistema",'</td>\n                        <td><span class="badge badge--info">').concat(e.accion,"</span></td>\n                        <td>").concat(e.recurso," #").concat(e.recurso_id||"-",'</td>\n                        <td class="text-muted">').concat(e.ip_address||"-","</td>\n                    </tr>\n                ");var n})).join(""),"\n            </tbody>\n        </table>\n    "):'<p class="text-center text-muted">No hay registros de auditoría</p>'}function Tn(){return jn.apply(this,arguments)}function jn(){return(jn=(0,i.A)(d().mark((function e(){var n,t,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Config..."),a=document.querySelector("#page-config")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-config"),e.abrupt("return");case 5:a.innerHTML='\n        <div class="page-header">\n            <h1 class="dashboard-page__title">Configuración</h1>\n            <p class="dashboard-page__subtitle">Configuración del sistema Genesys</p>\n        </div>\n\n        <div class="cards-grid cards-grid--2">\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Mi Perfil</h3>\n                </div>\n                <div class="card__body">\n                    <p>Nombre: '.concat(null===(n=Ze.user)||void 0===n?void 0:n.full_name,"</p>\n                    <p>Email: ").concat(null===(t=Ze.user)||void 0===t?void 0:t.email,'</p>\n                    <button class="btn btn--outline mt-4">Cambiar contraseña</button>\n                </div>\n            </div>\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Preferencias del Sistema</h3>\n                </div>\n                <div class="card__body">\n                    <p class="text-muted">Próximamente: Configuraciones adicionales del sistema</p>\n                </div>\n            </div>\n        </div>\n    ');case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dn(){return Bn.apply(this,arguments)}function Bn(){return Bn=(0,i.A)(d().mark((function e(){var n,t,a,i,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Home..."),t=document.querySelector('[data-page="medico-home"]')){e.next=4;break}return e.abrupt("return");case 4:a=Ze.data,i=a.empresas,r=a.tieneFirma,t.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Bienvenido, Dr. '.concat((null===(n=Ze.user)||void 0===n||null===(n=n.full_name)||void 0===n?void 0:n.split(" ")[0])||"",'</h1>\n            <p class="dashboard-page__subtitle">Panel de médico ocupacional</p>\n        </div>\n\n        ').concat(r?"":'\n            <div class="alert-banner alert-banner--warning mb-6">\n                <i data-lucide="alert-triangle"></i>\n                <span>No tienes firma digital configurada. <a href="#medico-firma">Configurar ahora</a></span>\n            </div>\n        ','\n\n        <div class="stats-grid stats-grid--3">\n            <div class="card card--stat">\n                <div class="card__icon-small"><i data-lucide="building-2"></i></div>\n                <div class="stat-value stat-value--primary">').concat(i.length,'</div>\n                <div class="stat-label">Empresas Asignadas</div>\n            </div>\n            <div class="card card--stat">\n                <div class="card__icon-small"><i data-lucide="users"></i></div>\n                <div class="stat-value stat-value--info">').concat(i.reduce((function(e,n){return e+(n.total_cargos||0)}),0),'</div>\n                <div class="stat-label">Cargos Totales</div>\n            </div>\n            <div class="card card--stat ').concat(r?"card--success":"card--warning",'">\n                <div class="card__icon-small"><i data-lucide="pen-tool"></i></div>\n                <div class="stat-value">').concat(r?"OK":"Pendiente",'</div>\n                <div class="stat-label">Firma Digital</div>\n            </div>\n        </div>\n\n        <div class="card mt-6">\n            <div class="card__header">\n                <h3 class="card__title">Mis Empresas</h3>\n                <a href="#medico-empresas" class="btn btn--ghost btn--sm">Ver todas</a>\n            </div>\n            <div class="card__body">\n                ').concat(Hn(i),"\n            </div>\n        </div>\n    "),window.lucide&&window.lucide.createIcons();case 7:case"end":return e.stop()}}),e)}))),Bn.apply(this,arguments)}function Hn(e){return e.length?'\n        <div class="cards-grid cards-grid--3">\n            '.concat(e.slice(0,6).map((function(e){return'\n                <div class="card card--clickable" data-empresa-id="'.concat(e.empresa_id,'">\n                    <div class="card__body">\n                        <h4 class="card__title">').concat(e.nombre_legal,'</h4>\n                        <p class="text-muted">').concat(e.ciudad||"Sin ciudad",'</p>\n                        <div class="mt-2">\n                            <span class="badge badge--info">').concat(e.total_cargos||0," cargos</span>\n                            ").concat(e.es_medico_principal?'<span class="badge badge--success">Principal</span>':"","\n                        </div>\n                    </div>\n                </div>\n            ")})).join(""),"\n        </div>\n    "):'\n            <div class="empty-state">\n                <i data-lucide="building-2"></i>\n                <p>No tienes empresas asignadas aún</p>\n            </div>\n        '}function Un(){return qn.apply(this,arguments)}function qn(){return qn=(0,i.A)(d().mark((function e(){var n,t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Empresas..."),n=document.querySelector('[data-page="medico-empresas"]')){e.next=4;break}return e.abrupt("return");case 4:t=Ze.data.empresas,n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Mis Empresas</h1>\n            <p class="dashboard-page__subtitle">Empresas asignadas a tu perfil</p>\n        </div>\n\n        <div class="cards-grid cards-grid--2">\n            '.concat(t.map((function(e){return'\n                <div class="card">\n                    <div class="card__header">\n                        <h3 class="card__title">'.concat(e.nombre_legal,"</h3>\n                        ").concat(e.es_medico_principal?'<span class="badge badge--success">Médico Principal</span>':"",'\n                    </div>\n                    <div class="card__body">\n                        <p><strong>NIT:</strong> ').concat(e.nit,"</p>\n                        <p><strong>Ciudad:</strong> ").concat(e.ciudad||"No especificada","</p>\n                        <p><strong>Sector:</strong> ").concat(e.sector_economico||"No especificado","</p>\n                        <p><strong>Cargos:</strong> ").concat(e.total_cargos||0,'</p>\n                        <div class="mt-4">\n                            <button class="btn btn--primary btn--sm" data-action="ver-cargos" data-id="').concat(e.empresa_id,'">\n                                <i data-lucide="users"></i> Ver Cargos\n                            </button>\n                            <button class="btn btn--outline btn--sm" data-action="ver-profesiograma" data-id="').concat(e.empresa_id,'">\n                                <i data-lucide="file-text"></i> Profesiograma\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            ')})).join(""),"\n        </div>\n    "),window.lucide&&window.lucide.createIcons(),n.addEventListener("click",(function(e){var n=e.target.closest("[data-action]");if(n){var t=n.dataset.action,a=n.dataset.id;if("ver-cargos"===t){console.log("[MultiRol] Ver cargos de empresa:",a);var i=document.getElementById("select-empresa-profesiograma");i&&(i.value=a),window.navigateToPage&&window.navigateToPage("profesiograma"),setTimeout((function(){return Gn(a)}),100)}else"ver-profesiograma"===t&&(console.log("[MultiRol] Ver profesiograma de empresa:",a),window.navigateToPage&&window.navigateToPage("profesiograma"),setTimeout((function(){return Gn(a)}),100))}}));case 8:case"end":return e.stop()}}),e)}))),qn.apply(this,arguments)}function Fn(){return $n.apply(this,arguments)}function $n(){return $n=(0,i.A)(d().mark((function e(){var n,t,a,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Profesiograma..."),n=document.querySelector("#page-profesiograma")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-profesiograma"),e.abrupt("return");case 5:t=Ze.empresaSeleccionada,a=Ze.data.empresas||[],n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Editor de Profesiograma</h1>\n            <p class="dashboard-page__subtitle">Editar y generar profesiogramas para tus empresas</p>\n        </div>\n\n        '.concat(t?"":'\n            <div class="card card--info" style="margin-bottom: 2rem;">\n                <div class="card__body" style="display: flex; align-items: center; gap: 1.6rem;">\n                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#5dc4af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <circle cx="12" cy="12" r="10"></circle>\n                        <path d="M12 16v-4"></path>\n                        <path d="M12 8h.01"></path>\n                    </svg>\n                    <div style="flex: 1;">\n                        <h3 style="margin: 0 0 0.4rem 0; font-size: 1.6rem; color: #2d3238;">Selecciona una empresa</h3>\n                        <p style="margin: 0; color: #666; font-size: 1.4rem;">\n                            Usa el selector en el encabezado para elegir la empresa cuyo profesiograma deseas revisar o editar.\n                        </p>\n                    </div>\n                </div>\n            </div>\n        ','\n\n        <div class="card" style="').concat(t?"display:none":"",'">\n            <div class="card__header">\n                <h3 class="card__title">Seleccionar Empresa</h3>\n            </div>\n            <div class="card__body">\n                <select class="select w-full" id="select-empresa-profesiograma">\n                    <option value="">Seleccione una empresa...</option>\n                    ').concat(a.map((function(e){return'\n                        <option value="'.concat(e.empresa_id,'" ').concat(e.empresa_id==t?"selected":"",">").concat(e.nombre_legal,"</option>\n                    ")})).join(""),'\n                </select>\n            </div>\n        </div>\n\n        <div id="profesiograma-editor" class="mt-6" style="display: none;">\n            \x3c!-- El editor de profesiograma se cargará aquí --\x3e\n        </div>\n    '),(i=document.getElementById("select-empresa-profesiograma"))&&i.addEventListener("change",(function(e){var n=e.target.value;if(n){var t=document.getElementById("header-empresa-selector");t&&(t.value=n,t.dispatchEvent(new Event("change"))),Gn(n)}})),t&&(console.log("[MultiRol] Cargando profesiograma para empresa seleccionada:",t),Gn(t)),window.lucide&&window.lucide.createIcons();case 12:case"end":return e.stop()}}),e)}))),$n.apply(this,arguments)}function Gn(e){return Vn.apply(this,arguments)}function Vn(){return Vn=(0,i.A)(d().mark((function e(n){var t,a,r,o,s,c,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("profesiograma-editor")){e.next=3;break}return e.abrupt("return");case 3:return t.style.display="block",t.innerHTML='\n        <div class="card">\n            <div class="card__body" style="display:flex;align-items:center;justify-content:center;padding:40px">\n                <div class="spinner" style="width:32px;height:32px;border:3px solid #e5e7eb;border-top-color:#5dc4af;border-radius:50%;animation:spin 1s linear infinite"></div>\n                <span style="margin-left:12px;color:#6b7280">Cargando datos del profesiograma...</span>\n            </div>\n        </div>\n    ',console.log("[MultiRol] Cargando profesiograma para empresa:",n),e.prev=6,e.next=9,fetch("".concat(We,"/medico/empresas/").concat(n,"/cargos"),{headers:{Authorization:"Bearer ".concat(Ze.token)}});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error al cargar los cargos");case 12:return e.next=14,a.json();case 14:r=e.sent,o=r.cargos,s=Ze.data.empresas.find((function(e){return e.empresa_id==n})),t.innerHTML='\n            <div class="card" style="margin-bottom:20px">\n                <div class="card__header" style="display:flex;justify-content:space-between;align-items:center">\n                    <div>\n                        <h3 class="card__title">'.concat((null==s?void 0:s.nombre_legal)||"Empresa",'</h3>\n                        <p style="color:#6b7280;font-size:14px;margin-top:4px">').concat(o.length,' cargo(s) registrado(s)</p>\n                    </div>\n                    <div style="display:flex;gap:8px">\n                        <a href="/pages/profesiograma-view.html?empresa_id=').concat(n,'" target="_blank" class="btn btn--outline btn--sm">\n                            <i data-lucide="external-link"></i>\n                            Ver Completo\n                        </a>\n                        <button class="btn btn--primary btn--sm" id="btn-exportar-pdf" data-empresa="').concat(n,'">\n                            <i data-lucide="download"></i>\n                            Exportar PDF\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            ').concat(o.length>0?'\n                <div class="cards-grid cards-grid--2">\n                    '.concat(o.map((function(e){return'\n                        <div class="card cargo-card" data-cargo-id="'.concat(e.id,'">\n                            <div class="card__header" style="padding-bottom:8px;border-bottom:1px solid #e5e7eb">\n                                <h4 class="card__title" style="font-size:16px;margin:0">').concat(e.nombre_cargo,'</h4>\n                                <span class="badge badge--outline" style="font-size:11px">').concat(e.area||"Sin área",'</span>\n                            </div>\n                            <div class="card__body" style="padding-top:12px">\n                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;color:#4b5563">\n                                    <div><strong>Zona:</strong> ').concat(e.zona||"N/A","</div>\n                                    <div><strong>Trabajadores:</strong> ").concat(e.num_trabajadores||0,"</div>\n                                    <div><strong>Riesgos:</strong> ").concat(e.total_riesgos||0,"</div>\n                                    <div>\n                                        ").concat(e.trabaja_alturas?'<span class="badge badge--warning" style="font-size:10px">Alturas</span>':"","\n                                        ").concat(e.manipula_alimentos?'<span class="badge badge--info" style="font-size:10px">Alimentos</span>':"","\n                                        ").concat(e.trabaja_espacios_confinados?'<span class="badge badge--danger" style="font-size:10px">Esp. Conf.</span>':"",'\n                                    </div>\n                                </div>\n                                <div style="margin-top:12px;padding-top:12px;border-top:1px solid #f3f4f6">\n                                    <button class="btn btn--sm btn--outline" data-action="editar-cargo" data-id="').concat(e.id,'" style="width:100%">\n                                        <i data-lucide="edit-2"></i>\n                                        Editar Cargo\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    ')})).join(""),"\n                </div>\n            "):'\n                <div class="card">\n                    <div class="card__body" style="text-align:center;padding:40px;color:#6b7280">\n                        <i data-lucide="inbox" style="width:48px;height:48px;margin-bottom:16px;opacity:0.5"></i>\n                        <p>No hay cargos registrados para esta empresa.</p>\n                        <p style="font-size:13px;margin-top:8px">Los cargos se crean durante el proceso del wizard de profesiograma.</p>\n                    </div>\n                </div>\n            ',"\n        "),window.lucide&&window.lucide.createIcons(),t._hasClickHandler||(t._hasClickHandler=!0,t.addEventListener("click",function(){var e=(0,i.A)(d().mark((function e(n){var a,i,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.target.closest("[data-action]")){e.next=3;break}return e.abrupt("return");case 3:"editar-cargo"===a.dataset.action&&(i=a.dataset.id,r=t.dataset.empresaId,console.log("[MultiRol] Editar cargo:",i,"empresa:",r),ct(r,i));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())),t.dataset.empresaId=n,(c=t.querySelector("#btn-exportar-pdf"))&&(l=c.cloneNode(!0),c.parentNode.replaceChild(l,c),l.addEventListener("click",(function(){var e=l.dataset.empresa;window.open("/pages/profesiograma-view.html?empresa_id=".concat(e,"&print=true"),"_blank")}))),e.next=30;break;case 25:e.prev=25,e.t0=e.catch(6),console.error("[MultiRol] Error cargando profesiograma:",e.t0),t.innerHTML='\n            <div class="card">\n                <div class="card__body" style="text-align:center;padding:40px;color:#ef4444">\n                    <i data-lucide="alert-circle" style="width:48px;height:48px;margin-bottom:16px"></i>\n                    <p>Error al cargar los datos del profesiograma.</p>\n                    <p style="font-size:13px;margin-top:8px">'.concat(e.t0.message,'</p>\n                    <button class="btn btn--outline btn--sm" style="margin-top:16px" onclick="loadProfesiogramaEditor(').concat(n,')">\n                        <i data-lucide="refresh-cw"></i>\n                        Reintentar\n                    </button>\n                </div>\n            </div>\n        '),window.lucide&&window.lucide.createIcons();case 30:case"end":return e.stop()}}),e,null,[[6,25]])}))),Vn.apply(this,arguments)}function Jn(){return Wn.apply(this,arguments)}function Wn(){return(Wn=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Exámenes..."),n=document.querySelector('[data-page="medico-examenes"]')){e.next=4;break}return e.abrupt("return");case 4:n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Exámenes Médicos</h1>\n            <p class="dashboard-page__subtitle">Gestión de exámenes por empresa</p>\n        </div>\n\n        <div class="card">\n            <div class="card__body">\n                <p class="text-center text-muted">\n                    <i data-lucide="activity" style="width: 48px; height: 48px; margin-bottom: 16px;"></i>\n                    <br>\n                    Selecciona una empresa desde "Mis Empresas" para ver los exámenes programados.\n                </p>\n            </div>\n        </div>\n    ',window.lucide&&window.lucide.createIcons();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xn(){return Zn.apply(this,arguments)}function Zn(){return(Zn=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Firma..."),n=document.querySelector('[data-page="medico-firma"]')){e.next=4;break}return e.abrupt("return");case 4:n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Mi Firma Digital</h1>\n            <p class="dashboard-page__subtitle">Configura tu firma para los documentos que generes</p>\n        </div>\n\n        <div id="firma-uploader-container"></div>\n    ',(0,Ue.initFirmaDigitalUploader)("firma-uploader-container",Ze.token);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kn(){return Yn.apply(this,arguments)}function Yn(){return(Yn=(0,i.A)(d().mark((function e(){var n,t,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Config..."),n=document.querySelector("#page-config")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-config"),e.abrupt("return");case 5:return t=Ze.user,a=Ze.data.tieneFirma,n.innerHTML='\n        <div class="page-header">\n            <h1 class="page-header__title">Mi Configuración</h1>\n            <p class="page-header__subtitle">Actualiza tu información profesional</p>\n        </div>\n\n        \x3c!-- Tabs de configuración --\x3e\n        <div class="tabs" style="margin-bottom: 2.4rem;">\n            <button class="tab active" data-config-tab="perfil">Perfil</button>\n            <button class="tab" data-config-tab="firma">Firma Digital</button>\n            <button class="tab" data-config-tab="seguridad">Seguridad</button>\n        </div>\n\n        \x3c!-- Tab: Perfil --\x3e\n        <div id="config-tab-perfil" class="config-tab-content">\n            <div class="dashboard-grid dashboard-grid--cols-2">\n                <div class="card">\n                    <div class="card__header">\n                        <h3 class="card__title">Datos Personales</h3>\n                    </div>\n                    <div class="card__body">\n                        <div class="form-group">\n                            <label class="form-label">Nombre completo</label>\n                            <input type="text" class="input" value="'.concat((null==t?void 0:t.full_name)||"",'" disabled style="background: #f8f9fa;">\n                        </div>\n                        <div class="form-group">\n                            <label class="form-label">Email</label>\n                            <input type="email" class="input" value="').concat((null==t?void 0:t.email)||"",'" disabled style="background: #f8f9fa;">\n                        </div>\n                        <div class="form-group">\n                            <label class="form-label">Teléfono</label>\n                            <input\n                                type="tel"\n                                class="input"\n                                value="').concat((null==t?void 0:t.phone)||"",'"\n                                id="config-phone"\n                                placeholder="Ingresa tu teléfono"\n                                style="width: 100%; padding: 1rem 1.2rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1.4rem; font-family: \'Raleway\', sans-serif;">\n                        </div>\n                    </div>\n                </div>\n\n                <div class="card">\n                    <div class="card__header">\n                        <h3 class="card__title">Información Profesional</h3>\n                    </div>\n                    <div class="card__body">\n                        <div class="form-group">\n                            <label class="form-label">Licencia SST</label>\n                            <input\n                                type="text"\n                                class="input"\n                                value="').concat((null==t?void 0:t.licencia_sst)||"",'"\n                                id="config-licencia"\n                                placeholder="Ej: 12345-2024"\n                                style="width: 100%; padding: 1rem 1.2rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1.4rem; font-family: \'Raleway\', sans-serif;">\n                        </div>\n                        <div class="form-group">\n                            <label class="form-label">Especialidad</label>\n                            <input\n                                type="text"\n                                class="input"\n                                value="').concat((null==t?void 0:t.especialidad)||"",'"\n                                id="config-especialidad"\n                                placeholder="Ej: Medicina Ocupacional"\n                                style="width: 100%; padding: 1rem 1.2rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1.4rem; font-family: \'Raleway\', sans-serif;">\n                        </div>\n                        <button class="btn btn--primary" id="btn-guardar-config" style="width: 100%; margin-top: 1.6rem;">\n                            <i data-lucide="save"></i>\n                            Guardar cambios\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Tab: Firma Digital --\x3e\n        <div id="config-tab-firma" class="config-tab-content" style="display: none;">\n            <div class="card">\n                <div class="card__header">\n                    <div style="display: flex; align-items: center; gap: 1.2rem;">\n                        <i data-lucide="pen-tool" style="width: 24px; height: 24px; color: #5dc4af;"></i>\n                        <div>\n                            <h3 class="card__title" style="margin: 0;">Firma Digital</h3>\n                            <p style="margin: 0.4rem 0 0 0; font-size: 1.3rem; color: #666;">\n                                Sube tu firma para firmar profesiogramas y documentos médicos\n                            </p>\n                        </div>\n                        ').concat(a?'<span class="badge badge--success">Configurada</span>':'<span class="badge badge--warning">Pendiente</span>','\n                    </div>\n                </div>\n                <div class="card__body">\n                    <div id="firma-digital-uploader-container"></div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Tab: Seguridad --\x3e\n        <div id="config-tab-seguridad" class="config-tab-content" style="display: none;">\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Cambiar Contraseña</h3>\n                </div>\n                <div class="card__body">\n                    <div class="form-group">\n                        <label>Contraseña actual</label>\n                        <input type="password" class="input" id="password-actual" placeholder="Ingresa tu contraseña actual">\n                    </div>\n                    <div class="form-group">\n                        <label>Nueva contraseña</label>\n                        <input type="password" class="input" id="password-nueva" placeholder="Mínimo 8 caracteres">\n                    </div>\n                    <div class="form-group">\n                        <label>Confirmar nueva contraseña</label>\n                        <input type="password" class="input" id="password-confirmar" placeholder="Repite la nueva contraseña">\n                    </div>\n                    <button class="btn btn--primary" id="btn-cambiar-password" style="margin-top: 1.6rem;">\n                        <i data-lucide="lock"></i>\n                        Cambiar contraseña\n                    </button>\n                </div>\n            </div>\n        </div>\n    '),window.lucide&&window.lucide.createIcons(),Qn(n),e.next=12,et();case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qn(e){var n=e.querySelectorAll("[data-config-tab]"),t=e.querySelectorAll(".config-tab-content");n.forEach((function(e){e.addEventListener("click",(function(){var a=e.dataset.configTab;n.forEach((function(e){return e.classList.remove("active")})),e.classList.add("active"),t.forEach((function(e){e.style.display="none"}));var i=document.getElementById("config-tab-".concat(a));i&&(i.style.display="block")}))}))}function et(){return nt.apply(this,arguments)}function nt(){return(nt=(0,i.A)(d().mark((function e(){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.resolve().then(t.bind(t,7763));case 3:n=e.sent,(0,n.initFirmaDigitalUploader)("firma-digital-uploader-container",Ze.token),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("[MultiRol] Error cargando componente de firma:",e.t0),(a=document.getElementById("firma-digital-uploader-container"))&&(a.innerHTML='\n                <div style="padding: 2.4rem; text-align: center; color: #f44336;">\n                    <i data-lucide="alert-circle" style="width: 48px; height: 48px; margin-bottom: 1.6rem;"></i>\n                    <p>Error al cargar el componente de firma digital</p>\n                    <p style="font-size: 1.2rem; color: #999; margin-top: 0.8rem;">Por favor, recarga la página</p>\n                </div>\n            ',window.lucide&&window.lucide.createIcons());case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function tt(e){return new Intl.NumberFormat("es-CO").format(e||0)}function at(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=document.querySelector(".toast-notification");t||((t=document.createElement("div")).className="toast-notification",document.body.appendChild(t)),t.textContent=e,t.className="toast-notification toast-notification--".concat(n," toast-notification--visible"),setTimeout((function(){t.classList.remove("toast-notification--visible")}),3e3)}function it(e){var n=new Je({title:"Detalles de Empresa",size:"medium",content:'\n            <div class="form" style="pointer-events:none">\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                            <circle cx="12" cy="7" r="4"></circle>\n                        </svg>\n                        Nombre Legal\n                    </label>\n                    <input type="text" class="form-input" value="'.concat(e.nombre_legal,'" readonly>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                <polyline points="14 2 14 8 20 8"></polyline>\n                                <line x1="12" y1="18" x2="12" y2="12"></line>\n                                <line x1="9" y1="15" x2="15" y2="15"></line>\n                            </svg>\n                            NIT\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.nit,'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <line x1="12" y1="8" x2="12" y2="12"></line>\n                                <line x1="12" y1="16" x2="12.01" y2="16"></line>\n                            </svg>\n                            Estado\n                        </label>\n                        <input type="text" class="form-input" value="').concat("activa"===e.status?"✓ Activa":"suspendida"===e.status?"⏸ Suspendida":"⏳ Pendiente",'" readonly>\n                    </div>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n                                <polyline points="22,6 12,13 2,6"></polyline>\n                            </svg>\n                            Email\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.email||"No registrado",'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                                <circle cx="12" cy="10" r="3"></circle>\n                            </svg>\n                            Ciudad\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.ciudad||"No registrada",'" readonly>\n                    </div>\n                </div>\n\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n                            <circle cx="9" cy="7" r="4"></circle>\n                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>\n                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n                        </svg>\n                        Médicos Asignados\n                    </label>\n                    <input type="text" class="form-input" value="').concat(e.medicos_asignados||0,' médicos" readonly>\n                </div>\n            </div>\n        '),buttons:[{label:"Cerrar",className:"btn--primary",action:"cancel"}]});n.element.addEventListener("click",(function(e){var t=e.target.closest("[data-action]");t&&"cancel"===t.dataset.action&&n.close()})),n.open()}function rt(e){var n=new Je({title:"Detalles del Médico",size:"medium",content:'\n            <div class="form" style="pointer-events:none">\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                            <circle cx="12" cy="7" r="4"></circle>\n                        </svg>\n                        Nombre Completo\n                    </label>\n                    <input type="text" class="form-input" value="'.concat(e.full_name||"No especificado",'" readonly>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n                                <polyline points="22,6 12,13 2,6"></polyline>\n                            </svg>\n                            Correo Electrónico\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.email||"No especificado",'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>\n                            </svg>\n                            Teléfono\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.phone||"No especificado",'" readonly>\n                    </div>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                <polyline points="14 2 14 8 20 8"></polyline>\n                            </svg>\n                            Licencia SST\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.licencia_sst||"Sin licencia",'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n                                <circle cx="8.5" cy="7" r="4"></circle>\n                                <polyline points="17 11 19 13 23 9"></polyline>\n                            </svg>\n                            Especialidad\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.especialidad||"No especificada",'" readonly>\n                    </div>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>\n                                <polyline points="9 22 9 12 15 12 15 22"></polyline>\n                            </svg>\n                            Empresas Asignadas\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.empresas_asignadas||0,'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M15.5 2H8.6c-.4 0-.8.2-1.1.5-.3.3-.5.7-.5 1.1v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8c.4 0 .8-.2 1.1-.5.3-.3.5-.7.5-1.1V6.5L15.5 2z"></path>\n                                <path d="M3 7.6v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8"></path>\n                                <path d="M15 2v5h5"></path>\n                            </svg>\n                            Firma Digital\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.firma_url?"✓ Configurada":"⚠ Pendiente",'" readonly>\n                    </div>\n                </div>\n\n                ').concat(e.fecha_vencimiento_licencia?'\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>\n                            <line x1="16" y1="2" x2="16" y2="6"></line>\n                            <line x1="8" y1="2" x2="8" y2="6"></line>\n                            <line x1="3" y1="10" x2="21" y2="10"></line>\n                        </svg>\n                        Vencimiento Licencia\n                    </label>\n                    <input type="text" class="form-input" value="'.concat(new Date(e.fecha_vencimiento_licencia).toLocaleDateString("es-CO"),'" readonly>\n                </div>\n                '):"","\n            </div>\n        "),buttons:[{label:"Cerrar",className:"btn--primary",action:"cancel"}]});n.element.addEventListener("click",(function(e){var t=e.target.closest("[data-action]");t&&"cancel"===t.dataset.action&&n.close()})),n.open()}function ot(e){var n;console.log("[MultiRol] 🔵 openEditEmpresaModal llamado con:",e),console.log("[MultiRol] 🔵 Modal class:",Je),console.log("[MultiRol] 🔵 typeof Modal:",(0,He.A)(Je));try{n=new Je({title:"Editar Empresa",size:"medium",content:'\n            <form id="form-edit-empresa" class="form">\n                <div class="form-group">\n                    <label for="edit-nombre" class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                            <circle cx="12" cy="7" r="4"></circle>\n                        </svg>\n                        Nombre Legal *\n                    </label>\n                    <input\n                        type="text"\n                        id="edit-nombre"\n                        name="nombre_legal"\n                        class="form-input"\n                        value="'.concat(e.nombre_legal,'"\n                        placeholder="Ej: Acme Corporation S.A.S."\n                        required>\n                </div>\n\n                <div class="form-group">\n                    <label for="edit-nit" class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                            <polyline points="14 2 14 8 20 8"></polyline>\n                            <line x1="12" y1="18" x2="12" y2="12"></line>\n                            <line x1="9" y1="15" x2="15" y2="15"></line>\n                        </svg>\n                        NIT *\n                    </label>\n                    <input\n                        type="text"\n                        id="edit-nit"\n                        name="nit"\n                        class="form-input"\n                        value="').concat(e.nit,'"\n                        placeholder="Ej: 900123456-7"\n                        required>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label for="edit-email" class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n                                <polyline points="22,6 12,13 2,6"></polyline>\n                            </svg>\n                            Email\n                        </label>\n                        <input\n                            type="email"\n                            id="edit-email"\n                            name="email"\n                            class="form-input"\n                            value="').concat(e.email||"",'"\n                            placeholder="empresa@ejemplo.com">\n                    </div>\n\n                    <div class="form-group">\n                        <label for="edit-ciudad" class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                                <circle cx="12" cy="10" r="3"></circle>\n                            </svg>\n                            Ciudad\n                        </label>\n                        <input\n                            type="text"\n                            id="edit-ciudad"\n                            name="ciudad"\n                            class="form-input"\n                            value="').concat(e.ciudad||"",'"\n                            placeholder="Ej: Bogotá">\n                    </div>\n                </div>\n\n                <div class="form-group">\n                    <label for="edit-status" class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <circle cx="12" cy="12" r="10"></circle>\n                            <line x1="12" y1="8" x2="12" y2="12"></line>\n                            <line x1="12" y1="16" x2="12.01" y2="16"></line>\n                        </svg>\n                        Estado *\n                    </label>\n                    <select id="edit-status" name="status" class="form-select" required>\n                        <option value="activa" ').concat("activa"===e.status?"selected":"",'>✓ Activa</option>\n                        <option value="suspendida" ').concat("suspendida"===e.status?"selected":"",'>⏸ Suspendida</option>\n                        <option value="pendiente" ').concat("pendiente"===e.status?"selected":"",">⏳ Pendiente</option>\n                    </select>\n                </div>\n            </form>\n        "),buttons:[{label:"Cancelar",className:"btn--outline",action:"cancel"},{label:"Guardar Cambios",className:"btn--primary",icon:"save",action:"save"}]}),console.log("[MultiRol] 🟢 Modal creado exitosamente:",n),console.log("[MultiRol] 🟢 Modal.element:",n.element)}catch(e){return console.error("[MultiRol] ❌ Error al crear modal:",e),void console.error("[MultiRol] ❌ Error stack:",e.stack)}n.element.addEventListener("click",function(){var t=(0,i.A)(d().mark((function t(a){var i,r,o,s,c;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=a.target.closest("[data-action]")){t.next=3;break}return t.abrupt("return");case 3:if("cancel"!==(r=i.dataset.action)){t.next=8;break}n.close(),t.next=34;break;case 8:if("save"!==r){t.next=34;break}if((o=document.getElementById("form-edit-empresa")).checkValidity()){t.next=13;break}return o.reportValidity(),t.abrupt("return");case 13:return s=new FormData(o),c=Object.fromEntries(s),console.log("[MultiRol] Guardando cambios empresa:",c),t.prev=16,t.next=19,fetch("".concat(We,"/admin/empresas/").concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ze.token)},body:JSON.stringify(c)});case 19:if(t.sent.ok){t.next=22;break}throw new Error("Error al actualizar empresa");case 22:return at("Empresa actualizada exitosamente","success"),n.close(),t.next=26,rn();case 26:return t.next=28,kn();case 28:t.next=34;break;case 30:t.prev=30,t.t0=t.catch(16),console.error("[MultiRol] Error:",t.t0),at("Error al actualizar empresa","error");case 34:case"end":return t.stop()}}),t,null,[[16,30]])})));return function(e){return t.apply(this,arguments)}}()),console.log("[MultiRol] 🟡 Abriendo modal...");try{n.open(),console.log("[MultiRol] 🟢 Modal abierto")}catch(e){console.error("[MultiRol] ❌ Error al abrir modal:",e)}}function st(e){var n=Ze.data.empresas||[],t=new Je({title:"Asignar Empresas - ".concat(e.full_name),size:"medium",content:'\n            <div class="form">\n                <p class="form-help" style="margin-bottom:16px;color:#6b7280">\n                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:4px">\n                        <circle cx="12" cy="12" r="10"></circle>\n                        <path d="M12 16v-4"></path>\n                        <path d="M12 8h.01"></path>\n                    </svg>\n                    Selecciona las empresas que este médico puede gestionar\n                </p>\n\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M11 4a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"></path>\n                            <path d="M21 21l-4.35-4.35"></path>\n                        </svg>\n                        Buscar Empresa\n                    </label>\n                    <input\n                        type="text"\n                        id="search-empresa"\n                        class="form-input"\n                        placeholder="Buscar por nombre o NIT..."\n                        style="margin-bottom:12px">\n                </div>\n\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>\n                            <polyline points="9 22 9 12 15 12 15 22"></polyline>\n                        </svg>\n                        Empresas Disponibles (<span id="empresas-count">'.concat(n.length,'</span>)\n                    </label>\n                    <div id="empresas-checkboxes" class="checkbox-list" style="max-height:400px;overflow-y:auto;padding:12px;border:1px solid #e5e7eb;border-radius:8px;background:#f9fafb">\n                        ').concat(n.length>0?n.map((function(e){return'\n                                <label class="form-checkbox empresa-item" data-nombre="'.concat(e.nombre_legal.toLowerCase(),'" data-nit="').concat(e.nit,'" style="padding:10px;margin-bottom:8px;border-radius:6px;background:#fff;border:1px solid #e5e7eb;cursor:pointer;transition:all 0.2s;display:flex;align-items:start;gap:8px" onmouseover="this.style.borderColor=\'#5dc4af\'" onmouseout="this.style.borderColor=\'#e5e7eb\'">\n                                    <input\n                                        type="checkbox"\n                                        name="empresas[]"\n                                        value="').concat(e.id,'">\n                                    <span style="display:flex;flex-direction:column;gap:2px">\n                                        <strong style="color:#383d47;font-size:14px">').concat(e.nombre_legal,'</strong>\n                                        <small style="color:#6b7280;font-size:12px">').concat(e.nit," - ").concat(e.ciudad||"Sin ciudad","</small>\n                                    </span>\n                                </label>\n                            ")})).join(""):'<p style="color:#6b7280;text-align:center;padding:20px">No hay empresas disponibles</p>',"\n                    </div>\n                </div>\n            </div>\n        "),buttons:[{label:"Cancelar",className:"btn--outline",action:"cancel"},{label:"Asignar Empresas",className:"btn--primary",icon:"link",action:"assign"}]});setTimeout((0,i.A)(d().mark((function n(){var a,i,r;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(We,"/admin/medicos/").concat(e.id,"/empresas"),{headers:{Authorization:"Bearer ".concat(Ze.token)}});case 3:if(!(a=n.sent).ok){n.next=11;break}return n.next=7,a.json();case 7:i=n.sent,r=i.empresas,console.log("[MultiRol] 🔵 Empresas asignadas recibidas:",r),r.forEach((function(e){var n=t.element.querySelector('input[value="'.concat(e.empresa_id,'"]'));n&&(n.checked=!0,console.log("[MultiRol] ✅ Checkbox marcado para empresa:",e.nombre_legal))}));case 11:n.next=16;break;case 13:n.prev=13,n.t0=n.catch(0),console.error("[MultiRol] Error cargando empresas asignadas:",n.t0);case 16:case"end":return n.stop()}}),n,null,[[0,13]])}))),100);var a=!1,r=function(){var n=(0,i.A)(d().mark((function n(i){var r,o,s,c,l,u,p,m,g;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=i.target.closest("[data-action]")){n.next=3;break}return n.abrupt("return");case 3:if("cancel"!==(o=r.dataset.action)){n.next=8;break}t.close(),n.next=55;break;case 8:if("assign"!==o){n.next=55;break}if(!a){n.next=12;break}return console.log("[MultiRol] Ya se está procesando, ignorando click..."),n.abrupt("return");case 12:return a=!0,r.disabled=!0,s=r.textContent,r.textContent="Asignando...",c=t.element.querySelectorAll('input[name="empresas[]"]:checked'),l=Array.from(c).map((function(e){return parseInt(e.value)})),console.log("[MultiRol] 🔵 Asignando empresas:",l),console.log("[MultiRol] 🔵 Médico ID:",e.id),console.log("[MultiRol] 🔵 API_BASE:",We),console.log("[MultiRol] 🔵 Token:",Ze.token?"existe":"NO EXISTE"),n.prev=22,u="".concat(We,"/admin/medicos/").concat(e.id,"/empresas"),console.log("[MultiRol] 🔵 URL completa:",u),n.next=27,fetch(u,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Ze.token)},body:JSON.stringify({empresas:l})});case 27:if(p=n.sent,console.log("[MultiRol] 🔵 Response status:",p.status),console.log("[MultiRol] 🔵 Response ok:",p.ok),p.ok){n.next=36;break}return n.next=33,p.json().catch((function(){return{message:"Error desconocido"}}));case 33:throw m=n.sent,console.error("[MultiRol] ❌ Error del servidor:",m),new Error(m.message||"Error al asignar empresas");case 36:return n.next=38,p.json();case 38:return g=n.sent,console.log("[MultiRol] 🟢 Respuesta exitosa:",g),at(g.message||"".concat(l.length," empresa(s) asignada(s) exitosamente"),"success"),t.close(),n.next=44,rn();case 44:return n.next=46,Cn();case 46:n.next=55;break;case 48:n.prev=48,n.t0=n.catch(22),console.error("[MultiRol] ❌ Error completo:",n.t0),at(n.t0.message||"Error al asignar empresas","error"),r.disabled=!1,r.textContent=s,a=!1;case 55:case"end":return n.stop()}}),n,null,[[22,48]])})));return function(e){return n.apply(this,arguments)}}();t.element.addEventListener("click",r),t.element.addEventListener("input",(function(e){if("search-empresa"===e.target.id){var n=e.target.value.toLowerCase().trim(),a=t.element.querySelectorAll(".empresa-item"),i=t.element.querySelector("#empresas-count"),r=0;a.forEach((function(e){var t=e.dataset.nombre||"",a=e.dataset.nit||"";t.includes(n)||a.includes(n)?(e.style.display="flex",r++):e.style.display="none"})),i&&(i.textContent=r)}})),t.open()}function ct(e,n){return lt.apply(this,arguments)}function lt(){return lt=(0,i.A)(d().mark((function e(n,t){var a,r,o,s,c;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[MultiRol] Abriendo modal editar cargo:",{empresaId:n,cargoId:t}),(a=new Je({title:"Cargando...",size:"small",content:'\n            <div style="display:flex;align-items:center;justify-content:center;padding:40px">\n                <div class="spinner" style="width:32px;height:32px;border:3px solid #e5e7eb;border-top-color:#5dc4af;border-radius:50%;animation:spin 1s linear infinite"></div>\n                <span style="margin-left:12px;color:#6b7280">Cargando datos del cargo...</span>\n            </div>\n        ',buttons:[]})).open(),e.prev=3,e.next=6,fetch("".concat(We,"/medico/empresas/").concat(n,"/cargos/").concat(t),{headers:{Authorization:"Bearer ".concat(Ze.token)}});case 6:if((r=e.sent).ok){e.next=9;break}throw new Error("Error al cargar cargo");case 9:return e.next=11,r.json();case 11:o=e.sent,s=o.cargo,a.close(),(c=new Je({title:"Editar: ".concat(s.nombre_cargo),size:"large",content:dt(s),buttons:[{label:"Cancelar",className:"btn--outline",action:"cancel"},{label:"Guardar Cambios",className:"btn--primary",icon:"save",action:"save"}]})).element.addEventListener("click",function(){var e=(0,i.A)(d().mark((function e(a){var i,r,o,s,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=a.target).closest(".tab-btn")&&(r=i.closest(".tab-btn"),o=r.dataset.tab,c.element.querySelectorAll(".tab-btn").forEach((function(e){e.classList.remove("active"),e.style.background="#e5e7eb",e.style.color="#374151"})),r.classList.add("active"),r.style.background="#5dc4af",r.style.color="white",c.element.querySelectorAll(".tab-content").forEach((function(e){e.style.display=e.dataset.tabContent===o?"block":"none"}))),i.closest("[data-add-item]")&&(s=i.closest("[data-add-item]"),l=s.dataset.addItem,mt(c.element,l)),i.closest("[data-remove-item]")&&i.closest("[data-remove-item]").closest(".editable-item").remove(),!i.closest('[data-action="save"]')){e.next=7;break}return e.next=7,gt(c,n,t);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),c.open(),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(3),a.close(),console.error("[MultiRol] Error cargando cargo:",e.t0),at("Error al cargar datos del cargo","error");case 24:case"end":return e.stop()}}),e,null,[[3,19]])}))),lt.apply(this,arguments)}function dt(e){console.log("[Editor] Cargo recibido:",e),console.log("[Editor] Generados:",e.generados),console.log("[Editor] Overrides:",e.overrides);var n=e.generados||{},t=e.overrides||{},a=function(e){return Array.isArray(e)&&e.length>0},i=a(t.epp)?t.epp:n.epp||[],r=a(t.aptitudes)?t.aptitudes:n.aptitudes||[],o=a(t.condiciones_incompatibles)?t.condiciones_incompatibles:n.condiciones_incompatibles||[],s=n.examenes||[];console.log("[Editor] EPP data:",i),console.log("[Editor] Examenes generados:",s);var c=a(t.examenes_ingreso)?t.examenes_ingreso:s.filter((function(e){return e.ingreso})).map((function(e){return{nombre:e.nombre,codigo:e.codigo,periodicidad:e.periodicidad,justificacion:e.justificacion}})),l=a(t.examenes_periodicos)?t.examenes_periodicos:s.filter((function(e){return e.periodico})).map((function(e){return{nombre:e.nombre,codigo:e.codigo,periodicidad:e.periodicidad,justificacion:e.justificacion}})),d=a(t.examenes_retiro)?t.examenes_retiro:s.filter((function(e){return e.retiro})).map((function(e){return{nombre:e.nombre,codigo:e.codigo,periodicidad:"N/A",justificacion:"Evaluación de egreso"}}));console.log("[Editor] Examenes ingreso:",c),console.log("[Editor] Examenes periodicos:",l);var u=function(e,n,t){return e&&0!==e.length?e.map((function(e,a){return'\n            <div class="editable-item" style="display:flex;gap:8px;margin-bottom:8px;align-items:center">\n                <input type="text" class="form-input" name="'.concat(n,'[]" value="').concat(ht("string"==typeof e?e:e.nombre||""),'" placeholder="').concat(t,'" style="flex:1">\n                <button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:4px">\n                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>\n                </button>\n            </div>\n        ')})).join(""):'<div class="empty-list" style="color:#9ca3af;font-size:13px;padding:8px">No hay items. Usa el botón "+" para agregar.</div>'},p=[{codigo:"EMO",nombre:"EXAMEN MEDICO CON ENFASIS OSTEOMUSCULAR"},{codigo:"EMOA",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS EN ALTURAS"},{codigo:"EMOD",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS DERMATOLOGICO"},{codigo:"EMOMP",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS EN MANIPULACION DE ALIMENTOS"},{codigo:"AUD",nombre:"AUDIOMETRIA"},{codigo:"ESP",nombre:"ESPIROMETRÍA"},{codigo:"OPTO",nombre:"OPTOMETRÍA"},{codigo:"VIS",nombre:"VISIOMETRÍA"},{codigo:"ECG",nombre:"ELECTROCARDIOGRAMA"},{codigo:"RXC",nombre:"RAYOS X DE COLUMNA"},{codigo:"PSM",nombre:"PRUEBA PSICOSENSOMETRICA"},{codigo:"PST",nombre:"PRUEBA PSICOTECNICA"},{codigo:"FRO",nombre:"FROTIS FARINGEO"},{codigo:"GLI",nombre:"GLICEMIA"},{codigo:"CH",nombre:"CUADRO HEMATICO"},{codigo:"RH",nombre:"HEMOCLASIFICIÓN GRUPO ABO Y FACTOR RH"},{codigo:"KOH",nombre:"PRUEBA DE KOH"},{codigo:"BUN",nombre:"NITROGENO UREICO [BUN]"},{codigo:"PL",nombre:"PERFIL LIPÍDICO"},{codigo:"PAS",nombre:"PRUEBA DE ALCOHOL EN SALIVA"},{codigo:"PE",nombre:"PRUEBA DE EMBARAZO"},{codigo:"PSP",nombre:"PRUEBA DE SUSTANCIAS PSICOACTIVAS"},{codigo:"TGO",nombre:"TRANSAMINASAS TGO"},{codigo:"TGP",nombre:"TRANSAMINASAS TGP"},{codigo:"TRI",nombre:"TRIGLICÉRIDOS"},{codigo:"COL",nombre:"COLESTEROL"},{codigo:"COP",nombre:"COPROLOGICO"},{codigo:"LEP",nombre:"LEPTOSPIRA"},{codigo:"BRU",nombre:"BRUCELA"},{codigo:"TOX",nombre:"TOXOPLASMA"},{codigo:"COLI",nombre:"COLINESTERASA"},{codigo:"CRE",nombre:"CREATININA"},{codigo:"ORI",nombre:"PARCIAL DE ORINA"},{codigo:"TET",nombre:"VACUNA DEL TETANO"},{codigo:"VH",nombre:"VACUNA DEL VIRUS HEPATITIS"},{codigo:"VFA",nombre:"VACUNA DE FIEBRE AMARILLA"},{codigo:"T4L",nombre:"T4 LIBRE"}],m=[{valor:"Semestral",meses:6},{valor:"Anual",meses:12},{valor:"Cada 2 años",meses:24},{valor:"Cada 3 años",meses:36},{valor:"Cada 5 años",meses:60},{valor:"Solo ingreso/egreso",meses:999},{valor:"N/A",meses:0}],g=function(e,n){return e&&0!==e.length?'\n            <table class="data-table" style="font-size:13px;width:100%">\n                <thead>\n                    <tr>\n                        <th style="text-align:left">Examen</th>\n                        <th style="text-align:left;width:140px">Periodicidad</th>\n                        <th style="text-align:left">Justificación</th>\n                        <th style="width:40px"></th>\n                    </tr>\n                </thead>\n                <tbody>\n                    '.concat(e.map((function(e,t){return'\n                        <tr class="editable-item">\n                            <td>\n                                <select class="form-input form-input--sm" name="examenes_'.concat(n,'_nombre[]" style="width:100%;font-size:11px">\n                                    <option value="">-- Seleccionar examen --</option>\n                                    ').concat((i=e.nombre||"",p.map((function(e){var n=e.nombre===i?"selected":"";return'<option value="'.concat(ht(e.nombre),'" ').concat(n,">").concat(e.codigo," - ").concat(ht(e.nombre),"</option>")})).join("")),'\n                                </select>\n                            </td>\n                            <td>\n                                <select class="form-input form-input--sm" name="examenes_').concat(n,'_periodicidad[]" style="width:100%">\n                                    ').concat((a=e.periodicidad||"",m.map((function(e){var n=e.valor===a?"selected":"";return'<option value="'.concat(ht(e.valor),'" ').concat(n,">").concat(ht(e.valor),"</option>")})).join("")),'\n                                </select>\n                            </td>\n                            <td><input type="text" class="form-input form-input--sm" name="examenes_').concat(n,'_justificacion[]" value="').concat(ht(e.justificacion||""),'" style="width:100%"></td>\n                            <td><button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:2px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></td>\n                        </tr>\n                    ');var a,i})).join(""),"\n                </tbody>\n            </table>\n        "):'<p style="color:#9ca3af;font-size:13px;padding:8px">No hay exámenes de '.concat(n,".</p>")},v=n.nr_maximo||0,h=n.periodicidad_minima||36;return'\n        <div class="cargo-editor" style="max-height:70vh;overflow-y:auto">\n            \x3c!-- Info del cargo (solo lectura) --\x3e\n            <div class="cargo-info" style="background:#f9fafb;padding:16px;border-radius:8px;margin-bottom:20px">\n                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;font-size:13px">\n                    <div><strong>Área:</strong> '.concat(e.area||"N/A","</div>\n                    <div><strong>Zona:</strong> ").concat(e.zona||"N/A","</div>\n                    <div><strong>Trabajadores:</strong> ").concat(e.num_trabajadores||0,'</div>\n                </div>\n                <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">\n                    ').concat(e.trabaja_alturas?'<span class="badge badge--warning">Trabajo en Alturas</span>':"","\n                    ").concat(e.manipula_alimentos?'<span class="badge badge--info">Manipula Alimentos</span>':"","\n                    ").concat(e.trabaja_espacios_confinados?'<span class="badge badge--danger">Espacios Confinados</span>':"",'\n                    <span class="badge badge--outline" style="font-size:11px">NR máx: ').concat(v,'</span>\n                    <span class="badge badge--outline" style="font-size:11px">Periodicidad: ').concat(h," meses</span>\n                </div>\n                ").concat(e.riesgos&&e.riesgos.length>0?'\n                    <div style="margin-top:12px;padding-top:12px;border-top:1px solid #e5e7eb">\n                        <strong style="font-size:12px;color:#6b7280">Riesgos identificados ('.concat(e.riesgos.length,'):</strong>\n                        <div style="margin-top:4px;display:flex;flex-wrap:wrap;gap:4px">\n                            ').concat(e.riesgos.slice(0,5).map((function(e){return'\n                                <span class="badge badge--outline" style="font-size:10px">'.concat(e.ges,"</span>\n                            ")})).join(""),"\n                            ").concat(e.riesgos.length>5?'<span style="font-size:11px;color:#9ca3af">+'.concat(e.riesgos.length-5," más</span>"):"","\n                        </div>\n                    </div>\n                "):"",'\n            </div>\n\n            \x3c!-- Tabs --\x3e\n            <div class="tabs" style="margin-bottom:16px">\n                <button class="tab-btn active" data-tab="examenes" style="padding:8px 16px;border:none;background:#5dc4af;color:white;border-radius:6px 6px 0 0;cursor:pointer">Exámenes Médicos</button>\n                <button class="tab-btn" data-tab="epp" style="padding:8px 16px;border:none;background:#e5e7eb;border-radius:6px 6px 0 0;cursor:pointer">EPP (').concat(i.length,')</button>\n                <button class="tab-btn" data-tab="aptitudes" style="padding:8px 16px;border:none;background:#e5e7eb;border-radius:6px 6px 0 0;cursor:pointer">Aptitudes (').concat(r.length,')</button>\n                <button class="tab-btn" data-tab="condiciones" style="padding:8px 16px;border:none;background:#e5e7eb;border-radius:6px 6px 0 0;cursor:pointer">Condiciones (').concat(o.length,')</button>\n            </div>\n\n            \x3c!-- Tab: Exámenes --\x3e\n            <div class="tab-content" data-tab-content="examenes">\n                <div style="margin-bottom:20px">\n                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">\n                        <h4 style="margin:0;font-size:14px;color:#374151">Exámenes de Ingreso (').concat(c.length,')</h4>\n                        <button type="button" class="btn btn--outline btn--sm" data-add-item="examenes_ingreso">+ Agregar</button>\n                    </div>\n                    <div id="list-examenes_ingreso">').concat(g(c,"ingreso"),'</div>\n                </div>\n                <div style="margin-bottom:20px">\n                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">\n                        <h4 style="margin:0;font-size:14px;color:#374151">Exámenes Periódicos (').concat(l.length,')</h4>\n                        <button type="button" class="btn btn--outline btn--sm" data-add-item="examenes_periodicos">+ Agregar</button>\n                    </div>\n                    <div id="list-examenes_periodicos">').concat(g(l,"periodicos"),'</div>\n                </div>\n                <div style="margin-bottom:20px">\n                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">\n                        <h4 style="margin:0;font-size:14px;color:#374151">Exámenes de Retiro (').concat(d.length,')</h4>\n                        <button type="button" class="btn btn--outline btn--sm" data-add-item="examenes_retiro">+ Agregar</button>\n                    </div>\n                    <div id="list-examenes_retiro">').concat(g(d,"retiro"),'</div>\n                </div>\n            </div>\n\n            \x3c!-- Tab: EPP --\x3e\n            <div class="tab-content" data-tab-content="epp" style="display:none">\n                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">\n                    <h4 style="margin:0;font-size:14px;color:#374151">Elementos de Protección Personal</h4>\n                    <button type="button" class="btn btn--outline btn--sm" data-add-item="epp">+ Agregar EPP</button>\n                </div>\n                <div id="list-epp">').concat(u(i,"epp","Ej: Casco de seguridad"),'</div>\n            </div>\n\n            \x3c!-- Tab: Aptitudes --\x3e\n            <div class="tab-content" data-tab-content="aptitudes" style="display:none">\n                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">\n                    <h4 style="margin:0;font-size:14px;color:#374151">Aptitudes Requeridas</h4>\n                    <button type="button" class="btn btn--outline btn--sm" data-add-item="aptitudes">+ Agregar Aptitud</button>\n                </div>\n                <div id="list-aptitudes">').concat(u(r,"aptitudes","Ej: Buena agudeza visual"),'</div>\n            </div>\n\n            \x3c!-- Tab: Condiciones Incompatibles --\x3e\n            <div class="tab-content" data-tab-content="condiciones" style="display:none">\n                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">\n                    <h4 style="margin:0;font-size:14px;color:#374151">Condiciones de Salud Incompatibles</h4>\n                    <button type="button" class="btn btn--outline btn--sm" data-add-item="condiciones_incompatibles">+ Agregar Condición</button>\n                </div>\n                <div id="list-condiciones_incompatibles">').concat(u(o,"condiciones_incompatibles","Ej: Vértigo severo"),'</div>\n            </div>\n\n            \x3c!-- Justificación obligatoria --\x3e\n            <div style="margin-top:24px;padding-top:20px;border-top:2px solid #e5e7eb">\n                <label class="form-label" style="color:#dc2626;font-weight:600">\n                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:inline;vertical-align:middle;margin-right:4px"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>\n                    Justificación de la modificación (obligatorio)\n                </label>\n                <textarea id="justificacion_modificacion" class="form-input" rows="3" placeholder="Describa el motivo de los cambios realizados (mínimo 10 caracteres)..." style="width:100%;margin-top:8px">').concat(e.justificacion_modificacion||"",'</textarea>\n                <p style="font-size:12px;color:#6b7280;margin-top:4px">Esta justificación quedará registrada en el profesiograma y en la auditoría del sistema.</p>\n            </div>\n        </div>\n\n        <style>\n            .tab-btn.active { background: #5dc4af !important; color: white !important; }\n            .form-input--sm { padding: 6px 8px; font-size: 12px; }\n            .data-table { border-collapse: collapse; }\n            .data-table th, .data-table td { padding: 8px; border-bottom: 1px solid #e5e7eb; }\n            .data-table th { background: #f9fafb; font-weight: 500; }\n        </style>\n    ')}var ut=[{codigo:"EMO",nombre:"EXAMEN MEDICO CON ENFASIS OSTEOMUSCULAR"},{codigo:"EMOA",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS EN ALTURAS"},{codigo:"EMOD",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS DERMATOLOGICO"},{codigo:"EMOMP",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS EN MANIPULACION DE ALIMENTOS"},{codigo:"AUD",nombre:"AUDIOMETRIA"},{codigo:"ESP",nombre:"ESPIROMETRÍA"},{codigo:"OPTO",nombre:"OPTOMETRÍA"},{codigo:"VIS",nombre:"VISIOMETRÍA"},{codigo:"ECG",nombre:"ELECTROCARDIOGRAMA"},{codigo:"RXC",nombre:"RAYOS X DE COLUMNA"},{codigo:"PSM",nombre:"PRUEBA PSICOSENSOMETRICA"},{codigo:"PST",nombre:"PRUEBA PSICOTECNICA"},{codigo:"FRO",nombre:"FROTIS FARINGEO"},{codigo:"GLI",nombre:"GLICEMIA"},{codigo:"CH",nombre:"CUADRO HEMATICO"},{codigo:"RH",nombre:"HEMOCLASIFICIÓN GRUPO ABO Y FACTOR RH"},{codigo:"KOH",nombre:"PRUEBA DE KOH"},{codigo:"BUN",nombre:"NITROGENO UREICO [BUN]"},{codigo:"PL",nombre:"PERFIL LIPÍDICO"},{codigo:"PAS",nombre:"PRUEBA DE ALCOHOL EN SALIVA"},{codigo:"PE",nombre:"PRUEBA DE EMBARAZO"},{codigo:"PSP",nombre:"PRUEBA DE SUSTANCIAS PSICOACTIVAS"},{codigo:"TGO",nombre:"TRANSAMINASAS TGO"},{codigo:"TGP",nombre:"TRANSAMINASAS TGP"},{codigo:"TRI",nombre:"TRIGLICÉRIDOS"},{codigo:"COL",nombre:"COLESTEROL"},{codigo:"COP",nombre:"COPROLOGICO"},{codigo:"LEP",nombre:"LEPTOSPIRA"},{codigo:"BRU",nombre:"BRUCELA"},{codigo:"TOX",nombre:"TOXOPLASMA"},{codigo:"COLI",nombre:"COLINESTERASA"},{codigo:"CRE",nombre:"CREATININA"},{codigo:"ORI",nombre:"PARCIAL DE ORINA"},{codigo:"TET",nombre:"VACUNA DEL TETANO"},{codigo:"VH",nombre:"VACUNA DEL VIRUS HEPATITIS"},{codigo:"VFA",nombre:"VACUNA DE FIEBRE AMARILLA"},{codigo:"T4L",nombre:"T4 LIBRE"}],pt=[{valor:"Semestral",meses:6},{valor:"Anual",meses:12},{valor:"Cada 2 años",meses:24},{valor:"Cada 3 años",meses:36},{valor:"Cada 5 años",meses:60},{valor:"Solo ingreso/egreso",meses:999},{valor:"N/A",meses:0}];function mt(e,n){var t=e.querySelector("#list-".concat(n));if(t){var a=t.querySelector(".empty-list");a&&a.remove();var i=t.querySelector("p");if(i&&i.remove(),n.startsWith("examenes_")){var r=n.replace("examenes_",""),o=ut.map((function(e){return'<option value="'.concat(e.nombre,'">').concat(e.codigo," - ").concat(e.nombre,"</option>")})).join(""),s=pt.map((function(e){return'<option value="'.concat(e.valor,'">').concat(e.valor,"</option>")})).join(""),c=t.querySelector("tbody");if(c){var l=document.createElement("tr");l.className="editable-item",l.innerHTML='\n                <td>\n                    <select class="form-input form-input--sm" name="examenes_'.concat(r,'_nombre[]" style="width:100%;font-size:11px">\n                        <option value="">-- Seleccionar examen --</option>\n                        ').concat(o,'\n                    </select>\n                </td>\n                <td>\n                    <select class="form-input form-input--sm" name="examenes_').concat(r,'_periodicidad[]" style="width:100%">\n                        ').concat(s,'\n                    </select>\n                </td>\n                <td><input type="text" class="form-input form-input--sm" name="examenes_').concat(r,'_justificacion[]" placeholder="Justificación técnica" style="width:100%"></td>\n                <td><button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:2px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></td>\n            '),c.appendChild(l)}else t.innerHTML='\n                <table class="data-table" style="font-size:13px;width:100%">\n                    <thead><tr><th>Examen</th><th style="width:140px">Periodicidad</th><th>Justificación</th><th style="width:40px"></th></tr></thead>\n                    <tbody>\n                        <tr class="editable-item">\n                            <td>\n                                <select class="form-input form-input--sm" name="examenes_'.concat(r,'_nombre[]" style="width:100%;font-size:11px">\n                                    <option value="">-- Seleccionar examen --</option>\n                                    ').concat(o,'\n                                </select>\n                            </td>\n                            <td>\n                                <select class="form-input form-input--sm" name="examenes_').concat(r,'_periodicidad[]" style="width:100%">\n                                    ').concat(s,'\n                                </select>\n                            </td>\n                            <td><input type="text" class="form-input form-input--sm" name="examenes_').concat(r,'_justificacion[]" placeholder="Justificación" style="width:100%"></td>\n                            <td><button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:2px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></td>\n                        </tr>\n                    </tbody>\n                </table>\n            ')}else{var d={epp:"Ej: Guantes de nitrilo",aptitudes:"Ej: Capacidad para trabajo en equipo",condiciones_incompatibles:"Ej: Epilepsia no controlada"}[n]||"Nuevo item",u=document.createElement("div");u.className="editable-item",u.style="display:flex;gap:8px;margin-bottom:8px;align-items:center",u.innerHTML='\n            <input type="text" class="form-input" name="'.concat(n,'[]" placeholder="').concat(d,'" style="flex:1">\n            <button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:4px">\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>\n            </button>\n        '),t.appendChild(u)}}}function gt(e,n,t){return vt.apply(this,arguments)}function vt(){return vt=(0,i.A)(d().mark((function e(n,t,a){var i,r,o,s,c,l,u,p,m;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.element,(o=null===(i=r.querySelector("#justificacion_modificacion"))||void 0===i||null===(i=i.value)||void 0===i?void 0:i.trim())&&!(o.length<10)){e.next=6;break}return at("La justificación es obligatoria (mínimo 10 caracteres)","error"),null===(s=r.querySelector("#justificacion_modificacion"))||void 0===s||s.focus(),e.abrupt("return");case 6:return l=function(e){var n=r.querySelectorAll('input[name="'.concat(e,'[]"]'));return Array.from(n).map((function(e){return e.value.trim()})).filter((function(e){return e}))},u={examenes_ingreso:(c=function(e){var n=r.querySelectorAll('select[name="examenes_'.concat(e,'_nombre[]"]')),t=r.querySelectorAll('select[name="examenes_'.concat(e,'_periodicidad[]"]')),a=r.querySelectorAll('input[name="examenes_'.concat(e,'_justificacion[]"]')),i=[];return n.forEach((function(e,n){var r,o;e.value.trim()&&i.push({nombre:e.value.trim(),periodicidad:(null===(r=t[n])||void 0===r||null===(r=r.value)||void 0===r?void 0:r.trim())||"",justificacion:(null===(o=a[n])||void 0===o||null===(o=o.value)||void 0===o?void 0:o.trim())||""})})),i})("ingreso"),examenes_periodicos:c("periodicos"),examenes_retiro:c("retiro"),epp:l("epp"),aptitudes:l("aptitudes"),condiciones_incompatibles:l("condiciones_incompatibles"),justificacion_modificacion:o},console.log("[MultiRol] Guardando cargo:",u),e.prev=10,e.next=13,fetch("".concat(We,"/medico/empresas/").concat(t,"/cargos/").concat(a),{method:"PUT",headers:{Authorization:"Bearer ".concat(Ze.token),"Content-Type":"application/json"},body:JSON.stringify(u)});case 13:return p=e.sent,e.next=16,p.json();case 16:if(m=e.sent,p.ok){e.next=19;break}throw new Error(m.message||"Error al guardar");case 19:at("Cargo actualizado correctamente","success"),n.close(),Gn(t),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(10),console.error("[MultiRol] Error guardando cargo:",e.t0),at(e.t0.message||"Error al guardar cambios","error");case 28:case"end":return e.stop()}}),e,null,[[10,24]])}))),vt.apply(this,arguments)}function ht(e){if(!e)return"";var n=document.createElement("div");return n.textContent=e,n.innerHTML}function ft(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function bt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ft(Object(t),!0).forEach((function(n){(0,a.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ft(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var yt={currentPage:"home",companyId:null,companyName:"",user:null,isLoading:!1,data:{summary:null,alerts:null,conditions:null,risks:null,examenes:null,cargos:null,matriz:null}},xt="#sidebar",_t="#sidebar-toggle",wt="#sidebar-overlay",Et="#mobile-menu-toggle",kt=".sidebar-nav__item",At=".dashboard-page",Ct=function(){return c((function e(){r(this,e),this.pages=new Map,this.currentPage=null,this.init()}),[{key:"init",value:function(){var e=this;document.querySelectorAll(At).forEach((function(n){var t=n.dataset.page;e.pages.set(t,n)})),this.bindNavEvents(),this.bindSidebarEvents();var n=window.location.hash.replace("#","")||"home";this.navigateTo(n)}},{key:"bindNavEvents",value:function(){var e=this;document.querySelectorAll(kt).forEach((function(n){n.addEventListener("click",(function(t){t.preventDefault();var a=n.dataset.page;a&&e.navigateTo(a)}))})),document.querySelectorAll("[data-navigate]").forEach((function(n){n.addEventListener("click",(function(t){t.preventDefault();var a=n.dataset.navigate;a&&e.navigateTo(a)}))})),window.addEventListener("popstate",(function(){var n=window.location.hash.replace("#","")||"home";e.navigateTo(n,!1)}))}},{key:"bindSidebarEvents",value:function(){var e=document.querySelector(xt),n=document.querySelector(_t),t=document.querySelector(wt),a=document.querySelector(Et);n&&n.addEventListener("click",(function(){e.classList.toggle("collapsed"),document.querySelector(".dashboard-main").classList.toggle("sidebar-collapsed")})),a&&a.addEventListener("click",(function(){e.classList.toggle("open"),t.classList.toggle("visible")})),t&&t.addEventListener("click",(function(){e.classList.remove("open"),t.classList.remove("visible")}))}},{key:"navigateTo",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.pages.has(e)||(console.warn('Page "'.concat(e,'" not found')),e="home"),this.pages.forEach((function(e,n){e.style.display="none"}));var t=this.pages.get(e);t&&(t.style.display="block"),document.querySelectorAll(kt).forEach((function(n){n.classList.remove("active"),n.dataset.page===e&&n.classList.add("active")})),this.currentPage=e,yt.currentPage=e,n&&window.history.pushState({page:e},"","#".concat(e));var a=document.querySelector(xt),i=document.querySelector(wt);a&&a.classList.remove("open"),i&&i.classList.remove("visible"),this.loadPageData(e),window.lucide&&window.lucide.createIcons(),console.log("Navigated to: ".concat(e))}},{key:"loadPageData",value:(e=(0,i.A)(d().mark((function e(n){var t,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={home:St,inteligencia:Rt,"mapa-org":jt,cargos:Bt,examenes:Ut,matriz:Ft,estadisticas:Vt,sve:Wt,psicosocial:Zt,documentos:Yt,profesiograma:ia,config:ea,"panel-medico":ta},!window.multiRolPageHandlers||!window.multiRolPageHandlers[n]){e.next=11;break}return e.prev=2,e.next=5,window.multiRolPageHandlers[n]();case 5:return e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(2),console.error("Error loading multi-rol page ".concat(n,":"),e.t0);case 11:if(!(a=t[n])){e.next=21;break}return e.prev=13,e.next=16,a();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(13),console.error("Error loading page ".concat(n,":"),e.t1);case 21:case"end":return e.stop()}}),e,null,[[2,8],[13,18]])}))),function(n){return e.apply(this,arguments)})}]);var e}();function St(){return It.apply(this,arguments)}function It(){return(It=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading Dashboard Home..."),e.prev=1,Mt(),e.next=5,Nt();case 5:(n=e.sent)&&Lt(n),zt("donut-cumplimiento",87),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Error loading dashboard home:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function Mt(){var e=new Date,n=document.getElementById("last-update"),t=document.getElementById("next-update");if(n&&(n.textContent="Hoy ".concat(Ot(e))),t){var a=new Date(e.getTime()+216e5);t.textContent="Hoy ".concat(Ot(a))}}function Ot(e){return e.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!0}).toUpperCase()}function Nt(){return Pt.apply(this,arguments)}function Pt(){return(Pt=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{cumplimiento:87,trabajadores:{total:53,alDia:45,alertas:8},alertas:{total:8,vencidos:3,proximos:5},examenes:{vencidos:3,proximos:5},riesgos:{nivelV:8,nivelIV:15,total:34},condiciones:{hipoacusia:15,trend:3},sve:3,peligros:122});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lt(e){ca("cumplimiento-value",e.cumplimiento),ca("total-trabajadores",e.trabajadores.total),ca("trabajadores-aldia",e.trabajadores.alDia),ca("trabajadores-alertas",e.trabajadores.alertas),ca("total-alertas",e.alertas.total),ca("alertas-vencidos",e.alertas.vencidos),ca("alertas-proximos",e.alertas.proximos),ca("hipoacusia-percent","".concat(e.condiciones.hipoacusia,"%")),ca("condition-trend-text","+".concat(e.condiciones.trend,"% vs trimestre")),ca("examenes-vencidos",e.examenes.vencidos),ca("examenes-proximos",e.examenes.proximos),ca("riesgos-v",e.riesgos.nivelV),ca("riesgos-iv",e.riesgos.nivelIV),ca("riesgos-total",e.riesgos.total),ca("stat-cumplimiento","".concat(e.cumplimiento,"%")),ca("stat-examenes-dia",e.trabajadores.alDia),ca("stat-total-trabajadores",e.trabajadores.total),ca("stat-sve-activos",e.sve),ca("stat-peligros",e.peligros),ca("insight-pattern-text","Aumento 15% deterioro auditivo en soldadores últimos 6 meses"),ca("insight-recommendation-text","Auditoría uso EPP + medir ruido")}function zt(e,n){var t=document.getElementById(e);if(t){var a=160,i=2*Math.PI*74,r=i-n/100*i;t.innerHTML='\n        <svg width="'.concat(a,'" height="').concat(a,'" viewBox="0 0 ').concat(a," ").concat(a,'">\n            \x3c!-- Background circle --\x3e\n            <circle\n                cx="').concat(80,'"\n                cy="').concat(80,'"\n                r="').concat(74,'"\n                fill="none"\n                stroke="#e5e7eb"\n                stroke-width="').concat(12,'"\n            />\n            \x3c!-- Progress circle --\x3e\n            <circle\n                cx="').concat(80,'"\n                cy="').concat(80,'"\n                r="').concat(74,'"\n                fill="none"\n                stroke="#5dc4af"\n                stroke-width="').concat(12,'"\n                stroke-linecap="round"\n                stroke-dasharray="').concat(i,'"\n                stroke-dashoffset="').concat(r,'"\n                transform="rotate(-90 ').concat(80," ").concat(80,')"\n                style="transition: stroke-dashoffset 0.5s ease;"\n            />\n            \x3c!-- Center text --\x3e\n            <text\n                x="').concat(80,'"\n                y="').concat(80,'"\n                text-anchor="middle"\n                dominant-baseline="middle"\n                font-family="Poppins, sans-serif"\n                font-size="36"\n                font-weight="700"\n                fill="#383d47"\n            >').concat(n,"%</text>\n        </svg>\n    ")}}function Rt(){return Tt.apply(this,arguments)}function Tt(){return(Tt=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Intelligence Page..."),oa("inteligencia-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="brain"></i>\n            </div>\n            <h3 class="empty-state__title">Inteligencia de Salud</h3>\n            <p class="empty-state__description">Aún no hay datos disponibles. Complete el wizard de riesgos para generar análisis de salud.</p>\n            <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Iniciar Wizard</a>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jt(){return Dt.apply(this,arguments)}function Dt(){return(Dt=(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Org Map Page..."),(n=document.getElementById("org-chart-canvas"))&&(n.innerHTML='\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="network"></i>\n                </div>\n                <h3 class="empty-state__title">Mapa Organizacional</h3>\n                <p class="empty-state__description">Aún no hay datos disponibles. Agregue cargos para visualizar la estructura organizacional.</p>\n            </div>\n        ',window.lucide&&window.lucide.createIcons());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bt(){return Ht.apply(this,arguments)}function Ht(){return Ht=(0,i.A)(d().mark((function e(){var n,t,a,i,r,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔵 [CARGOS] ========== Loading Cargos Page =========="),oa("cargos-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <div class="skeleton skeleton--circle" style="width:64px;height:64px;"></div>\n            </div>\n            <h3 class="empty-state__title">Cargando cargos...</h3>\n        </div>\n    '),e.next=4,ua();case 4:if(n=e.sent,console.log("🔵 [CARGOS] API result:",n),n&&n.success){e.next=11;break}return console.log("🟡 [CARGOS] No cargos found from API"),oa("cargos-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="users"></i>\n                </div>\n                <h3 class="empty-state__title">Gestión de Cargos</h3>\n                <p class="empty-state__description">Aún no hay cargos registrados. Complete el wizard para agregar cargos a la empresa.</p>\n                <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Agregar Cargos</a>\n            </div>\n        '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 11:if(e.prev=11,t=n.cargos||[],console.log("🔵 [CARGOS] Processing cargos from API:",t.length),0!==t.length){e.next=18;break}return oa("cargos-content",'\n                <div class="empty-state">\n                    <div class="empty-state__icon">\n                        <i data-lucide="users"></i>\n                    </div>\n                    <h3 class="empty-state__title">Sin Cargos</h3>\n                    <p class="empty-state__description">No hay cargos configurados. Agregue cargos en el wizard.</p>\n                    <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Agregar Cargos</a>\n                </div>\n            '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 18:a=t.map((function(e,n){var t=e.riesgosCount||0,a=e.num_trabajadores||0,i=e.nrNivelMaximo||"I",r=e.togglesActivos||[],o=r.map((function(e){return'<span class="badge badge--warning"><i data-lucide="'.concat({Alturas:"mountain",Alimentos:"utensils",Vehiculo:"car","Espacios Conf.":"box"}[e]||"alert-triangle",'" style="width:12px;height:12px;"></i> ').concat(e,"</span>")})).join(""),s={I:"success",II:"info",III:"warning",IV:"danger",V:"danger"}[i]||"muted";return'\n                <div class="card">\n                    <div class="card__header">\n                        <h3 class="card__title">'.concat(e.nombre_cargo||"Cargo "+(n+1),'</h3>\n                        <div class="card__badges">\n                            <span class="badge badge--').concat(t>0?"primary":"muted",'">').concat(t," riesgo").concat(1!==t?"s":"","</span>\n                            ").concat(t>0?'<span class="badge badge--'.concat(s,'">NR ').concat(i,"</span>"):"",'\n                        </div>\n                    </div>\n                    <div class="card__body">\n                        <div class="cargo-info">\n                            <div class="cargo-info__row">\n                                <i data-lucide="map-pin" class="text-muted"></i>\n                                <span>').concat(e.area||"Sin área"," / ").concat(e.zona||"Sin zona",'</span>\n                            </div>\n                            <div class="cargo-info__row">\n                                <i data-lucide="users" class="text-muted"></i>\n                                <span>').concat(a," persona").concat(1!==a?"s":"","</span>\n                            </div>\n                            ").concat(r.length>0?'\n                                <div class="cargo-info__conditions mt-2">\n                                    '.concat(o,"\n                                </div>\n                            "):"",'\n                        </div>\n                    </div>\n                    <div class="card__footer">\n                        <button class="btn btn--sm btn--ghost btn-view-cargo" data-cargo-id="').concat(e.id,"\" data-cargo='").concat(JSON.stringify(e).replace(/'/g,"&#39;"),'\'>\n                            <i data-lucide="eye"></i> Ver detalles\n                        </button>\n                        <button class="btn btn--sm btn--outline btn-edit-cargo" data-cargo-id="').concat(e.id,"\" data-cargo='").concat(JSON.stringify(e).replace(/'/g,"&#39;"),'\'>\n                            <i data-lucide="edit-2"></i> Editar\n                        </button>\n                    </div>\n                </div>\n            ')})).join(""),i=t.reduce((function(e,n){return e+(n.num_trabajadores||0)}),0),r=t.filter((function(e){var n;return null===(n=e.togglesActivos)||void 0===n?void 0:n.includes("Alturas")})).length,t.filter((function(e){var n;return null===(n=e.togglesActivos)||void 0===n?void 0:n.includes("Espacios Conf.")})).length,o=t.reduce((function(e,n){return e+(n.riesgosCount||0)}),0),oa("cargos-content",'\n            <div class="dashboard-grid dashboard-grid--cols-4 mb-6">\n                <div class="card card--stat">\n                    <div class="stat-value">'.concat(t.length,'</div>\n                    <div class="stat-label">Total Cargos</div>\n                </div>\n                <div class="card card--stat">\n                    <div class="stat-value">').concat(i,'</div>\n                    <div class="stat-label">Total Personas</div>\n                </div>\n                <div class="card card--stat">\n                    <div class="stat-value">').concat(o,'</div>\n                    <div class="stat-label">Total Riesgos</div>\n                </div>\n                <div class="card card--stat card--warning">\n                    <div class="stat-value stat-value--warning">').concat(r,'</div>\n                    <div class="stat-label">Trabajo en Alturas</div>\n                </div>\n            </div>\n            <div class="dashboard-grid dashboard-grid--cols-3">\n                ').concat(a,'\n            </div>\n            <div class="text-center mt-6">\n                <button class="btn btn--primary btn-nuevo-cargo-inline">\n                    <i data-lucide="plus"></i> Agregar Cargo\n                </button>\n            </div>\n        ')),window.lucide&&window.lucide.createIcons(),wa(),e.next=33;break;case 28:e.prev=28,e.t0=e.catch(11),console.error("Error loading cargos:",e.t0),oa("cargos-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="alert-circle"></i>\n                </div>\n                <h3 class="empty-state__title">Error</h3>\n                <p class="empty-state__description">Hubo un error al cargar los cargos.</p>\n            </div>\n        '),window.lucide&&window.lucide.createIcons();case 33:case"end":return e.stop()}}),e,null,[[11,28]])}))),Ht.apply(this,arguments)}function Ut(){return qt.apply(this,arguments)}function qt(){return(qt=(0,i.A)(d().mark((function e(){var t,a,i,r,o,s,c,l,u,p,m,g,v,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("🔵 [EXAMENES] ========== Loading Examenes Page =========="),t=sa(),console.log("🔵 [EXAMENES] wizardData:",t?"found":"not found"),t){e.next=13;break}return ca("examenes-stat-vencidos","0"),ca("examenes-stat-proximos","0"),ca("examenes-stat-aldia","0"),ca("examenes-stat-agendar","0"),ca("examenes-showing","Mostrando 0 de 0"),(a=document.getElementById("examenes-table-body"))&&(a.innerHTML='\n                <tr>\n                    <td colspan="7" class="table-empty">\n                        <div class="empty-state empty-state--inline">\n                            <i data-lucide="clipboard-list"></i>\n                            <span>Complete el wizard para ver los exámenes recomendados por cargo</span>\n                        </div>\n                    </td>\n                </tr>\n            '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 13:if(e.prev=13,i=t.formData||{},r=i.cargos||[],console.log("🔵 [EXAMENES] Processing cargos:",r.length),0!==r.length){e.next=28;break}return console.log("🟡 [EXAMENES] No cargos found"),ca("examenes-stat-vencidos","0"),ca("examenes-stat-proximos","0"),ca("examenes-stat-aldia","0"),ca("examenes-stat-agendar","0"),ca("examenes-showing","Mostrando 0 de 0"),(o=document.getElementById("examenes-table-body"))&&(o.innerHTML='\n                    <tr>\n                        <td colspan="7" class="table-empty">\n                            <div class="empty-state empty-state--inline">\n                                <i data-lucide="users"></i>\n                                <span>No hay cargos configurados. Agregue cargos en el wizard.</span>\n                            </div>\n                        </td>\n                    </tr>\n                '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 28:s={EMO:"Examen Médico Ocupacional",EMOA:"EMO con énfasis en Alturas",EMOMP:"EMO Manipuladores de Alimentos",OPTO:"Visiometría",AUD:"Audiometría",ECG:"Electrocardiograma",GLI:"Glicemia",PL:"Perfil Lipídico",PE:"Prueba de Esfuerzo",ESP:"Espirometría",PSM:"Prueba Psicosensométrica",PST:"Prueba Psicotécnica",FRO:"Frotis de Garganta",KOH:"KOH (Examen Hongos)",COP:"Coprológico"},c=["EMO","OPTO","AUD"],l={trabajaAlturas:["EMOA","GLI","PL","PE","ESP","ECG"],manipulaAlimentos:["EMOMP","FRO","KOH","COP"],conduceVehiculo:["PSM","PSP","GLI","PL"],trabajaEspaciosConfinados:["EMO","ESP","ECG","GLI","PL","PSM"],espaciosConfinados:["EMO","ESP","ECG","GLI","PL","PSM"]},u=0,p=0,m=[],r.forEach((function(e){var t=new Set(c);Object.entries(l).forEach((function(a){var i=n(a,2),r=i[0],o=i[1];e[r]&&o.forEach((function(e){return t.add(e)}))})),(e.gesSeleccionados||e.ges||[]).forEach((function(e){e.examenesMedicos&&Object.keys(e.examenesMedicos).forEach((function(e){return t.add(e)}))}));var a=Array.from(t),i=e.numPersonas||e.numTrabajadores||1;a.forEach((function(n){u++,p++,m.push('\n                    <tr>\n                        <td><input type="checkbox" class="examen-checkbox" data-cargo="'.concat(e.nombre,'" data-examen="').concat(n,'" /></td>\n                        <td>--</td>\n                        <td>\n                            <div class="cell-cargo">\n                                <strong>').concat(e.nombre||"Sin nombre",'</strong>\n                                <span class="text-xs text-muted">').concat(i," persona").concat(1!==i?"s":"",'</span>\n                            </div>\n                        </td>\n                        <td>\n                            <span class="badge badge--primary">').concat(n,'</span>\n                            <span class="text-sm">').concat(s[n]||n,'</span>\n                        </td>\n                        <td class="text-muted">Por programar</td>\n                        <td><span class="badge badge--warning">Por agendar</span></td>\n                        <td>\n                            <button class="btn btn--icon btn--sm" title="Agendar examen">\n                                <i data-lucide="calendar-plus"></i>\n                            </button>\n                        </td>\n                    </tr>\n                '))}))})),ca("examenes-stat-vencidos","0"),ca("examenes-stat-proximos","0"),ca("examenes-stat-aldia","0"),ca("examenes-stat-agendar",p.toString()),ca("examenes-showing","Mostrando ".concat(u," de ").concat(u)),(g=document.getElementById("filter-cargo"))&&(g.innerHTML='<option value="">Cargo: Todos</option>',r.forEach((function(e){g.innerHTML+='<option value="'.concat(e.nombre,'">').concat(e.nombre,"</option>")}))),(v=document.getElementById("examenes-table-body"))&&(m.length>0?v.innerHTML=m.join(""):v.innerHTML='\n                    <tr>\n                        <td colspan="7" class="table-empty">\n                            <div class="empty-state empty-state--inline">\n                                <i data-lucide="check-circle"></i>\n                                <span>No hay exámenes pendientes</span>\n                            </div>\n                        </td>\n                    </tr>\n                '),window.lucide&&window.lucide.createIcons(),e.next=53;break;case 47:e.prev=47,e.t0=e.catch(13),console.error("Error loading examenes:",e.t0),(h=document.getElementById("examenes-table-body"))&&(h.innerHTML='\n                <tr>\n                    <td colspan="7" class="table-empty">\n                        <div class="empty-state empty-state--inline">\n                            <i data-lucide="alert-circle"></i>\n                            <span>Error al cargar los exámenes</span>\n                        </div>\n                    </td>\n                </tr>\n            '),window.lucide&&window.lucide.createIcons();case 53:case"end":return e.stop()}}),e,null,[[13,47]])})))).apply(this,arguments)}function Ft(){return $t.apply(this,arguments)}function $t(){return($t=(0,i.A)(d().mark((function e(){var n,t,a,i,r,o,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔵 [MATRIZ] ========== Loading Matriz Page =========="),e.next=3,ma();case 3:if(n=e.sent,console.log("🔵 [MATRIZ] API result:",n),ca("matriz-fecha",(new Date).toLocaleDateString("es-CO")),t=localStorage.getItem("genesys_empresa"),a="Sin asignar",t)try{i=JSON.parse(t),a=i.nombre_legal||i.razon_social||i.nombre||"Sin asignar"}catch(e){}if(ca("matriz-responsable",a),n&&n.success){e.next=14;break}return(r=document.getElementById("matriz-dashboard-container"))&&(r.innerHTML='\n                <div class="matriz-empty-state">\n                    <div class="matriz-empty-state__icon">\n                        <i data-lucide="layout-grid"></i>\n                    </div>\n                    <h3 class="matriz-empty-state__title">Matriz de Riesgos GTC-45</h3>\n                    <p class="matriz-empty-state__description">\n                        Aún no hay peligros identificados. Complete el wizard para generar la matriz de riesgos.\n                    </p>\n                    <a href="/pages/wizard_riesgos.html" class="btn btn--primary">\n                        <i data-lucide="plus"></i>\n                        Crear Matriz\n                    </a>\n                </div>\n            ',window.lucide&&window.lucide.createIcons()),e.abrupt("return");case 14:return e.prev=14,o=new Be("matriz-dashboard-container"),e.next=18,o.init(n);case 18:console.log("🟢 [MATRIZ] Component initialized successfully"),Gt(n.documento),e.next=27;break;case 22:e.prev=22,e.t0=e.catch(14),console.error("🔴 [MATRIZ] Error initializing component:",e.t0),(s=document.getElementById("matriz-dashboard-container"))&&(s.innerHTML='\n                <div class="matriz-empty-state">\n                    <div class="matriz-empty-state__icon">\n                        <i data-lucide="alert-circle"></i>\n                    </div>\n                    <h3 class="matriz-empty-state__title">Error al cargar</h3>\n                    <p class="matriz-empty-state__description">\n                        Hubo un error al cargar los datos de la matriz. Intente recargar la página.\n                    </p>\n                </div>\n            ',window.lucide&&window.lucide.createIcons());case 27:case"end":return e.stop()}}),e,null,[[14,22]])})))).apply(this,arguments)}function Gt(e){var n=document.getElementById("btn-export-matriz-excel");if(n){var t=n.cloneNode(!0);n.parentNode.replaceChild(t,n),e&&e.excelUrl?t.addEventListener("click",(function(){var n=document.createElement("a");n.href=e.excelUrl,n.download=e.excelUrl.split("/").pop()||"Matriz_GTC45.xlsx",n.target="_blank",document.body.appendChild(n),n.click(),n.remove()})):t.style.display="none"}}function Vt(){return Jt.apply(this,arguments)}function Jt(){return(Jt=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Estadisticas Page..."),oa("estadisticas-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="bar-chart-3"></i>\n            </div>\n            <h3 class="empty-state__title">Perfil Sociodemográfico</h3>\n            <p class="empty-state__description">Aún no hay datos disponibles. El perfil se generará automáticamente con los datos de trabajadores.</p>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(){return Xt.apply(this,arguments)}function Xt(){return(Xt=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading SVE Page..."),oa("sve-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="activity"></i>\n            </div>\n            <h3 class="empty-state__title">Sistema de Vigilancia Epidemiológica</h3>\n            <p class="empty-state__description">Aún no hay SVE configurados. Se generarán automáticamente basados en los riesgos identificados.</p>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zt(){return Kt.apply(this,arguments)}function Kt(){return(Kt=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Psicosocial Page..."),oa("psicosocial-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="flask-conical"></i>\n            </div>\n            <h3 class="empty-state__title">Batería de Riesgo Psicosocial</h3>\n            <p class="empty-state__description">Aún no hay baterías aplicadas. Configure la empresa para comenzar la evaluación psicosocial.</p>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yt(){return Qt.apply(this,arguments)}function Qt(){return(Qt=(0,i.A)(d().mark((function e(){var t,a,i,r,o,s,c,l,u,p,m,g,v,h,f,b;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("🔵 [DOCUMENTOS] ========== Loading Documentos Page =========="),t=localStorage.getItem("genesys_empresa"),a=sa(),console.log("🔵 [DOCUMENTOS] wizardData:",a?"found":"not found"),i=[],!t){e.next=23;break}if(e.prev=6,!(r=JSON.parse(t)).id){e.next=18;break}return o=localStorage.getItem("authToken")||localStorage.getItem("genesys_token"),e.next=12,fetch("/api/documentos/empresa/".concat(r.id),{headers:o?{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"}:{"Content-Type":"application/json"}});case 12:if(!(s=e.sent).ok){e.next=18;break}return e.next=16,s.json();case 16:(c=e.sent).success&&c.documents&&(i=c.documents);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),console.warn("Error fetching documents from API:",e.t0);case 23:if(!(l=localStorage.getItem("genesys_pending_document_token"))||0!==i.length){e.next=39;break}return e.prev=25,e.next=28,fetch("/api/documentos/status/".concat(l));case 28:if(!(u=e.sent).ok){e.next=34;break}return e.next=32,u.json();case 32:(p=e.sent).success&&i.push({token_acceso:l,estado:p.status,preview_urls:p.urls||{},metadata:p.metadata||{},created_at:(new Date).toISOString()});case 34:e.next=39;break;case 36:e.prev=36,e.t1=e.catch(25),console.warn("Error fetching pending document:",e.t1);case 39:if(0!==i.length||!a){e.next=50;break}if(m=a.formData||{},g=m.cargos||[],console.log("🔵 [DOCUMENTOS] Wizard cargos:",g.length),!(g.length>0)){e.next=50;break}return v=0,h=0,g.forEach((function(e){var n;v+=(null===(n=e.ges)||void 0===n?void 0:n.length)||0,h+=e.numPersonas||0})),oa("documentos-content",'\n                <div class="alert-banner alert-banner--info mb-6">\n                    <i data-lucide="info"></i>\n                    <span>\n                        <strong>'.concat(m.nombreEmpresa||"Sin nombre","</strong> · NIT: ").concat(m.nit||"N/A"," ·\n                        ").concat(g.length," cargo(s), ").concat(h," trabajadores, ").concat(v,' riesgos identificados\n                    </span>\n                </div>\n\n                <div class="dashboard-section mb-6">\n                    <h2 class="dashboard-section__title">Documentos Disponibles para Generar</h2>\n                    <div class="dashboard-grid dashboard-grid--cols-4">\n                        <div class="card">\n                            <div class="card__body text-center">\n                                <i data-lucide="file-spreadsheet" style="width:48px;height:48px;color:#10b981;margin-bottom:16px;"></i>\n                                <h3 class="card__title">Matriz GTC-45</h3>\n                                <p class="text-muted text-sm mb-4">Excel con ').concat(v,' peligros identificados</p>\n                                <span class="badge badge--success">Listo para generar</span>\n                            </div>\n                        </div>\n                        <div class="card">\n                            <div class="card__body text-center">\n                                <i data-lucide="file-text" style="width:48px;height:48px;color:#5dc4af;margin-bottom:16px;"></i>\n                                <h3 class="card__title">Profesiograma</h3>\n                                <p class="text-muted text-sm mb-4">PDF para ').concat(g.length,' cargo(s)</p>\n                                <span class="badge badge--success">Listo para generar</span>\n                            </div>\n                        </div>\n                        <div class="card">\n                            <div class="card__body text-center">\n                                <i data-lucide="user-check" style="width:48px;height:48px;color:#f59e0b;margin-bottom:16px;"></i>\n                                <h3 class="card__title">Perfil de Cargo</h3>\n                                <p class="text-muted text-sm mb-4">Requisitos por cargo</p>\n                                <span class="badge badge--success">Listo para generar</span>\n                            </div>\n                        </div>\n                        <div class="card">\n                            <div class="card__body text-center">\n                                <i data-lucide="receipt" style="width:48px;height:48px;color:#6366f1;margin-bottom:16px;"></i>\n                                <h3 class="card__title">Cotización</h3>\n                                <p class="text-muted text-sm mb-4">Presupuesto de exámenes</p>\n                                <span class="badge badge--success">Listo para generar</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="dashboard-section mb-6">\n                    <h2 class="dashboard-section__title">Resumen de Cargos</h2>\n                    <div class="table-container">\n                        <table class="data-table">\n                            <thead>\n                                <tr>\n                                    <th>Cargo</th>\n                                    <th>Área</th>\n                                    <th>Zona</th>\n                                    <th>Trabajadores</th>\n                                    <th>Riesgos GES</th>\n                                    <th>Especial</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ').concat(g.map((function(e){var n;return"\n                                    <tr>\n                                        <td><strong>".concat(e.nombre||"Sin nombre","</strong></td>\n                                        <td>").concat(e.area||"N/A","</td>\n                                        <td>").concat(e.zona||"N/A","</td>\n                                        <td>").concat(e.numPersonas||0,'</td>\n                                        <td><span class="badge badge--primary">').concat((null===(n=e.ges)||void 0===n?void 0:n.length)||0,"</span></td>\n                                        <td>\n                                            ").concat(e.trabajaAlturas?'<span class="badge badge--warning" title="Trabajo en alturas">🪜</span>':"","\n                                            ").concat(e.manipulaAlimentos?'<span class="badge badge--info" title="Manipula alimentos">🍽️</span>':"","\n                                            ").concat(e.conduceVehiculo?'<span class="badge badge--secondary" title="Conduce vehículo">🚗</span>':"","\n                                            ").concat(e.trabajaEspaciosConfinados?'<span class="badge badge--danger" title="Espacios confinados">⚠️</span>':"","\n                                            ").concat(e.trabajaAlturas||e.manipulaAlimentos||e.conduceVehiculo||e.trabajaEspaciosConfinados?"":"-","\n                                        </td>\n                                    </tr>\n                                ")})).join(""),'\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n\n                <div class="text-center mt-6">\n                    <a href="/pages/wizard_riesgos.html" class="btn btn--primary btn--lg">\n                        <i data-lucide="zap"></i>\n                        Ir al Wizard para Generar Documentos\n                    </a>\n                </div>\n            ')),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 50:i.length>0?(f={matriz:{icon:"file-spreadsheet",label:"Matriz GTC-45",color:"#10b981"},profesiograma:{icon:"file-text",label:"Profesiograma",color:"#5dc4af"},perfil:{icon:"user-check",label:"Perfil de Cargo",color:"#f59e0b"},cotizacion:{icon:"receipt",label:"Cotización",color:"#6366f1"}},b=i.map((function(e){var t=e.preview_urls||{},a=e.metadata||{},i=new Date(e.created_at).toLocaleDateString("es-CO"),r="pagado"===e.estado?"Pagado":"completado"===e.estado?"Completado":"Pendiente",o="pagado"===e.estado?"success":"completado"===e.estado?"primary":"warning",s=Object.entries(t).filter((function(e){return"thumbnails"!==n(e,1)[0]})).map((function(e){var t=n(e,2),a=t[0],i=t[1],r=f[a]||{icon:"file",label:a,color:"#6b7280"};return'\n                    <div class="card card--document">\n                        <div class="card__body">\n                            <div class="document-icon" style="color:'.concat(r.color,';">\n                                <i data-lucide="').concat(r.icon,'"></i>\n                            </div>\n                            <div class="document-info">\n                                <h4>').concat(r.label,'</h4>\n                                <span class="text-xs text-muted">').concat("matriz"===a?"Excel":"PDF",'</span>\n                            </div>\n                            <a href="').concat(i,'" target="_blank" class="btn btn--sm btn--primary" download>\n                                <i data-lucide="download"></i>\n                            </a>\n                        </div>\n                    </div>\n                ')})).join("");return'\n                <div class="card mb-4">\n                    <div class="card__header">\n                        <div>\n                            <h3 class="card__title">'.concat(a.nombreEmpresa||"Empresa",'</h3>\n                            <span class="text-sm text-muted">Generado: ').concat(i," · ").concat(a.numCargos||0,' cargos</span>\n                        </div>\n                        <span class="badge badge--').concat(o,'">').concat(r,'</span>\n                    </div>\n                    <div class="card__body">\n                        <div class="dashboard-grid dashboard-grid--cols-4">\n                            ').concat(s||'<p class="text-muted">Sin documentos disponibles</p>',"\n                        </div>\n                    </div>\n                </div>\n            ")})).join(""),oa("documentos-content",'\n            <div class="dashboard-section">\n                <h2 class="dashboard-section__title">Documentos Generados</h2>\n                '.concat(b,'\n            </div>\n            <div class="text-center mt-6">\n                <a href="/pages/wizard_riesgos.html" class="btn btn--outline">\n                    <i data-lucide="plus"></i>\n                    Generar Nuevos Documentos\n                </a>\n            </div>\n        '))):oa("documentos-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="folder-open"></i>\n                </div>\n                <h3 class="empty-state__title">Centro de Documentos</h3>\n                <p class="empty-state__description">Aún no hay documentos generados. Complete el wizard para generar profesiogramas, matrices y más.</p>\n                <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Generar Documentos</a>\n            </div>\n        '),window.lucide&&window.lucide.createIcons();case 52:case"end":return e.stop()}}),e,null,[[6,20],[25,36]])})))).apply(this,arguments)}function ea(){return na.apply(this,arguments)}function na(){return(na=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Config Page..."),oa("config-content",'\n        <div class="card">\n            <div class="card__header">\n                <h3 class="card__title">Configuración de Empresa</h3>\n            </div>\n            <div class="card__body">\n                <p class="text-muted">La configuración se habilitará cuando la empresa esté registrada en el sistema.</p>\n            </div>\n        </div>\n    ');case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ta(){return aa.apply(this,arguments)}function aa(){return(aa=(0,i.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Panel Medico Page..."),ca("medico-info","Sin médico asignado"),oa("panel-medico-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="stethoscope"></i>\n            </div>\n            <h3 class="empty-state__title">Panel Médico Ocupacional</h3>\n            <p class="empty-state__description">Este panel es exclusivo para médicos ocupacionales. Contacte al administrador para obtener acceso.</p>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ia(){return ra.apply(this,arguments)}function ra(){return ra=(0,i.A)(d().mark((function e(){var t,a,i,r,o,s,c,l,u,p;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔵 [PROFESIOGRAMA] ========== Loading Profesiograma Page =========="),oa("profesiograma-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <div class="skeleton skeleton--circle" style="width:64px;height:64px;"></div>\n            </div>\n            <h3 class="empty-state__title">Cargando profesiograma...</h3>\n        </div>\n    '),e.next=4,ua();case 4:if(t=e.sent,console.log("🔵 [PROFESIOGRAMA] API result:",t),t&&t.success){e.next=10;break}return oa("profesiograma-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="file-text"></i>\n                </div>\n                <h3 class="empty-state__title">Sin Profesiograma</h3>\n                <p class="empty-state__description">Aún no has generado un profesiograma. Usa el asistente para crear uno.</p>\n                <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Crear Profesiograma</a>\n            </div>\n        '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 10:if(e.prev=10,i=t.cargos||[],console.log("🔵 [PROFESIOGRAMA] Processing cargos from API:",i.length),0!==i.length){e.next=18;break}return console.log("🟡 [PROFESIOGRAMA] No cargos found"),oa("profesiograma-content",'\n                <div class="empty-state">\n                    <div class="empty-state__icon">\n                        <i data-lucide="file-text"></i>\n                    </div>\n                    <h3 class="empty-state__title">Sin Cargos Configurados</h3>\n                    <p class="empty-state__description">No hay cargos en el profesiograma. Completa el wizard para agregar cargos.</p>\n                    <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Ir al Wizard</a>\n                </div>\n            '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 18:if(r=localStorage.getItem("genesys_empresa"),o={nombre:"Empresa",nit:"--"},s=(null===(a=i[0])||void 0===a?void 0:a.documento_id)||null,r)try{c=JSON.parse(r),o={nombre:c.nombre_legal||c.razon_social||c.nombre||"Empresa",nit:c.nit||"--"}}catch(e){}l=i.map((function(e,t){var a=e.riesgosCount||0,i=e.togglesActivos||[],r=e.nrNivelMaximo||"I",o=e.conteoNiveles||{},s=e.examenesMedicos||[];console.log("🔬 [CARGO ".concat(t+1,'] "').concat(e.nombre_cargo,'":'),{riesgosCount:a,examenesMedicosCount:s.length,examenesMedicos:s});var c={I:"success",II:"info",III:"warning",IV:"danger",V:"danger"}[r]||"muted",l=i.map((function(e){return{Alturas:{icon:"mountain",label:"Alturas"},Alimentos:{icon:"utensils",label:"Alimentos"},Vehiculo:{icon:"car",label:"Conducción"},"Espacios Conf.":{icon:"box",label:"Esp. Confinados"}}[e]||{icon:"alert-triangle",label:e}})),d=Object.entries(o).filter((function(e){return n(e,2)[1]>0})).map((function(e){var t=n(e,2),a=t[0],i=t[1];return'<span class="badge badge--'.concat({I:"success",II:"info",III:"warning",IV:"danger",V:"danger"}[a]||"muted",'">').concat(i," NR-").concat(a,"</span>")})).join(" "),u=s.length>0?s.map((function(e){return'\n                    <div class="exam-item">\n                        <div class="exam-item__header">\n                            <span class="exam-item__name">'.concat(e.nombre,'</span>\n                            <span class="badge badge--').concat(1===e.prioridad?"danger":"info",' badge--sm">').concat(e.tipo,'</span>\n                        </div>\n                        <div class="exam-item__footer">\n                            <span class="exam-item__periodicidad">\n                                <i data-lucide="calendar" style="width:12px;height:12px;"></i>\n                                ').concat(e.periodicidad,"\n                            </span>\n                        </div>\n                    </div>\n                ")})).join(""):'<p class="text-muted text-sm">No hay exámenes médicos asignados para este cargo.</p>';return'\n                <div class="card card--profesiograma">\n                    <div class="card__header">\n                        <div>\n                            <h3 class="card__title">'.concat(e.nombre_cargo||"Cargo "+(t+1),'</h3>\n                            <span class="text-sm text-muted">').concat(e.area||"Sin área"," · ").concat(e.zona||"Sin zona"," · ").concat(e.num_trabajadores||0,' persona(s)</span>\n                        </div>\n                        <div class="card__badges">\n                            <span class="badge badge--').concat(a>0?"primary":"muted",'">').concat(a," Riesgos</span>\n                            ").concat(a>0?'<span class="badge badge--'.concat(c,'">NR Max: ').concat(r,"</span>"):"",'\n                        </div>\n                    </div>\n                    <div class="card__body">\n                        ').concat(l.length>0?'\n                            <div class="profesiograma-section mb-4">\n                                <p class="profesiograma-section__title">\n                                    <i data-lucide="alert-triangle" style="width:16px;height:16px;color:#f59e0b;"></i>\n                                    Condiciones Especiales\n                                </p>\n                                <div class="flex gap-2 flex-wrap">\n                                    '.concat(l.map((function(e){return'<span class="badge badge--warning"><i data-lucide="'.concat(e.icon,'" style="width:12px;height:12px;"></i> ').concat(e.label,"</span>")})).join(""),"\n                                </div>\n                            </div>\n                        "):"","\n\n                        ").concat(a>0?'\n                            <div class="profesiograma-section mb-4">\n                                <p class="profesiograma-section__title">\n                                    <i data-lucide="shield-alert" style="width:16px;height:16px;color:#ef4444;"></i>\n                                    Distribución de Riesgos\n                                </p>\n                                <div class="flex gap-2 flex-wrap">\n                                    '.concat(d||'<span class="badge badge--muted">Sin clasificar</span>',"\n                                </div>\n                            </div>\n                        "):"",'\n\n                        <div class="profesiograma-section">\n                            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">\n                                <p class="profesiograma-section__title" style="margin-bottom:0;">\n                                    <i data-lucide="stethoscope" style="width:16px;height:16px;color:#10b981;"></i>\n                                    Exámenes Médicos Requeridos\n                                    ').concat(s.length>0?'<span class="badge badge--sm badge--success" style="margin-left:8px;">'.concat(s.length,"</span>"):"","\n                                </p>\n                                ").concat(s.length>0?'\n                                    <button class="btn btn--outline btn--sm" style="padding:4px 12px;font-size:12px;" onclick="alert(\'Función de descarga en desarrollo\')">\n                                        <i data-lucide="download" style="width:12px;height:12px;"></i>\n                                        Descargar Excel\n                                    </button>\n                                ':"",'\n                            </div>\n                            <div class="exams-grid">\n                                ').concat(u,"\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ")})).join(""),u=i.reduce((function(e,n){return e+(n.num_trabajadores||0)}),0),p=i.reduce((function(e,n){return e+(n.riesgosCount||0)}),0),oa("profesiograma-content",'\n            <div class="dashboard-grid dashboard-grid--cols-4 mb-6">\n                <div class="card card--stat">\n                    <div class="stat-value">'.concat(i.length,'</div>\n                    <div class="stat-label">Cargos</div>\n                </div>\n                <div class="card card--stat">\n                    <div class="stat-value">').concat(u,'</div>\n                    <div class="stat-label">Trabajadores</div>\n                </div>\n                <div class="card card--stat">\n                    <div class="stat-value">').concat(p,'</div>\n                    <div class="stat-label">Riesgos Identificados</div>\n                </div>\n                <div class="card card--stat card--highlight">\n                    <div class="stat-value stat-value--primary">').concat(t.total||i.length,'</div>\n                    <div class="stat-label">Total BD</div>\n                </div>\n            </div>\n\n            <div class="card card--company mb-6">\n                <div class="card__body" style="display:flex;align-items:center;gap:24px;">\n                    <div class="company-logo" style="width:64px;height:64px;background:#5dc4af;border-radius:12px;display:flex;align-items:center;justify-content:center;">\n                        <i data-lucide="building-2" style="width:32px;height:32px;color:#fff;"></i>\n                    </div>\n                    <div>\n                        <h2 style="margin:0 0 4px;">').concat(o.nombre,'</h2>\n                        <p class="text-muted" style="margin:0;">NIT: ').concat(o.nit,'</p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="dashboard-section">\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">\n                    <h2 class="dashboard-section__title" style="margin: 0;">Protocolo de Vigilancia por Cargo</h2>\n                    <div>\n                        <a href="/pages/wizard_riesgos.html" class="btn btn--outline mr-3">\n                            <i data-lucide="edit"></i> Editar en Wizard\n                        </a>\n                        <a href="/pages/profesiograma_view.html').concat(s?"?documento_id="+s:"",'" class="btn btn--primary">\n                            <i data-lucide="eye"></i> Ver Profesiograma Completo\n                        </a>\n                    </div>\n                </div>\n                <div class="dashboard-grid dashboard-grid--cols-2">\n                    ').concat(l,"\n                </div>\n            </div>\n        ")),window.lucide&&window.lucide.createIcons(),e.next=34;break;case 29:e.prev=29,e.t0=e.catch(10),console.error("Error loading profesiograma:",e.t0),oa("profesiograma-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="alert-circle"></i>\n                </div>\n                <h3 class="empty-state__title">Error al cargar</h3>\n                <p class="empty-state__description">Hubo un error al cargar los datos del profesiograma.</p>\n            </div>\n        '),window.lucide&&window.lucide.createIcons();case 34:case"end":return e.stop()}}),e,null,[[10,29]])}))),ra.apply(this,arguments)}function oa(e,n){console.log("🟢 [showPageContent] containerId:",e);var t=document.getElementById(e);console.log("🟢 [showPageContent] container found:",!!t),t?(t.innerHTML=n,console.log("🟢 [showPageContent] HTML set, length:",n.length),console.log("🟢 [showPageContent] First 200 chars:",n.substring(0,200))):(console.error("🔴 [showPageContent] Container NOT FOUND:",e),console.error("🔴 [showPageContent] Available elements with IDs:",Array.from(document.querySelectorAll("[id]")).map((function(e){return e.id})).join(", ")))}function sa(){var e=localStorage.getItem("genesys_wizard_state");if(!e)return console.warn("🟡 [getWizardData] No wizard state in localStorage"),null;try{var n=JSON.parse(e);return console.log("🟢 [getWizardData] Successfully parsed wizard state"),n}catch(e){return console.error("🔴 [getWizardData] Error parsing:",e),null}}function ca(e,n){var t=document.getElementById(e);t&&(t.textContent=n)}function la(){var e=localStorage.getItem("authToken")||localStorage.getItem("genesys_token");return{"Content-Type":"application/json",Authorization:e?"Bearer ".concat(e):""}}function da(){var e=localStorage.getItem("genesys_empresa");if(e)try{var n=JSON.parse(e);return console.log("🔵 [API] Empresa ID:",n.id),n.id}catch(e){console.error("🔴 [API] Error parsing empresa:",e)}return null}function ua(){return pa.apply(this,arguments)}function pa(){return(pa=(0,i.A)(d().mark((function e(){var n,t,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=da()){e.next=4;break}return console.warn("🟡 [API] No empresa ID, cannot fetch cargos"),e.abrupt("return",null);case 4:return e.prev=4,console.log("🔵 [API] Fetching cargos for empresa:",n),e.next=8,fetch("/api/cargos/empresa/".concat(n),{headers:la()});case 8:if((t=e.sent).ok){e.next=12;break}return console.error("🔴 [API] Error fetching cargos:",t.status),e.abrupt("return",null);case 12:return e.next=14,t.json();case 14:return a=e.sent,console.log("🟢 [API] Cargos fetched:",a),yt.data.cargos=a.cargos||[],yt.companyId=n,e.abrupt("return",a);case 21:return e.prev=21,e.t0=e.catch(4),console.error("🔴 [API] Error fetching cargos:",e.t0),e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,null,[[4,21]])})))).apply(this,arguments)}function ma(){return ga.apply(this,arguments)}function ga(){return(ga=(0,i.A)(d().mark((function e(){var n,t,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=da()){e.next=4;break}return console.warn("🟡 [API] No empresa ID, cannot fetch matriz"),e.abrupt("return",null);case 4:return e.prev=4,console.log("🔵 [API] Fetching matriz for empresa:",n),e.next=8,fetch("/api/cargos/matriz-gtc45/".concat(n),{headers:la()});case 8:if((t=e.sent).ok){e.next=12;break}return console.error("🔴 [API] Error fetching matriz:",t.status),e.abrupt("return",null);case 12:return e.next=14,t.json();case 14:return a=e.sent,console.log("🟢 [API] Matriz fetched:",a),yt.data.matriz=a,e.abrupt("return",a);case 20:return e.prev=20,e.t0=e.catch(4),console.error("🔴 [API] Error fetching matriz:",e.t0),e.abrupt("return",null);case 24:case"end":return e.stop()}}),e,null,[[4,20]])})))).apply(this,arguments)}function va(){var e=document.getElementById("user-menu"),n=document.getElementById("user-dropdown"),t=document.getElementById("btn-logout");e&&n&&(e.addEventListener("click",(function(t){t.stopPropagation(),n.classList.toggle("open"),e.classList.toggle("open")})),document.addEventListener("click",(function(t){e.contains(t.target)||(n.classList.remove("open"),e.classList.remove("open"))})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&(n.classList.remove("open"),e.classList.remove("open"))}))),t&&t.addEventListener("click",(function(e){e.preventDefault(),ha()}));var a=document.getElementById("sidebar-logout");a&&a.addEventListener("click",(function(e){e.preventDefault(),ha()})),function(){var e=document.getElementById("user-avatar"),n=document.getElementById("user-name"),t=document.getElementById("user-email"),a=localStorage.getItem("genesys_user")||localStorage.getItem("userData"),i=localStorage.getItem("genesys_empresa");if(a)try{var r=JSON.parse(a);if(e&&r.nombre){var o=r.nombre.split(" ").map((function(e){return e[0]})).slice(0,2).join("").toUpperCase();e.textContent=o}n&&r.nombre&&(n.textContent=r.nombre),t&&r.email&&(t.textContent=r.email)}catch(e){console.warn("Error parsing user data:",e)}else if(i)try{var s=JSON.parse(i);if(e&&s.razon_social){var c=s.razon_social.split(" ").map((function(e){return e[0]})).slice(0,2).join("").toUpperCase();e.textContent=c}n&&s.razon_social&&(n.textContent=s.razon_social),t&&s.email&&(t.textContent=s.email)}catch(e){console.warn("Error parsing empresa data:",e)}else e&&(e.textContent="US"),n&&(n.textContent="Usuario"),t&&(t.textContent="usuario@empresa.com")}()}function ha(){localStorage.removeItem("genesys_token"),localStorage.removeItem("genesys_user"),localStorage.removeItem("genesys_empresa"),localStorage.removeItem("genesys_auth_type"),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),sessionStorage.clear(),window.location.href="/pages/login.html"}function fa(){return ba.apply(this,arguments)}function ba(){return ba=(0,i.A)(d().mark((function e(){var n,t,a,r,o,s,c,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[Dashboard] Loading company data..."),n=function(){var e=(0,i.A)(d().mark((function e(n){var t,a,i,r,o,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n||localStorage.getItem("empresaId"),a=localStorage.getItem("authToken"),!t||!a){e.next=21;break}return e.prev=3,e.next=6,fetch("/api/documentos/empresa/".concat(t),{headers:{Authorization:"Bearer ".concat(a)}});case 6:if(!(i=e.sent).ok){e.next=16;break}return e.next=10,i.json();case 10:if(!((r=e.sent).success&&r.documents&&r.documents.length>0)){e.next=16;break}return console.log("[Dashboard] Enriched data from API with",r.documents.length,"documents"),o=r.documents[0],s=o.metadata||{},e.abrupt("return",{sector:s.sector,actividad_economica:s.actividadEconomica,responsable:s.nombreResponsable,nombre_responsable:o.nombre_responsable,numCargos:s.numCargos});case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),console.warn("[Dashboard] Error enriching from API:",e.t0);case 21:return e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(n){return e.apply(this,arguments)}}(),t=da(),console.log("[Dashboard] Logged-in empresa ID:",t),!(a=localStorage.getItem("genesys_empresa"))){e.next=23;break}return e.prev=6,r=JSON.parse(a),console.log("[Dashboard] Found empresa from login:",r),e.next=11,n();case 11:if(!(o=e.sent)){e.next=16;break}return ya((s=bt(bt({},r),{},{sector:o.sector||r.sector||"-",actividad_economica:o.actividad_economica||r.actividad_economica||"-",responsable:o.responsable||o.nombre_responsable||r.responsable||"-",numCargos:o.numCargos||0})).nombre_legal||s.razon_social,s),e.abrupt("return",s);case 16:return ya(r.nombre_legal||r.razon_social||r.nombre,r),e.abrupt("return",r);case 20:e.prev=20,e.t0=e.catch(6),console.warn("[Dashboard] Error parsing genesys_empresa:",e.t0);case 23:if(!(c=localStorage.getItem("genesys_user"))){e.next=36;break}if(e.prev=25,!(l=JSON.parse(c)).empresa){e.next=31;break}return console.log("[Dashboard] Found empresa from user data:",l.empresa),ya(l.empresa.nombre||l.empresa.razon_social,l.empresa),e.abrupt("return",l.empresa);case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(25),console.warn("[Dashboard] Error parsing genesys_user:",e.t1);case 36:return console.log("[Dashboard] No company data found"),ca("company-name","Sin empresa"),e.abrupt("return",null);case 39:case"end":return e.stop()}}),e,null,[[6,20],[25,33]])}))),ba.apply(this,arguments)}function ya(e,n){if(ca("company-name",e||"Sin empresa"),ca("company-sector",(null==n?void 0:n.sector)||"-"),ca("company-activity",(null==n?void 0:n.actividad_economica)||"-"),ca("company-nit",(null==n?void 0:n.nit)||"-"),ca("responsable-name",(null==n?void 0:n.responsable)||(null==n?void 0:n.nombre_responsable)||"-"),yt.companyName=e,yt.companyId=(null==n?void 0:n.id)||null,null!=n&&n.cargos&&Array.isArray(n.cargos)){var t=n.cargos.length,a=n.cargos.reduce((function(e,n){return e+(n.numPersonas||n.numTrabajadores||0)}),0);ca("stat-total-trabajadores",a.toString());var i=0;n.cargos.forEach((function(e){e.ges&&Array.isArray(e.ges)&&(i+=e.ges.length),e.gesSeleccionados&&Array.isArray(e.gesSeleccionados)&&(i+=e.gesSeleccionados.length)})),ca("stat-peligros",i.toString()),console.log("[Dashboard] Company stats - Cargos: ".concat(t,", Trabajadores: ").concat(a,", GES: ").concat(i))}}function xa(){console.log("[CargoWizard] Opening create wizard...");var e,n=da(),t=je({mode:"create",empresaId:n,onSave:(e=(0,i.A)(d().mark((function e(t){var a,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[CargoWizard] Saving new cargo:",t),e.prev=1,e.next=4,fetch("/api/cargos",{method:"POST",headers:la(),body:JSON.stringify(bt(bt({},t),{},{empresa_id:n}))});case 4:if((a=e.sent).ok){e.next=7;break}throw new Error("Error al crear el cargo");case 7:return e.next=9,a.json();case 9:return i=e.sent,console.log("[CargoWizard] Cargo created:",i),e.next=13,Bt();case 13:Ea("Cargo creado exitosamente","success"),e.next=21;break;case 16:throw e.prev=16,e.t0=e.catch(1),console.error("[CargoWizard] Error saving cargo:",e.t0),Ea("Error al crear el cargo: "+e.t0.message,"error"),e.t0;case 21:case"end":return e.stop()}}),e,null,[[1,16]])}))),function(n){return e.apply(this,arguments)}),onCancel:function(){console.log("[CargoWizard] Create wizard cancelled")}});t.show()}function _a(e,n){console.log("[CargoWizard] Opening edit wizard for cargo:",e,n);var t,a=da(),r=je({mode:"edit",cargoId:e,cargoData:n,empresaId:a,onSave:(t=(0,i.A)(d().mark((function n(t){var i,r,o;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("[CargoWizard] Saving edited cargo:",t),n.prev=1,t.pendingApprovals&&t.pendingApprovals.length>0&&(console.log("[CargoWizard] Cargo has pending approvals:",t.pendingApprovals),t.estado_aprobacion="pendiente"),n.next=5,fetch("/api/cargos/".concat(e),{method:"PUT",headers:la(),body:JSON.stringify(bt(bt({},t),{},{empresa_id:a}))});case 5:if((r=n.sent).ok){n.next=8;break}throw new Error("Error al actualizar el cargo");case 8:return n.next=10,r.json();case 10:return o=n.sent,console.log("[CargoWizard] Cargo updated:",o),n.next=14,Bt();case 14:(null===(i=t.pendingApprovals)||void 0===i?void 0:i.length)>0?Ea("Cargo actualizado. Algunos cambios están pendientes de aprobación.","warning"):Ea("Cargo actualizado exitosamente","success"),n.next=23;break;case 18:throw n.prev=18,n.t0=n.catch(1),console.error("[CargoWizard] Error updating cargo:",n.t0),Ea("Error al actualizar el cargo: "+n.t0.message,"error"),n.t0;case 23:case"end":return n.stop()}}),n,null,[[1,18]])}))),function(e){return t.apply(this,arguments)}),onCancel:function(){console.log("[CargoWizard] Edit wizard cancelled")}});r.show()}function wa(){var e=document.getElementById("btn-nuevo-cargo");e&&e.addEventListener("click",(function(e){e.preventDefault(),xa()}));var t=document.querySelector(".btn-nuevo-cargo-inline");t&&t.addEventListener("click",(function(e){e.preventDefault(),xa()})),document.querySelectorAll(".btn-edit-cargo").forEach((function(e){e.addEventListener("click",(function(n){n.preventDefault();var t=e.dataset.cargoId,a={};try{var i=e.dataset.cargo;i&&(a=JSON.parse(i.replace(/&#39;/g,"'")))}catch(e){console.error("[CargoWizard] Error parsing cargo data:",e)}_a(t,a)}))})),document.querySelectorAll(".btn-view-cargo").forEach((function(e){e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation();var a={};try{var i=e.dataset.cargo;i&&(a=JSON.parse(i.replace(/&#39;/g,"'")))}catch(e){console.error("[CargoDetails] Error parsing cargo data:",e)}!function(e){var t=document.querySelector(".cargo-details-popup");t&&t.remove();var a=e.togglesActivos||[],i=e.nrNivelMaximo||"N/A",r="muted";"I"===i?r="success":"II"===i?r="info":"III"===i?r="warning":"IV"===i?r="danger":"V"===i&&(r="critical");var o=e.gesSeleccionados||[],s=o.reduce((function(e,n){var t=n.riesgo||n.categoria||"Otros";return e[t]||(e[t]=[]),e[t].push(n),e}),{}),c="";c=Object.keys(s).length>0?Object.entries(s).map((function(e){var t=n(e,2),a=t[0],i=t[1];return'\n            <div class="ges-category">\n                <div class="ges-category__header">'.concat(a,'</div>\n                <ul class="ges-category__list">\n                    ').concat(i.map((function(e){var n,t,a,i=e.niveles||{},r=(null===(n=i.deficiencia)||void 0===n?void 0:n.value)||i.deficiencia||"-",o=(null===(t=i.exposicion)||void 0===t?void 0:t.value)||i.exposicion||"-",s=(null===(a=i.consecuencia)||void 0===a?void 0:a.value)||i.consecuencia||"-";return'<li>\n                            <span class="ges-name">'.concat(e.ges||e.nombre||"Sin nombre",'</span>\n                            <span class="ges-niveles">ND:').concat(r," NE:").concat(o," NC:").concat(s,"</span>\n                        </li>")})).join(""),"\n                </ul>\n            </div>\n        ")})).join(""):'<p class="text-muted">Sin riesgos asignados</p>';var l=e.examenesMedicos||[],d="";d=l.length>0?'\n            <ul class="examenes-list">\n                '.concat(l.map((function(e){return'\n                    <li>\n                        <span class="examen-codigo">'.concat(e.codigo,'</span>\n                        <span class="examen-nombre">').concat(e.nombre,"</span>\n                    </li>\n                ")})).join(""),"\n            </ul>\n        "):'<p class="text-muted">Sin exámenes asignados</p>';var u=e.conteoNiveles||{},p='\n        <div class="niveles-grid">\n            '.concat(["V","IV","III","II","I"].map((function(e){return'\n                <div class="nivel-item nivel-item--'.concat(e.toLowerCase(),'">\n                    <span class="nivel-label">NR ').concat(e,'</span>\n                    <span class="nivel-count">').concat(u[e]||0,"</span>\n                </div>\n            ")})).join(""),"\n        </div>\n    "),m=document.createElement("div");m.className="cargo-details-popup",m.innerHTML='\n        <div class="cargo-details-overlay"></div>\n        <div class="cargo-details-modal">\n            <div class="cargo-details-modal__header">\n                <h2 class="cargo-details-modal__title">\n                    <i data-lucide="briefcase"></i>\n                    '.concat(e.nombre_cargo||"Sin nombre",'\n                </h2>\n                <button class="cargo-details-modal__close" aria-label="Cerrar">\n                    <i data-lucide="x"></i>\n                </button>\n            </div>\n            <div class="cargo-details-modal__body">\n                \x3c!-- Info básica --\x3e\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="info"></i> Información General\n                    </h3>\n                    <div class="details-grid">\n                        <div class="detail-item">\n                            <span class="detail-label">Área</span>\n                            <span class="detail-value">').concat(e.area||"Sin área",'</span>\n                        </div>\n                        <div class="detail-item">\n                            <span class="detail-label">Zona</span>\n                            <span class="detail-value">').concat(e.zona||"Sin zona",'</span>\n                        </div>\n                        <div class="detail-item">\n                            <span class="detail-label">Personas</span>\n                            <span class="detail-value">').concat(e.num_trabajadores||0,'</span>\n                        </div>\n                        <div class="detail-item">\n                            <span class="detail-label">NR Máximo</span>\n                            <span class="detail-value">\n                                <span class="badge badge--').concat(r,'">').concat(e.nrMaximo||"N/A"," (").concat(i,")</span>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Descripción --\x3e\n                ").concat(e.descripcion_tareas?'\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="file-text"></i> Descripción de Tareas\n                    </h3>\n                    <p class="descripcion-text">'.concat(e.descripcion_tareas,"</p>\n                </div>\n                "):"","\n\n                \x3c!-- Condiciones especiales --\x3e\n                ").concat(a.length>0?'\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="alert-triangle"></i> Condiciones Especiales\n                    </h3>\n                    <div class="toggles-badges">\n                        '.concat(a.map((function(e){return'\n                            <span class="badge badge--attention">'.concat(e,"</span>\n                        ")})).join(""),"\n                    </div>\n                </div>\n                "):"",'\n\n                \x3c!-- Distribución de riesgos --\x3e\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="bar-chart-3"></i> Distribución de Riesgos por NR\n                    </h3>\n                    ').concat(p,'\n                </div>\n\n                \x3c!-- Riesgos GES --\x3e\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="shield-alert"></i> Riesgos Identificados (').concat(o.length,')\n                    </h3>\n                    <div class="ges-list">\n                        ').concat(c,'\n                    </div>\n                </div>\n\n                \x3c!-- Exámenes médicos --\x3e\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="stethoscope"></i> Exámenes Médicos (').concat(l.length,")\n                    </h3>\n                    ").concat(d,'\n                </div>\n            </div>\n            <div class="cargo-details-modal__footer">\n                <button class="btn btn--outline btn-close-popup">Cerrar</button>\n                <button class="btn btn--primary btn-edit-from-popup" data-cargo-id="').concat(e.id,'">\n                    <i data-lucide="edit-2"></i> Editar Cargo\n                </button>\n            </div>\n        </div>\n    '),document.body.appendChild(m),window.lucide&&window.lucide.createIcons();requestAnimationFrame((function(){m.classList.add("show")}));var g=function(){m.classList.remove("show"),setTimeout((function(){return m.remove()}),300)};m.querySelector(".cargo-details-overlay").addEventListener("click",g),m.querySelector(".cargo-details-modal__close").addEventListener("click",g),m.querySelector(".btn-close-popup").addEventListener("click",g),m.querySelector(".btn-edit-from-popup").addEventListener("click",(function(){g(),_a(e.id,e)}));var v=function(e){"Escape"===e.key&&(g(),document.removeEventListener("keydown",v))};document.addEventListener("keydown",v)}(a)}))})),console.log("[CargoWizard] Events bound successfully")}function Ea(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=document.createElement("div");t.className="notification notification--".concat(n),t.innerHTML='\n        <i data-lucide="'.concat("success"===n?"check-circle":"error"===n?"alert-circle":"warning"===n?"alert-triangle":"info",'"></i>\n        <span>').concat(e,"</span>\n    "),document.body.appendChild(t),window.lucide&&window.lucide.createIcons(),setTimeout((function(){t.classList.add("show")}),10),setTimeout((function(){t.classList.remove("show"),setTimeout((function(){t.remove()}),300)}),4e3)}function ka(){var e=function(){var e=localStorage.getItem("genesys_user");if(e)try{var n=JSON.parse(e).rol;if("admin_genesys"===n||"medico_ocupacional"===n)return console.log("[Paywall] Usuario es",n,"- Paywall deshabilitado"),!1}catch(e){console.warn("[Paywall] Error leyendo rol del usuario:",e)}return!0},n=function(){return"paid"===localStorage.getItem("genesys_payment_status")},t=document.getElementById("paywall-btn-pay");t&&t.addEventListener("click",(0,i.A)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[Paywall] Pay button clicked"),(n=document.getElementById("paywall-overlay"))&&(n.style.display="none"),Ea("Contáctenos para procesar su pago y desbloquear todos los documentos","info"),setTimeout((function(){var e=encodeURIComponent("Hola, quiero pagar por los documentos del dashboard");window.open("https://wa.me/".concat("573102877240","?text=").concat(e),"_blank")}),1500);case 5:case"end":return e.stop()}}),e)}))));var a=document.getElementById("paywall-download-cotizacion");a&&a.addEventListener("click",(0,i.A)(d().mark((function e(){var n,t,a,i,r,o,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.disabled=!0,console.log("[Paywall] Downloading cotización..."),e.prev=2,n=localStorage.getItem("empresaId"),t=localStorage.getItem("authToken"),n&&t){e.next=7;break}throw new Error("No se encontró información de sesión");case 7:return e.next=9,fetch("/api/documentos/empresa/".concat(n),{headers:{Authorization:"Bearer ".concat(t)}});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error al obtener documentos");case 12:return e.next=14,a.json();case 14:if(!((i=e.sent).documents&&i.documents.length>0)){e.next=26;break}if(o=i.documents[0],!(s=null===(r=o.preview_urls)||void 0===r?void 0:r.cotizacion)){e.next=23;break}window.open(s,"_blank"),Ea("Cotización descargada exitosamente","success"),e.next=24;break;case 23:throw new Error("Cotización no disponible");case 24:e.next=27;break;case 26:throw new Error("No hay documentos disponibles");case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(2),console.error("[Paywall] Error downloading cotización:",e.t0),Ea(e.t0.message||"Error al descargar la cotización","error");case 33:this.disabled=!1;case 34:case"end":return e.stop()}}),e,this,[[2,29]])}))));var r=document.getElementById("paywall-download-perfil");r&&r.addEventListener("click",(0,i.A)(d().mark((function e(){var n,t,a,i,r,o,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.disabled=!0,console.log("[Paywall] Downloading perfil..."),e.prev=2,n=localStorage.getItem("empresaId"),t=localStorage.getItem("authToken"),n&&t){e.next=7;break}throw new Error("No se encontró información de sesión");case 7:return e.next=9,fetch("/api/documentos/empresa/".concat(n),{headers:{Authorization:"Bearer ".concat(t)}});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error al obtener documentos");case 12:return e.next=14,a.json();case 14:if(!((i=e.sent).documents&&i.documents.length>0)){e.next=26;break}if(o=i.documents[0],!(s=null===(r=o.preview_urls)||void 0===r?void 0:r.perfil)){e.next=23;break}window.open(s,"_blank"),Ea("Perfil de Cargo descargado exitosamente","success"),e.next=24;break;case 23:throw new Error("Perfil de cargo no disponible");case 24:e.next=27;break;case 26:throw new Error("No hay documentos disponibles");case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(2),console.error("[Paywall] Error downloading perfil:",e.t0),Ea(e.t0.message||"Error al descargar el perfil","error");case 33:this.disabled=!1;case 34:case"end":return e.stop()}}),e,this,[[2,29]])})))),e()?n()?console.log("[Paywall] User has paid. No paywall will be shown."):(console.log("[Paywall] User has not paid. Timer starting (8s)..."),setTimeout((function(){!n()&&e()&&function(){var e=document.getElementById("paywall-overlay");if(e){var n=0;if(yt.data.cargos&&yt.data.cargos.length>0)n=yt.data.cargos.length,console.log("[Paywall] Using cargo count from DashboardState:",n);else try{var t=localStorage.getItem("genesys_empresa");t&&(n=JSON.parse(t).numCargos||0,console.log("[Paywall] Using cargo count from genesys_empresa:",n))}catch(e){console.warn("[Paywall] Error reading cargo count:",e)}var a=3e4*n,i=document.getElementById("paywall-cargo-count");i&&(i.textContent=n.toString());var r=document.getElementById("paywall-total");r&&(r.textContent="$"+a.toLocaleString("es-CO")),e.style.display="flex",window.lucide&&window.lucide.createIcons(),console.log("[Paywall] Modal shown - Cargos:",n,"Total:","$"+a.toLocaleString("es-CO"))}}()}),8e3)):console.log("[Paywall] Paywall deshabilitado para este rol.")}document.addEventListener("DOMContentLoaded",(0,i.A)(d().mark((function e(){var n,t,a,i,r,o,s,c,l,u;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("🚀 Dashboard Premium initializing..."),!(n=localStorage.getItem("user")||sessionStorage.getItem("user"))){e.next=15;break}if(e.prev=3,"admin_genesys"!==(t=JSON.parse(n)).rol&&"medico_ocupacional"!==t.rol){e.next=10;break}return console.log("[Dashboard] Detectado rol especial:",t.rol),e.next=9,Ke();case 9:return e.abrupt("return");case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.warn("[Dashboard] Error parsing user:",e.t0);case 15:if(console.log("🔍 [DEBUG] Checking localStorage..."),a=localStorage.getItem("genesys_wizard_state"),console.log("🔍 [DEBUG] genesys_wizard_state exists:",!!a),a)try{l=JSON.parse(a),console.log("🔍 [DEBUG] Parsed wizard state:",{currentStep:l.currentStep,hasFormData:!!l.formData,nombreEmpresa:(null===(i=l.formData)||void 0===i?void 0:i.nombreEmpresa)||"N/A",nit:(null===(r=l.formData)||void 0===r?void 0:r.nit)||"N/A",cargosCount:(null===(o=l.formData)||void 0===o||null===(o=o.cargos)||void 0===o?void 0:o.length)||0,firstCargo:(null===(s=l.formData)||void 0===s||null===(s=s.cargos)||void 0===s?void 0:s[0])||"No cargos"}),(null===(c=l.formData)||void 0===c||null===(c=c.cargos)||void 0===c?void 0:c.length)>0&&l.formData.cargos.forEach((function(e,n){var t;console.log("🔍 [DEBUG] Cargo ".concat(n,":"),{nombre:e.nombre,area:e.area,zona:e.zona,numPersonas:e.numPersonas,gesCount:(null===(t=e.ges)||void 0===t?void 0:t.length)||0,toggles:{trabajaAlturas:e.trabajaAlturas,manipulaAlimentos:e.manipulaAlimentos,conduceVehiculo:e.conduceVehiculo,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados}})}))}catch(e){console.error("🔴 [DEBUG] Error parsing wizard state:",e)}else console.warn("🟡 [DEBUG] No wizard state found in localStorage. Keys available:",Object.keys(localStorage));return console.log("🔍 [DEBUG] Checking DOM containers..."),["cargos-content","matriz-critical-content","profesiograma-content","documentos-content","examenes-table-body"].forEach((function(e){var n=document.getElementById(e);console.log('🔍 [DEBUG] Container "'.concat(e,'":'),n?"FOUND":"NOT FOUND")})),new Ct,va(),e.next=26,fa();case 26:if(!(u=da())){e.next=31;break}return console.log("[Dashboard] Pre-loading cargos for empresa:",u),e.next=31,ua();case 31:document.addEventListener("keydown",(function(e){if((e.metaKey||e.ctrlKey)&&"k"===e.key){e.preventDefault();var n=document.getElementById("global-search");n&&n.focus()}})),console.log("✅ Dashboard Premium ready");case 33:case"end":return e.stop()}}),e,null,[[3,12]])})))),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ka):ka(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){console.log("🎭 Inicializando sistema multi-rol..."),Ke()})):(console.log("🎭 Inicializando sistema multi-rol..."),Ke()),console.log("✅ Dashboard Premium initialized")})()})();