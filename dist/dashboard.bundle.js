/*! For license information please see dashboard.bundle.js.LICENSE.txt */
(()=>{var e={7763:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>L,getFirmaState:()=>M,initFirmaDigitalUploader:()=>u,tieneFirmaConfigurada:()=>O});var a=t(9394),o=t(4467),i=t(467),r=t(4756),s=t.n(r);function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}var l="/api/medico/firma",d={tieneFirma:!1,firma:null,isLoading:!1,isDragging:!1,error:null,validationErrors:[]};function u(e,n){var t=document.getElementById(e);t?(d.authToken=n,function(e){e.innerHTML='\n        <div class="firma-uploader">\n            <div class="firma-uploader__header">\n                <h3 class="firma-uploader__title">\n                    <i data-lucide="pen-tool"></i>\n                    Mi Firma Digital\n                </h3>\n                <p class="firma-uploader__description">\n                    Suba su firma en formato PNG con fondo transparente.\n                    Esta firma se incorporará en los documentos que genere.\n                </p>\n            </div>\n\n            <div class="firma-uploader__content">\n                \x3c!-- Área de preview o dropzone --\x3e\n                <div id="firma-preview-area" class="firma-uploader__preview-area">\n                    '.concat(p(),'\n                </div>\n\n                \x3c!-- Mensajes de error --\x3e\n                <div id="firma-errors" class="firma-uploader__errors" style="display: none;"></div>\n\n                \x3c!-- Información de ayuda --\x3e\n                <div class="firma-uploader__help">\n                    <button type="button" class="firma-uploader__help-toggle" id="firma-help-toggle">\n                        <i data-lucide="help-circle"></i>\n                        ¿Cómo crear una firma con fondo transparente?\n                    </button>\n                    <div class="firma-uploader__help-content" id="firma-help-content" style="display: none;">\n                        <div class="firma-uploader__help-steps">\n                            <div class="help-step">\n                                <span class="help-step__number">1</span>\n                                <div class="help-step__content">\n                                    <strong>Firme en papel blanco</strong>\n                                    <p>Use un bolígrafo de tinta oscura (negro o azul) y firme sobre papel blanco liso.</p>\n                                </div>\n                            </div>\n                            <div class="help-step">\n                                <span class="help-step__number">2</span>\n                                <div class="help-step__content">\n                                    <strong>Fotografíe o escanee</strong>\n                                    <p>Tome una foto con buena iluminación o escanee la firma a alta resolución.</p>\n                                </div>\n                            </div>\n                            <div class="help-step">\n                                <span class="help-step__number">3</span>\n                                <div class="help-step__content">\n                                    <strong>Quite el fondo</strong>\n                                    <p>Use herramientas como <a href="https://www.remove.bg/es" target="_blank" rel="noopener">remove.bg</a>\n                                    o el editor de imágenes de su preferencia para eliminar el fondo blanco.</p>\n                                </div>\n                            </div>\n                            <div class="help-step">\n                                <span class="help-step__number">4</span>\n                                <div class="help-step__content">\n                                    <strong>Guarde como PNG</strong>\n                                    <p>Es importante guardar en formato PNG para mantener la transparencia.</p>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="firma-uploader__requirements">\n                            <h4>Requisitos técnicos:</h4>\n                            <ul>\n                                <li><i data-lucide="check"></i> Formato: PNG con transparencia</li>\n                                <li><i data-lucide="check"></i> Tamaño máximo: 500 KB</li>\n                                <li><i data-lucide="check"></i> Dimensiones mínimas: 100 x 30 píxeles</li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '),function(e){var n=e.querySelector("#firma-help-toggle"),t=e.querySelector("#firma-help-content");n&&t&&n.addEventListener("click",(function(){var e="none"!==t.style.display;t.style.display=e?"none":"block",n.classList.toggle("active",!e)}));m(e),g(e)}(e),window.lucide&&window.lucide.createIcons()}(t),function(e){E.apply(this,arguments)}(t)):console.error("Container #".concat(e," not found"))}function p(){return d.isLoading?'\n            <div class="firma-uploader__loading">\n                <div class="spinner"></div>\n                <span>Cargando...</span>\n            </div>\n        ':d.tieneFirma&&d.firma?'\n            <div class="firma-uploader__preview">\n                <div class="firma-uploader__preview-image checkered-bg">\n                    <img src="'.concat(d.firma.url,'" alt="Mi firma digital" id="firma-image">\n                </div>\n                <div class="firma-uploader__preview-info">\n                    <span class="firma-uploader__preview-dimensions">\n                        ').concat(d.firma.width," x ").concat(d.firma.height,' px\n                    </span>\n                    <span class="firma-uploader__preview-size">\n                        ').concat(I(d.firma.size),'\n                    </span>\n                </div>\n                <div class="firma-uploader__preview-actions">\n                    <button type="button" class="btn btn--outline btn--sm" id="btn-cambiar-firma">\n                        <i data-lucide="refresh-cw"></i>\n                        Cambiar firma\n                    </button>\n                    <button type="button" class="btn btn--danger btn--sm" id="btn-eliminar-firma">\n                        <i data-lucide="trash-2"></i>\n                        Eliminar\n                    </button>\n                </div>\n            </div>\n        '):'\n        <div class="firma-uploader__dropzone '.concat(d.isDragging?"dragging":"",'" id="firma-dropzone">\n            <div class="firma-uploader__dropzone-content">\n                <i data-lucide="upload-cloud" class="firma-uploader__dropzone-icon"></i>\n                <p class="firma-uploader__dropzone-text">\n                    Arrastre su firma aquí o\n                </p>\n                <button type="button" class="btn btn--primary btn--sm" id="btn-seleccionar-firma">\n                    Seleccionar archivo\n                </button>\n                <span class="firma-uploader__dropzone-formats">\n                    PNG con transparencia • Máx. 500KB\n                </span>\n            </div>\n            <input type="file" id="firma-file-input" accept="image/png" style="display: none;">\n        </div>\n    ')}function m(e){var n=e.querySelector("#firma-dropzone"),t=e.querySelector("#firma-file-input"),a=e.querySelector("#btn-seleccionar-firma");n&&(a&&a.addEventListener("click",(function(e){e.stopPropagation(),null==t||t.click()})),n.addEventListener("click",(function(e){(e.target===n||e.target.closest(".firma-uploader__dropzone-content")&&!e.target.closest("button"))&&(null==t||t.click())})),["dragenter","dragover"].forEach((function(e){n.addEventListener(e,(function(e){e.preventDefault(),e.stopPropagation(),d.isDragging=!0,n.classList.add("dragging")}))})),["dragleave","drop"].forEach((function(e){n.addEventListener(e,(function(e){e.preventDefault(),e.stopPropagation(),d.isDragging=!1,n.classList.remove("dragging")}))})),n.addEventListener("drop",(function(n){var t,a=null===(t=n.dataTransfer)||void 0===t?void 0:t.files;(null==a?void 0:a.length)>0&&v(a[0],e)})),t&&t.addEventListener("change",(function(n){var t,a=null===(t=n.target.files)||void 0===t?void 0:t[0];a&&v(a,e)})))}function g(e){var n=e.querySelector("#btn-cambiar-firma"),t=e.querySelector("#btn-eliminar-firma");n&&n.addEventListener("click",(function(){d.tieneFirma=!1,d.firma=null,k(e)})),t&&t.addEventListener("click",(function(){confirm("¿Está seguro de eliminar su firma digital?")&&function(e){_.apply(this,arguments)}(e)}))}function v(e,n){return f.apply(this,arguments)}function f(){return(f=(0,i.A)(s().mark((function e(n,t){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.validationErrors=[],C(t),e.next=4,h(n);case 4:if((a=e.sent).valid){e.next=8;break}return A(t,a.errors),e.abrupt("return");case 8:return e.next=10,x(n,t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=(0,i.A)(s().mark((function e(n){var t,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],"image/png"!==n.type&&t.push("El archivo debe ser formato PNG"),n.size>512e3&&t.push("El archivo es muy grande. Máximo 500KB (actual: ".concat(I(n.size),")")),e.prev=4,e.next=7,y(n);case 7:(o=e.sent).valid||t.push.apply(t,(0,a.A)(o.errors)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t.push("No se pudo leer el archivo de imagen");case 14:return e.abrupt("return",{valid:0===t.length,errors:t});case 15:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}function y(e){return new Promise((function(n){var t=new Image,a=document.createElement("canvas"),o=a.getContext("2d");t.onload=function(){var e=[];(t.width<100||t.height<30)&&e.push("La imagen es muy pequeña. Mínimo 100x30 píxeles (actual: ".concat(t.width,"x").concat(t.height,")")),a.width=t.width,a.height=t.height,o.drawImage(t,0,0);try{for(var i=o.getImageData(0,0,a.width,a.height).data,r=!1,s=3;s<i.length;s+=4)if(i[s]<255){r=!0;break}r||e.push("La imagen no tiene fondo transparente. Debe tener canal alpha.")}catch(e){console.warn("Could not validate transparency:",e)}URL.revokeObjectURL(t.src),n({valid:0===e.length,errors:e})},t.onerror=function(){URL.revokeObjectURL(t.src),n({valid:!1,errors:["El archivo no es una imagen válida"]})},t.src=URL.createObjectURL(e)}))}function x(e,n){return w.apply(this,arguments)}function w(){return(w=(0,i.A)(s().mark((function e(n,t){var a,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.isLoading=!0,k(t),e.prev=2,(a=new FormData).append("firma",n),e.next=7,fetch(l,{method:"POST",headers:{Authorization:"Bearer ".concat(d.authToken)},body:a});case 7:return o=e.sent,e.next=10,o.json();case 10:if(i=e.sent,o.ok){e.next=13;break}throw new Error(i.message||"Error subiendo firma");case 13:d.tieneFirma=!0,d.firma=i.firma,d.error=null,S("Firma subida exitosamente","success"),window.dispatchEvent(new CustomEvent("firmaDigitalActualizada",{detail:{tieneFirma:!0,firma:i.firma}})),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(2),console.error("Error subiendo firma:",e.t0),A(t,[e.t0.message]);case 24:return e.prev=24,d.isLoading=!1,k(t),e.finish(24);case 28:case"end":return e.stop()}}),e,null,[[2,20,24,28]])})))).apply(this,arguments)}function _(){return(_=(0,i.A)(s().mark((function e(n){var t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.isLoading=!0,k(n),e.prev=2,e.next=5,fetch(l,{method:"DELETE",headers:{Authorization:"Bearer ".concat(d.authToken),"Content-Type":"application/json"}});case 5:return t=e.sent,e.next=8,t.json();case 8:if(a=e.sent,t.ok){e.next=11;break}throw new Error(a.message||"Error eliminando firma");case 11:d.tieneFirma=!1,d.firma=null,d.error=null,S("Firma eliminada","success"),window.dispatchEvent(new CustomEvent("firmaDigitalActualizada",{detail:{tieneFirma:!1,firma:null}})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(2),console.error("Error eliminando firma:",e.t0),A(n,[e.t0.message]);case 22:return e.prev=22,d.isLoading=!1,k(n),e.finish(22);case 26:case"end":return e.stop()}}),e,null,[[2,18,22,26]])})))).apply(this,arguments)}function E(){return(E=(0,i.A)(s().mark((function e(n){var t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.isLoading=!0,k(n),e.prev=2,e.next=5,fetch(l,{method:"GET",headers:{Authorization:"Bearer ".concat(d.authToken),"Content-Type":"application/json"}});case 5:return t=e.sent,e.next=8,t.json();case 8:if(a=e.sent,t.ok){e.next=11;break}throw new Error(a.message||"Error obteniendo firma");case 11:d.tieneFirma=a.tieneFirma,d.firma=a.firma,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),console.error("Error cargando firma:",e.t0);case 18:return e.prev=18,d.isLoading=!1,k(n),e.finish(18);case 22:case"end":return e.stop()}}),e,null,[[2,15,18,22]])})))).apply(this,arguments)}function k(e){var n=e.querySelector("#firma-preview-area");n&&(n.innerHTML=p(),m(e),g(e),window.lucide&&window.lucide.createIcons())}function A(e,n){var t=e.querySelector("#firma-errors");t&&(t.innerHTML=n.map((function(e){return'\n            <div class="firma-uploader__error">\n                <i data-lucide="alert-circle"></i>\n                <span>'.concat(e,"</span>\n            </div>\n        ")})).join(""),t.style.display="block",window.lucide&&window.lucide.createIcons())}function C(e){var n=e.querySelector("#firma-errors");n&&(n.style.display="none",n.innerHTML="")}function S(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=document.querySelector(".firma-toast");t||((t=document.createElement("div")).className="firma-toast",document.body.appendChild(t)),t.textContent=e,t.className="firma-toast firma-toast--".concat(n," firma-toast--visible"),setTimeout((function(){t.classList.remove("firma-toast--visible")}),3e3)}function I(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}function M(){return function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){(0,o.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},d)}function O(){return d.tieneFirma}const L={initFirmaDigitalUploader:u,getFirmaState:M,tieneFirmaConfigurada:O}},4633:(e,n,t)=>{var a=t(3738).default;function o(){"use strict";e.exports=o=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var n,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(e,n,t){e[n]=t.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function p(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{p({},"")}catch(n){p=function(e,n,t){return e[n]=t}}function m(e,n,t,a){var o=n&&n.prototype instanceof x?n:x,i=Object.create(o.prototype),r=new P(a||[]);return s(i,"_invoke",{value:M(e,t,r)}),i}function g(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var v="suspendedStart",f="suspendedYield",h="executing",b="completed",y={};function x(){}function w(){}function _(){}var E={};p(E,l,(function(){return this}));var k=Object.getPrototypeOf,A=k&&k(k(T([])));A&&A!==i&&r.call(A,l)&&(E=A);var C=_.prototype=x.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(n){p(e,n,(function(e){return this._invoke(n,e)}))}))}function I(e,n){function t(o,i,s,c){var l=g(e[o],e,i);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==a(u)&&r.call(u,"__await")?n.resolve(u.__await).then((function(e){t("next",e,s,c)}),(function(e){t("throw",e,s,c)})):n.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return t("throw",e,s,c)}))}c(l.arg)}var o;s(this,"_invoke",{value:function(e,a){function i(){return new n((function(n,o){t(e,a,n,o)}))}return o=o?o.then(i,i):i()}})}function M(e,t,a){var o=v;return function(i,r){if(o===h)throw Error("Generator is already running");if(o===b){if("throw"===i)throw r;return{value:n,done:!0}}for(a.method=i,a.arg=r;;){var s=a.delegate;if(s){var c=O(s,a);if(c){if(c===y)continue;return c}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===v)throw o=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=h;var l=g(e,t,a);if("normal"===l.type){if(o=a.done?b:f,l.arg===y)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(o=b,a.method="throw",a.arg=l.arg)}}}function O(e,t){var a=t.method,o=e.iterator[a];if(o===n)return t.delegate=null,"throw"===a&&e.iterator.return&&(t.method="return",t.arg=n,O(e,t),"throw"===t.method)||"return"!==a&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+a+"' method")),y;var i=g(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,y;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,y):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function L(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function N(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function T(e){if(e||""===e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(r.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}throw new TypeError(a(e)+" is not iterable")}return w.prototype=_,s(C,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===w||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,u,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},S(I.prototype),p(I.prototype,d,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,a,o,i){void 0===i&&(i=Promise);var r=new I(m(e,n,a,o),i);return t.isGeneratorFunction(n)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},S(C),p(C,u,"Generator"),p(C,l,(function(){return this})),p(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var n=Object(e),t=[];for(var a in n)t.push(a);return t.reverse(),function e(){for(;t.length;){var a=t.pop();if(a in n)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=T,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(N),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(a,o){return s.type="throw",s.arg=e,t.next=a,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=n,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),y},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),N(t),y}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var a=t.completion;if("throw"===a.type){var o=a.arg;N(t)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:T(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=n),y}},t}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},3738:e=>{function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},4756:(e,n,t)=>{var a=t(4633)();e.exports=a;try{regeneratorRuntime=a}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}},3145:(e,n,t)=>{"use strict";function a(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}t.d(n,{A:()=>a})},4243:(e,n,t)=>{"use strict";t.d(n,{A:()=>o});var a=t(3145);function o(e){if(Array.isArray(e))return(0,a.A)(e)}},467:(e,n,t)=>{"use strict";function a(e,n,t,a,o,i,r){try{var s=e[i](r),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(a,o)}function o(e){return function(){var n=this,t=arguments;return new Promise((function(o,i){var r=e.apply(n,t);function s(e){a(r,o,i,s,c,"next",e)}function c(e){a(r,o,i,s,c,"throw",e)}s(void 0)}))}}t.d(n,{A:()=>o})},4467:(e,n,t)=>{"use strict";t.d(n,{A:()=>o});var a=t(9922);function o(e,n,t){return(n=(0,a.A)(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}},3893:(e,n,t)=>{"use strict";function a(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}t.d(n,{A:()=>a})},519:(e,n,t)=>{"use strict";function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}t.d(n,{A:()=>a})},9394:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var a=t(4243),o=t(3893),i=t(7800),r=t(519);function s(e){return(0,a.A)(e)||(0,o.A)(e)||(0,i.A)(e)||(0,r.A)()}},2327:(e,n,t)=>{"use strict";t.d(n,{A:()=>o});var a=t(2284);function o(e,n){if("object"!=(0,a.A)(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=(0,a.A)(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}},9922:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var a=t(2284),o=t(2327);function i(e){var n=(0,o.A)(e,"string");return"symbol"==(0,a.A)(n)?n:n+""}},2284:(e,n,t)=>{"use strict";function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.d(n,{A:()=>a})},7800:(e,n,t)=>{"use strict";t.d(n,{A:()=>o});var a=t(3145);function o(e,n){if(e){if("string"==typeof e)return(0,a.A)(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?(0,a.A)(e,n):void 0}}}},n={};function t(a){var o=n[a];if(void 0!==o)return o.exports;var i=n[a]={exports:{}};return e[a](i,i.exports,t),i.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=t(7800);function n(n,t){return function(e){if(Array.isArray(e))return e}(n)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,o,i,r,s=[],c=!0,l=!1;try{if(i=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(a=i.call(t)).done)&&(s.push(a.value),s.length!==n);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=t.return&&(r=t.return(),Object(r)!==r))return}finally{if(l)throw o}}return s}}(n,t)||(0,e.A)(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var a=t(4467),o=t(9394),i=t(467);function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var s=t(9922);function c(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(0,s.A)(a.key),a)}}function l(e,n,t){return n&&c(e.prototype,n),t&&c(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var d=t(4756),u=t.n(d);function p(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}const m=globalThis,g=m.trustedTypes,v=g?g.createPolicy("lit-html",{createHTML:e=>e}):void 0,f="$lit$",h=`lit$${Math.random().toFixed(9).slice(2)}$`,b="?"+h,y=`<${b}>`,x=document,w=()=>x.createComment(""),_=e=>null===e||"object"!=typeof e&&"function"!=typeof e,E=Array.isArray,k=e=>E(e)||"function"==typeof e?.[Symbol.iterator],A="[ \t\n\f\r]",C=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,S=/-->/g,I=/>/g,M=RegExp(`>|${A}(?:([^\\s"'>=/]+)(${A}*=${A}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),O=/'/g,L=/"/g,N=/^(?:script|style|textarea|title)$/i,P=e=>(n,...t)=>({_$litType$:e,strings:n,values:t}),T=P(1),R=(P(2),P(3),Symbol.for("lit-noChange")),j=Symbol.for("lit-nothing"),z=new WeakMap,D=x.createTreeWalker(x,129);function B(e,n){if(!E(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==v?v.createHTML(n):n}const q=(e,n)=>{const t=e.length-1,a=[];let o,i=2===n?"<svg>":3===n?"<math>":"",r=C;for(let n=0;n<t;n++){const t=e[n];let s,c,l=-1,d=0;for(;d<t.length&&(r.lastIndex=d,c=r.exec(t),null!==c);)d=r.lastIndex,r===C?"!--"===c[1]?r=S:void 0!==c[1]?r=I:void 0!==c[2]?(N.test(c[2])&&(o=RegExp("</"+c[2],"g")),r=M):void 0!==c[3]&&(r=M):r===M?">"===c[0]?(r=o??C,l=-1):void 0===c[1]?l=-2:(l=r.lastIndex-c[2].length,s=c[1],r=void 0===c[3]?M:'"'===c[3]?L:O):r===L||r===O?r=M:r===S||r===I?r=C:(r=M,o=void 0);const u=r===M&&e[n+1].startsWith("/>")?" ":"";i+=r===C?t+y:l>=0?(a.push(s),t.slice(0,l)+f+t.slice(l)+h+u):t+h+(-2===l?n:u)}return[B(e,i+(e[t]||"<?>")+(2===n?"</svg>":3===n?"</math>":"")),a]};class H{constructor({strings:e,_$litType$:n},t){let a;this.parts=[];let o=0,i=0;const r=e.length-1,s=this.parts,[c,l]=q(e,n);if(this.el=H.createElement(c,t),D.currentNode=this.el.content,2===n||3===n){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(a=D.nextNode())&&s.length<r;){if(1===a.nodeType){if(a.hasAttributes())for(const e of a.getAttributeNames())if(e.endsWith(f)){const n=l[i++],t=a.getAttribute(e).split(h),r=/([.?@])?(.*)/.exec(n);s.push({type:1,index:o,name:r[2],strings:t,ctor:"."===r[1]?V:"?"===r[1]?W:"@"===r[1]?J:G}),a.removeAttribute(e)}else e.startsWith(h)&&(s.push({type:6,index:o}),a.removeAttribute(e));if(N.test(a.tagName)){const e=a.textContent.split(h),n=e.length-1;if(n>0){a.textContent=g?g.emptyScript:"";for(let t=0;t<n;t++)a.append(e[t],w()),D.nextNode(),s.push({type:2,index:++o});a.append(e[n],w())}}}else if(8===a.nodeType)if(a.data===b)s.push({type:2,index:o});else{let e=-1;for(;-1!==(e=a.data.indexOf(h,e+1));)s.push({type:7,index:o}),e+=h.length-1}o++}}static createElement(e,n){const t=x.createElement("template");return t.innerHTML=e,t}}function U(e,n,t=e,a){if(n===R)return n;let o=void 0!==a?t._$Co?.[a]:t._$Cl;const i=_(n)?void 0:n._$litDirective$;return o?.constructor!==i&&(o?._$AO?.(!1),void 0===i?o=void 0:(o=new i(e),o._$AT(e,t,a)),void 0!==a?(t._$Co??=[])[a]=o:t._$Cl=o),void 0!==o&&(n=U(e,o._$AS(e,n.values),o,a)),n}class F{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:n},parts:t}=this._$AD,a=(e?.creationScope??x).importNode(n,!0);D.currentNode=a;let o=D.nextNode(),i=0,r=0,s=t[0];for(;void 0!==s;){if(i===s.index){let n;2===s.type?n=new $(o,o.nextSibling,this,e):1===s.type?n=new s.ctor(o,s.name,s.strings,this,e):6===s.type&&(n=new X(o,this,e)),this._$AV.push(n),s=t[++r]}i!==s?.index&&(o=D.nextNode(),i++)}return D.currentNode=x,a}p(e){let n=0;for(const t of this._$AV)void 0!==t&&(void 0!==t.strings?(t._$AI(e,t,n),n+=t.strings.length-2):t._$AI(e[n])),n++}}class ${get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,n,t,a){this.type=2,this._$AH=j,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=t,this.options=a,this._$Cv=a?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return void 0!==n&&11===e?.nodeType&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=U(this,e,n),_(e)?e===j||null==e||""===e?(this._$AH!==j&&this._$AR(),this._$AH=j):e!==this._$AH&&e!==R&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):k(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==j&&_(this._$AH)?this._$AA.nextSibling.data=e:this.T(x.createTextNode(e)),this._$AH=e}$(e){const{values:n,_$litType$:t}=e,a="number"==typeof t?this._$AC(e):(void 0===t.el&&(t.el=H.createElement(B(t.h,t.h[0]),this.options)),t);if(this._$AH?._$AD===a)this._$AH.p(n);else{const e=new F(a,this),t=e.u(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let n=z.get(e.strings);return void 0===n&&z.set(e.strings,n=new H(e)),n}k(e){E(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let t,a=0;for(const o of e)a===n.length?n.push(t=new $(this.O(w()),this.O(w()),this,this.options)):t=n[a],t._$AI(o),a++;a<n.length&&(this._$AR(t&&t._$AB.nextSibling,a),n.length=a)}_$AR(e=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class G{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,n,t,a,o){this.type=1,this._$AH=j,this._$AN=void 0,this.element=e,this.name=n,this._$AM=a,this.options=o,t.length>2||""!==t[0]||""!==t[1]?(this._$AH=Array(t.length-1).fill(new String),this.strings=t):this._$AH=j}_$AI(e,n=this,t,a){const o=this.strings;let i=!1;if(void 0===o)e=U(this,e,n,0),i=!_(e)||e!==this._$AH&&e!==R,i&&(this._$AH=e);else{const a=e;let r,s;for(e=o[0],r=0;r<o.length-1;r++)s=U(this,a[t+r],n,r),s===R&&(s=this._$AH[r]),i||=!_(s)||s!==this._$AH[r],s===j?e=j:e!==j&&(e+=(s??"")+o[r+1]),this._$AH[r]=s}i&&!a&&this.j(e)}j(e){e===j?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class V extends G{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===j?void 0:e}}class W extends G{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==j)}}class J extends G{constructor(e,n,t,a,o){super(e,n,t,a,o),this.type=5}_$AI(e,n=this){if((e=U(this,e,n,0)??j)===R)return;const t=this._$AH,a=e===j&&t!==j||e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive,o=e!==j&&(t===j||a);a&&this.element.removeEventListener(this.name,this,t),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class X{constructor(e,n,t){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=t}get _$AU(){return this._$AM._$AU}_$AI(e){U(this,e)}}const Z=m.litHtmlPolyfillSupport;Z?.(H,$),(m.litHtmlVersions??=[]).push("3.3.1");var K,Y,Q,ee,ne,te,ae,oe,ie,re,se,ce,le,de,ue,pe,me,ge,ve,fe,he,be,ye,xe,we,_e,Ee,ke,Ae,Ce,Se,Ie,Me,Oe,Le,Ne,Pe;function Te(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Re(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Te(Object(t),!0).forEach((function(n){(0,a.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Te(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var je=function(){return l((function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.options=Re({mode:n.mode||"create",cargoId:n.cargoId||null,cargoData:n.cargoData||null,empresaId:n.empresaId||null,onSave:n.onSave||function(){},onCancel:n.onCancel||function(){}},n),this.state={currentStep:0,totalSteps:5,loading:!1,error:null,cargo:{nombre:"",area:"",zona:"",descripcion:"",numPersonas:1,tareasRutinarias:!1,trabajaAlturas:!1,manipulaAlimentos:!1,conduceVehiculo:!1,trabajaEspaciosConfinados:!1,riesgosSeleccionados:[],niveles:{},controles:{}},pendingApprovals:[],originalNiveles:{},originalControles:{},catalogoGES:[],catalogoRiesgos:[],existingAreas:[],existingZonas:[]},this.steps=[{id:"info",title:"Información Básica",icon:"user"},{id:"riesgos",title:"Selección de Riesgos",icon:"alert-triangle"},{id:"niveles",title:"Niveles de Riesgo",icon:"sliders"},{id:"controles",title:"Controles",icon:"shield"},{id:"resumen",title:"Resumen",icon:"check-circle"}],this.niveles={ND:[{value:1,label:"Bajo / N/A",color:"#10b981"},{value:2,label:"Medio",color:"#84cc16"},{value:6,label:"Alto",color:"#f59e0b"},{value:10,label:"Muy Alto",color:"#ef4444"}],NE:[{value:1,label:"Esporádica",color:"#10b981"},{value:2,label:"Ocasional",color:"#84cc16"},{value:3,label:"Frecuente",color:"#f59e0b"},{value:4,label:"Continua",color:"#ef4444"}],NC:[{value:10,label:"Leve",color:"#10b981"},{value:25,label:"Grave",color:"#f59e0b"},{value:60,label:"Muy Grave",color:"#f97316"},{value:100,label:"Mortal",color:"#ef4444"}]},this.modalElement=null,this.init()}),[{key:"init",value:(s=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"edit"===this.options.mode&&this.options.cargoData&&this.loadCargoData(this.options.cargoData),e.next=3,this.loadCatalogos();case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"loadCargoData",value:function(e){this.state.cargo=Re(Re({},this.state.cargo),{},{nombre:e.nombre||e.nombre_cargo||"",area:e.area||"",zona:e.zona||"",descripcion:e.descripcion||e.descripcion_tareas||e.descripcionTareas||"",numPersonas:e.numPersonas||e.num_trabajadores||1,tareasRutinarias:e.tareasRutinarias||e.tareas_rutinarias||!1,trabajaAlturas:e.trabajaAlturas||e.trabaja_alturas||!1,manipulaAlimentos:e.manipulaAlimentos||e.manipula_alimentos||!1,conduceVehiculo:e.conduceVehiculo||e.conduce_vehiculo||!1,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados||e.trabaja_espacios_confinados||!1,riesgosSeleccionados:e.gesSeleccionados||e.riesgos||e.riesgosSeleccionados||[],niveles:e.niveles||{},controles:e.controles||{}}),this.state.originalNiveles=JSON.parse(JSON.stringify(this.state.cargo.niveles)),this.state.originalControles=JSON.parse(JSON.stringify(this.state.cargo.controles))}},{key:"loadCatalogos",value:(a=(0,i.A)(u().mark((function e(){var n,t,a,i,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/catalogo/ges");case 3:if(!(n=e.sent).ok){e.next=9;break}return e.next=7,n.json();case 7:t=e.sent,this.state.catalogoGES=t.data||t||[];case 9:if(!this.options.empresaId){e.next=20;break}return e.next=12,fetch("/api/cargos/empresa/".concat(this.options.empresaId));case 12:if(!(a=e.sent).ok){e.next=20;break}return e.next=16,a.json();case 16:i=e.sent,r=i.cargos||[],this.state.existingAreas=(0,o.A)(new Set(r.map((function(e){return e.area})).filter(Boolean))),this.state.existingZonas=(0,o.A)(new Set(r.map((function(e){return e.zona})).filter(Boolean)));case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),console.error("[CargoMiniWizard] Error loading catalogs:",e.t0);case 25:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(){return a.apply(this,arguments)})},{key:"show",value:function(){var e=this;this.modalElement=document.createElement("div"),this.modalElement.className="cargo-mini-wizard-overlay",this.modalElement.innerHTML='\n      <div class="cargo-mini-wizard-modal">\n        <div class="cargo-mini-wizard-content" id="cargo-mini-wizard-content">\n        </div>\n      </div>\n    ',document.body.appendChild(this.modalElement),document.body.style.overflow="hidden",this.renderContent(),this.modalElement.addEventListener("click",(function(n){n.target===e.modalElement&&e.handleCancel()})),this.escapeHandler=function(n){"Escape"===n.key&&e.handleCancel()},document.addEventListener("keydown",this.escapeHandler)}},{key:"hide",value:function(){this.modalElement&&(document.body.removeChild(this.modalElement),document.body.style.overflow="",this.modalElement=null),this.escapeHandler&&document.removeEventListener("keydown",this.escapeHandler)}},{key:"renderContent",value:function(){var e=this,n=document.getElementById("cargo-mini-wizard-content");n&&(((e,n,t)=>{const a=t?.renderBefore??n;let o=a._$litPart$;if(void 0===o){const e=t?.renderBefore??null;a._$litPart$=o=new $(n.insertBefore(w(),e),e,void 0,t??{})}o._$AI(e)})(T(K||(K=p(['\n      \x3c!-- Header --\x3e\n      <div class="mini-wizard__header">\n        <div class="mini-wizard__header-left">\n          <h2 class="mini-wizard__title">\n            ','\n          </h2>\n          <p class="mini-wizard__subtitle">\n            ','\n          </p>\n        </div>\n        <button class="mini-wizard__close" @click=','>\n          <i data-lucide="x"></i>\n        </button>\n      </div>\n\n      \x3c!-- Progress Steps --\x3e\n      <div class="mini-wizard__progress">\n        ','\n      </div>\n\n      \x3c!-- Content --\x3e\n      <div class="mini-wizard__body">\n        ','\n      </div>\n\n      \x3c!-- Footer --\x3e\n      <div class="mini-wizard__footer">\n        <div class="mini-wizard__footer-left">\n          ','\n        </div>\n        <div class="mini-wizard__footer-right">\n          <button class="btn btn--ghost" @click=',">\n            Cancelar\n          </button>\n          ","\n        </div>\n      </div>\n    "])),"edit"===this.options.mode?"Editar Cargo":"Nuevo Cargo",this.steps[this.state.currentStep].title,(function(){return e.handleCancel()}),this.steps.map((function(n,t){return T(Y||(Y=p(['\n          <div class="mini-wizard__step '," ",'">\n            <div class="mini-wizard__step-icon">\n              <i data-lucide="','"></i>\n            </div>\n            <span class="mini-wizard__step-label">',"</span>\n          </div>\n        "])),t===e.state.currentStep?"active":"",t<e.state.currentStep?"completed":"",n.icon,n.title)})),this.renderCurrentStep(),this.state.currentStep>0?T(Q||(Q=p(['\n            <button class="btn btn--outline" @click=','>\n              <i data-lucide="arrow-left"></i>\n              Anterior\n            </button>\n          '])),(function(){return e.goToPreviousStep()})):"",(function(){return e.handleCancel()}),this.state.currentStep<this.state.totalSteps-1?T(ee||(ee=p(['\n            <button class="btn btn--primary" @click=','>\n              Siguiente\n              <i data-lucide="arrow-right"></i>\n            </button>\n          '])),(function(){return e.goToNextStep()})):T(ne||(ne=p(['\n            <button class="btn btn--primary" @click=','>\n              <i data-lucide="save"></i>\n              ',"\n            </button>\n          "])),(function(){return e.handleSave()}),"edit"===this.options.mode?"Guardar Cambios":"Crear Cargo")),n),window.lucide&&window.lucide.createIcons())}},{key:"renderCurrentStep",value:function(){switch(this.state.currentStep){case 0:return this.renderInfoStep();case 1:return this.renderRiesgosStep();case 2:return this.renderNivelesStep();case 3:return this.renderControlesStep();case 4:return this.renderResumenStep();default:return T(te||(te=p(["<p>Paso no encontrado</p>"])))}}},{key:"renderInfoStep",value:function(){var e=this,n=this.state.cargo;return T(ae||(ae=p(['\n      <div class="mini-wizard__step-content">\n        <div class="mini-wizard__form-grid">\n          \x3c!-- Columna izquierda: Campos básicos --\x3e\n          <div class="mini-wizard__form-col">\n            <div class="form-group">\n              <label class="form-label">Nombre del Cargo <span class="required">*</span></label>\n              <input\n                type="text"\n                class="form-input"\n                .value=',"\n                @input=",'\n                placeholder="Ej: Operario de Producción"\n                required\n              />\n            </div>\n\n            <div class="form-group">\n              <label class="form-label">Área <span class="required">*</span></label>\n              <input\n                type="text"\n                class="form-input"\n                list="areas-list"\n                .value=',"\n                @input=",'\n                placeholder="Ej: Producción, Administración"\n              />\n              <datalist id="areas-list">\n                ','\n              </datalist>\n            </div>\n\n            <div class="form-group">\n              <label class="form-label">Zona o Lugar <span class="required">*</span></label>\n              <input\n                type="text"\n                class="form-input"\n                list="zonas-list"\n                .value=',"\n                @input=",'\n                placeholder="Ej: Planta 1, Oficina central"\n              />\n              <datalist id="zonas-list">\n                ','\n              </datalist>\n            </div>\n\n            <div class="form-group">\n              <label class="form-label">Número de Trabajadores <span class="required">*</span></label>\n              <input\n                type="number"\n                class="form-input"\n                .value=',"\n                @input=",'\n                min="1"\n                max="9999"\n              />\n            </div>\n\n            <div class="form-group">\n              <label class="form-label">Descripción</label>\n              <textarea\n                class="form-input form-textarea"\n                .value=',"\n                @input=",'\n                placeholder="Descripción de las funciones del cargo..."\n                rows="4"\n              ></textarea>\n            </div>\n          </div>\n\n          \x3c!-- Columna derecha: Toggles especiales --\x3e\n          <div class="mini-wizard__form-col">\n            <label class="form-label form-label--section">\n              <i data-lucide="shield"></i>\n              Características Especiales\n            </label>\n            <div class="toggles-grid">\n              ',"\n            </div>\n          </div>\n        </div>\n      </div>\n    "])),n.nombre,(function(n){return e.updateCargo("nombre",n.target.value)}),n.area,(function(n){return e.updateCargo("area",n.target.value)}),this.state.existingAreas.map((function(e){return T(oe||(oe=p(['<option value="','">'])),e)})),n.zona,(function(n){return e.updateCargo("zona",n.target.value)}),this.state.existingZonas.map((function(e){return T(ie||(ie=p(['<option value="','">'])),e)})),n.numPersonas,(function(n){return e.updateCargo("numPersonas",parseInt(n.target.value)||1)}),n.descripcion,(function(n){return e.updateCargo("descripcion",n.target.value)}),[{name:"tareasRutinarias",label:"Tareas repetitivas",icon:"repeat",severity:"warning"},{name:"conduceVehiculo",label:"Conduce vehículo",icon:"car",severity:"warning"},{name:"manipulaAlimentos",label:"Manipula alimentos",icon:"utensils",severity:"danger"},{name:"trabajaAlturas",label:"Trabaja en alturas",icon:"arrow-up",severity:"danger"},{name:"trabajaEspaciosConfinados",label:"Espacios confinados",icon:"door-closed",severity:"danger"}].map((function(t){return T(re||(re=p(['\n                <div class="toggle-item toggle-item--','">\n                  <div class="toggle-item__info">\n                    <i data-lucide="','" class="toggle-item__icon"></i>\n                    <span class="toggle-item__label">','</span>\n                  </div>\n                  <label class="toggle-switch toggle-switch--','">\n                    <input\n                      type="checkbox"\n                      .checked=',"\n                      @change=",'\n                    />\n                    <span class="toggle-switch__slider"></span>\n                  </label>\n                </div>\n              '])),t.severity,t.icon,t.label,t.severity,n[t.name],(function(n){return e.updateCargo(t.name,n.target.checked)}))})))}},{key:"renderRiesgosStep",value:function(){var e=this,t=this.state.catalogoGES.reduce((function(e,n){var t=n.riesgo_nombre||n.categoria||n.riesgo||"Otros";return e[t]||(e[t]=[]),e[t].push(n),e}),{}),a=this.state.cargo.riesgosSeleccionados.map((function(e){return e.id_ges||e.idGes||e.id}));return this.state.expandedCategories||(this.state.expandedCategories={}),T(se||(se=p(['\n      <div class="mini-wizard__step-content mini-wizard__step-content--riesgos">\n        <div class="riesgos-header">\n          <p>Selecciona los riesgos asociados a este cargo</p>\n          <span class="riesgos-count">\n            ',' seleccionados\n          </span>\n        </div>\n\n        <div class="riesgos-grid">\n          ',"\n        </div>\n      </div>\n    "])),a.length,Object.entries(t).map((function(t){var o=n(t,2),i=o[0],r=o[1],s=e.state.expandedCategories[i],c=s?r:r.slice(0,10);return T(ce||(ce=p(['\n              <div class="riesgos-category">\n                <div class="riesgos-category__header">\n                  <span class="riesgos-category__name">','</span>\n                  <span class="riesgos-category__count">','</span>\n                </div>\n                <div class="riesgos-category__items">\n                  ',"\n                  ","\n                </div>\n              </div>\n            "])),i,r.length,c.map((function(n){var t=n.id_ges||n.idGes||n.id,o=a.includes(t);return T(le||(le=p(['\n                      <div\n                        class="riesgo-chip ','"\n                        @click=','\n                      >\n                        <span class="riesgo-chip__name">',"</span>\n                        ","\n                      </div>\n                    "])),o?"selected":"",(function(){return e.toggleRiesgo(n)}),n.nombre,o?T(de||(de=p(['<i data-lucide="check"></i>']))):"")})),r.length>10?T(ue||(ue=p(['\n                    <button\n                      class="riesgo-chip riesgo-chip--toggle"\n                      @click=',"\n                    >\n                      ","\n                    </button>\n                  "])),(function(){return e.toggleCategoryExpanded(i)}),s?T(pe||(pe=p(['<i data-lucide="chevron-up"></i> Mostrar menos']))):T(me||(me=p(['<i data-lucide="chevron-down"></i> +'," más"])),r.length-10)):"")})))}},{key:"renderNivelesStep",value:function(){var e=this,n=this.state.cargo.riesgosSeleccionados;return 0===n.length?T(ge||(ge=p(['\n        <div class="mini-wizard__empty">\n          <i data-lucide="alert-circle"></i>\n          <p>No hay riesgos seleccionados</p>\n          <span>Vuelve al paso anterior para seleccionar riesgos</span>\n        </div>\n      ']))):T(ve||(ve=p(['\n      <div class="mini-wizard__step-content">\n        ','\n\n        <div class="niveles-list">\n          ',"\n        </div>\n      </div>\n    "])),"edit"===this.options.mode?T(fe||(fe=p(['\n          <div class="approval-warning">\n            <i data-lucide="alert-triangle"></i>\n            <div>\n              <strong>Cambios en niveles requieren aprobación</strong>\n              <p>Las modificaciones en los niveles de riesgo serán marcadas para revisión antes de aplicarse.</p>\n            </div>\n          </div>\n        ']))):"",n.map((function(n,t){return e.renderNivelItem(n,t)})))}},{key:"renderNivelItem",value:function(e,n){var t=this,a=e.id_ges||e.idGes||e.id,o=this.state.cargo.niveles[a]||{ND:1,NE:1,NC:10},i=o.ND*o.NE,r=i*o.NC,s=this.getNRInfo(r);return T(he||(he=p(['\n      <div class="nivel-item">\n        <div class="nivel-item__header">\n          <span class="nivel-item__name">','</span>\n          <span class="nivel-item__badge nivel-item__badge--','">\n            NR: '," (",')\n          </span>\n        </div>\n\n        <div class="nivel-item__selectors">\n          \x3c!-- ND --\x3e\n          <div class="nivel-selector">\n            <label>ND (Deficiencia)</label>\n            <div class="nivel-buttons">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- NE --\x3e\n          <div class="nivel-selector">\n            <label>NE (Exposición)</label>\n            <div class="nivel-buttons">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- NC --\x3e\n          <div class="nivel-selector">\n            <label>NC (Consecuencia)</label>\n            <div class="nivel-buttons">\n              ','\n            </div>\n          </div>\n\n          \x3c!-- Calculated values --\x3e\n          <div class="nivel-calculated">\n            <div class="nivel-calc-item">\n              <span class="nivel-calc-label">NP</span>\n              <span class="nivel-calc-value">','</span>\n            </div>\n            <div class="nivel-calc-item nivel-calc-item--nr" style="--nr-color: ','">\n              <span class="nivel-calc-label">NR</span>\n              <span class="nivel-calc-value">',"</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    "])),e.nombre,s.level,r,s.label,this.niveles.ND.map((function(e){return T(be||(be=p(['\n                <button\n                  type="button"\n                  class="nivel-btn ','"\n                  style="--nivel-color: ','"\n                  @click=',"\n                >\n                  ","\n                </button>\n              "])),o.ND===e.value?"active":"",e.color,(function(){return t.updateNivel(a,"ND",e.value)}),e.value)})),this.niveles.NE.map((function(e){return T(ye||(ye=p(['\n                <button\n                  type="button"\n                  class="nivel-btn ','"\n                  style="--nivel-color: ','"\n                  @click=',"\n                >\n                  ","\n                </button>\n              "])),o.NE===e.value?"active":"",e.color,(function(){return t.updateNivel(a,"NE",e.value)}),e.value)})),this.niveles.NC.map((function(e){return T(xe||(xe=p(['\n                <button\n                  type="button"\n                  class="nivel-btn ','"\n                  style="--nivel-color: ','"\n                  @click=',"\n                >\n                  ","\n                </button>\n              "])),o.NC===e.value?"active":"",e.color,(function(){return t.updateNivel(a,"NC",e.value)}),e.value)})),i,s.color,r)}},{key:"renderControlesStep",value:function(){var e=this,n=this.state.cargo.riesgosSeleccionados;return 0===n.length?T(we||(we=p(['\n        <div class="mini-wizard__empty">\n          <i data-lucide="alert-circle"></i>\n          <p>No hay riesgos seleccionados</p>\n        </div>\n      ']))):T(_e||(_e=p(['\n      <div class="mini-wizard__step-content">\n        ','\n\n        <div class="controles-list">\n          ',"\n        </div>\n      </div>\n    "])),"edit"===this.options.mode?T(Ee||(Ee=p(['\n          <div class="approval-warning">\n            <i data-lucide="alert-triangle"></i>\n            <div>\n              <strong>Cambios en controles requieren aprobación</strong>\n              <p>Las modificaciones en los controles serán marcadas para revisión antes de aplicarse.</p>\n            </div>\n          </div>\n        ']))):"",n.map((function(n,t){return e.renderControlItem(n,t)})))}},{key:"renderControlItem",value:function(e,n){var t=this,a=e.id_ges||e.idGes||e.id,o=this.state.cargo.controles[a]||{fuente:"",medio:"",individuo:""};return T(ke||(ke=p(['\n      <div class="control-item">\n        <div class="control-item__header">\n          <span class="control-item__name">','</span>\n        </div>\n\n        <div class="control-item__fields">\n          <div class="form-group">\n            <label class="form-label">Control en la Fuente</label>\n            <textarea\n              class="form-input form-textarea form-textarea--sm"\n              .value=',"\n              @input=",'\n              placeholder="Ej: Aislamiento acústico, guardas de protección..."\n              rows="2"\n            ></textarea>\n          </div>\n\n          <div class="form-group">\n            <label class="form-label">Control en el Medio</label>\n            <textarea\n              class="form-input form-textarea form-textarea--sm"\n              .value=',"\n              @input=",'\n              placeholder="Ej: Señalización, ventilación, iluminación..."\n              rows="2"\n            ></textarea>\n          </div>\n\n          <div class="form-group">\n            <label class="form-label">Control en el Individuo</label>\n            <textarea\n              class="form-input form-textarea form-textarea--sm"\n              .value=',"\n              @input=",'\n              placeholder="Ej: EPP, capacitación, pausas activas..."\n              rows="2"\n            ></textarea>\n          </div>\n        </div>\n      </div>\n    '])),e.nombre,o.fuente,(function(e){return t.updateControl(a,"fuente",e.target.value)}),o.medio,(function(e){return t.updateControl(a,"medio",e.target.value)}),o.individuo,(function(e){return t.updateControl(a,"individuo",e.target.value)}))}},{key:"renderResumenStep",value:function(){var e=this,n=this.state.cargo,t=this.checkPendingApprovals();return T(Ae||(Ae=p(['\n      <div class="mini-wizard__step-content">\n        ','\n\n        <div class="resumen-grid">\n          \x3c!-- Info básica --\x3e\n          <div class="resumen-section">\n            <h3 class="resumen-section__title">\n              <i data-lucide="user"></i>\n              Información del Cargo\n            </h3>\n            <div class="resumen-section__content">\n              <div class="resumen-item">\n                <span class="resumen-item__label">Nombre:</span>\n                <span class="resumen-item__value">','</span>\n              </div>\n              <div class="resumen-item">\n                <span class="resumen-item__label">Área:</span>\n                <span class="resumen-item__value">','</span>\n              </div>\n              <div class="resumen-item">\n                <span class="resumen-item__label">Zona:</span>\n                <span class="resumen-item__value">','</span>\n              </div>\n              <div class="resumen-item">\n                <span class="resumen-item__label">Trabajadores:</span>\n                <span class="resumen-item__value">','</span>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Características especiales --\x3e\n          <div class="resumen-section">\n            <h3 class="resumen-section__title">\n              <i data-lucide="shield"></i>\n              Características Especiales\n            </h3>\n            <div class="resumen-section__content">\n              <div class="resumen-toggles">\n                ',"\n                ","\n                ","\n                ","\n                ","\n                ",'\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Riesgos --\x3e\n          <div class="resumen-section resumen-section--full">\n            <h3 class="resumen-section__title">\n              <i data-lucide="alert-triangle"></i>\n              Riesgos Seleccionados (',')\n            </h3>\n            <div class="resumen-section__content">\n              <div class="resumen-riesgos">\n                ',"\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    "])),t?T(Ce||(Ce=p(['\n          <div class="approval-pending-banner">\n            <i data-lucide="clock"></i>\n            <div>\n              <strong>Cambios pendientes de aprobación</strong>\n              <p>Algunos cambios en niveles y/o controles requieren verificación con la empresa antes de aplicarse.</p>\n            </div>\n          </div>\n        ']))):"",n.nombre||"-",n.area||"-",n.zona||"-",n.numPersonas,n.trabajaAlturas?T(Se||(Se=p(['<span class="resumen-toggle resumen-toggle--danger">Alturas</span>']))):"",n.manipulaAlimentos?T(Ie||(Ie=p(['<span class="resumen-toggle resumen-toggle--danger">Alimentos</span>']))):"",n.conduceVehiculo?T(Me||(Me=p(['<span class="resumen-toggle resumen-toggle--warning">Vehículo</span>']))):"",n.trabajaEspaciosConfinados?T(Oe||(Oe=p(['<span class="resumen-toggle resumen-toggle--danger">Espacios Confinados</span>']))):"",n.tareasRutinarias?T(Le||(Le=p(['<span class="resumen-toggle resumen-toggle--warning">Tareas Rutinarias</span>']))):"",n.trabajaAlturas||n.manipulaAlimentos||n.conduceVehiculo||n.trabajaEspaciosConfinados||n.tareasRutinarias?"":T(Ne||(Ne=p(['<span class="resumen-toggle resumen-toggle--none">Ninguna</span>']))),n.riesgosSeleccionados.length,n.riesgosSeleccionados.map((function(t){var a=t.id_ges||t.idGes||t.id,o=n.niveles[a]||{ND:1,NE:1,NC:10},i=o.ND*o.NE*o.NC,r=e.getNRInfo(i);return T(Pe||(Pe=p(['\n                    <div class="resumen-riesgo">\n                      <span class="resumen-riesgo__name">','</span>\n                      <span class="resumen-riesgo__nr" style="background: ','">\n                        NR: ',"\n                      </span>\n                    </div>\n                  "])),t.nombre,r.color,i)})))}},{key:"updateCargo",value:function(e,n){this.state.cargo[e]=n,this.renderContent()}},{key:"toggleRiesgo",value:function(e){var n=e.id_ges||e.idGes||e.id,t=this.state.cargo.riesgosSeleccionados,a=t.findIndex((function(e){return(e.id_ges||e.idGes||e.id)===n}));a>=0?(t.splice(a,1),delete this.state.cargo.niveles[n],delete this.state.cargo.controles[n]):(t.push(e),this.state.cargo.niveles[n]={ND:1,NE:1,NC:10},this.state.cargo.controles[n]={fuente:"",medio:"",individuo:""}),this.renderContent()}},{key:"toggleCategoryExpanded",value:function(e){this.state.expandedCategories||(this.state.expandedCategories={}),this.state.expandedCategories[e]=!this.state.expandedCategories[e],this.renderContent()}},{key:"updateNivel",value:function(e,n,t){this.state.cargo.niveles[e]||(this.state.cargo.niveles[e]={ND:1,NE:1,NC:10}),this.state.cargo.niveles[e][n]=t,"edit"===this.options.mode&&this.checkNivelApprovalNeeded(e,n,t),this.renderContent()}},{key:"updateControl",value:function(e,n,t){this.state.cargo.controles[e]||(this.state.cargo.controles[e]={fuente:"",medio:"",individuo:""}),this.state.cargo.controles[e][n]=t,"edit"===this.options.mode&&this.checkControlApprovalNeeded(e,n,t)}},{key:"checkNivelApprovalNeeded",value:function(e,n,t){var a=this.state.originalNiveles[e];if(a&&a[n]!==t){var o="nivel_".concat(e,"_").concat(n);this.state.pendingApprovals.includes(o)||this.state.pendingApprovals.push(o)}}},{key:"checkControlApprovalNeeded",value:function(e,n,t){var a=this.state.originalControles[e];if(a&&a[n]!==t){var o="control_".concat(e,"_").concat(n);this.state.pendingApprovals.includes(o)||this.state.pendingApprovals.push(o)}}},{key:"checkPendingApprovals",value:function(){return this.state.pendingApprovals.length>0}},{key:"goToNextStep",value:function(){this.validateCurrentStep()&&this.state.currentStep<this.state.totalSteps-1&&(this.state.currentStep++,this.renderContent())}},{key:"goToPreviousStep",value:function(){this.state.currentStep>0&&(this.state.currentStep--,this.renderContent())}},{key:"validateCurrentStep",value:function(){var e=this.state.cargo;switch(this.state.currentStep){case 0:return!e.nombre||e.nombre.length<3?(alert("El nombre del cargo debe tener al menos 3 caracteres"),!1):e.area?!!e.zona||(alert("La zona es requerida"),!1):(alert("El área es requerida"),!1);case 1:return 0!==e.riesgosSeleccionados.length||(alert("Debes seleccionar al menos un riesgo"),!1);default:return!0}}},{key:"handleSave",value:(t=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkPendingApprovals()){e.next=6;break}return e.next=3,this.showApprovalModal();case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return this.state.loading=!0,this.renderContent(),e.prev=8,e.next=11,this.options.onSave(Re(Re({},this.state.cargo),{},{pendingApprovals:this.state.pendingApprovals,mode:this.options.mode,cargoId:this.options.cargoId}));case 11:this.hide(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(8),console.error("[CargoMiniWizard] Error saving:",e.t0),alert("Error al guardar: "+e.t0.message);case 18:return e.prev=18,this.state.loading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[8,14,18,21]])}))),function(){return t.apply(this,arguments)})},{key:"handleCancel",value:function(){this.options.onCancel(),this.hide()}},{key:"showApprovalModal",value:(e=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=document.createElement("div");n.className="approval-modal-overlay",n.innerHTML='\n        <div class="approval-modal">\n          <div class="approval-modal__icon">\n            <i data-lucide="alert-triangle"></i>\n          </div>\n          <h3 class="approval-modal__title">Cambios Requieren Aprobación</h3>\n          <p class="approval-modal__message">\n            Has modificado niveles de riesgo y/o controles existentes.\n            Estos cambios deben ser verificados con la empresa antes de aplicarse.\n          </p>\n          <p class="approval-modal__submessage">\n            Los cambios quedarán en estado "Pendiente de aprobación" hasta que sean revisados.\n          </p>\n          <div class="approval-modal__actions">\n            <button class="btn btn--ghost" id="approval-cancel">Cancelar</button>\n            <button class="btn btn--primary" id="approval-confirm">\n              <i data-lucide="clock"></i>\n              Enviar para Aprobación\n            </button>\n          </div>\n        </div>\n      ',document.body.appendChild(n),window.lucide&&window.lucide.createIcons(),n.querySelector("#approval-cancel").addEventListener("click",(function(){document.body.removeChild(n),e(!1)})),n.querySelector("#approval-confirm").addEventListener("click",(function(){document.body.removeChild(n),e(!0)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})},{key:"getNRInfo",value:function(e){return e<=20?{level:"i",label:"Nivel I",color:"#10b981"}:e<=120?{level:"ii",label:"Nivel II",color:"#84cc16"}:e<=500?{level:"iii",label:"Nivel III",color:"#f59e0b"}:e<=1e3?{level:"iv",label:"Nivel IV",color:"#f97316"}:{level:"v",label:"Nivel V",color:"#ef4444"}}}]);var e,t,a,s}();function ze(e){return new je(e)}var De=function(){return l((function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"matriz-dashboard-container";r(this,e),this.container=document.getElementById(n),this.data=null,this.filteredData=null,this.sortConfig={column:null,direction:"asc"},this.searchTerm="",this.filters={nivel:"",cargo:"",tipo:""},this.documento=null}),[{key:"init",value:(n=(0,i.A)(u().mark((function e(n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("🔵 [MATRIZ] Initializing component with data:",n),this.container){e.next=4;break}return console.error("🔴 [MATRIZ] Container not found"),e.abrupt("return");case 4:this.data=this.processAPIData(n),this.filteredData=(0,o.A)(this.data),this.documento=n.documento||null,this.render(),this.attachEventListeners(),window.lucide&&window.lucide.createIcons();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"processAPIData",value:function(e){if(!e||!e.categorias)return[];var n=[];return Object.values(e.categorias).forEach((function(e){e.peligros.forEach((function(t){n.push({id:t.id,cargo:t.cargo,area:t.area,tipo:e.nombre,descripcion:t.descripcion,nd:t.niveles.nd,ne:t.niveles.ne,nc:t.niveles.nc,np:t.niveles.np,nr:t.niveles.nr,nrNivel:t.niveles.nrNivel,niveles:t.niveles,interpretacion:t.interpretacion,controles:t.controles,controlesExistentes:t.controlesExistentes,tieneControlesExistentes:t.tieneControlesExistentes,requiereAccionUrgente:t.requiereAccionUrgente,sugerenciasIA:t.sugerenciasIA})}))})),console.log("🟢 [MATRIZ] Processed risks:",n.length),n}},{key:"calculateMetrics",value:function(){var e={total:this.data.length,critical:this.data.filter((function(e){return"V"===e.nrNivel})).length,high:this.data.filter((function(e){return"IV"===e.nrNivel})).length,medium:this.data.filter((function(e){return"III"===e.nrNivel})).length,low:this.data.filter((function(e){return"II"===e.nrNivel||"I"===e.nrNivel})).length};return e}},{key:"getFilterOptions",value:function(){return{cargos:(0,o.A)(new Set(this.data.map((function(e){return e.cargo})))).sort(),tipos:(0,o.A)(new Set(this.data.map((function(e){return e.tipo})))).sort(),niveles:["I","II","III","IV","V"]}}},{key:"render",value:function(){var e=this,n=this.calculateMetrics(),t=this.getFilterOptions();this.container.innerHTML='\n            \x3c!-- Metrics Cards --\x3e\n            <div class="matriz-metrics-grid">\n                '.concat(this.renderMetricCard("Total de Peligros",n.total,"layout-grid",""),"\n                ").concat(this.renderMetricCard("Nivel V - Crítico",n.critical,"alert-octagon","critical"),"\n                ").concat(this.renderMetricCard("Nivel IV - Alto",n.high,"alert-triangle","high"),"\n                ").concat(this.renderMetricCard("Nivel III - Moderado",n.medium,"alert-circle","medium"),"\n                ").concat(this.renderMetricCard("Nivel I-II - Aceptable",n.low,"check-circle","low"),'\n            </div>\n\n            \x3c!-- Toolbar: Search & Filters --\x3e\n            <div class="matriz-toolbar">\n                <div class="matriz-search">\n                    <i data-lucide="search" class="matriz-search__icon"></i>\n                    <input\n                        type="text"\n                        class="matriz-search__input"\n                        placeholder="Buscar por descripción, cargo o área..."\n                        id="matriz-search-input"\n                        value="').concat(this.searchTerm,'"\n                    />\n                </div>\n\n                <div class="matriz-filters">\n                    <div class="filter-dropdown">\n                        <select id="filter-nivel">\n                            <option value="">Todos los niveles</option>\n                            ').concat(t.niveles.map((function(n){return'\n                                <option value="'.concat(n,'" ').concat(e.filters.nivel===n?"selected":"",">\n                                    Nivel ").concat(n,"\n                                </option>\n                            ")})).join(""),'\n                        </select>\n                    </div>\n\n                    <div class="filter-dropdown">\n                        <select id="filter-cargo">\n                            <option value="">Todos los cargos</option>\n                            ').concat(t.cargos.map((function(n){return'\n                                <option value="'.concat(n,'" ').concat(e.filters.cargo===n?"selected":"",">\n                                    ").concat(n,"\n                                </option>\n                            ")})).join(""),'\n                        </select>\n                    </div>\n\n                    <div class="filter-dropdown">\n                        <select id="filter-tipo">\n                            <option value="">Todos los tipos</option>\n                            ').concat(t.tipos.map((function(n){return'\n                                <option value="'.concat(n,'" ').concat(e.filters.tipo===n?"selected":"",">\n                                    ").concat(n,"\n                                </option>\n                            ")})).join(""),'\n                        </select>\n                    </div>\n                </div>\n\n                <div class="matriz-actions">\n                    <button class="btn btn--icon" id="btn-reset-filters" title="Limpiar filtros">\n                        <i data-lucide="rotate-ccw"></i>\n                    </button>\n                </div>\n            </div>\n\n            \x3c!-- Table Container --\x3e\n            <div class="matriz-table-container">\n                ').concat(this.renderTable(),'\n            </div>\n\n            \x3c!-- Results Count --\x3e\n            <div class="matriz-results-count">\n                Mostrando <strong>').concat(this.filteredData.length,"</strong> de <strong>").concat(this.data.length,"</strong> peligros\n            </div>\n        "),window.lucide&&window.lucide.createIcons()}},{key:"renderMetricCard",value:function(e,n,t,a){return'\n            <div class="metric-card '.concat(a?"metric-card--".concat(a):"",'">\n                <div class="metric-card__icon">\n                    <i data-lucide="').concat(t,'"></i>\n                </div>\n                <div class="metric-card__value">').concat(n,'</div>\n                <div class="metric-card__label">').concat(e,"</div>\n            </div>\n        ")}},{key:"renderTable",value:function(){var e=this;return 0===this.filteredData.length?this.renderEmptyState():'\n            <table class="matriz-table">\n                <thead>\n                    <tr>\n                        '.concat(this.renderTableHeader("cargo","Cargo"),"\n                        ").concat(this.renderTableHeader("area","Área"),"\n                        ").concat(this.renderTableHeader("tipo","Tipo de Riesgo"),"\n                        ").concat(this.renderTableHeader("descripcion","Descripción del Peligro"),"\n                        ").concat(this.renderTableHeader("nd","ND"),"\n                        ").concat(this.renderTableHeader("ne","NE"),"\n                        ").concat(this.renderTableHeader("nc","NC"),"\n                        ").concat(this.renderTableHeader("np","NP"),"\n                        ").concat(this.renderTableHeader("nr","NR"),"\n                        <th>Nivel</th>\n                        <th>Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ").concat(this.filteredData.map((function(n){return e.renderTableRow(n)})).join(""),"\n                </tbody>\n            </table>\n        ")}},{key:"renderTableHeader",value:function(e,n){var t=this.sortConfig.column===e?"sorted-".concat(this.sortConfig.direction):"";return'\n            <th class="sortable '.concat(t,'" data-column="').concat(e,'">\n                ').concat(n,"\n            </th>\n        ")}},{key:"renderTableRow",value:function(e){return'\n            <tr class="row-expandable" data-risk-id="'.concat(e.id,'">\n                <td class="cell-cargo">').concat(e.cargo,"</td>\n                <td>").concat(e.area||"N/A",'</td>\n                <td>\n                    <span class="risk-badge risk-badge--tipo">').concat(e.tipo,'</span>\n                </td>\n                <td class="cell-riesgo">').concat(e.descripcion,'</td>\n                <td class="cell-nr">').concat(e.nd,'</td>\n                <td class="cell-nr">').concat(e.ne,'</td>\n                <td class="cell-nr">').concat(e.nc,'</td>\n                <td class="cell-nr">').concat(e.np,'</td>\n                <td class="cell-nr"><strong>').concat(e.nr,"</strong></td>\n                <td>\n                    ").concat(this.renderNRBadge(e.nrNivel),'\n                </td>\n                <td>\n                    <button class="btn btn--icon btn--sm" data-action="expand" data-risk-id="').concat(e.id,'">\n                        <i data-lucide="chevron-down"></i>\n                    </button>\n                </td>\n            </tr>\n            <tr class="risk-details" id="details-').concat(e.id,'">\n                <td colspan="11">\n                    <div class="risk-details-content">\n                        ').concat(this.renderRiskDetails(e),"\n                    </div>\n                </td>\n            </tr>\n        ")}},{key:"renderNRBadge",value:function(e){var n=e.toLowerCase();return'<span class="risk-badge risk-badge--nr risk-badge--nr-'.concat(n,'">Nivel ').concat(e,"</span>")}},{key:"renderRiskDetails",value:function(e){var n,t,a,o,i,r,s,c,l,d,u,p,m,g,v,f,h=e.requiereAccionUrgente||"V"===e.nrNivel||"IV"===e.nrNivel||e.np&&e.np>=10,b=this.isControlEmpty(null===(n=e.controlesExistentes)||void 0===n?void 0:n.fuente),y=this.isControlEmpty(null===(t=e.controlesExistentes)||void 0===t?void 0:t.medio),x=this.isControlEmpty(null===(a=e.controlesExistentes)||void 0===a?void 0:a.individuo),w=this.getRiskLevelIcon(e.nrNivel),_=(e.nrNivel||"iii").toLowerCase();return'\n            <div class="risk-expanded-panel">\n                \x3c!-- FILA 1: Interpretación + Controles Existentes --\x3e\n                <div class="risk-panel-row risk-panel-row--primary">\n                    \x3c!-- Columna 1: Interpretación del Riesgo --\x3e\n                    <div class="risk-panel-card risk-panel-card--interpretation">\n                        <div class="risk-panel-card__header">\n                            <div class="risk-level-indicator risk-level-indicator--'.concat(_,'">\n                                ').concat(w,'\n                            </div>\n                            <div class="risk-panel-card__title">\n                                <span class="label">Interpretación del Riesgo</span>\n                                <span class="level-badge level-badge--').concat(_,'">\n                                    Nivel ').concat(e.nrNivel||"N/A",'\n                                </span>\n                            </div>\n                        </div>\n                        <div class="risk-panel-card__body">\n                            <p class="interpretation-meaning">\n                                <strong>').concat((null===(o=e.interpretacion)||void 0===o?void 0:o.significado)||"Sin interpretación",'</strong>\n                            </p>\n                            <p class="interpretation-action">\n                                ').concat((null===(i=e.interpretacion)||void 0===i?void 0:i.accion)||"",'\n                            </p>\n                        </div>\n                    </div>\n\n                    \x3c!-- Columna 2: Control en Fuente --\x3e\n                    <div class="risk-panel-card risk-panel-card--control ').concat(b&&h?"risk-panel-card--warning":"",'">\n                        ').concat(b&&h?'\n                            <div class="control-warning-float">\n                                <i data-lucide="alert-triangle"></i>\n                                <span>Sin control</span>\n                            </div>\n                        ':"",'\n                        <div class="risk-panel-card__header">\n                            <i data-lucide="target" class="control-icon"></i>\n                            <span class="risk-panel-card__title">Fuente</span>\n                        </div>\n                        <div class="risk-panel-card__body">\n                            ').concat(this.renderControlContent(null===(r=e.controlesExistentes)||void 0===r?void 0:r.fuente),'\n                        </div>\n                    </div>\n\n                    \x3c!-- Columna 3: Control en Medio --\x3e\n                    <div class="risk-panel-card risk-panel-card--control ').concat(y&&h?"risk-panel-card--warning":"",'">\n                        ').concat(y&&h?'\n                            <div class="control-warning-float">\n                                <i data-lucide="alert-triangle"></i>\n                                <span>Sin control</span>\n                            </div>\n                        ':"",'\n                        <div class="risk-panel-card__header">\n                            <i data-lucide="layers" class="control-icon"></i>\n                            <span class="risk-panel-card__title">Medio</span>\n                        </div>\n                        <div class="risk-panel-card__body">\n                            ').concat(this.renderControlContent(null===(s=e.controlesExistentes)||void 0===s?void 0:s.medio),'\n                        </div>\n                    </div>\n\n                    \x3c!-- Columna 4: Control en Individuo --\x3e\n                    <div class="risk-panel-card risk-panel-card--control ').concat(x&&h?"risk-panel-card--warning":"",'">\n                        ').concat(x&&h?'\n                            <div class="control-warning-float">\n                                <i data-lucide="alert-triangle"></i>\n                                <span>Sin control</span>\n                            </div>\n                        ':"",'\n                        <div class="risk-panel-card__header">\n                            <i data-lucide="user-check" class="control-icon"></i>\n                            <span class="risk-panel-card__title">Individuo</span>\n                        </div>\n                        <div class="risk-panel-card__body">\n                            ').concat(this.renderControlContent(null===(c=e.controlesExistentes)||void 0===c?void 0:c.individuo),"\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Botón de Sugerencias IA (si hay riesgo alto) --\x3e\n                ").concat(h&&e.sugerenciasIA?'\n                    <div class="risk-panel-suggestions-bar">\n                        <button class="btn-suggestions" data-risk-id="'.concat(e.id,'">\n                            <i data-lucide="lightbulb"></i>\n                            <span>Ver sugerencias para reducir este riesgo</span>\n                            <i data-lucide="chevron-right" class="arrow"></i>\n                        </button>\n                    </div>\n\n                    \x3c!-- Tooltip de sugerencias (position: fixed) --\x3e\n                    <div class="sugerencias-ia-tooltip" id="sugerencias-').concat(e.id,'">\n                        <div class="sugerencias-ia-tooltip__header">\n                            <i data-lucide="sparkles"></i>\n                            <span>Sugerencias para reducir el riesgo</span>\n                        </div>\n                        <div class="sugerencias-ia-tooltip__body">\n                            ').concat(null!==(l=e.sugerenciasIA.fuente)&&void 0!==l&&l.length?'\n                                <div class="sugerencia-grupo">\n                                    <span class="sugerencia-label">En la Fuente</span>\n                                    <ul>'.concat(e.sugerenciasIA.fuente.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"</ul>\n                                </div>\n                            "):"","\n                            ").concat(null!==(d=e.sugerenciasIA.medio)&&void 0!==d&&d.length?'\n                                <div class="sugerencia-grupo">\n                                    <span class="sugerencia-label">En el Medio</span>\n                                    <ul>'.concat(e.sugerenciasIA.medio.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"</ul>\n                                </div>\n                            "):"","\n                            ").concat(null!==(u=e.sugerenciasIA.individuo)&&void 0!==u&&u.length?'\n                                <div class="sugerencia-grupo">\n                                    <span class="sugerencia-label">En el Individuo</span>\n                                    <ul>'.concat(e.sugerenciasIA.individuo.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"</ul>\n                                </div>\n                            "):"","\n                        </div>\n                    </div>\n                "):"","\n\n                \x3c!-- FILA 2: Medidas de Intervención Sugeridas --\x3e\n                ").concat(this.hasControlesSugeridos(e)?'\n                    <div class="risk-panel-row risk-panel-row--controls">\n                        <div class="risk-panel-section-header">\n                            <i data-lucide="shield-check"></i>\n                            <span>Medidas de Intervención Sugeridas (ISO 45001)</span>\n                        </div>\n                        <div class="risk-panel-controls-grid">\n                            '.concat(this.renderControlSugerido(null===(p=e.controles)||void 0===p?void 0:p.eliminacion,"Eliminación",1,"eliminacion"),"\n                            ").concat(this.renderControlSugerido(null===(m=e.controles)||void 0===m?void 0:m.sustitucion,"Sustitución",2,"sustitucion"),"\n                            ").concat(this.renderControlSugerido(null===(g=e.controles)||void 0===g?void 0:g.epp,"EPP",3,"epp"),"\n                            ").concat(this.renderControlSugerido(null===(v=e.controles)||void 0===v?void 0:v.ingenieria,"Controles de Ingeniería",4,"ingenieria"),"\n                            ").concat(this.renderControlSugerido(null===(f=e.controles)||void 0===f?void 0:f.administrativos,"Controles Administrativos",5,"administrativos"),"\n                        </div>\n                    </div>\n                "):"","\n            </div>\n        ")}},{key:"isControlEmpty",value:function(e){if(!e)return!0;var n=(Array.isArray(e)?e:[e]).filter((function(e){return e&&"string"==typeof e&&e.trim()}));return 0===n.length}},{key:"getRiskLevelIcon",value:function(e){var n={V:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                    <line x1="12" y1="9" x2="12" y2="13"></line>\n                    <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                  </svg>',IV:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                    <line x1="12" y1="9" x2="12" y2="13"></line>\n                    <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                  </svg>',III:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                     <circle cx="12" cy="12" r="10"></circle>\n                     <line x1="12" y1="8" x2="12" y2="12"></line>\n                     <line x1="12" y1="16" x2="12.01" y2="16"></line>\n                   </svg>',II:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <circle cx="12" cy="12" r="10"></circle>\n                    <line x1="12" y1="16" x2="12" y2="12"></line>\n                    <line x1="12" y1="8" x2="12.01" y2="8"></line>\n                  </svg>',I:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                   <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>\n                   <polyline points="22 4 12 14.01 9 11.01"></polyline>\n                 </svg>'};return n[e]||n.III}},{key:"renderControlContent",value:function(e){if(!e)return'<p class="control-empty">No especificado</p>';var n=(Array.isArray(e)?e:[e]).filter((function(e){return e&&"string"==typeof e&&e.trim()}));return 0===n.length?'<p class="control-empty">No especificado</p>':'\n            <ul class="control-list">\n                '.concat(n.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"\n            </ul>\n        ")}},{key:"hasControlesSugeridos",value:function(e){var n,t,a,o,i;return e.controles&&((null===(n=e.controles.eliminacion)||void 0===n?void 0:n.length)>0||(null===(t=e.controles.sustitucion)||void 0===t?void 0:t.length)>0||(null===(a=e.controles.ingenieria)||void 0===a?void 0:a.length)>0||(null===(o=e.controles.administrativos)||void 0===o?void 0:o.length)>0||(null===(i=e.controles.epp)||void 0===i?void 0:i.length)>0)}},{key:"renderControlSugerido",value:function(e,n,t,a){if(!e||0===e.length)return"";var o=(Array.isArray(e)?e:[e]).filter((function(e){return e&&"string"==typeof e&&e.trim()}));return 0===o.length?"":'\n            <div class="control-sugerido control-sugerido--'.concat(a,'">\n                <div class="control-sugerido__header">\n                    <span class="control-sugerido__badge">').concat(t,'</span>\n                    <span class="control-sugerido__title">').concat(n,'</span>\n                </div>\n                <ul class="control-sugerido__list">\n                    ').concat(o.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"\n                </ul>\n            </div>\n        ")}},{key:"attachTooltipEventListeners",value:function(){var e=this;this.container.querySelectorAll(".btn-suggestions").forEach((function(n){var t=n.dataset.riskId,a=document.getElementById("sugerencias-".concat(t));a&&n.addEventListener("click",(function(t){t.stopPropagation(),e.container.querySelectorAll(".sugerencias-ia-tooltip.active").forEach((function(e){e!==a&&e.classList.remove("active")})),e.positionTooltip(n,a),a.classList.toggle("active")}))})),document.addEventListener("click",(function(n){n.target.closest(".btn-suggestions")||n.target.closest(".sugerencias-ia-tooltip")||e.container.querySelectorAll(".sugerencias-ia-tooltip.active").forEach((function(e){e.classList.remove("active")}))}));var n=this.container.querySelector(".matriz-table-container");n&&n.addEventListener("scroll",(function(){e.container.querySelectorAll(".sugerencias-ia-tooltip.active").forEach((function(n){var t=n.id.replace("sugerencias-",""),a=e.container.querySelector('.btn-suggestions[data-risk-id="'.concat(t,'"]'));a&&e.positionTooltip(a,n)}))}))}},{key:"positionTooltip",value:function(e,n){var t=e.getBoundingClientRect(),a=window.innerWidth,o=window.innerHeight,i=t.right+12;i+380>a-20&&(i=t.left-380-12),i<20&&(i=Math.max(20,(a-380)/2));var r=t.top;r+400>o-20&&(r=o-400-20),r<20&&(r=20),n.style.left="".concat(i,"px"),n.style.top="".concat(r,"px")}},{key:"renderEmptyState",value:function(){return'\n            <div class="matriz-empty-state">\n                <div class="matriz-empty-state__icon">\n                    <i data-lucide="search-x"></i>\n                </div>\n                <h3 class="matriz-empty-state__title">No se encontraron peligros</h3>\n                <p class="matriz-empty-state__description">\n                    '.concat(this.searchTerm||Object.values(this.filters).some((function(e){return e}))?"Intenta ajustar los filtros de búsqueda":"Aún no hay peligros identificados en la matriz","\n                </p>\n                ").concat(this.searchTerm||Object.values(this.filters).some((function(e){return e}))?'\n                    <button class="btn btn--outline" id="btn-clear-search">\n                        <i data-lucide="rotate-ccw"></i>\n                        Limpiar búsqueda\n                    </button>\n                ':"","\n            </div>\n        ")}},{key:"attachEventListeners",value:function(){var e=this,n=document.getElementById("matriz-search-input");n&&n.addEventListener("input",(function(n){e.searchTerm=n.target.value.toLowerCase(),e.applyFilters()})),["nivel","cargo","tipo"].forEach((function(n){var t=document.getElementById("filter-".concat(n));t&&t.addEventListener("change",(function(t){e.filters[n]=t.target.value,e.applyFilters()}))}));var t=document.getElementById("btn-reset-filters");t&&t.addEventListener("click",(function(){return e.resetFilters()})),this.container.querySelectorAll("th.sortable").forEach((function(n){n.addEventListener("click",(function(n){var t=n.currentTarget.dataset.column;e.sortTable(t)}))})),this.container.querySelectorAll('[data-action="expand"]').forEach((function(n){n.addEventListener("click",(function(n){n.stopPropagation();var t=n.currentTarget.dataset.riskId;e.toggleRowDetails(t,n.currentTarget)}))}));var a=document.getElementById("btn-clear-search");a&&a.addEventListener("click",(function(){return e.resetFilters()})),this.attachTooltipEventListeners()}},{key:"applyFilters",value:function(){var e=this;this.filteredData=this.data.filter((function(n){if(e.searchTerm&&!"".concat(n.descripcion," ").concat(n.cargo," ").concat(n.area).toLowerCase().includes(e.searchTerm))return!1;return(!e.filters.nivel||n.nrNivel===e.filters.nivel)&&((!e.filters.cargo||n.cargo===e.filters.cargo)&&(!e.filters.tipo||n.tipo===e.filters.tipo))}));var n=this.container.querySelector(".matriz-table-container");n&&(n.innerHTML=this.renderTable(),this.attachTableEventListeners());var t=this.container.querySelector(".matriz-results-count");t&&(t.innerHTML="Mostrando <strong>".concat(this.filteredData.length,"</strong> de <strong>").concat(this.data.length,"</strong> peligros")),window.lucide&&window.lucide.createIcons()}},{key:"resetFilters",value:function(){this.searchTerm="",this.filters={nivel:"",cargo:"",tipo:""},this.sortConfig={column:null,direction:"asc"},this.render(),this.attachEventListeners()}},{key:"exportExcel",value:(e=(0,i.A)(u().mark((function e(){var n,t,a,o,i,r,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.documento&&this.documento.excelUrl){e.next=4;break}return console.error("No Excel URL available"),alert("No hay archivo Excel disponible para descargar"),e.abrupt("return");case 4:if(n=document.getElementById("btn-export-matriz-excel")){e.next=7;break}return e.abrupt("return");case 7:return t=n.innerHTML,n.disabled=!0,n.innerHTML='<i data-lucide="loader-2" class="animate-spin"></i> <span>Descargando...</span>',window.lucide&&window.lucide.createIcons(),e.prev=11,e.next=14,fetch(this.documento.excelUrl);case 14:if((a=e.sent).ok){e.next=17;break}throw new Error("Error al descargar el archivo");case 17:return e.next=19,a.blob();case 19:o=e.sent,i=window.URL.createObjectURL(o),(r=document.createElement("a")).href=i,s=this.documento.excelUrl.split("/"),c=s[s.length-1]||"Matriz_GTC45.xlsx",r.download=c,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),r.remove(),e.next=36;break;case 32:e.prev=32,e.t0=e.catch(11),console.error("Error exporting matriz:",e.t0),alert("Error al descargar el archivo Excel. Intente de nuevo.");case 36:return e.prev=36,n.disabled=!1,n.innerHTML=t,window.lucide&&window.lucide.createIcons(),e.finish(36);case 41:case"end":return e.stop()}}),e,this,[[11,32,36,41]])}))),function(){return e.apply(this,arguments)})},{key:"sortTable",value:function(e){var n=this;this.sortConfig.column===e?this.sortConfig.direction="asc"===this.sortConfig.direction?"desc":"asc":(this.sortConfig.column=e,this.sortConfig.direction="asc"),this.filteredData.sort((function(t,a){var o=t[e],i=a[e];return["nd","ne","nc","np","nr"].includes(e)?(o=Number(o),i=Number(i)):(o=String(o||"").toLowerCase(),i=String(i||"").toLowerCase()),o<i?"asc"===n.sortConfig.direction?-1:1:o>i?"asc"===n.sortConfig.direction?1:-1:0}));var t=this.container.querySelector(".matriz-table-container");t&&(t.innerHTML=this.renderTable(),this.attachTableEventListeners()),window.lucide&&window.lucide.createIcons()}},{key:"toggleRowDetails",value:function(e,n){var t=this.container.querySelector(".matriz-table-container");if(t){var a=t.querySelector("#details-".concat(e));if(!a)return console.error("Details row not found for risk:",e),void console.log("Available detail rows:",t.querySelectorAll(".risk-details"));var o=a.classList.contains("expanded");if(o?a.classList.remove("expanded"):a.classList.add("expanded"),n){var i=o?"chevron-down":"chevron-up";n.innerHTML='<i data-lucide="'.concat(i,'"></i>'),window.lucide&&window.lucide.createIcons()}}else console.error("Table container not found")}},{key:"attachTableEventListeners",value:function(){var e=this;this.container.querySelectorAll("th.sortable").forEach((function(n){n.addEventListener("click",(function(n){var t=n.currentTarget.dataset.column;e.sortTable(t)}))})),this.container.querySelectorAll('[data-action="expand"]').forEach((function(n){n.addEventListener("click",(function(n){n.stopPropagation();var t=n.currentTarget.dataset.riskId;e.toggleRowDetails(t,n.currentTarget)}))}));var n=document.getElementById("btn-clear-search");n&&n.addEventListener("click",(function(){return e.resetFilters()})),this.attachTooltipEventListeners()}}]);var e,n}();const Be=De;var qe=t(2284),He=t(7763);function Ue(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}var Fe=function(){return l((function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,e),this.container=document.getElementById(n),!this.container)throw new Error("Container #".concat(n," not found"));this.options=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ue(Object(t),!0).forEach((function(n){(0,a.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ue(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({columns:t.columns||[],data:t.data||[],pageSize:t.pageSize||10,searchable:!1!==t.searchable,sortable:!1!==t.sortable,actions:t.actions||[],onRowClick:t.onRowClick||null,emptyMessage:t.emptyMessage||"No hay datos para mostrar",loadingMessage:t.loadingMessage||"Cargando..."},t),this.currentPage=1,this.searchQuery="",this.sortColumn=null,this.sortDirection="asc",this.isLoading=!1,this.init()}),[{key:"init",value:function(){this.render(),this.attachEventListeners()}},{key:"setLoading",value:function(e){this.isLoading=e,this.render()}},{key:"setData",value:function(e){this.options.data=e,this.currentPage=1,this.render()}},{key:"getProcessedData",value:function(){var e=this,n=(0,o.A)(this.options.data);if(this.searchQuery){var t=this.searchQuery.toLowerCase();n=n.filter((function(n){return e.options.columns.some((function(a){var o=e.getCellValue(n,a.field);return o&&o.toString().toLowerCase().includes(t)}))}))}if(this.sortColumn){var a=this.options.columns.find((function(n){return n.field===e.sortColumn}));n.sort((function(n,t){var o=e.getCellValue(n,e.sortColumn),i=e.getCellValue(t,e.sortColumn);return null==o?1:null==i?-1:a.comparator?a.comparator(o,i)*("asc"===e.sortDirection?1:-1):o<i?"asc"===e.sortDirection?-1:1:o>i?"asc"===e.sortDirection?1:-1:0}))}return n}},{key:"getPaginatedData",value:function(){var e=this.getProcessedData(),n=(this.currentPage-1)*this.options.pageSize,t=n+this.options.pageSize;return e.slice(n,t)}},{key:"getCellValue",value:function(e,n){return n.split(".").reduce((function(e,n){return null==e?void 0:e[n]}),e)}},{key:"render",value:function(){var e=this.getProcessedData(),n=this.getPaginatedData(),t=Math.ceil(e.length/this.options.pageSize);this.container.innerHTML='\n            <div class="datatable">\n                '.concat(this.renderToolbar(e.length),"\n                ").concat(this.isLoading?this.renderLoading():this.renderTable(n),"\n                ").concat(!this.isLoading&&e.length>0?this.renderPagination(t):"","\n            </div>\n        ")}},{key:"renderToolbar",value:function(e){return this.options.searchable||this.options.toolbar?'\n            <div class="datatable__toolbar">\n                '.concat(this.options.searchable?'\n                    <div class="datatable__search">\n                        <input\n                            type="text"\n                            class="datatable__search-input"\n                            placeholder="Buscar..."\n                            value="'.concat(this.searchQuery,'">\n                        <i data-lucide="search"></i>\n                    </div>\n                '):"",'\n                <div class="datatable__info">\n                    ').concat(e," registro(s)\n                </div>\n                ").concat(this.options.toolbar?this.options.toolbar():"","\n            </div>\n        "):""}},{key:"renderLoading",value:function(){return'\n            <div class="datatable__loading">\n                <div class="spinner"></div>\n                <p>'.concat(this.options.loadingMessage,"</p>\n            </div>\n        ")}},{key:"renderTable",value:function(e){var n=this;return 0===e.length?'\n                <div class="datatable__empty">\n                    <i data-lucide="inbox"></i>\n                    <p>'.concat(this.options.emptyMessage,"</p>\n                </div>\n            "):'\n            <div class="datatable__wrapper">\n                <table class="datatable__table">\n                    <thead>\n                        <tr>\n                            '.concat(this.options.columns.map((function(e){return n.renderHeaderCell(e)})).join(""),"\n                            ").concat(this.options.actions.length>0?'<th class="datatable__th datatable__th--actions">Acciones</th>':"","\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ").concat(e.map((function(e,t){return n.renderRow(e,t)})).join(""),"\n                    </tbody>\n                </table>\n            </div>\n        ")}},{key:"renderHeaderCell",value:function(e){var n=this.options.sortable&&!1!==e.sortable,t=this.sortColumn===e.field,a=t?"asc"===this.sortDirection?"chevron-up":"chevron-down":"chevrons-up-down";return'\n            <th class="datatable__th '.concat(n?"datatable__th--sortable":""," ").concat(t?"datatable__th--sorted":"",'"\n                data-field="').concat(e.field,'"\n                style="').concat(e.width?"width: ".concat(e.width):"",'">\n                <div class="datatable__th-content">\n                    <span>').concat(e.label,"</span>\n                    ").concat(n?'<i data-lucide="'.concat(a,'" class="datatable__sort-icon"></i>'):"","\n                </div>\n            </th>\n        ")}},{key:"renderRow",value:function(e,n){var t=this,a="function"==typeof this.options.onRowClick;return'\n            <tr class="datatable__tr '.concat(a?"datatable__tr--clickable":"",'"\n                data-index="').concat(n,'">\n                ').concat(this.options.columns.map((function(n){return t.renderCell(e,n)})).join(""),"\n                ").concat(this.options.actions.length>0?this.renderActionsCell(e,n):"","\n            </tr>\n        ")}},{key:"renderCell",value:function(e,n){var t=this.getCellValue(e,n.field),a=n.render?n.render(t,e):null!=t?t:"";return'\n            <td class="datatable__td" data-field="'.concat(n.field,'">\n                ').concat(a,"\n            </td>\n        ")}},{key:"renderActionsCell",value:function(e,n){return'\n            <td class="datatable__td datatable__td--actions">\n                <div class="datatable__actions">\n                    '.concat(this.options.actions.map((function(e){return'\n                        <button\n                            class="datatable__action-btn"\n                            data-action="'.concat(e.name,'"\n                            data-index="').concat(n,'"\n                            title="').concat(e.label,'">\n                            <i data-lucide="').concat(e.icon,'"></i>\n                        </button>\n                    ')})).join(""),"\n                </div>\n            </td>\n        ")}},{key:"renderPagination",value:function(e){var n=this;if(e<=1)return"";var t=Math.max(1,this.currentPage-Math.floor(2.5)),a=Math.min(e,t+5-1);a-t<4&&(t=Math.max(1,a-5+1));for(var o=[],i=t;i<=a;i++)o.push(i);return'\n            <div class="datatable__pagination">\n                <button\n                    class="datatable__page-btn"\n                    data-page="'.concat(this.currentPage-1,'"\n                    ').concat(1===this.currentPage?"disabled":"",'>\n                    <i data-lucide="chevron-left"></i>\n                </button>\n\n                ').concat(t>1?'\n                    <button class="datatable__page-btn" data-page="1">1</button>\n                    '.concat(t>2?'<span class="datatable__ellipsis">...</span>':"","\n                "):"","\n\n                ").concat(o.map((function(e){return'\n                    <button\n                        class="datatable__page-btn '.concat(e===n.currentPage?"datatable__page-btn--active":"",'"\n                        data-page="').concat(e,'">\n                        ').concat(e,"\n                    </button>\n                ")})).join(""),"\n\n                ").concat(a<e?"\n                    ".concat(a<e-1?'<span class="datatable__ellipsis">...</span>':"",'\n                    <button class="datatable__page-btn" data-page="').concat(e,'">').concat(e,"</button>\n                "):"",'\n\n                <button\n                    class="datatable__page-btn"\n                    data-page="').concat(this.currentPage+1,'"\n                    ').concat(this.currentPage===e?"disabled":"",'>\n                    <i data-lucide="chevron-right"></i>\n                </button>\n            </div>\n        ')}},{key:"attachEventListeners",value:function(){var e=this;this.container.addEventListener("input",(function(n){n.target.matches(".datatable__search-input")&&(e.searchQuery=n.target.value,e.currentPage=1,e.render(),e.refreshLucide())})),this.container.addEventListener("click",(function(n){var t=n.target.closest(".datatable__th--sortable");if(t){var a=t.dataset.field;return e.sortColumn===a?e.sortDirection="asc"===e.sortDirection?"desc":"asc":(e.sortColumn=a,e.sortDirection="asc"),e.render(),void e.refreshLucide()}var o=n.target.closest(".datatable__page-btn");if(o&&!o.disabled)return e.currentPage=parseInt(o.dataset.page),e.render(),void e.refreshLucide();var i=n.target.closest(".datatable__action-btn");if(i){var r=i.dataset.action,s=parseInt(i.dataset.index),c=e.getPaginatedData()[s],l=e.options.actions.find((function(e){return e.name===r}));l&&l.handler&&l.handler(c,s)}else{var d=n.target.closest(".datatable__tr--clickable");if(d&&!n.target.closest(".datatable__action-btn")){var u=parseInt(d.dataset.index),p=e.getPaginatedData()[u];e.options.onRowClick&&e.options.onRowClick(p,u)}}}))}},{key:"refreshLucide",value:function(){window.lucide&&window.lucide.createIcons()}},{key:"destroy",value:function(){this.container.innerHTML=""}}])}();const $e=Fe;function Ge(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}var Ve=function(){return l((function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.options=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ge(Object(t),!0).forEach((function(n){(0,a.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ge(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({id:n.id||"modal-".concat(Date.now()),title:n.title||"",content:n.content||"",size:n.size||"medium",closeOnBackdrop:!1!==n.closeOnBackdrop,closeOnEsc:!1!==n.closeOnEsc,showCloseButton:!1!==n.showCloseButton,buttons:n.buttons||[],onOpen:n.onOpen||null,onClose:n.onClose||null,onConfirmClose:n.onConfirmClose||null},n),this.isOpen=!1,this.isDirty=!1,this.element=null,this.previousFocus=null,this.create()}),[{key:"create",value:function(){var e=this;this.backdrop=document.createElement("div"),this.backdrop.className="modal-backdrop",this.backdrop.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(45,50,56,0.6);z-index:9998;display:none;",document.body.appendChild(this.backdrop),this.element=document.createElement("div"),this.element.id=this.options.id,this.element.className="modal modal--".concat(this.options.size),this.element.setAttribute("role","dialog"),this.element.setAttribute("aria-modal","true"),this.element.setAttribute("aria-labelledby","".concat(this.options.id,"-title")),this.element.style.display="none",this.element.innerHTML='\n            <div class="modal__header">\n                <h2 class="modal__title" id="'.concat(this.options.id,'-title">').concat(this.options.title,"</h2>\n                ").concat(this.options.showCloseButton?'\n                    <button class="modal__close" aria-label="Cerrar modal">\n                        <i data-lucide="x"></i>\n                    </button>\n                ':"",'\n            </div>\n            <div class="modal__body">\n                ').concat(this.options.content,"\n            </div>\n            ").concat(this.options.buttons.length>0?'\n                <div class="modal__footer">\n                    '.concat(this.options.buttons.map((function(n){return e.renderButton(n)})).join(""),"\n                </div>\n            "):"","\n        "),document.body.appendChild(this.element),this.attachEventListeners(),this.refreshLucide()}},{key:"renderButton",value:function(e){return'\n            <button\n                class="btn '.concat(e.className||"btn--outline",'"\n                data-action="').concat(e.action,'"\n                ').concat(e.disabled?"disabled":"",">\n                ").concat(e.icon?'<i data-lucide="'.concat(e.icon,'"></i>'):"","\n                ").concat(e.label,"\n            </button>\n        ")}},{key:"open",value:function(){var e=this;if(!this.isOpen){this.previousFocus=document.activeElement,this.backdrop.style.display="block",this.element.style.display="block",setTimeout((function(){e.element.classList.add("open")}),10);var n=this.element.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');n&&n.focus(),document.body.style.overflow="hidden",this.isOpen=!0,this.options.onOpen&&this.options.onOpen(this)}}},{key:"close",value:(e=(0,i.A)(u().mark((function e(){var n,t=this,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>0&&void 0!==a[0]&&a[0],this.isOpen){e.next=3;break}return e.abrupt("return");case 3:if(n||!this.isDirty||!this.options.onConfirmClose){e.next=9;break}return e.next=6,this.options.onConfirmClose(this);case 6:if(e.sent){e.next=9;break}return e.abrupt("return");case 9:this.element.classList.remove("open"),setTimeout((function(){t.element.style.display="none",t.backdrop.style.display="none",document.body.style.overflow="",t.previousFocus&&t.previousFocus.focus(),t.isOpen=!1,t.options.onClose&&t.options.onClose(t)}),300);case 11:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"setContent",value:function(e){var n=this.element.querySelector(".modal__body");n&&(n.innerHTML=e,this.refreshLucide())}},{key:"setTitle",value:function(e){var n=this.element.querySelector(".modal__title");n&&(n.textContent=e)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"attachEventListeners",value:function(){var e=this;if(this.options.showCloseButton){var n=this.element.querySelector(".modal__close");n&&n.addEventListener("click",(function(){return e.close()}))}if(this.options.closeOnBackdrop){var t=this.element.querySelector(".modal__backdrop");t&&t.addEventListener("click",(function(){return e.close()}))}this.options.closeOnEsc&&(this.escHandler=function(n){"Escape"===n.key&&e.isOpen&&e.close()},document.addEventListener("keydown",this.escHandler)),this.element.addEventListener("click",(function(n){var t=n.target.closest("[data-action]");if(t){var a=t.dataset.action,o=e.options.buttons.find((function(e){return e.action===a}));o&&o.handler&&o.handler(e)}})),this.element.addEventListener("keydown",(function(n){"Tab"===n.key&&e.trapFocus(n)}))}},{key:"trapFocus",value:function(e){var n=this.element.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),t=n[0],a=n[n.length-1];e.shiftKey?document.activeElement===t&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),t.focus())}},{key:"refreshLucide",value:function(){window.lucide&&window.lucide.createIcons()}},{key:"destroy",value:function(){this.isOpen&&this.close(!0),this.escHandler&&document.removeEventListener("keydown",this.escHandler),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null}}]);var e}();Ve.confirm=function(e){return new Promise((function(n){var t=new Ve({title:e.title||"Confirmar",content:e.message||"¿Está seguro?",size:"small",buttons:[{label:e.cancelLabel||"Cancelar",className:"btn--outline",action:"cancel",handler:function(e){e.close(),n(!1)}},{label:e.confirmLabel||"Confirmar",className:e.danger?"btn--danger":"btn--primary",action:"confirm",handler:function(e){e.close(),n(!0)}}],onClose:function(){t.destroy()}});t.open()}))},Ve.alert=function(e){return new Promise((function(n){var t=new Ve({title:e.title||"Aviso",content:e.message||"",size:"small",buttons:[{label:e.buttonLabel||"Aceptar",className:"btn--primary",action:"ok",handler:function(e){e.close(),n()}}],onClose:function(){t.destroy()}});t.open()}))};const We=Ve,Je=Math.min,Xe=Math.max,Ze=Math.round,Ke=(Math.floor,e=>({x:e,y:e})),Ye={left:"right",right:"left",bottom:"top",top:"bottom"},Qe={start:"end",end:"start"};function en(e,n,t){return Xe(e,Je(n,t))}function nn(e,n){return"function"==typeof e?e(n):e}function tn(e){return e.split("-")[0]}function an(e){return e.split("-")[1]}function on(e){return"x"===e?"y":"x"}function rn(e){return"y"===e?"height":"width"}const sn=new Set(["top","bottom"]);function cn(e){return sn.has(tn(e))?"y":"x"}function ln(e){return on(cn(e))}function dn(e){return e.replace(/start|end/g,(e=>Qe[e]))}const un=["left","right"],pn=["right","left"],mn=["top","bottom"],gn=["bottom","top"];function vn(e,n,t,a){const o=an(e);let i=function(e,n,t){switch(e){case"top":case"bottom":return t?n?pn:un:n?un:pn;case"left":case"right":return n?mn:gn;default:return[]}}(tn(e),"start"===t,a);return o&&(i=i.map((e=>e+"-"+o)),n&&(i=i.concat(i.map(dn)))),i}function fn(e){return e.replace(/left|right|bottom|top/g,(e=>Ye[e]))}function hn(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function bn(e){const{x:n,y:t,width:a,height:o}=e;return{width:a,height:o,top:t,left:n,right:n+a,bottom:t+o,x:n,y:t}}function yn(e,n,t){let{reference:a,floating:o}=e;const i=cn(n),r=ln(n),s=rn(r),c=tn(n),l="y"===i,d=a.x+a.width/2-o.width/2,u=a.y+a.height/2-o.height/2,p=a[s]/2-o[s]/2;let m;switch(c){case"top":m={x:d,y:a.y-o.height};break;case"bottom":m={x:d,y:a.y+a.height};break;case"right":m={x:a.x+a.width,y:u};break;case"left":m={x:a.x-o.width,y:u};break;default:m={x:a.x,y:a.y}}switch(an(n)){case"start":m[r]-=p*(t&&l?-1:1);break;case"end":m[r]+=p*(t&&l?-1:1)}return m}async function xn(e,n){var t;void 0===n&&(n={});const{x:a,y:o,platform:i,rects:r,elements:s,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:p=!1,padding:m=0}=nn(n,e),g=hn(m),v=s[p?"floating"===u?"reference":"floating":u],f=bn(await i.getClippingRect({element:null==(t=await(null==i.isElement?void 0:i.isElement(v)))||t?v:v.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(s.floating)),boundary:l,rootBoundary:d,strategy:c})),h="floating"===u?{x:a,y:o,width:r.floating.width,height:r.floating.height}:r.reference,b=await(null==i.getOffsetParent?void 0:i.getOffsetParent(s.floating)),y=await(null==i.isElement?void 0:i.isElement(b))&&await(null==i.getScale?void 0:i.getScale(b))||{x:1,y:1},x=bn(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:h,offsetParent:b,strategy:c}):h);return{top:(f.top-x.top+g.top)/y.y,bottom:(x.bottom-f.bottom+g.bottom)/y.y,left:(f.left-x.left+g.left)/y.x,right:(x.right-f.right+g.right)/y.x}}const wn=new Set(["left","top"]);function _n(){return"undefined"!=typeof window}function En(e){return Cn(e)?(e.nodeName||"").toLowerCase():"#document"}function kn(e){var n;return(null==e||null==(n=e.ownerDocument)?void 0:n.defaultView)||window}function An(e){var n;return null==(n=(Cn(e)?e.ownerDocument:e.document)||window.document)?void 0:n.documentElement}function Cn(e){return!!_n()&&(e instanceof Node||e instanceof kn(e).Node)}function Sn(e){return!!_n()&&(e instanceof Element||e instanceof kn(e).Element)}function In(e){return!!_n()&&(e instanceof HTMLElement||e instanceof kn(e).HTMLElement)}function Mn(e){return!(!_n()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof kn(e).ShadowRoot)}const On=new Set(["inline","contents"]);function Ln(e){const{overflow:n,overflowX:t,overflowY:a,display:o}=Fn(e);return/auto|scroll|overlay|hidden|clip/.test(n+a+t)&&!On.has(o)}const Nn=new Set(["table","td","th"]);function Pn(e){return Nn.has(En(e))}const Tn=[":popover-open",":modal"];function Rn(e){return Tn.some((n=>{try{return e.matches(n)}catch(e){return!1}}))}const jn=["transform","translate","scale","rotate","perspective"],zn=["transform","translate","scale","rotate","perspective","filter"],Dn=["paint","layout","strict","content"];function Bn(e){const n=qn(),t=Sn(e)?Fn(e):e;return jn.some((e=>!!t[e]&&"none"!==t[e]))||!!t.containerType&&"normal"!==t.containerType||!n&&!!t.backdropFilter&&"none"!==t.backdropFilter||!n&&!!t.filter&&"none"!==t.filter||zn.some((e=>(t.willChange||"").includes(e)))||Dn.some((e=>(t.contain||"").includes(e)))}function qn(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const Hn=new Set(["html","body","#document"]);function Un(e){return Hn.has(En(e))}function Fn(e){return kn(e).getComputedStyle(e)}function $n(e){return Sn(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Gn(e){if("html"===En(e))return e;const n=e.assignedSlot||e.parentNode||Mn(e)&&e.host||An(e);return Mn(n)?n.host:n}function Vn(e){const n=Gn(e);return Un(n)?e.ownerDocument?e.ownerDocument.body:e.body:In(n)&&Ln(n)?n:Vn(n)}function Wn(e,n,t){var a;void 0===n&&(n=[]),void 0===t&&(t=!0);const o=Vn(e),i=o===(null==(a=e.ownerDocument)?void 0:a.body),r=kn(o);if(i){const e=Jn(r);return n.concat(r,r.visualViewport||[],Ln(o)?o:[],e&&t?Wn(e):[])}return n.concat(o,Wn(o,[],t))}function Jn(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Xn(e){const n=Fn(e);let t=parseFloat(n.width)||0,a=parseFloat(n.height)||0;const o=In(e),i=o?e.offsetWidth:t,r=o?e.offsetHeight:a,s=Ze(t)!==i||Ze(a)!==r;return s&&(t=i,a=r),{width:t,height:a,$:s}}function Zn(e){return Sn(e)?e:e.contextElement}function Kn(e){const n=Zn(e);if(!In(n))return Ke(1);const t=n.getBoundingClientRect(),{width:a,height:o,$:i}=Xn(n);let r=(i?Ze(t.width):t.width)/a,s=(i?Ze(t.height):t.height)/o;return r&&Number.isFinite(r)||(r=1),s&&Number.isFinite(s)||(s=1),{x:r,y:s}}const Yn=Ke(0);function Qn(e){const n=kn(e);return qn()&&n.visualViewport?{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}:Yn}function et(e,n,t,a){void 0===n&&(n=!1),void 0===t&&(t=!1);const o=e.getBoundingClientRect(),i=Zn(e);let r=Ke(1);n&&(a?Sn(a)&&(r=Kn(a)):r=Kn(e));const s=function(e,n,t){return void 0===n&&(n=!1),!(!t||n&&t!==kn(e))&&n}(i,t,a)?Qn(i):Ke(0);let c=(o.left+s.x)/r.x,l=(o.top+s.y)/r.y,d=o.width/r.x,u=o.height/r.y;if(i){const e=kn(i),n=a&&Sn(a)?kn(a):a;let t=e,o=Jn(t);for(;o&&a&&n!==t;){const e=Kn(o),n=o.getBoundingClientRect(),a=Fn(o),i=n.left+(o.clientLeft+parseFloat(a.paddingLeft))*e.x,r=n.top+(o.clientTop+parseFloat(a.paddingTop))*e.y;c*=e.x,l*=e.y,d*=e.x,u*=e.y,c+=i,l+=r,t=kn(o),o=Jn(t)}}return bn({width:d,height:u,x:c,y:l})}function nt(e,n){const t=$n(e).scrollLeft;return n?n.left+t:et(An(e)).left+t}function tt(e,n){const t=e.getBoundingClientRect();return{x:t.left+n.scrollLeft-nt(e,t),y:t.top+n.scrollTop}}const at=new Set(["absolute","fixed"]);function ot(e,n,t){let a;if("viewport"===n)a=function(e,n){const t=kn(e),a=An(e),o=t.visualViewport;let i=a.clientWidth,r=a.clientHeight,s=0,c=0;if(o){i=o.width,r=o.height;const e=qn();(!e||e&&"fixed"===n)&&(s=o.offsetLeft,c=o.offsetTop)}const l=nt(a);if(l<=0){const e=a.ownerDocument,n=e.body,t=getComputedStyle(n),o="CSS1Compat"===e.compatMode&&parseFloat(t.marginLeft)+parseFloat(t.marginRight)||0,r=Math.abs(a.clientWidth-n.clientWidth-o);r<=25&&(i-=r)}else l<=25&&(i+=l);return{width:i,height:r,x:s,y:c}}(e,t);else if("document"===n)a=function(e){const n=An(e),t=$n(e),a=e.ownerDocument.body,o=Xe(n.scrollWidth,n.clientWidth,a.scrollWidth,a.clientWidth),i=Xe(n.scrollHeight,n.clientHeight,a.scrollHeight,a.clientHeight);let r=-t.scrollLeft+nt(e);const s=-t.scrollTop;return"rtl"===Fn(a).direction&&(r+=Xe(n.clientWidth,a.clientWidth)-o),{width:o,height:i,x:r,y:s}}(An(e));else if(Sn(n))a=function(e,n){const t=et(e,!0,"fixed"===n),a=t.top+e.clientTop,o=t.left+e.clientLeft,i=In(e)?Kn(e):Ke(1);return{width:e.clientWidth*i.x,height:e.clientHeight*i.y,x:o*i.x,y:a*i.y}}(n,t);else{const t=Qn(e);a={x:n.x-t.x,y:n.y-t.y,width:n.width,height:n.height}}return bn(a)}function it(e,n){const t=Gn(e);return!(t===n||!Sn(t)||Un(t))&&("fixed"===Fn(t).position||it(t,n))}function rt(e,n,t){const a=In(n),o=An(n),i="fixed"===t,r=et(e,!0,i,n);let s={scrollLeft:0,scrollTop:0};const c=Ke(0);function l(){c.x=nt(o)}if(a||!a&&!i)if(("body"!==En(n)||Ln(o))&&(s=$n(n)),a){const e=et(n,!0,i,n);c.x=e.x+n.clientLeft,c.y=e.y+n.clientTop}else o&&l();i&&!a&&o&&l();const d=!o||a||i?Ke(0):tt(o,s);return{x:r.left+s.scrollLeft-c.x-d.x,y:r.top+s.scrollTop-c.y-d.y,width:r.width,height:r.height}}function st(e){return"static"===Fn(e).position}function ct(e,n){if(!In(e)||"fixed"===Fn(e).position)return null;if(n)return n(e);let t=e.offsetParent;return An(e)===t&&(t=t.ownerDocument.body),t}function lt(e,n){const t=kn(e);if(Rn(e))return t;if(!In(e)){let n=Gn(e);for(;n&&!Un(n);){if(Sn(n)&&!st(n))return n;n=Gn(n)}return t}let a=ct(e,n);for(;a&&Pn(a)&&st(a);)a=ct(a,n);return a&&Un(a)&&st(a)&&!Bn(a)?t:a||function(e){let n=Gn(e);for(;In(n)&&!Un(n);){if(Bn(n))return n;if(Rn(n))return null;n=Gn(n)}return null}(e)||t}const dt={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:n,rect:t,offsetParent:a,strategy:o}=e;const i="fixed"===o,r=An(a),s=!!n&&Rn(n.floating);if(a===r||s&&i)return t;let c={scrollLeft:0,scrollTop:0},l=Ke(1);const d=Ke(0),u=In(a);if((u||!u&&!i)&&(("body"!==En(a)||Ln(r))&&(c=$n(a)),In(a))){const e=et(a);l=Kn(a),d.x=e.x+a.clientLeft,d.y=e.y+a.clientTop}const p=!r||u||i?Ke(0):tt(r,c);return{width:t.width*l.x,height:t.height*l.y,x:t.x*l.x-c.scrollLeft*l.x+d.x+p.x,y:t.y*l.y-c.scrollTop*l.y+d.y+p.y}},getDocumentElement:An,getClippingRect:function(e){let{element:n,boundary:t,rootBoundary:a,strategy:o}=e;const i=[..."clippingAncestors"===t?Rn(n)?[]:function(e,n){const t=n.get(e);if(t)return t;let a=Wn(e,[],!1).filter((e=>Sn(e)&&"body"!==En(e))),o=null;const i="fixed"===Fn(e).position;let r=i?Gn(e):e;for(;Sn(r)&&!Un(r);){const n=Fn(r),t=Bn(r);t||"fixed"!==n.position||(o=null),(i?!t&&!o:!t&&"static"===n.position&&o&&at.has(o.position)||Ln(r)&&!t&&it(e,r))?a=a.filter((e=>e!==r)):o=n,r=Gn(r)}return n.set(e,a),a}(n,this._c):[].concat(t),a],r=i[0],s=i.reduce(((e,t)=>{const a=ot(n,t,o);return e.top=Xe(a.top,e.top),e.right=Je(a.right,e.right),e.bottom=Je(a.bottom,e.bottom),e.left=Xe(a.left,e.left),e}),ot(n,r,o));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}},getOffsetParent:lt,getElementRects:async function(e){const n=this.getOffsetParent||lt,t=this.getDimensions,a=await t(e.floating);return{reference:rt(e.reference,await n(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:n,height:t}=Xn(e);return{width:n,height:t}},getScale:Kn,isElement:Sn,isRTL:function(e){return"rtl"===Fn(e).direction}};const ut=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(n){var t,a;const{x:o,y:i,placement:r,middlewareData:s}=n,c=await async function(e,n){const{placement:t,platform:a,elements:o}=e,i=await(null==a.isRTL?void 0:a.isRTL(o.floating)),r=tn(t),s=an(t),c="y"===cn(t),l=wn.has(r)?-1:1,d=i&&c?-1:1,u=nn(n,e);let{mainAxis:p,crossAxis:m,alignmentAxis:g}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return s&&"number"==typeof g&&(m="end"===s?-1*g:g),c?{x:m*d,y:p*l}:{x:p*l,y:m*d}}(n,e);return r===(null==(t=s.offset)?void 0:t.placement)&&null!=(a=s.arrow)&&a.alignmentOffset?{}:{x:o+c.x,y:i+c.y,data:{...c,placement:r}}}}},pt=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(n){const{x:t,y:a,placement:o}=n,{mainAxis:i=!0,crossAxis:r=!1,limiter:s={fn:e=>{let{x:n,y:t}=e;return{x:n,y:t}}},...c}=nn(e,n),l={x:t,y:a},d=await xn(n,c),u=cn(tn(o)),p=on(u);let m=l[p],g=l[u];if(i){const e="y"===p?"bottom":"right";m=en(m+d["y"===p?"top":"left"],m,m-d[e])}if(r){const e="y"===u?"bottom":"right";g=en(g+d["y"===u?"top":"left"],g,g-d[e])}const v=s.fn({...n,[p]:m,[u]:g});return{...v,data:{x:v.x-t,y:v.y-a,enabled:{[p]:i,[u]:r}}}}}},mt=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(n){var t,a;const{placement:o,middlewareData:i,rects:r,initialPlacement:s,platform:c,elements:l}=n,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:v=!0,...f}=nn(e,n);if(null!=(t=i.arrow)&&t.alignmentOffset)return{};const h=tn(o),b=cn(s),y=tn(s)===s,x=await(null==c.isRTL?void 0:c.isRTL(l.floating)),w=p||(y||!v?[fn(s)]:function(e){const n=fn(e);return[dn(e),n,dn(n)]}(s)),_="none"!==g;!p&&_&&w.push(...vn(s,v,g,x));const E=[s,...w],k=await xn(n,f),A=[];let C=(null==(a=i.flip)?void 0:a.overflows)||[];if(d&&A.push(k[h]),u){const e=function(e,n,t){void 0===t&&(t=!1);const a=an(e),o=ln(e),i=rn(o);let r="x"===o?a===(t?"end":"start")?"right":"left":"start"===a?"bottom":"top";return n.reference[i]>n.floating[i]&&(r=fn(r)),[r,fn(r)]}(o,r,x);A.push(k[e[0]],k[e[1]])}if(C=[...C,{placement:o,overflows:A}],!A.every((e=>e<=0))){var S,I;const e=((null==(S=i.flip)?void 0:S.index)||0)+1,n=E[e];if(n){if(!("alignment"===u&&b!==cn(n))||C.every((e=>cn(e.placement)!==b||e.overflows[0]>0)))return{data:{index:e,overflows:C},reset:{placement:n}}}let t=null==(I=C.filter((e=>e.overflows[0]<=0)).sort(((e,n)=>e.overflows[1]-n.overflows[1]))[0])?void 0:I.placement;if(!t)switch(m){case"bestFit":{var M;const e=null==(M=C.filter((e=>{if(_){const n=cn(e.placement);return n===b||"y"===n}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,n)=>e+n),0)])).sort(((e,n)=>e[1]-n[1]))[0])?void 0:M[0];e&&(t=e);break}case"initialPlacement":t=s}if(o!==t)return{reset:{placement:t}}}return{}}}},gt=e=>({name:"arrow",options:e,async fn(n){const{x:t,y:a,placement:o,rects:i,platform:r,elements:s,middlewareData:c}=n,{element:l,padding:d=0}=nn(e,n)||{};if(null==l)return{};const u=hn(d),p={x:t,y:a},m=ln(o),g=rn(m),v=await r.getDimensions(l),f="y"===m,h=f?"top":"left",b=f?"bottom":"right",y=f?"clientHeight":"clientWidth",x=i.reference[g]+i.reference[m]-p[m]-i.floating[g],w=p[m]-i.reference[m],_=await(null==r.getOffsetParent?void 0:r.getOffsetParent(l));let E=_?_[y]:0;E&&await(null==r.isElement?void 0:r.isElement(_))||(E=s.floating[y]||i.floating[g]);const k=x/2-w/2,A=E/2-v[g]/2-1,C=Je(u[h],A),S=Je(u[b],A),I=C,M=E-v[g]-S,O=E/2-v[g]/2+k,L=en(I,O,M),N=!c.arrow&&null!=an(o)&&O!==L&&i.reference[g]/2-(O<I?C:S)-v[g]/2<0,P=N?O<I?O-I:O-M:0;return{[m]:p[m]+P,data:{[m]:L,centerOffset:O-L-P,...N&&{alignmentOffset:P}},reset:N}}}),vt=(e,n,t)=>{const a=new Map,o={platform:dt,...t},i={...o.platform,_c:a};return(async(e,n,t)=>{const{placement:a="bottom",strategy:o="absolute",middleware:i=[],platform:r}=t,s=i.filter(Boolean),c=await(null==r.isRTL?void 0:r.isRTL(n));let l=await r.getElementRects({reference:e,floating:n,strategy:o}),{x:d,y:u}=yn(l,a,c),p=a,m={},g=0;for(let t=0;t<s.length;t++){const{name:i,fn:v}=s[t],{x:f,y:h,data:b,reset:y}=await v({x:d,y:u,initialPlacement:a,placement:p,strategy:o,middlewareData:m,rects:l,platform:r,elements:{reference:e,floating:n}});d=null!=f?f:d,u=null!=h?h:u,m={...m,[i]:{...m[i],...b}},y&&g<=50&&(g++,"object"==typeof y&&(y.placement&&(p=y.placement),y.rects&&(l=!0===y.rects?await r.getElementRects({reference:e,floating:n,strategy:o}):y.rects),({x:d,y:u}=yn(l,p,c))),t=-1)}return{x:d,y:u,placement:p,strategy:o,middlewareData:m}})(e,n,{...o,platform:i})};var ft=function(){return l((function e(){r(this,e),this.tooltip=null,this.arrowEl=null,this.currentTarget=null,this.showTimeout=null,this.hideTimeout=null,this.cleanup=null,this.init()}),[{key:"init",value:function(){this.createTooltipElement(),this.injectStyles(),this.setupEventListeners()}},{key:"createTooltipElement",value:function(){this.tooltip=document.createElement("div"),this.tooltip.className="floating-tooltip",this.tooltip.setAttribute("role","tooltip"),this.tooltip.style.display="none";var e=document.createElement("div");e.className="floating-tooltip__content",this.tooltip.appendChild(e),this.arrowEl=document.createElement("div"),this.arrowEl.className="floating-tooltip__arrow",this.tooltip.appendChild(this.arrowEl),document.body.appendChild(this.tooltip)}},{key:"injectStyles",value:function(){if(!document.getElementById("floating-tooltip-styles")){var e=document.createElement("style");e.id="floating-tooltip-styles",e.textContent='\n            .floating-tooltip {\n                position: absolute;\n                top: 0;\n                left: 0;\n                z-index: 10000;\n                max-width: 280px;\n                pointer-events: none;\n                opacity: 0;\n                transform: scale(0.95);\n                transition: opacity 0.15s ease, transform 0.15s ease;\n            }\n\n            .floating-tooltip--visible {\n                opacity: 1;\n                transform: scale(1);\n            }\n\n            .floating-tooltip__content {\n                background: #1f2937;\n                color: #f3f4f6;\n                padding: 8px 12px;\n                border-radius: 6px;\n                font-size: 13px;\n                line-height: 1.4;\n                font-family: \'Raleway\', system-ui, sans-serif;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25),\n                            0 2px 4px rgba(0, 0, 0, 0.15);\n                border: 1px solid rgba(255, 255, 255, 0.08);\n            }\n\n            .floating-tooltip__arrow {\n                position: absolute;\n                width: 8px;\n                height: 8px;\n                background: #1f2937;\n                transform: rotate(45deg);\n            }\n\n            /* Arrow positioning based on placement */\n            .floating-tooltip[data-placement^="top"] .floating-tooltip__arrow {\n                bottom: -4px;\n                border-right: 1px solid rgba(255, 255, 255, 0.08);\n                border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n            }\n\n            .floating-tooltip[data-placement^="bottom"] .floating-tooltip__arrow {\n                top: -4px;\n                border-left: 1px solid rgba(255, 255, 255, 0.08);\n                border-top: 1px solid rgba(255, 255, 255, 0.08);\n            }\n\n            .floating-tooltip[data-placement^="left"] .floating-tooltip__arrow {\n                right: -4px;\n                border-right: 1px solid rgba(255, 255, 255, 0.08);\n                border-top: 1px solid rgba(255, 255, 255, 0.08);\n            }\n\n            .floating-tooltip[data-placement^="right"] .floating-tooltip__arrow {\n                left: -4px;\n                border-left: 1px solid rgba(255, 255, 255, 0.08);\n                border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n            }\n\n            /* Title styling */\n            .floating-tooltip__title {\n                font-weight: 600;\n                color: #5dc4af;\n                margin-bottom: 4px;\n                font-size: 13px;\n            }\n\n            /* Description styling */\n            .floating-tooltip__description {\n                color: #d1d5db;\n            }\n\n            /* Keyboard shortcut styling */\n            .floating-tooltip__shortcut {\n                display: inline-block;\n                background: rgba(255, 255, 255, 0.1);\n                padding: 2px 6px;\n                border-radius: 4px;\n                font-family: \'Monaco\', \'Menlo\', monospace;\n                font-size: 11px;\n                color: #9ca3af;\n                margin-left: 8px;\n            }\n\n            /* High contrast mode */\n            @media (prefers-contrast: high) {\n                .floating-tooltip__content {\n                    background: #000;\n                    border: 2px solid #fff;\n                }\n                .floating-tooltip__arrow {\n                    background: #000;\n                    border-color: #fff;\n                }\n            }\n\n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                .floating-tooltip {\n                    transition: none;\n                }\n            }\n        ',document.head.appendChild(e)}}},{key:"setupEventListeners",value:function(){var e=this;document.addEventListener("mouseenter",(function(n){if(n.target&&"function"==typeof n.target.closest){var t=n.target.closest("[data-tooltip]");t&&e.handleMouseEnter(t)}}),!0),document.addEventListener("mouseleave",(function(n){if(n.target&&"function"==typeof n.target.closest){var t=n.target.closest("[data-tooltip]");t&&e.handleMouseLeave(t)}}),!0),document.addEventListener("focusin",(function(n){if(n.target&&"function"==typeof n.target.closest){var t=n.target.closest("[data-tooltip]");t&&e.handleMouseEnter(t)}}),!0),document.addEventListener("focusout",(function(n){if(n.target&&"function"==typeof n.target.closest){var t=n.target.closest("[data-tooltip]");t&&e.handleMouseLeave(t)}}),!0),document.addEventListener("scroll",(function(){e.hide()}),!0)}},{key:"handleMouseEnter",value:function(e){var n=this;clearTimeout(this.hideTimeout),this.showTimeout=setTimeout((function(){var t=e.getAttribute("data-tooltip"),a=e.getAttribute("data-tooltip-placement")||"top",o=e.getAttribute("data-tooltip-title"),i=e.getAttribute("data-tooltip-shortcut");n.show(e,t,{placement:a,title:o,shortcut:i})}),200)}},{key:"handleMouseLeave",value:function(e){var n=this;clearTimeout(this.showTimeout),this.hideTimeout=setTimeout((function(){n.hide()}),100)}},{key:"show",value:(e=(0,i.A)(u().mark((function e(n,t){var a,o,i,r,s,c,l,d,p,m,g,v,f,h,b=this,y=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(a=y.length>2&&void 0!==y[2]?y[2]:{}).placement,i=void 0===o?"top":o,r=a.title,s=a.shortcut,this.currentTarget=n,c="",r&&(c+='<div class="floating-tooltip__title">'.concat(r,"</div>")),c+='<span class="floating-tooltip__description">'.concat(t,"</span>"),s&&(c+='<span class="floating-tooltip__shortcut">'.concat(s,"</span>")),this.tooltip.querySelector(".floating-tooltip__content").innerHTML=c,this.tooltip.style.display="block",e.next=11,vt(n,this.tooltip,{placement:i,middleware:[ut(8),mt({fallbackAxisSideDirection:"start"}),pt({padding:8}),gt({element:this.arrowEl})]});case 11:l=e.sent,d=l.x,p=l.y,m=l.placement,g=l.middlewareData,Object.assign(this.tooltip.style,{left:"".concat(d,"px"),top:"".concat(p,"px")}),this.tooltip.setAttribute("data-placement",m),g.arrow&&(v=g.arrow,f=v.x,h=v.y,Object.assign(this.arrowEl.style,{left:null!=f?"".concat(f,"px"):"",top:null!=h?"".concat(h,"px"):""})),requestAnimationFrame((function(){b.tooltip.classList.add("floating-tooltip--visible")}));case 20:case"end":return e.stop()}}),e,this)}))),function(n,t){return e.apply(this,arguments)})},{key:"hide",value:function(){var e=this;this.tooltip.classList.remove("floating-tooltip--visible"),setTimeout((function(){e.tooltip.classList.contains("floating-tooltip--visible")||(e.tooltip.style.display="none")}),150),this.currentTarget=null}},{key:"destroy",value:function(){clearTimeout(this.showTimeout),clearTimeout(this.hideTimeout),this.tooltip&&this.tooltip.parentNode&&this.tooltip.parentNode.removeChild(this.tooltip);var e=document.getElementById("floating-tooltip-styles");e&&e.remove()}}]);var e}(),ht=null,bt={init:function(){return ht||(ht=new ft),ht},show:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};ht||this.init(),ht.show(e,n,t)},hide:function(){ht&&ht.hide()},destroy:function(){ht&&(ht.destroy(),ht=null)}};var yt="/api",xt={ADMIN_GENESYS:"admin_genesys",MEDICO_OCUPACIONAL:"medico_ocupacional",EMPRESA:"empresa"},wt={user:null,rol:null,token:null,empresaSeleccionada:null,data:{empresas:[],medicos:[],pagos:[],auditoria:[]}};function _t(){return Et.apply(this,arguments)}function Et(){return(Et=(0,i.A)(u().mark((function e(){var n,t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Inicializando dashboard multi-rol..."),bt.init(),console.log("[MultiRol] ✅ Tooltips inicializados"),n=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),t=localStorage.getItem("genesys_user")||sessionStorage.getItem("genesys_user"),n){e.next=9;break}return console.warn("[MultiRol] No hay token, redirigiendo a login..."),window.location.href="/pages/login.html",e.abrupt("return");case 9:if(t){e.next=12;break}return console.warn("[MultiRol] No hay usuario en localStorage, pero hay token. Continuando..."),e.abrupt("return");case 12:return e.prev=12,wt.token=n,wt.user=JSON.parse(t),wt.rol=wt.user.rol||"empresa",console.log("[MultiRol] Usuario:",wt.user.full_name),console.log("[MultiRol] Rol:",wt.rol),console.log("[MultiRol] 🔄 Ejecutando configureRoleBasedUI..."),e.next=21,kt();case 21:console.log("[MultiRol] ✅ configureRoleBasedUI completado"),console.log("[MultiRol] 🔄 Ejecutando configureSidebarForRole...");try{Mt(),console.log("[MultiRol] ✅ configureSidebarForRole completado")}catch(e){console.error("[MultiRol] ❌ Error en configureSidebarForRole:",e)}return console.log("[MultiRol] 🔄 Ejecutando loadInitialDataForRole..."),e.next=27,Ot();case 27:if(console.log("[MultiRol] ✅ loadInitialDataForRole completado"),wt.rol===xt.MEDICO_OCUPACIONAL&&(console.log("[MultiRol] 🔄 Inicializando selector de empresas del médico..."),St(),console.log("[MultiRol] ✅ Selector de empresas inicializado")),jt(),a=window.location.hash.replace("#","")||"home",!window.multiRolPageHandlers||!window.multiRolPageHandlers[a]){e.next=35;break}return console.log("[MultiRol] 🔄 Cargando datos de página actual:",a),e.next=35,window.multiRolPageHandlers[a]();case 35:window.addEventListener("firmaDigitalActualizada",(function(e){var n;console.log("[MultiRol] 📝 Firma digital actualizada:",e.detail),wt.data.tieneFirma=e.detail.tieneFirma,wt.data.firma=e.detail.firma;var t=null===(n=document.querySelector('.dashboard-page[style*="display: block"]'))||void 0===n?void 0:n.id;"page-home"===t&&wt.rol===xt.MEDICO_OCUPACIONAL&&(console.log("[MultiRol] Re-renderizando dashboard médico..."),Ut()),"page-config"===t&&wt.rol===xt.MEDICO_OCUPACIONAL&&(console.log("[MultiRol] Re-renderizando config médico..."),_a())})),window.addEventListener("empresaSeleccionada",(function(e){console.log("[MultiRol] 🏢 Empresa seleccionada:",e.detail);var n=e.detail,t=n.empresaId;n.empresa;if(wt.rol===xt.MEDICO_OCUPACIONAL&&t){var a=document.getElementById("select-empresa-profesiograma");a&&a.value!==t&&(a.value=t);var o=document.getElementById("page-profesiograma");o&&"none"!==o.style.display&&(console.log("[MultiRol] Cargando profesiograma automáticamente para empresa:",t),fa(t))}})),e.next=43;break;case 39:e.prev=39,e.t0=e.catch(12),console.error("[MultiRol] Error inicializando:",e.t0),Ia("Error cargando dashboard","error");case 43:case"end":return e.stop()}}),e,null,[[12,39]])})))).apply(this,arguments)}function kt(){return At.apply(this,arguments)}function At(){return(At=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=wt.rol,Ct(wt.user,n),document.querySelectorAll("[data-role-visible]").forEach((function(e){var t=e.dataset.roleVisible.split(",");e.style.display=t.includes(n)?"":"none"})),document.body.classList.remove("rol-admin","rol-medico","rol-empresa"),document.body.classList.add("rol-".concat(n.replace("_","-")));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(e,n){var t=document.getElementById("user-name"),o=document.getElementById("user-role"),i=document.getElementById("company-info"),r=document.getElementById("company-name"),s=document.querySelector(".header-company-info__details");if(t&&(t.textContent=e.full_name||e.email),o){var c=(0,a.A)((0,a.A)((0,a.A)({},xt.ADMIN_GENESYS,"Administrador Genesys"),xt.MEDICO_OCUPACIONAL,"Médico Ocupacional"),xt.EMPRESA,"Usuario Empresa");o.textContent=c[n]||n}i&&(n===xt.ADMIN_GENESYS?i.innerHTML='\n                <div class="header-company-info__main">\n                    <span class="header-company-info__name">Genesys Laboral Medicine</span>\n                </div>\n            ':n===xt.MEDICO_OCUPACIONAL?i.innerHTML='\n                <div class="header-medico-info">\n                    <div class="header-medico-info__identity">\n                        <span class="header-medico-info__name">'.concat(e.full_name||"Médico Ocupacional",'</span>\n                        <span class="header-medico-info__license" data-tooltip="Licencia de Seguridad y Salud en el Trabajo" data-tooltip-placement="bottom">\n                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>\n                                <polyline points="22 4 12 14.01 9 11.01"></polyline>\n                            </svg>\n                            Lic. SST: ').concat(e.licencia_sst||"No registrada",'\n                        </span>\n                    </div>\n                    <div class="header-medico-info__separator"></div>\n                    <div class="header-medico-info__empresa">\n                        <label for="header-empresa-selector">Empresa:</label>\n                        <select id="header-empresa-selector" class="header-empresa-select">\n                            <option value="">Cargando...</option>\n                        </select>\n                    </div>\n                </div>\n            '):(r&&(r.textContent=e.company_name||"Mi Empresa"),s&&(s.style.display="flex")))}function St(){var e=document.getElementById("header-empresa-selector");if(e){var n=wt.data.empresas||[];e.innerHTML='\n        <option value="">Seleccionar empresa...</option>\n        '.concat(n.map((function(e){return'\n            <option value="'.concat(e.empresa_id,'" data-nit="').concat(e.nit,'" data-ciudad="').concat(e.ciudad||"N/A",'">\n                ').concat(e.nombre_legal,"\n            </option>\n        ")})).join(""),"\n    "),wt.empresaSeleccionada&&(e.value=wt.empresaSeleccionada,It(wt.empresaSeleccionada)),e.addEventListener("change",(function(e){var t=e.target.value;if(wt.empresaSeleccionada=t,t)It(t),window.dispatchEvent(new CustomEvent("empresaSeleccionada",{detail:{empresaId:t,empresa:n.find((function(e){return e.empresa_id==t}))}}));else{var a=document.getElementById("empresa-details");a&&(a.style.display="none")}}))}}function It(e){var n=(wt.data.empresas||[]).find((function(n){return n.empresa_id==e})),t=document.getElementById("empresa-details"),a=document.getElementById("empresa-nit-value"),o=document.getElementById("empresa-ciudad-value");n&&t&&(t.style.display="flex",a&&(a.textContent=n.nit||"-"),o&&(o.textContent=n.ciudad||"Sin ciudad"))}function Mt(){var e=wt.rol;console.log("[MultiRol] Configurando sidebar para rol:",e);var n=document.getElementById("sidebar");if(n){var t=(0,a.A)((0,a.A)((0,a.A)({},xt.ADMIN_GENESYS,{visible:["home","admin-empresas","admin-medicos","admin-pagos","admin-auditoria","config"],hidden:["mapa-org","cargos","matriz","profesiograma","examenes","documentos","inteligencia","estadisticas","sve","psicosocial","panel-medico"]}),xt.MEDICO_OCUPACIONAL,{visible:["home","profesiograma","examenes","documentos","config"],hidden:["mapa-org","cargos","matriz","inteligencia","estadisticas","sve","psicosocial","admin-empresas","admin-medicos","admin-pagos","admin-auditoria"]}),xt.EMPRESA,{visible:["home","mapa-org","cargos","matriz","profesiograma","examenes","documentos","inteligencia","estadisticas","sve","psicosocial","panel-medico","config"],hidden:["admin-empresas","admin-medicos","admin-pagos","admin-auditoria"]}),o=t[e]||t[xt.EMPRESA],i=n.querySelectorAll(".sidebar-nav__item[data-page]"),r=0,s=0;console.log("[MultiRol] Encontrados",i.length,"items de navegación"),i.forEach((function(e){var n=e.dataset.page,t=e.parentElement;n&&o.hidden.includes(n)?(t.style.display="none",s++,console.log("[MultiRol] Ocultando pestaña:",n)):(t.style.display="",r++,console.log("[MultiRol] Mostrando pestaña:",n))})),console.log("[MultiRol] Sidebar configurado: ".concat(r," pestañas visibles, ").concat(s," ocultas"))}else console.warn("[MultiRol] Sidebar no encontrado")}function Ot(){return Lt.apply(this,arguments)}function Lt(){return(Lt=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=wt.rol,wt.token,e.prev=1,e.t0=n,e.next=e.t0===xt.ADMIN_GENESYS?5:e.t0===xt.MEDICO_OCUPACIONAL?8:11;break;case 5:return e.next=7,Nt();case 7:return e.abrupt("break",12);case 8:return e.next=10,Tt();case 10:case 11:return e.abrupt("break",12);case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(1),console.error("[MultiRol] Error cargando datos iniciales:",e.t1);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function Nt(){return Pt.apply(this,arguments)}function Pt(){return(Pt=(0,i.A)(u().mark((function e(){var t,a,o,i,r,s,c,l,d,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=wt.token,e.prev=1,e.next=4,Promise.all([fetch("".concat(yt,"/admin/empresas?limit=100"),{headers:{Authorization:"Bearer ".concat(t)}}),fetch("".concat(yt,"/admin/medicos"),{headers:{Authorization:"Bearer ".concat(t)}}),fetch("".concat(yt,"/admin/pagos?estado=pendiente&limit=10"),{headers:{Authorization:"Bearer ".concat(t)}})]);case 4:if(a=e.sent,o=n(a,3),i=o[0],r=o[1],s=o[2],!i.ok){e.next=14;break}return e.next=12,i.json();case 12:c=e.sent,wt.data.empresas=c.empresas||[];case 14:if(!r.ok){e.next=19;break}return e.next=17,r.json();case 17:l=e.sent,wt.data.medicos=l.medicos||[];case 19:if(!s.ok){e.next=25;break}return e.next=22,s.json();case 22:p=e.sent,wt.data.pagos=p.pagos||[],wt.data.pagosPendientes=(null===(d=p.pagination)||void 0===d?void 0:d.total)||0;case 25:return console.log("[MultiRol] Datos admin cargados"),e.next=28,zt();case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(1),console.error("[MultiRol] Error cargando datos admin:",e.t0);case 33:case"end":return e.stop()}}),e,null,[[1,30]])})))).apply(this,arguments)}function Tt(){return Rt.apply(this,arguments)}function Rt(){return(Rt=(0,i.A)(u().mark((function e(){var t,a,o,i,r,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=wt.token,e.prev=1,e.next=4,Promise.all([fetch("".concat(yt,"/medico/empresas"),{headers:{Authorization:"Bearer ".concat(t)}}),fetch("".concat(yt,"/medico/firma"),{headers:{Authorization:"Bearer ".concat(t)}})]);case 4:if(a=e.sent,o=n(a,2),i=o[0],r=o[1],!i.ok){e.next=13;break}return e.next=11,i.json();case 11:s=e.sent,wt.data.empresas=s.empresas||[];case 13:if(!r.ok){e.next=19;break}return e.next=16,r.json();case 16:c=e.sent,wt.data.firma=c.firma,wt.data.tieneFirma=c.tieneFirma;case 19:return console.log("[MultiRol] Datos médico cargados"),e.next=22,Ut();case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(1),console.error("[MultiRol] Error cargando datos médico:",e.t0);case 27:case"end":return e.stop()}}),e,null,[[1,24]])})))).apply(this,arguments)}function jt(){var e=wt.rol;window.multiRolPageHandlers={"admin-home":Gt,"admin-empresas":Xt,"admin-medicos":Kt,"admin-pagos":Qt,"admin-auditoria":ta,"admin-config":sa,"medico-home":la,"medico-empresas":pa,"medico-profesiograma":ga,"medico-examenes":ba,"medico-firma":xa,"medico-config":_a},e===xt.MEDICO_OCUPACIONAL?(window.multiRolPageHandlers.config=_a,window.multiRolPageHandlers.profesiograma=ga,console.log("[MultiRol] Handlers de config y profesiograma sobrescritos para médico")):e===xt.ADMIN_GENESYS&&(window.multiRolPageHandlers.config=sa,console.log("[MultiRol] Handler de config sobrescrito para admin"))}function zt(){return Dt.apply(this,arguments)}function Dt(){return Dt=(0,i.A)(u().mark((function e(){var n,t,a,o,i,r,s,c,l,d,p,m,g;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Renderizando dashboard admin..."),n=document.querySelector("#page-home")){e.next=5;break}return console.warn("[MultiRol] No se encontró la página home"),e.abrupt("return");case 5:t=wt.data,a=t.empresas,o=void 0===a?[]:a,i=t.medicos,r=void 0===i?[]:i,s=t.pagos,c=void 0===s?[]:s,l=t.pagosPendientes,d=void 0===l?0:l,p=o.length,m=r.length,g=o.filter((function(e){return"activo"===e.status})).length,n.innerHTML='\n        <div class="page-header">\n            <h1 class="page-header__title">Panel de Administración Genesys</h1>\n            <div class="page-header__meta">\n                <div class="live-indicator">\n                    <span class="live-indicator__dot"></span>\n                    <span>Sistema en línea</span>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Estadísticas principales --\x3e\n        <div class="dashboard-grid dashboard-grid--cols-4">\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="building-2"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">'.concat(p,'</div>\n                    <div class="metric-label">Empresas Registradas</div>\n                    <div class="metric-sublabel">\n                        <span style="color: #4caf50;">').concat(g,'</span> activas\n                    </div>\n                </div>\n            </div>\n\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="user-cog"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">').concat(m,'</div>\n                    <div class="metric-label">Médicos Ocupacionales</div>\n                    <div class="metric-sublabel">Registrados en el sistema</div>\n                </div>\n            </div>\n\n            <div class="card card--metric card--warning">\n                <div class="card__icon">\n                    <i data-lucide="credit-card"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value metric-value--warning">').concat(d,'</div>\n                    <div class="metric-label">Pagos Pendientes</div>\n                    <div class="metric-sublabel">Requieren revisión</div>\n                </div>\n            </div>\n\n            <div class="card card--metric card--success">\n                <div class="card__icon">\n                    <i data-lucide="activity"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value metric-value--success">100%</div>\n                    <div class="metric-label">Sistema Operativo</div>\n                    <div class="metric-sublabel">Todos los servicios OK</div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Sección de accesos rápidos --\x3e\n        <div class="dashboard-grid dashboard-grid--cols-2" style="margin-top: 2.4rem;">\n            <div class="card card--link" data-navigate="admin-empresas">\n                <div class="card__header">\n                    <h3 class="card__title">Gestión de Empresas</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Administra todas las empresas registradas en el sistema\n                    </p>\n                    ').concat(Bt(o.slice(0,3)),'\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="admin-medicos">\n                <div class="card__header">\n                    <h3 class="card__title">Gestión de Médicos</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Administra médicos ocupacionales y sus asignaciones\n                    </p>\n                    ').concat(qt(r.slice(0,3)),'\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="admin-pagos">\n                <div class="card__header">\n                    <h3 class="card__title">Pagos Manuales</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Revisa y aprueba pagos pendientes de validación\n                    </p>\n                    ').concat(Ht(c.slice(0,3)),'\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="admin-auditoria">\n                <div class="card__header">\n                    <h3 class="card__title">Auditoría del Sistema</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Consulta logs y actividad del sistema\n                    </p>\n                    <div style="padding: 1.6rem; background: #f8f9fa; border-radius: 8px; text-align: center;">\n                        <i data-lucide="shield-check" style="width: 32px; height: 32px; color: #5dc4af;"></i>\n                        <p style="margin-top: 0.8rem; font-size: 1.3rem; color: #666;">\n                            Sistema monitoreado 24/7\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '),window.lucide&&window.lucide.createIcons(),n.querySelectorAll("[data-navigate]").forEach((function(e){e.style.cursor="pointer",e.addEventListener("click",(function(e){var n=e.currentTarget.dataset.navigate;console.log("[MultiRol] Navegando a:",n);var t=document.querySelector('[data-page="'.concat(n,'"]'));t&&t.click()}))}));case 12:case"end":return e.stop()}}),e)}))),Dt.apply(this,arguments)}function Bt(e){return e&&0!==e.length?'\n        <ul style="list-style: none; padding: 0; margin: 0;">\n            '.concat(e.map((function(e){return'\n                <li style="padding: 1rem 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">\n                    <div>\n                        <div style="font-weight: 500; color: #2d3238; font-size: 1.4rem;">'.concat(e.nombre_legal||"Sin nombre",'</div>\n                        <div style="font-size: 1.2rem; color: #999;">').concat(e.ciudad||"Sin ciudad",'</div>\n                    </div>\n                    <span class="badge ').concat("activo"===e.status?"badge--success":"badge--secondary",'" style="font-size: 1.1rem;">\n                        ').concat(e.status||"inactivo","\n                    </span>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p style="color: #999; font-size: 1.3rem; text-align: center;">No hay empresas registradas</p>'}function qt(e){return e&&0!==e.length?'\n        <ul style="list-style: none; padding: 0; margin: 0;">\n            '.concat(e.map((function(e){return'\n                <li style="padding: 1rem 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">\n                    <div>\n                        <div style="font-weight: 500; color: #2d3238; font-size: 1.4rem;">'.concat(e.full_name||e.email,'</div>\n                        <div style="font-size: 1.2rem; color: #999;">Licencia: ').concat(e.licencia_sst||"N/A","</div>\n                    </div>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p style="color: #999; font-size: 1.3rem; text-align: center;">No hay médicos registrados</p>'}function Ht(e){return e&&0!==e.length?'\n        <ul style="list-style: none; padding: 0; margin: 0;">\n            '.concat(e.map((function(e){return'\n                <li style="padding: 1rem 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">\n                    <div>\n                        <div style="font-weight: 500; color: #2d3238; font-size: 1.4rem;">'.concat(e.empresa_nombre||"Empresa",'</div>\n                        <div style="font-size: 1.2rem; color: #999;">$').concat((e.monto||0).toLocaleString("es-CO"),'</div>\n                    </div>\n                    <span class="badge badge--warning" style="font-size: 1.1rem;">Pendiente</span>\n                </li>\n            ')})).join(""),"\n        </ul>\n    "):'<p style="color: #999; font-size: 1.3rem; text-align: center;">No hay pagos pendientes</p>'}function Ut(){return Ft.apply(this,arguments)}function Ft(){return Ft=(0,i.A)(u().mark((function e(){var n,t,a,o,i,r,s,c,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Renderizando dashboard médico..."),n=document.querySelector("#page-home")){e.next=5;break}return console.warn("[MultiRol] No se encontró la página home"),e.abrupt("return");case 5:t=wt.data,a=t.empresas,o=void 0===a?[]:a,t.firma,i=t.tieneFirma,r=void 0!==i&&i,s=wt.user,c=o.length,l=o.filter((function(e){return"activo"===e.status||"activa"===e.status})).length,n.innerHTML='\n        <div class="page-header">\n            <h1 class="page-header__title">Panel Médico Ocupacional</h1>\n            <div class="page-header__meta">\n                <div class="live-indicator">\n                    <span class="live-indicator__dot"></span>\n                    <span>Dr(a). '.concat(s.full_name||s.email,"</span>\n                </div>\n                ").concat(s.licencia_sst?'<span style="margin-left: 1.6rem;">Licencia SST: '.concat(s.licencia_sst,"</span>"):"","\n            </div>\n        </div>\n\n        \x3c!-- Alerta de firma digital --\x3e\n        ").concat(r?"":'\n            <div class="card card--warning" style="margin-bottom: 2.4rem;">\n                <div class="card__body" style="display: flex; align-items: center; gap: 1.6rem;">\n                    <i data-lucide="alert-triangle" style="width: 32px; height: 32px; color: #ff9800;"></i>\n                    <div style="flex: 1;">\n                        <h3 style="margin: 0 0 0.4rem 0; font-size: 1.6rem; color: #2d3238;">Firma Digital Pendiente</h3>\n                        <p style="margin: 0; color: #666; font-size: 1.4rem;">\n                            Para poder firmar profesiogramas y documentos médicos, necesitas configurar tu firma digital.\n                        </p>\n                    </div>\n                    <button class="btn btn--primary" onclick="document.querySelector(\'[data-page=config]\').click()">\n                        <i data-lucide="pen-tool"></i>\n                        Configurar Firma\n                    </button>\n                </div>\n            </div>\n        ','\n\n        \x3c!-- Estadísticas principales --\x3e\n        <div class="dashboard-grid dashboard-grid--cols-4">\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="building-2"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">').concat(c,'</div>\n                    <div class="metric-label">Empresas Asignadas</div>\n                    <div class="metric-sublabel">\n                        <span style="color: #4caf50;">').concat(l,'</span> activas\n                    </div>\n                </div>\n            </div>\n\n            <div class="card card--metric ').concat(r?"card--success":"card--warning",'">\n                <div class="card__icon">\n                    <i data-lucide="').concat(r?"check-circle":"pen-tool",'"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value ').concat(r?"metric-value--success":"metric-value--warning",'">\n                        ').concat(r?"✓":"!",'\n                    </div>\n                    <div class="metric-label">Firma Digital</div>\n                    <div class="metric-sublabel">').concat(r?"Configurada":"Pendiente",'</div>\n                </div>\n            </div>\n\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="file-text"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">0</div>\n                    <div class="metric-label">Profesiogramas</div>\n                    <div class="metric-sublabel">Pendientes de firma</div>\n                </div>\n            </div>\n\n            <div class="card card--metric">\n                <div class="card__icon">\n                    <i data-lucide="clipboard-list"></i>\n                </div>\n                <div class="card__body">\n                    <div class="metric-value">0</div>\n                    <div class="metric-label">Exámenes</div>\n                    <div class="metric-sublabel">Próximos a vencer</div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Accesos rápidos --\x3e\n        <div class="dashboard-grid dashboard-grid--cols-2" style="margin-top: 2.4rem;">\n            <div class="card card--link" data-navigate="profesiograma">\n                <div class="card__header">\n                    <h3 class="card__title">Profesiogramas</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Revisa y firma profesiogramas de las empresas asignadas\n                    </p>\n                    <div style="padding: 1.6rem; background: #f8f9fa; border-radius: 8px; text-align: center;">\n                        <i data-lucide="file-text" style="width: 32px; height: 32px; color: #5dc4af;"></i>\n                        <p style="margin-top: 0.8rem; font-size: 1.3rem; color: #666;">\n                            ').concat(c," empresa").concat(1!==c?"s":""," asignada").concat(1!==c?"s":"",'\n                        </p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="examenes">\n                <div class="card__header">\n                    <h3 class="card__title">Exámenes Médicos</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <p style="color: #666; font-size: 1.4rem; margin-bottom: 1.6rem;">\n                        Gestiona exámenes ocupacionales de trabajadores\n                    </p>\n                    <div style="padding: 1.6rem; background: #f8f9fa; border-radius: 8px; text-align: center;">\n                        <i data-lucide="clipboard-list" style="width: 32px; height: 32px; color: #5dc4af;"></i>\n                        <p style="margin-top: 0.8rem; font-size: 1.3rem; color: #666;">\n                            Vigila vencimientos y recomendaciones\n                        </p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Empresas Asignadas</h3>\n                </div>\n                <div class="card__body">\n                    ').concat($t(o.slice(0,5)),'\n                </div>\n            </div>\n\n            <div class="card card--link" data-navigate="config">\n                <div class="card__header">\n                    <h3 class="card__title">Mi Perfil</h3>\n                    <i data-lucide="arrow-right" class="card__link-icon"></i>\n                </div>\n                <div class="card__body">\n                    <div style="display: flex; flex-direction: column; gap: 1.2rem;">\n                        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: 6px;">\n                            <span style="color: #666; font-size: 1.3rem;">Nombre</span>\n                            <span style="font-weight: 500; font-size: 1.3rem;">').concat(s.full_name||"No configurado",'</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: 6px;">\n                            <span style="color: #666; font-size: 1.3rem;">Email</span>\n                            <span style="font-weight: 500; font-size: 1.3rem;">').concat(s.email,'</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: 6px;">\n                            <span style="color: #666; font-size: 1.3rem;">Licencia SST</span>\n                            <span style="font-weight: 500; font-size: 1.3rem;">').concat(s.licencia_sst||"No configurada",'</span>\n                        </div>\n                        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #f8f9fa; border-radius: 6px;">\n                            <span style="color: #666; font-size: 1.3rem;">Firma Digital</span>\n                            <span class="badge ').concat(r?"badge--success":"badge--warning",'" style="font-size: 1.1rem;">\n                                ').concat(r?"Configurada":"Pendiente","\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    "),window.lucide&&window.lucide.createIcons(),n.querySelectorAll("[data-navigate]").forEach((function(e){e.style.cursor="pointer",e.addEventListener("click",(function(e){var n=e.currentTarget.dataset.navigate;console.log("[MultiRol] Navegando a:",n);var t=document.querySelector('[data-page="'.concat(n,'"]'));t&&t.click()}))}));case 12:case"end":return e.stop()}}),e)}))),Ft.apply(this,arguments)}function $t(e){return e&&0!==e.length?'\n        <ul style="list-style: none; padding: 0; margin: 0;">\n            '.concat(e.map((function(e){return'\n                <li style="padding: 1rem 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">\n                    <div>\n                        <div style="font-weight: 500; color: #2d3238; font-size: 1.4rem;">'.concat(e.nombre_legal||"Sin nombre",'</div>\n                        <div style="font-size: 1.2rem; color: #999;">').concat(e.ciudad||"Sin ciudad"," · ").concat(e.nit||"Sin NIT",'</div>\n                    </div>\n                    <span class="badge ').concat("activo"===e.status||"activa"===e.status?"badge--success":"badge--secondary",'" style="font-size: 1.1rem;">\n                        ').concat(e.status||"inactivo","\n                    </span>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p style="color: #999; font-size: 1.3rem; text-align: center;">No tienes empresas asignadas</p>'}function Gt(){return Vt.apply(this,arguments)}function Vt(){return(Vt=(0,i.A)(u().mark((function e(){var n,t,a,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Home..."),n=document.querySelector('[data-page="admin-home"]')){e.next=4;break}return e.abrupt("return");case 4:t=wt.data,a=t.empresas,o=t.medicos,i=t.pagos,n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Dashboard Administrador</h1>\n            <p class="dashboard-page__subtitle">Vista general del sistema Genesys</p>\n        </div>\n\n        <div class="stats-grid stats-grid--4">\n            <div class="card card--stat">\n                <div class="card__icon-small"><i data-lucide="building-2"></i></div>\n                <div class="stat-value stat-value--primary">'.concat(a.length,'</div>\n                <div class="stat-label">Empresas Activas</div>\n            </div>\n            <div class="card card--stat">\n                <div class="card__icon-small"><i data-lucide="stethoscope"></i></div>\n                <div class="stat-value stat-value--info">').concat(o.length,'</div>\n                <div class="stat-label">Médicos Registrados</div>\n            </div>\n            <div class="card card--stat card--warning">\n                <div class="card__icon-small"><i data-lucide="clock"></i></div>\n                <div class="stat-value stat-value--warning">').concat(i.length,'</div>\n                <div class="stat-label">Pagos Pendientes</div>\n            </div>\n            <div class="card card--stat card--success">\n                <div class="card__icon-small"><i data-lucide="check-circle"></i></div>\n                <div class="stat-value stat-value--success">98%</div>\n                <div class="stat-label">Uptime Sistema</div>\n            </div>\n        </div>\n\n        <div class="cards-grid cards-grid--2 mt-6">\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Pagos Pendientes</h3>\n                    <a href="#admin-pagos" class="btn btn--ghost btn--sm">Ver todos</a>\n                </div>\n                <div class="card__body" id="admin-pagos-preview">\n                    ').concat(Wt(i),'\n                </div>\n            </div>\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Últimas Empresas</h3>\n                    <a href="#admin-empresas" class="btn btn--ghost btn--sm">Ver todas</a>\n                </div>\n                <div class="card__body" id="admin-empresas-preview">\n                    ').concat(Jt(a),"\n                </div>\n            </div>\n        </div>\n    "),window.lucide&&window.lucide.createIcons();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(e){return e.length?'\n        <ul class="list list--simple">\n            '.concat(e.slice(0,5).map((function(e){return'\n                <li class="list__item">\n                    <div class="list__content">\n                        <span class="list__title">'.concat(e.empresa_nombre||"Empresa",'</span>\n                        <span class="list__subtitle">$').concat(Sa(e.monto),'</span>\n                    </div>\n                    <span class="badge badge--warning">').concat(e.estado,"</span>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p class="text-muted text-center">No hay pagos pendientes</p>'}function Jt(e){return e.length?'\n        <ul class="list list--simple">\n            '.concat(e.slice(0,5).map((function(e){return'\n                <li class="list__item">\n                    <div class="list__content">\n                        <span class="list__title">'.concat(e.nombre_legal,'</span>\n                        <span class="list__subtitle">').concat(e.ciudad||"Sin ciudad",'</span>\n                    </div>\n                    <span class="badge ').concat("activa"===e.status?"badge--success":"badge--warning",'">').concat(e.status,"</span>\n                </li>\n            ")})).join(""),"\n        </ul>\n    "):'<p class="text-muted text-center">No hay empresas registradas</p>'}function Xt(){return Zt.apply(this,arguments)}function Zt(){return(Zt=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Empresas..."),n=document.querySelector("#page-admin-empresas")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-admin-empresas"),e.abrupt("return");case 5:n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Gestión de Empresas</h1>\n            <p class="dashboard-page__subtitle">Administrar empresas clientes de Genesys</p>\n        </div>\n\n        <div id="empresas-table-container"></div>\n    ',new $e("empresas-table-container",{columns:[{field:"nombre_legal",label:"Empresa",render:function(e,n){return'\n                    <div class="table__cell-main">'.concat(e,'</div>\n                    <div class="table__cell-sub">').concat(n.email||"","</div>\n                ")}},{field:"nit",label:"NIT"},{field:"ciudad",label:"Ciudad",render:function(e){return e||"-"}},{field:"medicos_asignados",label:"Médicos",render:function(e){return e||0}},{field:"status",label:"Estado",render:function(e){return'<span class="badge '.concat((n=e,{activa:"badge--success",suspendida:"badge--danger",pendiente:"badge--warning"}[n]||"badge--info"),'">').concat(e,"</span>");var n}}],data:wt.data.empresas,actions:[{name:"ver",label:"Ver detalle",icon:"eye",handler:function(e){Ma(e)}},{name:"editar",label:"Editar",icon:"edit-2",handler:function(e){console.log("[MultiRol] Editar empresa:",e);try{La(e)}catch(e){console.error("[MultiRol] ERROR al abrir modal:",e)}}}],pageSize:10,searchable:!0,sortable:!0,emptyMessage:"No hay empresas registradas"}),window.lucide&&window.lucide.createIcons();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kt(){return Yt.apply(this,arguments)}function Yt(){return(Yt=(0,i.A)(u().mark((function e(){var n,t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Médicos..."),t=document.querySelector("#page-admin-medicos")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-admin-medicos"),e.abrupt("return");case 5:t.innerHTML='\n        <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem;">\n            <div>\n                <h1 class="dashboard-page__title">Gestión de Médicos</h1>\n                <p class="dashboard-page__subtitle">Médicos ocupacionales registrados en el sistema</p>\n            </div>\n            <button class="btn btn--primary" id="btn-nuevo-medico">\n                <i data-lucide="plus"></i>\n                Nuevo Médico\n            </button>\n        </div>\n\n        <div id="medicos-table-container"></div>\n    ',new $e("medicos-table-container",{columns:[{field:"full_name",label:"Médico",render:function(e,n){return'\n                    <div class="table__cell-main">'.concat(e,'</div>\n                    <div class="table__cell-sub">').concat(n.email,"</div>\n                ")}},{field:"licencia_sst",label:"Licencia SST",render:function(e){return e||"Sin licencia"}},{field:"empresas_asignadas",label:"Empresas",render:function(e){return e||0}},{field:"firma_url",label:"Firma",render:function(e){return e?'<span class="badge badge--success">Configurada</span>':'<span class="badge badge--warning">Pendiente</span>'}}],data:wt.data.medicos,actions:[{name:"ver",label:"Ver detalle",icon:"eye",handler:function(e){console.log("[MultiRol] Ver médico:",e),Oa(e)}},{name:"asignar",label:"Asignar empresas",icon:"link",handler:function(e){console.log("[MultiRol] Asignar empresas a médico:",e),Na(e)}}],pageSize:10,searchable:!0,sortable:!0,emptyMessage:"No hay médicos registrados"}),window.lucide&&window.lucide.createIcons(),null===(n=document.getElementById("btn-nuevo-medico"))||void 0===n||n.addEventListener("click",(function(){console.log("[MultiRol] Nuevo médico")}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qt(){return ea.apply(this,arguments)}function ea(){return(ea=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Pagos..."),n=document.querySelector("#page-admin-pagos")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-admin-pagos"),e.abrupt("return");case 5:n.innerHTML='\n        <div class="page-header">\n            <h1 class="dashboard-page__title">Gestión de Pagos</h1>\n            <p class="dashboard-page__subtitle">Pagos manuales pendientes de aprobación</p>\n        </div>\n\n        <div class="tabs mb-6">\n            <button class="tab active" data-tab="pendientes">Pendientes</button>\n            <button class="tab" data-tab="aprobados">Aprobados</button>\n            <button class="tab" data-tab="rechazados">Rechazados</button>\n        </div>\n\n        <div class="card">\n            <div class="card__body" id="pagos-content">\n                '.concat(na(wt.data.pagos),"\n            </div>\n        </div>\n    "),window.lucide&&window.lucide.createIcons();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function na(e){return e.length?'\n        <table class="table">\n            <thead>\n                <tr>\n                    <th>Empresa</th>\n                    <th>Monto</th>\n                    <th>Referencia</th>\n                    <th>Fecha</th>\n                    <th>Comprobante</th>\n                    <th>Acciones</th>\n                </tr>\n            </thead>\n            <tbody>\n                '.concat(e.map((function(e){return"\n                    <tr>\n                        <td>".concat(e.empresa_nombre||"N/A",'</td>\n                        <td class="font-semibold">$').concat(Sa(e.monto),"</td>\n                        <td>").concat(e.referencia_pago||"-","</td>\n                        <td>").concat((n=e.created_at,n?new Date(n).toLocaleDateString("es-CO"):"-"),"</td>\n                        <td>\n                            ").concat(e.comprobante_url?'<a href="'.concat(e.comprobante_url,'" target="_blank" class="btn btn--ghost btn--sm">\n                                    <i data-lucide="file-image"></i> Ver\n                                   </a>'):"-",'\n                        </td>\n                        <td>\n                            <div class="table__actions">\n                                <button class="btn btn--success btn--sm" data-action="aprobar" data-id="').concat(e.id,'">\n                                    <i data-lucide="check"></i> Aprobar\n                                </button>\n                                <button class="btn btn--danger btn--sm" data-action="rechazar" data-id="').concat(e.id,'">\n                                    <i data-lucide="x"></i> Rechazar\n                                </button>\n                            </div>\n                        </td>\n                    </tr>\n                ');var n})).join(""),"\n            </tbody>\n        </table>\n    "):'\n            <div class="empty-state">\n                <i data-lucide="check-circle" class="empty-state__icon"></i>\n                <h3 class="empty-state__title">Sin pagos pendientes</h3>\n                <p class="empty-state__description">No hay pagos manuales esperando aprobación</p>\n            </div>\n        '}function ta(){return aa.apply(this,arguments)}function aa(){return(aa=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Auditoría..."),n=document.querySelector("#page-admin-auditoria")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-admin-auditoria"),e.abrupt("return");case 5:return n.innerHTML='\n        <div class="page-header">\n            <h1 class="dashboard-page__title">Log de Auditoría</h1>\n            <p class="dashboard-page__subtitle">Registro de todas las acciones del sistema</p>\n        </div>\n\n        <div class="filters-bar">\n            <div class="header-search--inline">\n                <i data-lucide="search" class="header-search__icon"></i>\n                <input type="text" placeholder="Buscar en auditoría..." id="search-auditoria">\n            </div>\n            <select class="select" id="filter-accion">\n                <option value="">Todas las acciones</option>\n                <option value="crear_medico">Crear médico</option>\n                <option value="aprobar_pago">Aprobar pago</option>\n                <option value="subir_firma">Subir firma</option>\n            </select>\n            <button class="btn btn--outline" id="btn-exportar-auditoria">\n                <i data-lucide="download"></i>\n                Exportar\n            </button>\n        </div>\n\n        <div class="card">\n            <div class="card__body" id="auditoria-content">\n                <p class="text-center text-muted">Cargando registros de auditoría...</p>\n            </div>\n        </div>\n    ',window.lucide&&window.lucide.createIcons(),e.next=9,oa();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oa(){return ia.apply(this,arguments)}function ia(){return(ia=(0,i.A)(u().mark((function e(){var n,t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(yt,"/admin/auditoria?limit=50"),{headers:{Authorization:"Bearer ".concat(wt.token)}});case 3:if(!(n=e.sent).ok){e.next=10;break}return e.next=7,n.json();case 7:t=e.sent,(a=document.getElementById("auditoria-content"))&&(a.innerHTML=ra(t.registros||[]),window.lucide&&window.lucide.createIcons());case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("[MultiRol] Error cargando auditoría:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function ra(e){return e.length?'\n        <table class="table table--compact">\n            <thead>\n                <tr>\n                    <th>Fecha</th>\n                    <th>Usuario</th>\n                    <th>Acción</th>\n                    <th>Recurso</th>\n                    <th>IP</th>\n                </tr>\n            </thead>\n            <tbody>\n                '.concat(e.map((function(e){return"\n                    <tr>\n                        <td>".concat((n=e.created_at,n?new Date(n).toLocaleString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"),"</td>\n                        <td>").concat(e.user_name||"Sistema",'</td>\n                        <td><span class="badge badge--info">').concat(e.accion,"</span></td>\n                        <td>").concat(e.recurso," #").concat(e.recurso_id||"-",'</td>\n                        <td class="text-muted">').concat(e.ip_address||"-","</td>\n                    </tr>\n                ");var n})).join(""),"\n            </tbody>\n        </table>\n    "):'<p class="text-center text-muted">No hay registros de auditoría</p>'}function sa(){return ca.apply(this,arguments)}function ca(){return(ca=(0,i.A)(u().mark((function e(){var n,t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Admin Config..."),a=document.querySelector("#page-config")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-config"),e.abrupt("return");case 5:a.innerHTML='\n        <div class="page-header">\n            <h1 class="dashboard-page__title">Configuración</h1>\n            <p class="dashboard-page__subtitle">Configuración del sistema Genesys</p>\n        </div>\n\n        <div class="cards-grid cards-grid--2">\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Mi Perfil</h3>\n                </div>\n                <div class="card__body">\n                    <p>Nombre: '.concat(null===(n=wt.user)||void 0===n?void 0:n.full_name,"</p>\n                    <p>Email: ").concat(null===(t=wt.user)||void 0===t?void 0:t.email,'</p>\n                    <button class="btn btn--outline mt-4">Cambiar contraseña</button>\n                </div>\n            </div>\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Preferencias del Sistema</h3>\n                </div>\n                <div class="card__body">\n                    <p class="text-muted">Próximamente: Configuraciones adicionales del sistema</p>\n                </div>\n            </div>\n        </div>\n    ');case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function la(){return da.apply(this,arguments)}function da(){return da=(0,i.A)(u().mark((function e(){var n,t,a,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Home..."),t=document.querySelector('[data-page="medico-home"]')){e.next=4;break}return e.abrupt("return");case 4:a=wt.data,o=a.empresas,i=a.tieneFirma,t.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Bienvenido, Dr. '.concat((null===(n=wt.user)||void 0===n||null===(n=n.full_name)||void 0===n?void 0:n.split(" ")[0])||"",'</h1>\n            <p class="dashboard-page__subtitle">Panel de médico ocupacional</p>\n        </div>\n\n        ').concat(i?"":'\n            <div class="alert-banner alert-banner--warning mb-6">\n                <i data-lucide="alert-triangle"></i>\n                <span>No tienes firma digital configurada. <a href="#medico-firma">Configurar ahora</a></span>\n            </div>\n        ','\n\n        <div class="stats-grid stats-grid--3">\n            <div class="card card--stat">\n                <div class="card__icon-small"><i data-lucide="building-2"></i></div>\n                <div class="stat-value stat-value--primary">').concat(o.length,'</div>\n                <div class="stat-label">Empresas Asignadas</div>\n            </div>\n            <div class="card card--stat">\n                <div class="card__icon-small"><i data-lucide="users"></i></div>\n                <div class="stat-value stat-value--info">').concat(o.reduce((function(e,n){return e+(n.total_cargos||0)}),0),'</div>\n                <div class="stat-label">Cargos Totales</div>\n            </div>\n            <div class="card card--stat ').concat(i?"card--success":"card--warning",'">\n                <div class="card__icon-small"><i data-lucide="pen-tool"></i></div>\n                <div class="stat-value">').concat(i?"OK":"Pendiente",'</div>\n                <div class="stat-label">Firma Digital</div>\n            </div>\n        </div>\n\n        <div class="card mt-6">\n            <div class="card__header">\n                <h3 class="card__title">Mis Empresas</h3>\n                <a href="#medico-empresas" class="btn btn--ghost btn--sm">Ver todas</a>\n            </div>\n            <div class="card__body">\n                ').concat(ua(o),"\n            </div>\n        </div>\n    "),window.lucide&&window.lucide.createIcons();case 7:case"end":return e.stop()}}),e)}))),da.apply(this,arguments)}function ua(e){return e.length?'\n        <div class="cards-grid cards-grid--3">\n            '.concat(e.slice(0,6).map((function(e){return'\n                <div class="card card--clickable" data-empresa-id="'.concat(e.empresa_id,'">\n                    <div class="card__body">\n                        <h4 class="card__title">').concat(e.nombre_legal,'</h4>\n                        <p class="text-muted">').concat(e.ciudad||"Sin ciudad",'</p>\n                        <div class="mt-2">\n                            <span class="badge badge--info">').concat(e.total_cargos||0," cargos</span>\n                            ").concat(e.es_medico_principal?'<span class="badge badge--success">Principal</span>':"","\n                        </div>\n                    </div>\n                </div>\n            ")})).join(""),"\n        </div>\n    "):'\n            <div class="empty-state">\n                <i data-lucide="building-2"></i>\n                <p>No tienes empresas asignadas aún</p>\n            </div>\n        '}function pa(){return ma.apply(this,arguments)}function ma(){return ma=(0,i.A)(u().mark((function e(){var n,t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Empresas..."),n=document.querySelector('[data-page="medico-empresas"]')){e.next=4;break}return e.abrupt("return");case 4:t=wt.data.empresas,n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Mis Empresas</h1>\n            <p class="dashboard-page__subtitle">Empresas asignadas a tu perfil</p>\n        </div>\n\n        <div class="cards-grid cards-grid--2">\n            '.concat(t.map((function(e){return'\n                <div class="card">\n                    <div class="card__header">\n                        <h3 class="card__title">'.concat(e.nombre_legal,"</h3>\n                        ").concat(e.es_medico_principal?'<span class="badge badge--success">Médico Principal</span>':"",'\n                    </div>\n                    <div class="card__body">\n                        <p><strong>NIT:</strong> ').concat(e.nit,"</p>\n                        <p><strong>Ciudad:</strong> ").concat(e.ciudad||"No especificada","</p>\n                        <p><strong>Sector:</strong> ").concat(e.sector_economico||"No especificado","</p>\n                        <p><strong>Cargos:</strong> ").concat(e.total_cargos||0,'</p>\n                        <div class="mt-4">\n                            <button class="btn btn--primary btn--sm" data-action="ver-cargos" data-id="').concat(e.empresa_id,'">\n                                <i data-lucide="users"></i> Ver Cargos\n                            </button>\n                            <button class="btn btn--outline btn--sm" data-action="ver-profesiograma" data-id="').concat(e.empresa_id,'">\n                                <i data-lucide="file-text"></i> Profesiograma\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            ')})).join(""),"\n        </div>\n    "),window.lucide&&window.lucide.createIcons(),n.addEventListener("click",(function(e){var n=e.target.closest("[data-action]");if(n){var t=n.dataset.action,a=n.dataset.id;if("ver-cargos"===t){console.log("[MultiRol] Ver cargos de empresa:",a);var o=document.getElementById("select-empresa-profesiograma");o&&(o.value=a),window.navigateToPage&&window.navigateToPage("profesiograma"),setTimeout((function(){return fa(a)}),100)}else"ver-profesiograma"===t&&(console.log("[MultiRol] Ver profesiograma de empresa:",a),window.navigateToPage&&window.navigateToPage("profesiograma"),setTimeout((function(){return fa(a)}),100))}}));case 8:case"end":return e.stop()}}),e)}))),ma.apply(this,arguments)}function ga(){return va.apply(this,arguments)}function va(){return va=(0,i.A)(u().mark((function e(){var n,t,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Profesiograma..."),n=document.querySelector("#page-profesiograma")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-profesiograma"),e.abrupt("return");case 5:t=wt.empresaSeleccionada,a=wt.data.empresas||[],n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Editor de Profesiograma</h1>\n            <p class="dashboard-page__subtitle">Editar y generar profesiogramas para tus empresas</p>\n        </div>\n\n        '.concat(t?"":'\n            <div class="card card--info" style="margin-bottom: 2rem;">\n                <div class="card__body" style="display: flex; align-items: center; gap: 1.6rem;">\n                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#5dc4af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <circle cx="12" cy="12" r="10"></circle>\n                        <path d="M12 16v-4"></path>\n                        <path d="M12 8h.01"></path>\n                    </svg>\n                    <div style="flex: 1;">\n                        <h3 style="margin: 0 0 0.4rem 0; font-size: 1.6rem; color: #2d3238;">Selecciona una empresa</h3>\n                        <p style="margin: 0; color: #666; font-size: 1.4rem;">\n                            Usa el selector en el encabezado para elegir la empresa cuyo profesiograma deseas revisar o editar.\n                        </p>\n                    </div>\n                </div>\n            </div>\n        ','\n\n        <div class="card" style="').concat(t?"display:none":"",'">\n            <div class="card__header">\n                <h3 class="card__title">Seleccionar Empresa</h3>\n            </div>\n            <div class="card__body">\n                <select class="select w-full" id="select-empresa-profesiograma">\n                    <option value="">Seleccione una empresa...</option>\n                    ').concat(a.map((function(e){return'\n                        <option value="'.concat(e.empresa_id,'" ').concat(e.empresa_id==t?"selected":"",">").concat(e.nombre_legal,"</option>\n                    ")})).join(""),'\n                </select>\n            </div>\n        </div>\n\n        <div id="profesiograma-editor" class="mt-6" style="display: none;">\n            \x3c!-- El editor de profesiograma se cargará aquí --\x3e\n        </div>\n    '),(o=document.getElementById("select-empresa-profesiograma"))&&o.addEventListener("change",(function(e){var n=e.target.value;if(n){var t=document.getElementById("header-empresa-selector");t&&(t.value=n,t.dispatchEvent(new Event("change"))),fa(n)}})),t&&(console.log("[MultiRol] Cargando profesiograma para empresa seleccionada:",t),fa(t)),window.lucide&&window.lucide.createIcons();case 12:case"end":return e.stop()}}),e)}))),va.apply(this,arguments)}function fa(e){return ha.apply(this,arguments)}function ha(){return ha=(0,i.A)(u().mark((function e(n){var t,a,o,r,s,c,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("profesiograma-editor")){e.next=3;break}return e.abrupt("return");case 3:return t.style.display="block",t.innerHTML='\n        <div class="card">\n            <div class="card__body" style="display:flex;align-items:center;justify-content:center;padding:40px">\n                <div class="spinner" style="width:32px;height:32px;border:3px solid #e5e7eb;border-top-color:#5dc4af;border-radius:50%;animation:spin 1s linear infinite"></div>\n                <span style="margin-left:12px;color:#6b7280">Cargando datos del profesiograma...</span>\n            </div>\n        </div>\n    ',console.log("[MultiRol] Cargando profesiograma para empresa:",n),e.prev=6,e.next=9,fetch("".concat(yt,"/medico/empresas/").concat(n,"/cargos"),{headers:{Authorization:"Bearer ".concat(wt.token)}});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error al cargar los cargos");case 12:return e.next=14,a.json();case 14:o=e.sent,r=o.cargos,s=wt.data.empresas.find((function(e){return e.empresa_id==n})),t.innerHTML='\n            <div class="card" style="margin-bottom:20px">\n                <div class="card__header" style="display:flex;justify-content:space-between;align-items:center">\n                    <div>\n                        <h3 class="card__title">'.concat((null==s?void 0:s.nombre_legal)||"Empresa",'</h3>\n                        <p style="color:#6b7280;font-size:14px;margin-top:4px">').concat(r.length,' cargo(s) registrado(s)</p>\n                    </div>\n                    <div style="display:flex;gap:8px">\n                        <a href="/pages/profesiograma-view.html?empresa_id=').concat(n,'" target="_blank" class="btn btn--outline btn--sm">\n                            <i data-lucide="external-link"></i>\n                            Ver Completo\n                        </a>\n                        <button class="btn btn--primary btn--sm" id="btn-exportar-pdf" data-empresa="').concat(n,'">\n                            <i data-lucide="download"></i>\n                            Exportar PDF\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            ').concat(r.length>0?'\n                <div class="cards-grid cards-grid--2">\n                    '.concat(r.map((function(e){return'\n                        <div class="card cargo-card" data-cargo-id="'.concat(e.id,'">\n                            <div class="card__header" style="padding-bottom:8px;border-bottom:1px solid #e5e7eb">\n                                <h4 class="card__title" style="font-size:16px;margin:0">').concat(e.nombre_cargo,'</h4>\n                                <span class="badge badge--outline" style="font-size:11px">').concat(e.area||"Sin área",'</span>\n                            </div>\n                            <div class="card__body" style="padding-top:12px">\n                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;color:#4b5563">\n                                    <div><strong>Zona:</strong> ').concat(e.zona||"N/A","</div>\n                                    <div><strong>Trabajadores:</strong> ").concat(e.num_trabajadores||0,"</div>\n                                    <div><strong>Riesgos:</strong> ").concat(e.total_riesgos||0,"</div>\n                                    <div>\n                                        ").concat(e.trabaja_alturas?'<span class="badge badge--warning" style="font-size:10px" data-tooltip="Requiere exámenes especiales para trabajo en alturas">Alturas</span>':"","\n                                        ").concat(e.manipula_alimentos?'<span class="badge badge--info" style="font-size:10px" data-tooltip="Requiere certificación de manipulación de alimentos">Alimentos</span>':"","\n                                        ").concat(e.trabaja_espacios_confinados?'<span class="badge badge--danger" style="font-size:10px" data-tooltip="Requiere capacitación especial para espacios confinados">Esp. Conf.</span>':"",'\n                                    </div>\n                                </div>\n                                <div style="margin-top:12px;padding-top:12px;border-top:1px solid #f3f4f6">\n                                    <button class="btn btn--sm btn--outline" data-action="editar-cargo" data-id="').concat(e.id,'" style="width:100%" data-tooltip="Editar exámenes, EPP y aptitudes del cargo" data-tooltip-placement="bottom">\n                                        <i data-lucide="edit-2"></i>\n                                        Editar Cargo\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    ')})).join(""),"\n                </div>\n            "):'\n                <div class="card">\n                    <div class="card__body" style="text-align:center;padding:40px;color:#6b7280">\n                        <i data-lucide="inbox" style="width:48px;height:48px;margin-bottom:16px;opacity:0.5"></i>\n                        <p>No hay cargos registrados para esta empresa.</p>\n                        <p style="font-size:13px;margin-top:8px">Los cargos se crean durante el proceso del wizard de profesiograma.</p>\n                    </div>\n                </div>\n            ',"\n        "),window.lucide&&window.lucide.createIcons(),t._hasClickHandler||(t._hasClickHandler=!0,t.addEventListener("click",function(){var e=(0,i.A)(u().mark((function e(n){var a,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.target.closest("[data-action]")){e.next=3;break}return e.abrupt("return");case 3:"editar-cargo"===a.dataset.action&&(o=a.dataset.id,i=t.dataset.empresaId,console.log("[MultiRol] Editar cargo:",o,"empresa:",i),Pa(i,o));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())),t.dataset.empresaId=n,(c=t.querySelector("#btn-exportar-pdf"))&&(l=c.cloneNode(!0),c.parentNode.replaceChild(l,c),l.addEventListener("click",(function(){var e=l.dataset.empresa;window.open("/pages/profesiograma-view.html?empresa_id=".concat(e,"&print=true"),"_blank")}))),e.next=30;break;case 25:e.prev=25,e.t0=e.catch(6),console.error("[MultiRol] Error cargando profesiograma:",e.t0),t.innerHTML='\n            <div class="card">\n                <div class="card__body" style="text-align:center;padding:40px;color:#ef4444">\n                    <i data-lucide="alert-circle" style="width:48px;height:48px;margin-bottom:16px"></i>\n                    <p>Error al cargar los datos del profesiograma.</p>\n                    <p style="font-size:13px;margin-top:8px">'.concat(e.t0.message,'</p>\n                    <button class="btn btn--outline btn--sm" style="margin-top:16px" onclick="loadProfesiogramaEditor(').concat(n,')">\n                        <i data-lucide="refresh-cw"></i>\n                        Reintentar\n                    </button>\n                </div>\n            </div>\n        '),window.lucide&&window.lucide.createIcons();case 30:case"end":return e.stop()}}),e,null,[[6,25]])}))),ha.apply(this,arguments)}function ba(){return ya.apply(this,arguments)}function ya(){return(ya=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Exámenes..."),n=document.querySelector('[data-page="medico-examenes"]')){e.next=4;break}return e.abrupt("return");case 4:n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Exámenes Médicos</h1>\n            <p class="dashboard-page__subtitle">Gestión de exámenes por empresa</p>\n        </div>\n\n        <div class="card">\n            <div class="card__body">\n                <p class="text-center text-muted">\n                    <i data-lucide="activity" style="width: 48px; height: 48px; margin-bottom: 16px;"></i>\n                    <br>\n                    Selecciona una empresa desde "Mis Empresas" para ver los exámenes programados.\n                </p>\n            </div>\n        </div>\n    ',window.lucide&&window.lucide.createIcons();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xa(){return wa.apply(this,arguments)}function wa(){return(wa=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Firma..."),n=document.querySelector('[data-page="medico-firma"]')){e.next=4;break}return e.abrupt("return");case 4:n.innerHTML='\n        <div class="dashboard-page__header">\n            <h1 class="dashboard-page__title">Mi Firma Digital</h1>\n            <p class="dashboard-page__subtitle">Configura tu firma para los documentos que generes</p>\n        </div>\n\n        <div id="firma-uploader-container"></div>\n    ',(0,He.initFirmaDigitalUploader)("firma-uploader-container",wt.token);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _a(){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,i.A)(u().mark((function e(){var n,t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[MultiRol] Cargando Médico Config..."),n=document.querySelector("#page-config")){e.next=5;break}return console.warn("[MultiRol] No se encontró #page-config"),e.abrupt("return");case 5:return t=wt.user,a=wt.data.tieneFirma,n.innerHTML='\n        <div class="page-header">\n            <h1 class="page-header__title">Mi Configuración</h1>\n            <p class="page-header__subtitle">Actualiza tu información profesional</p>\n        </div>\n\n        \x3c!-- Tabs de configuración --\x3e\n        <div class="tabs" style="margin-bottom: 2.4rem;">\n            <button class="tab active" data-config-tab="perfil">Perfil</button>\n            <button class="tab" data-config-tab="firma">Firma Digital</button>\n            <button class="tab" data-config-tab="seguridad">Seguridad</button>\n        </div>\n\n        \x3c!-- Tab: Perfil --\x3e\n        <div id="config-tab-perfil" class="config-tab-content">\n            <div class="dashboard-grid dashboard-grid--cols-2">\n                <div class="card">\n                    <div class="card__header">\n                        <h3 class="card__title">Datos Personales</h3>\n                    </div>\n                    <div class="card__body">\n                        <div class="form-group">\n                            <label class="form-label">Nombre completo</label>\n                            <input type="text" class="input" value="'.concat((null==t?void 0:t.full_name)||"",'" disabled style="background: #f8f9fa;">\n                        </div>\n                        <div class="form-group">\n                            <label class="form-label">Email</label>\n                            <input type="email" class="input" value="').concat((null==t?void 0:t.email)||"",'" disabled style="background: #f8f9fa;">\n                        </div>\n                        <div class="form-group">\n                            <label class="form-label">Teléfono</label>\n                            <input\n                                type="tel"\n                                class="input"\n                                value="').concat((null==t?void 0:t.phone)||"",'"\n                                id="config-phone"\n                                placeholder="Ingresa tu teléfono"\n                                style="width: 100%; padding: 1rem 1.2rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1.4rem; font-family: \'Raleway\', sans-serif;">\n                        </div>\n                    </div>\n                </div>\n\n                <div class="card">\n                    <div class="card__header">\n                        <h3 class="card__title">Información Profesional</h3>\n                    </div>\n                    <div class="card__body">\n                        <div class="form-group">\n                            <label class="form-label">Licencia SST</label>\n                            <input\n                                type="text"\n                                class="input"\n                                value="').concat((null==t?void 0:t.licencia_sst)||"",'"\n                                id="config-licencia"\n                                placeholder="Ej: 12345-2024"\n                                style="width: 100%; padding: 1rem 1.2rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1.4rem; font-family: \'Raleway\', sans-serif;">\n                        </div>\n                        <div class="form-group">\n                            <label class="form-label">Especialidad</label>\n                            <input\n                                type="text"\n                                class="input"\n                                value="').concat((null==t?void 0:t.especialidad)||"",'"\n                                id="config-especialidad"\n                                placeholder="Ej: Medicina Ocupacional"\n                                style="width: 100%; padding: 1rem 1.2rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1.4rem; font-family: \'Raleway\', sans-serif;">\n                        </div>\n                        <button class="btn btn--primary" id="btn-guardar-config" style="width: 100%; margin-top: 1.6rem;">\n                            <i data-lucide="save"></i>\n                            Guardar cambios\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Tab: Firma Digital --\x3e\n        <div id="config-tab-firma" class="config-tab-content" style="display: none;">\n            <div class="card">\n                <div class="card__header">\n                    <div style="display: flex; align-items: center; gap: 1.2rem;">\n                        <i data-lucide="pen-tool" style="width: 24px; height: 24px; color: #5dc4af;"></i>\n                        <div>\n                            <h3 class="card__title" style="margin: 0;">Firma Digital</h3>\n                            <p style="margin: 0.4rem 0 0 0; font-size: 1.3rem; color: #666;">\n                                Sube tu firma para firmar profesiogramas y documentos médicos\n                            </p>\n                        </div>\n                        ').concat(a?'<span class="badge badge--success">Configurada</span>':'<span class="badge badge--warning">Pendiente</span>','\n                    </div>\n                </div>\n                <div class="card__body">\n                    <div id="firma-digital-uploader-container"></div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Tab: Seguridad --\x3e\n        <div id="config-tab-seguridad" class="config-tab-content" style="display: none;">\n            <div class="card">\n                <div class="card__header">\n                    <h3 class="card__title">Cambiar Contraseña</h3>\n                </div>\n                <div class="card__body">\n                    <div class="form-group">\n                        <label>Contraseña actual</label>\n                        <input type="password" class="input" id="password-actual" placeholder="Ingresa tu contraseña actual">\n                    </div>\n                    <div class="form-group">\n                        <label>Nueva contraseña</label>\n                        <input type="password" class="input" id="password-nueva" placeholder="Mínimo 8 caracteres">\n                    </div>\n                    <div class="form-group">\n                        <label>Confirmar nueva contraseña</label>\n                        <input type="password" class="input" id="password-confirmar" placeholder="Repite la nueva contraseña">\n                    </div>\n                    <button class="btn btn--primary" id="btn-cambiar-password" style="margin-top: 1.6rem;">\n                        <i data-lucide="lock"></i>\n                        Cambiar contraseña\n                    </button>\n                </div>\n            </div>\n        </div>\n    '),window.lucide&&window.lucide.createIcons(),ka(n),e.next=12,Aa();case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ka(e){var n=e.querySelectorAll("[data-config-tab]"),t=e.querySelectorAll(".config-tab-content");n.forEach((function(e){e.addEventListener("click",(function(){var a=e.dataset.configTab;n.forEach((function(e){return e.classList.remove("active")})),e.classList.add("active"),t.forEach((function(e){e.style.display="none"}));var o=document.getElementById("config-tab-".concat(a));o&&(o.style.display="block")}))}))}function Aa(){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,i.A)(u().mark((function e(){var n,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.resolve().then(t.bind(t,7763));case 3:n=e.sent,(0,n.initFirmaDigitalUploader)("firma-digital-uploader-container",wt.token),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("[MultiRol] Error cargando componente de firma:",e.t0),(a=document.getElementById("firma-digital-uploader-container"))&&(a.innerHTML='\n                <div style="padding: 2.4rem; text-align: center; color: #f44336;">\n                    <i data-lucide="alert-circle" style="width: 48px; height: 48px; margin-bottom: 1.6rem;"></i>\n                    <p>Error al cargar el componente de firma digital</p>\n                    <p style="font-size: 1.2rem; color: #999; margin-top: 0.8rem;">Por favor, recarga la página</p>\n                </div>\n            ',window.lucide&&window.lucide.createIcons());case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function Sa(e){return new Intl.NumberFormat("es-CO").format(e||0)}function Ia(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=document.querySelector(".toast-notification");t||((t=document.createElement("div")).className="toast-notification",document.body.appendChild(t)),t.textContent=e,t.className="toast-notification toast-notification--".concat(n," toast-notification--visible"),setTimeout((function(){t.classList.remove("toast-notification--visible")}),3e3)}function Ma(e){var n=new We({title:"Detalles de Empresa",size:"medium",content:'\n            <div class="form" style="pointer-events:none">\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                            <circle cx="12" cy="7" r="4"></circle>\n                        </svg>\n                        Nombre Legal\n                    </label>\n                    <input type="text" class="form-input" value="'.concat(e.nombre_legal,'" readonly>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                <polyline points="14 2 14 8 20 8"></polyline>\n                                <line x1="12" y1="18" x2="12" y2="12"></line>\n                                <line x1="9" y1="15" x2="15" y2="15"></line>\n                            </svg>\n                            NIT\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.nit,'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <line x1="12" y1="8" x2="12" y2="12"></line>\n                                <line x1="12" y1="16" x2="12.01" y2="16"></line>\n                            </svg>\n                            Estado\n                        </label>\n                        <input type="text" class="form-input" value="').concat("activa"===e.status?"✓ Activa":"suspendida"===e.status?"⏸ Suspendida":"⏳ Pendiente",'" readonly>\n                    </div>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n                                <polyline points="22,6 12,13 2,6"></polyline>\n                            </svg>\n                            Email\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.email||"No registrado",'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                                <circle cx="12" cy="10" r="3"></circle>\n                            </svg>\n                            Ciudad\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.ciudad||"No registrada",'" readonly>\n                    </div>\n                </div>\n\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n                            <circle cx="9" cy="7" r="4"></circle>\n                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>\n                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n                        </svg>\n                        Médicos Asignados\n                    </label>\n                    <input type="text" class="form-input" value="').concat(e.medicos_asignados||0,' médicos" readonly>\n                </div>\n            </div>\n        '),buttons:[{label:"Cerrar",className:"btn--primary",action:"cancel"}]});n.element.addEventListener("click",(function(e){var t=e.target.closest("[data-action]");t&&"cancel"===t.dataset.action&&n.close()})),n.open()}function Oa(e){var n=new We({title:"Detalles del Médico",size:"medium",content:'\n            <div class="form" style="pointer-events:none">\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                            <circle cx="12" cy="7" r="4"></circle>\n                        </svg>\n                        Nombre Completo\n                    </label>\n                    <input type="text" class="form-input" value="'.concat(e.full_name||"No especificado",'" readonly>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n                                <polyline points="22,6 12,13 2,6"></polyline>\n                            </svg>\n                            Correo Electrónico\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.email||"No especificado",'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>\n                            </svg>\n                            Teléfono\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.phone||"No especificado",'" readonly>\n                    </div>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                <polyline points="14 2 14 8 20 8"></polyline>\n                            </svg>\n                            Licencia SST\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.licencia_sst||"Sin licencia",'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n                                <circle cx="8.5" cy="7" r="4"></circle>\n                                <polyline points="17 11 19 13 23 9"></polyline>\n                            </svg>\n                            Especialidad\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.especialidad||"No especificada",'" readonly>\n                    </div>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>\n                                <polyline points="9 22 9 12 15 12 15 22"></polyline>\n                            </svg>\n                            Empresas Asignadas\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.empresas_asignadas||0,'" readonly>\n                    </div>\n\n                    <div class="form-group">\n                        <label class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M15.5 2H8.6c-.4 0-.8.2-1.1.5-.3.3-.5.7-.5 1.1v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8c.4 0 .8-.2 1.1-.5.3-.3.5-.7.5-1.1V6.5L15.5 2z"></path>\n                                <path d="M3 7.6v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8"></path>\n                                <path d="M15 2v5h5"></path>\n                            </svg>\n                            Firma Digital\n                        </label>\n                        <input type="text" class="form-input" value="').concat(e.firma_url?"✓ Configurada":"⚠ Pendiente",'" readonly>\n                    </div>\n                </div>\n\n                ').concat(e.fecha_vencimiento_licencia?'\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>\n                            <line x1="16" y1="2" x2="16" y2="6"></line>\n                            <line x1="8" y1="2" x2="8" y2="6"></line>\n                            <line x1="3" y1="10" x2="21" y2="10"></line>\n                        </svg>\n                        Vencimiento Licencia\n                    </label>\n                    <input type="text" class="form-input" value="'.concat(new Date(e.fecha_vencimiento_licencia).toLocaleDateString("es-CO"),'" readonly>\n                </div>\n                '):"","\n            </div>\n        "),buttons:[{label:"Cerrar",className:"btn--primary",action:"cancel"}]});n.element.addEventListener("click",(function(e){var t=e.target.closest("[data-action]");t&&"cancel"===t.dataset.action&&n.close()})),n.open()}function La(e){var n;console.log("[MultiRol] 🔵 openEditEmpresaModal llamado con:",e),console.log("[MultiRol] 🔵 Modal class:",We),console.log("[MultiRol] 🔵 typeof Modal:",(0,qe.A)(We));try{n=new We({title:"Editar Empresa",size:"medium",content:'\n            <form id="form-edit-empresa" class="form">\n                <div class="form-group">\n                    <label for="edit-nombre" class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                            <circle cx="12" cy="7" r="4"></circle>\n                        </svg>\n                        Nombre Legal *\n                    </label>\n                    <input\n                        type="text"\n                        id="edit-nombre"\n                        name="nombre_legal"\n                        class="form-input"\n                        value="'.concat(e.nombre_legal,'"\n                        placeholder="Ej: Acme Corporation S.A.S."\n                        required>\n                </div>\n\n                <div class="form-group">\n                    <label for="edit-nit" class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                            <polyline points="14 2 14 8 20 8"></polyline>\n                            <line x1="12" y1="18" x2="12" y2="12"></line>\n                            <line x1="9" y1="15" x2="15" y2="15"></line>\n                        </svg>\n                        NIT *\n                    </label>\n                    <input\n                        type="text"\n                        id="edit-nit"\n                        name="nit"\n                        class="form-input"\n                        value="').concat(e.nit,'"\n                        placeholder="Ej: 900123456-7"\n                        required>\n                </div>\n\n                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">\n                    <div class="form-group">\n                        <label for="edit-email" class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n                                <polyline points="22,6 12,13 2,6"></polyline>\n                            </svg>\n                            Email\n                        </label>\n                        <input\n                            type="email"\n                            id="edit-email"\n                            name="email"\n                            class="form-input"\n                            value="').concat(e.email||"",'"\n                            placeholder="empresa@ejemplo.com">\n                    </div>\n\n                    <div class="form-group">\n                        <label for="edit-ciudad" class="form-label">\n                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                                <circle cx="12" cy="10" r="3"></circle>\n                            </svg>\n                            Ciudad\n                        </label>\n                        <input\n                            type="text"\n                            id="edit-ciudad"\n                            name="ciudad"\n                            class="form-input"\n                            value="').concat(e.ciudad||"",'"\n                            placeholder="Ej: Bogotá">\n                    </div>\n                </div>\n\n                <div class="form-group">\n                    <label for="edit-status" class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <circle cx="12" cy="12" r="10"></circle>\n                            <line x1="12" y1="8" x2="12" y2="12"></line>\n                            <line x1="12" y1="16" x2="12.01" y2="16"></line>\n                        </svg>\n                        Estado *\n                    </label>\n                    <select id="edit-status" name="status" class="form-select" required>\n                        <option value="activa" ').concat("activa"===e.status?"selected":"",'>✓ Activa</option>\n                        <option value="suspendida" ').concat("suspendida"===e.status?"selected":"",'>⏸ Suspendida</option>\n                        <option value="pendiente" ').concat("pendiente"===e.status?"selected":"",">⏳ Pendiente</option>\n                    </select>\n                </div>\n            </form>\n        "),buttons:[{label:"Cancelar",className:"btn--outline",action:"cancel"},{label:"Guardar Cambios",className:"btn--primary",icon:"save",action:"save"}]}),console.log("[MultiRol] 🟢 Modal creado exitosamente:",n),console.log("[MultiRol] 🟢 Modal.element:",n.element)}catch(e){return console.error("[MultiRol] ❌ Error al crear modal:",e),void console.error("[MultiRol] ❌ Error stack:",e.stack)}n.element.addEventListener("click",function(){var t=(0,i.A)(u().mark((function t(a){var o,i,r,s,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=a.target.closest("[data-action]")){t.next=3;break}return t.abrupt("return");case 3:if("cancel"!==(i=o.dataset.action)){t.next=8;break}n.close(),t.next=34;break;case 8:if("save"!==i){t.next=34;break}if((r=document.getElementById("form-edit-empresa")).checkValidity()){t.next=13;break}return r.reportValidity(),t.abrupt("return");case 13:return s=new FormData(r),c=Object.fromEntries(s),console.log("[MultiRol] Guardando cambios empresa:",c),t.prev=16,t.next=19,fetch("".concat(yt,"/admin/empresas/").concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(wt.token)},body:JSON.stringify(c)});case 19:if(t.sent.ok){t.next=22;break}throw new Error("Error al actualizar empresa");case 22:return Ia("Empresa actualizada exitosamente","success"),n.close(),t.next=26,Ot();case 26:return t.next=28,Xt();case 28:t.next=34;break;case 30:t.prev=30,t.t0=t.catch(16),console.error("[MultiRol] Error:",t.t0),Ia("Error al actualizar empresa","error");case 34:case"end":return t.stop()}}),t,null,[[16,30]])})));return function(e){return t.apply(this,arguments)}}()),console.log("[MultiRol] 🟡 Abriendo modal...");try{n.open(),console.log("[MultiRol] 🟢 Modal abierto")}catch(e){console.error("[MultiRol] ❌ Error al abrir modal:",e)}}function Na(e){var n=wt.data.empresas||[],t=new We({title:"Asignar Empresas - ".concat(e.full_name),size:"medium",content:'\n            <div class="form">\n                <p class="form-help" style="margin-bottom:16px;color:#6b7280">\n                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:4px">\n                        <circle cx="12" cy="12" r="10"></circle>\n                        <path d="M12 16v-4"></path>\n                        <path d="M12 8h.01"></path>\n                    </svg>\n                    Selecciona las empresas que este médico puede gestionar\n                </p>\n\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M11 4a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"></path>\n                            <path d="M21 21l-4.35-4.35"></path>\n                        </svg>\n                        Buscar Empresa\n                    </label>\n                    <input\n                        type="text"\n                        id="search-empresa"\n                        class="form-input"\n                        placeholder="Buscar por nombre o NIT..."\n                        style="margin-bottom:12px">\n                </div>\n\n                <div class="form-group">\n                    <label class="form-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;vertical-align:middle;margin-right:6px">\n                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>\n                            <polyline points="9 22 9 12 15 12 15 22"></polyline>\n                        </svg>\n                        Empresas Disponibles (<span id="empresas-count">'.concat(n.length,'</span>)\n                    </label>\n                    <div id="empresas-checkboxes" class="checkbox-list" style="max-height:400px;overflow-y:auto;padding:12px;border:1px solid #e5e7eb;border-radius:8px;background:#f9fafb">\n                        ').concat(n.length>0?n.map((function(e){return'\n                                <label class="form-checkbox empresa-item" data-nombre="'.concat(e.nombre_legal.toLowerCase(),'" data-nit="').concat(e.nit,'" style="padding:10px;margin-bottom:8px;border-radius:6px;background:#fff;border:1px solid #e5e7eb;cursor:pointer;transition:all 0.2s;display:flex;align-items:start;gap:8px" onmouseover="this.style.borderColor=\'#5dc4af\'" onmouseout="this.style.borderColor=\'#e5e7eb\'">\n                                    <input\n                                        type="checkbox"\n                                        name="empresas[]"\n                                        value="').concat(e.id,'">\n                                    <span style="display:flex;flex-direction:column;gap:2px">\n                                        <strong style="color:#383d47;font-size:14px">').concat(e.nombre_legal,'</strong>\n                                        <small style="color:#6b7280;font-size:12px">').concat(e.nit," - ").concat(e.ciudad||"Sin ciudad","</small>\n                                    </span>\n                                </label>\n                            ")})).join(""):'<p style="color:#6b7280;text-align:center;padding:20px">No hay empresas disponibles</p>',"\n                    </div>\n                </div>\n            </div>\n        "),buttons:[{label:"Cancelar",className:"btn--outline",action:"cancel"},{label:"Asignar Empresas",className:"btn--primary",icon:"link",action:"assign"}]});setTimeout((0,i.A)(u().mark((function n(){var a,o,i;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(yt,"/admin/medicos/").concat(e.id,"/empresas"),{headers:{Authorization:"Bearer ".concat(wt.token)}});case 3:if(!(a=n.sent).ok){n.next=11;break}return n.next=7,a.json();case 7:o=n.sent,i=o.empresas,console.log("[MultiRol] 🔵 Empresas asignadas recibidas:",i),i.forEach((function(e){var n=t.element.querySelector('input[value="'.concat(e.empresa_id,'"]'));n&&(n.checked=!0,console.log("[MultiRol] ✅ Checkbox marcado para empresa:",e.nombre_legal))}));case 11:n.next=16;break;case 13:n.prev=13,n.t0=n.catch(0),console.error("[MultiRol] Error cargando empresas asignadas:",n.t0);case 16:case"end":return n.stop()}}),n,null,[[0,13]])}))),100);var a=!1,o=function(){var n=(0,i.A)(u().mark((function n(o){var i,r,s,c,l,d,p,m,g;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=o.target.closest("[data-action]")){n.next=3;break}return n.abrupt("return");case 3:if("cancel"!==(r=i.dataset.action)){n.next=8;break}t.close(),n.next=55;break;case 8:if("assign"!==r){n.next=55;break}if(!a){n.next=12;break}return console.log("[MultiRol] Ya se está procesando, ignorando click..."),n.abrupt("return");case 12:return a=!0,i.disabled=!0,s=i.textContent,i.textContent="Asignando...",c=t.element.querySelectorAll('input[name="empresas[]"]:checked'),l=Array.from(c).map((function(e){return parseInt(e.value)})),console.log("[MultiRol] 🔵 Asignando empresas:",l),console.log("[MultiRol] 🔵 Médico ID:",e.id),console.log("[MultiRol] 🔵 API_BASE:",yt),console.log("[MultiRol] 🔵 Token:",wt.token?"existe":"NO EXISTE"),n.prev=22,d="".concat(yt,"/admin/medicos/").concat(e.id,"/empresas"),console.log("[MultiRol] 🔵 URL completa:",d),n.next=27,fetch(d,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(wt.token)},body:JSON.stringify({empresas:l})});case 27:if(p=n.sent,console.log("[MultiRol] 🔵 Response status:",p.status),console.log("[MultiRol] 🔵 Response ok:",p.ok),p.ok){n.next=36;break}return n.next=33,p.json().catch((function(){return{message:"Error desconocido"}}));case 33:throw m=n.sent,console.error("[MultiRol] ❌ Error del servidor:",m),new Error(m.message||"Error al asignar empresas");case 36:return n.next=38,p.json();case 38:return g=n.sent,console.log("[MultiRol] 🟢 Respuesta exitosa:",g),Ia(g.message||"".concat(l.length," empresa(s) asignada(s) exitosamente"),"success"),t.close(),n.next=44,Ot();case 44:return n.next=46,Kt();case 46:n.next=55;break;case 48:n.prev=48,n.t0=n.catch(22),console.error("[MultiRol] ❌ Error completo:",n.t0),Ia(n.t0.message||"Error al asignar empresas","error"),i.disabled=!1,i.textContent=s,a=!1;case 55:case"end":return n.stop()}}),n,null,[[22,48]])})));return function(e){return n.apply(this,arguments)}}();t.element.addEventListener("click",o),t.element.addEventListener("input",(function(e){if("search-empresa"===e.target.id){var n=e.target.value.toLowerCase().trim(),a=t.element.querySelectorAll(".empresa-item"),o=t.element.querySelector("#empresas-count"),i=0;a.forEach((function(e){var t=e.dataset.nombre||"",a=e.dataset.nit||"";t.includes(n)||a.includes(n)?(e.style.display="flex",i++):e.style.display="none"})),o&&(o.textContent=i)}})),t.open()}function Pa(e,n){return Ta.apply(this,arguments)}function Ta(){return Ta=(0,i.A)(u().mark((function e(n,t){var a,o,r,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[MultiRol] Abriendo modal editar cargo:",{empresaId:n,cargoId:t}),(a=new We({title:"Cargando...",size:"small",content:'\n            <div style="display:flex;align-items:center;justify-content:center;padding:40px">\n                <div class="spinner" style="width:32px;height:32px;border:3px solid #e5e7eb;border-top-color:#5dc4af;border-radius:50%;animation:spin 1s linear infinite"></div>\n                <span style="margin-left:12px;color:#6b7280">Cargando datos del cargo...</span>\n            </div>\n        ',buttons:[]})).open(),e.prev=3,e.next=6,fetch("".concat(yt,"/medico/empresas/").concat(n,"/cargos/").concat(t),{headers:{Authorization:"Bearer ".concat(wt.token)}});case 6:if((o=e.sent).ok){e.next=9;break}throw new Error("Error al cargar cargo");case 9:return e.next=11,o.json();case 11:r=e.sent,s=r.cargo,a.close(),(c=new We({title:"Editar: ".concat(s.nombre_cargo),size:"xl",content:Ra(s),buttons:[{label:"Cancelar",className:"btn--outline",action:"cancel"},{label:"Guardar Cambios",className:"btn--primary",icon:"save",action:"save"}]})).element.addEventListener("click",function(){var e=(0,i.A)(u().mark((function e(a){var o,i,r,s,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=a.target).closest(".tab-btn")&&(i=o.closest(".tab-btn"),r=i.dataset.tab,c.element.querySelectorAll(".tab-btn").forEach((function(e){e.classList.remove("active"),e.style.background="#e5e7eb",e.style.color="#374151"})),i.classList.add("active"),i.style.background="#5dc4af",i.style.color="white",c.element.querySelectorAll(".tab-content").forEach((function(e){e.style.display=e.dataset.tabContent===r?"block":"none"}))),o.closest("[data-add-item]")&&(s=o.closest("[data-add-item]"),l=s.dataset.addItem,Da(c.element,l)),o.closest("[data-remove-item]")&&o.closest("[data-remove-item]").closest(".editable-item").remove(),!o.closest('[data-action="save"]')){e.next=7;break}return e.next=7,Ba(c,n,t);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),c.open(),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(3),a.close(),console.error("[MultiRol] Error cargando cargo:",e.t0),Ia("Error al cargar datos del cargo","error");case 24:case"end":return e.stop()}}),e,null,[[3,19]])}))),Ta.apply(this,arguments)}function Ra(e){console.log("[Editor] Cargo recibido:",e),console.log("[Editor] Generados:",e.generados),console.log("[Editor] Overrides:",e.overrides);var n=e.generados||{},t=e.overrides||{},a=function(e){return Array.isArray(e)&&e.length>0},o=a(t.epp)?t.epp:n.epp||[],i=a(t.aptitudes)?t.aptitudes:n.aptitudes||[],r=a(t.condiciones_incompatibles)?t.condiciones_incompatibles:n.condiciones_incompatibles||[],s=n.examenes||[];console.log("[Editor] EPP data:",o),console.log("[Editor] Examenes generados:",s);var c=a(t.examenes_ingreso)?t.examenes_ingreso:s.filter((function(e){return e.ingreso})).map((function(e){return{nombre:e.nombre,codigo:e.codigo,periodicidad:e.periodicidad,justificacion:e.justificacion}})),l=a(t.examenes_periodicos)?t.examenes_periodicos:s.filter((function(e){return e.periodico})).map((function(e){return{nombre:e.nombre,codigo:e.codigo,periodicidad:e.periodicidad,justificacion:e.justificacion}})),d=a(t.examenes_retiro)?t.examenes_retiro:s.filter((function(e){return e.retiro})).map((function(e){return{nombre:e.nombre,codigo:e.codigo,periodicidad:"N/A",justificacion:"Evaluación de egreso"}}));console.log("[Editor] Examenes ingreso:",c),console.log("[Editor] Examenes periodicos:",l);var u=function(e,n,t){return e&&0!==e.length?e.map((function(e,a){return'\n            <div class="editable-item" style="display:flex;gap:8px;margin-bottom:8px;align-items:center">\n                <input type="text" class="form-input" name="'.concat(n,'[]" value="').concat(Ha("string"==typeof e?e:e.nombre||""),'" placeholder="').concat(t,'" style="flex:1">\n                <button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:4px">\n                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>\n                </button>\n            </div>\n        ')})).join(""):'<div class="empty-list" style="color:#9ca3af;font-size:13px;padding:8px">No hay items. Usa el botón "+" para agregar.</div>'},p=[{codigo:"EMO",nombre:"EXAMEN MEDICO CON ENFASIS OSTEOMUSCULAR"},{codigo:"EMOA",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS EN ALTURAS"},{codigo:"EMOD",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS DERMATOLOGICO"},{codigo:"EMOMP",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS EN MANIPULACION DE ALIMENTOS"},{codigo:"AUD",nombre:"AUDIOMETRIA"},{codigo:"ESP",nombre:"ESPIROMETRÍA"},{codigo:"OPTO",nombre:"OPTOMETRÍA"},{codigo:"VIS",nombre:"VISIOMETRÍA"},{codigo:"ECG",nombre:"ELECTROCARDIOGRAMA"},{codigo:"RXC",nombre:"RAYOS X DE COLUMNA"},{codigo:"PSM",nombre:"PRUEBA PSICOSENSOMETRICA"},{codigo:"PST",nombre:"PRUEBA PSICOTECNICA"},{codigo:"FRO",nombre:"FROTIS FARINGEO"},{codigo:"GLI",nombre:"GLICEMIA"},{codigo:"CH",nombre:"CUADRO HEMATICO"},{codigo:"RH",nombre:"HEMOCLASIFICIÓN GRUPO ABO Y FACTOR RH"},{codigo:"KOH",nombre:"PRUEBA DE KOH"},{codigo:"BUN",nombre:"NITROGENO UREICO [BUN]"},{codigo:"PL",nombre:"PERFIL LIPÍDICO"},{codigo:"PAS",nombre:"PRUEBA DE ALCOHOL EN SALIVA"},{codigo:"PE",nombre:"PRUEBA DE EMBARAZO"},{codigo:"PSP",nombre:"PRUEBA DE SUSTANCIAS PSICOACTIVAS"},{codigo:"TGO",nombre:"TRANSAMINASAS TGO"},{codigo:"TGP",nombre:"TRANSAMINASAS TGP"},{codigo:"TRI",nombre:"TRIGLICÉRIDOS"},{codigo:"COL",nombre:"COLESTEROL"},{codigo:"COP",nombre:"COPROLOGICO"},{codigo:"LEP",nombre:"LEPTOSPIRA"},{codigo:"BRU",nombre:"BRUCELA"},{codigo:"TOX",nombre:"TOXOPLASMA"},{codigo:"COLI",nombre:"COLINESTERASA"},{codigo:"CRE",nombre:"CREATININA"},{codigo:"ORI",nombre:"PARCIAL DE ORINA"},{codigo:"TET",nombre:"VACUNA DEL TETANO"},{codigo:"VH",nombre:"VACUNA DEL VIRUS HEPATITIS"},{codigo:"VFA",nombre:"VACUNA DE FIEBRE AMARILLA"},{codigo:"T4L",nombre:"T4 LIBRE"}],m=[{valor:"Semestral",meses:6},{valor:"Anual",meses:12},{valor:"Cada 2 años",meses:24},{valor:"Cada 3 años",meses:36},{valor:"Cada 5 años",meses:60},{valor:"Solo ingreso/egreso",meses:999},{valor:"N/A",meses:0}],g=function(e,n){return e&&0!==e.length?'\n            <table class="data-table" style="font-size:13px;width:100%">\n                <thead>\n                    <tr>\n                        <th style="text-align:left">Examen</th>\n                        <th style="text-align:left;width:140px">Periodicidad</th>\n                        <th style="text-align:left">Justificación</th>\n                        <th style="width:40px"></th>\n                    </tr>\n                </thead>\n                <tbody>\n                    '.concat(e.map((function(e,t){return'\n                        <tr class="editable-item">\n                            <td>\n                                <select class="form-input form-input--sm" name="examenes_'.concat(n,'_nombre[]" style="width:100%;font-size:11px">\n                                    <option value="">-- Seleccionar examen --</option>\n                                    ').concat((o=e.nombre||"",p.map((function(e){var n=e.nombre===o?"selected":"";return'<option value="'.concat(Ha(e.nombre),'" ').concat(n,">").concat(e.codigo," - ").concat(Ha(e.nombre),"</option>")})).join("")),'\n                                </select>\n                            </td>\n                            <td>\n                                <select class="form-input form-input--sm" name="examenes_').concat(n,'_periodicidad[]" style="width:100%">\n                                    ').concat((a=e.periodicidad||"",m.map((function(e){var n=e.valor===a?"selected":"";return'<option value="'.concat(Ha(e.valor),'" ').concat(n,">").concat(Ha(e.valor),"</option>")})).join("")),'\n                                </select>\n                            </td>\n                            <td><input type="text" class="form-input form-input--sm" name="examenes_').concat(n,'_justificacion[]" value="').concat(Ha(e.justificacion||""),'" style="width:100%"></td>\n                            <td><button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:2px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></td>\n                        </tr>\n                    ');var a,o})).join(""),"\n                </tbody>\n            </table>\n        "):'<p style="color:#9ca3af;font-size:13px;padding:8px">No hay exámenes de '.concat(n,".</p>")},v=n.nr_maximo||0,f=n.periodicidad_minima||36;return'\n        <div class="cargo-editor" style="max-height:70vh;overflow-y:auto">\n            \x3c!-- Info del cargo (solo lectura) --\x3e\n            <div class="cargo-info" style="background:#f9fafb;padding:16px;border-radius:8px;margin-bottom:20px">\n                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;font-size:13px">\n                    <div><strong>Área:</strong> '.concat(e.area||"N/A","</div>\n                    <div><strong>Zona:</strong> ").concat(e.zona||"N/A","</div>\n                    <div><strong>Trabajadores:</strong> ").concat(e.num_trabajadores||0,'</div>\n                </div>\n                <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">\n                    ').concat(e.trabaja_alturas?'<span class="badge badge--warning">Trabajo en Alturas</span>':"","\n                    ").concat(e.manipula_alimentos?'<span class="badge badge--info">Manipula Alimentos</span>':"","\n                    ").concat(e.trabaja_espacios_confinados?'<span class="badge badge--danger">Espacios Confinados</span>':"",'\n                    <span class="badge badge--outline" style="font-size:11px">NR máx: ').concat(v,'</span>\n                    <span class="badge badge--outline" style="font-size:11px">Periodicidad: ').concat(f," meses</span>\n                </div>\n                ").concat(e.riesgos&&e.riesgos.length>0?'\n                    <div style="margin-top:12px;padding-top:12px;border-top:1px solid #e5e7eb">\n                        <strong style="font-size:12px;color:#6b7280">Riesgos identificados ('.concat(e.riesgos.length,'):</strong>\n                        <div style="margin-top:4px;display:flex;flex-wrap:wrap;gap:4px">\n                            ').concat(e.riesgos.slice(0,5).map((function(e){return'\n                                <span class="badge badge--outline" style="font-size:10px">'.concat(e.ges,"</span>\n                            ")})).join(""),"\n                            ").concat(e.riesgos.length>5?'<span style="font-size:11px;color:#9ca3af">+'.concat(e.riesgos.length-5," más</span>"):"","\n                        </div>\n                    </div>\n                "):"",'\n            </div>\n\n            \x3c!-- Tabs --\x3e\n            <div class="tabs" style="margin-bottom:16px">\n                <button class="tab-btn active" data-tab="examenes" style="padding:8px 16px;border:none;background:#5dc4af;color:white;border-radius:6px 6px 0 0;cursor:pointer">Exámenes Médicos</button>\n                <button class="tab-btn" data-tab="epp" style="padding:8px 16px;border:none;background:#e5e7eb;border-radius:6px 6px 0 0;cursor:pointer">EPP (').concat(o.length,')</button>\n                <button class="tab-btn" data-tab="aptitudes" style="padding:8px 16px;border:none;background:#e5e7eb;border-radius:6px 6px 0 0;cursor:pointer">Aptitudes (').concat(i.length,')</button>\n                <button class="tab-btn" data-tab="condiciones" style="padding:8px 16px;border:none;background:#e5e7eb;border-radius:6px 6px 0 0;cursor:pointer">Condiciones (').concat(r.length,')</button>\n            </div>\n\n            \x3c!-- Tab: Exámenes --\x3e\n            <div class="tab-content" data-tab-content="examenes">\n                <div style="margin-bottom:20px">\n                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">\n                        <h4 style="margin:0;font-size:14px;color:#374151">Exámenes de Ingreso (').concat(c.length,')</h4>\n                        <button type="button" class="btn btn--outline btn--sm" data-add-item="examenes_ingreso">+ Agregar</button>\n                    </div>\n                    <div id="list-examenes_ingreso">').concat(g(c,"ingreso"),'</div>\n                </div>\n                <div style="margin-bottom:20px">\n                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">\n                        <h4 style="margin:0;font-size:14px;color:#374151">Exámenes Periódicos (').concat(l.length,')</h4>\n                        <button type="button" class="btn btn--outline btn--sm" data-add-item="examenes_periodicos">+ Agregar</button>\n                    </div>\n                    <div id="list-examenes_periodicos">').concat(g(l,"periodicos"),'</div>\n                </div>\n                <div style="margin-bottom:20px">\n                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">\n                        <h4 style="margin:0;font-size:14px;color:#374151">Exámenes de Retiro (').concat(d.length,')</h4>\n                        <button type="button" class="btn btn--outline btn--sm" data-add-item="examenes_retiro">+ Agregar</button>\n                    </div>\n                    <div id="list-examenes_retiro">').concat(g(d,"retiro"),'</div>\n                </div>\n            </div>\n\n            \x3c!-- Tab: EPP --\x3e\n            <div class="tab-content" data-tab-content="epp" style="display:none">\n                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">\n                    <h4 style="margin:0;font-size:14px;color:#374151">Elementos de Protección Personal</h4>\n                    <button type="button" class="btn btn--outline btn--sm" data-add-item="epp">+ Agregar EPP</button>\n                </div>\n                <div id="list-epp">').concat(u(o,"epp","Ej: Casco de seguridad"),'</div>\n            </div>\n\n            \x3c!-- Tab: Aptitudes --\x3e\n            <div class="tab-content" data-tab-content="aptitudes" style="display:none">\n                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">\n                    <h4 style="margin:0;font-size:14px;color:#374151">Aptitudes Requeridas</h4>\n                    <button type="button" class="btn btn--outline btn--sm" data-add-item="aptitudes">+ Agregar Aptitud</button>\n                </div>\n                <div id="list-aptitudes">').concat(u(i,"aptitudes","Ej: Buena agudeza visual"),'</div>\n            </div>\n\n            \x3c!-- Tab: Condiciones Incompatibles --\x3e\n            <div class="tab-content" data-tab-content="condiciones" style="display:none">\n                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">\n                    <h4 style="margin:0;font-size:14px;color:#374151">Condiciones de Salud Incompatibles</h4>\n                    <button type="button" class="btn btn--outline btn--sm" data-add-item="condiciones_incompatibles">+ Agregar Condición</button>\n                </div>\n                <div id="list-condiciones_incompatibles">').concat(u(r,"condiciones_incompatibles","Ej: Vértigo severo"),'</div>\n            </div>\n\n            \x3c!-- Justificación obligatoria --\x3e\n            <div style="margin-top:24px;padding-top:20px;border-top:2px solid #e5e7eb">\n                <label class="form-label" style="color:#dc2626;font-weight:600">\n                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:inline;vertical-align:middle;margin-right:4px"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>\n                    Justificación de la modificación (obligatorio)\n                </label>\n                <textarea id="justificacion_modificacion" class="form-input" rows="3" placeholder="Describa el motivo de los cambios realizados (mínimo 10 caracteres)..." style="width:100%;margin-top:8px">').concat(e.justificacion_modificacion||"",'</textarea>\n                <p style="font-size:12px;color:#6b7280;margin-top:4px">Esta justificación quedará registrada en el profesiograma y en la auditoría del sistema.</p>\n            </div>\n        </div>\n\n        <style>\n            .tab-btn.active { background: #5dc4af !important; color: white !important; }\n            .form-input--sm { padding: 6px 8px; font-size: 12px; }\n            .data-table { border-collapse: collapse; }\n            .data-table th, .data-table td { padding: 8px; border-bottom: 1px solid #e5e7eb; }\n            .data-table th { background: #f9fafb; font-weight: 500; }\n        </style>\n    ')}var ja=[{codigo:"EMO",nombre:"EXAMEN MEDICO CON ENFASIS OSTEOMUSCULAR"},{codigo:"EMOA",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS EN ALTURAS"},{codigo:"EMOD",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS DERMATOLOGICO"},{codigo:"EMOMP",nombre:"EXAMEN MEDICO OSTEOMUSCULAR CON ENFASIS EN MANIPULACION DE ALIMENTOS"},{codigo:"AUD",nombre:"AUDIOMETRIA"},{codigo:"ESP",nombre:"ESPIROMETRÍA"},{codigo:"OPTO",nombre:"OPTOMETRÍA"},{codigo:"VIS",nombre:"VISIOMETRÍA"},{codigo:"ECG",nombre:"ELECTROCARDIOGRAMA"},{codigo:"RXC",nombre:"RAYOS X DE COLUMNA"},{codigo:"PSM",nombre:"PRUEBA PSICOSENSOMETRICA"},{codigo:"PST",nombre:"PRUEBA PSICOTECNICA"},{codigo:"FRO",nombre:"FROTIS FARINGEO"},{codigo:"GLI",nombre:"GLICEMIA"},{codigo:"CH",nombre:"CUADRO HEMATICO"},{codigo:"RH",nombre:"HEMOCLASIFICIÓN GRUPO ABO Y FACTOR RH"},{codigo:"KOH",nombre:"PRUEBA DE KOH"},{codigo:"BUN",nombre:"NITROGENO UREICO [BUN]"},{codigo:"PL",nombre:"PERFIL LIPÍDICO"},{codigo:"PAS",nombre:"PRUEBA DE ALCOHOL EN SALIVA"},{codigo:"PE",nombre:"PRUEBA DE EMBARAZO"},{codigo:"PSP",nombre:"PRUEBA DE SUSTANCIAS PSICOACTIVAS"},{codigo:"TGO",nombre:"TRANSAMINASAS TGO"},{codigo:"TGP",nombre:"TRANSAMINASAS TGP"},{codigo:"TRI",nombre:"TRIGLICÉRIDOS"},{codigo:"COL",nombre:"COLESTEROL"},{codigo:"COP",nombre:"COPROLOGICO"},{codigo:"LEP",nombre:"LEPTOSPIRA"},{codigo:"BRU",nombre:"BRUCELA"},{codigo:"TOX",nombre:"TOXOPLASMA"},{codigo:"COLI",nombre:"COLINESTERASA"},{codigo:"CRE",nombre:"CREATININA"},{codigo:"ORI",nombre:"PARCIAL DE ORINA"},{codigo:"TET",nombre:"VACUNA DEL TETANO"},{codigo:"VH",nombre:"VACUNA DEL VIRUS HEPATITIS"},{codigo:"VFA",nombre:"VACUNA DE FIEBRE AMARILLA"},{codigo:"T4L",nombre:"T4 LIBRE"}],za=[{valor:"Semestral",meses:6},{valor:"Anual",meses:12},{valor:"Cada 2 años",meses:24},{valor:"Cada 3 años",meses:36},{valor:"Cada 5 años",meses:60},{valor:"Solo ingreso/egreso",meses:999},{valor:"N/A",meses:0}];function Da(e,n){var t=e.querySelector("#list-".concat(n));if(t){var a=t.querySelector(".empty-list");a&&a.remove();var o=t.querySelector("p");if(o&&o.remove(),n.startsWith("examenes_")){var i=n.replace("examenes_",""),r=ja.map((function(e){return'<option value="'.concat(e.nombre,'">').concat(e.codigo," - ").concat(e.nombre,"</option>")})).join(""),s=za.map((function(e){return'<option value="'.concat(e.valor,'">').concat(e.valor,"</option>")})).join(""),c=t.querySelector("tbody");if(c){var l=document.createElement("tr");l.className="editable-item",l.innerHTML='\n                <td>\n                    <select class="form-input form-input--sm" name="examenes_'.concat(i,'_nombre[]" style="width:100%;font-size:11px">\n                        <option value="">-- Seleccionar examen --</option>\n                        ').concat(r,'\n                    </select>\n                </td>\n                <td>\n                    <select class="form-input form-input--sm" name="examenes_').concat(i,'_periodicidad[]" style="width:100%">\n                        ').concat(s,'\n                    </select>\n                </td>\n                <td><input type="text" class="form-input form-input--sm" name="examenes_').concat(i,'_justificacion[]" placeholder="Justificación técnica" style="width:100%"></td>\n                <td><button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:2px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></td>\n            '),c.appendChild(l)}else t.innerHTML='\n                <table class="data-table" style="font-size:13px;width:100%">\n                    <thead><tr><th>Examen</th><th style="width:140px">Periodicidad</th><th>Justificación</th><th style="width:40px"></th></tr></thead>\n                    <tbody>\n                        <tr class="editable-item">\n                            <td>\n                                <select class="form-input form-input--sm" name="examenes_'.concat(i,'_nombre[]" style="width:100%;font-size:11px">\n                                    <option value="">-- Seleccionar examen --</option>\n                                    ').concat(r,'\n                                </select>\n                            </td>\n                            <td>\n                                <select class="form-input form-input--sm" name="examenes_').concat(i,'_periodicidad[]" style="width:100%">\n                                    ').concat(s,'\n                                </select>\n                            </td>\n                            <td><input type="text" class="form-input form-input--sm" name="examenes_').concat(i,'_justificacion[]" placeholder="Justificación" style="width:100%"></td>\n                            <td><button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:2px"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></td>\n                        </tr>\n                    </tbody>\n                </table>\n            ')}else{var d={epp:"Ej: Guantes de nitrilo",aptitudes:"Ej: Capacidad para trabajo en equipo",condiciones_incompatibles:"Ej: Epilepsia no controlada"}[n]||"Nuevo item",u=document.createElement("div");u.className="editable-item",u.style="display:flex;gap:8px;margin-bottom:8px;align-items:center",u.innerHTML='\n            <input type="text" class="form-input" name="'.concat(n,'[]" placeholder="').concat(d,'" style="flex:1">\n            <button type="button" class="btn btn--ghost btn--sm" data-remove-item style="color:#ef4444;padding:4px">\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>\n            </button>\n        '),t.appendChild(u)}}}function Ba(e,n,t){return qa.apply(this,arguments)}function qa(){return qa=(0,i.A)(u().mark((function e(n,t,a){var o,i,r,s,c,l,d,p,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.element,(r=null===(o=i.querySelector("#justificacion_modificacion"))||void 0===o||null===(o=o.value)||void 0===o?void 0:o.trim())&&!(r.length<10)){e.next=6;break}return Ia("La justificación es obligatoria (mínimo 10 caracteres)","error"),null===(s=i.querySelector("#justificacion_modificacion"))||void 0===s||s.focus(),e.abrupt("return");case 6:return l=function(e){var n=i.querySelectorAll('input[name="'.concat(e,'[]"]'));return Array.from(n).map((function(e){return e.value.trim()})).filter((function(e){return e}))},d={examenes_ingreso:(c=function(e){var n=i.querySelectorAll('select[name="examenes_'.concat(e,'_nombre[]"]')),t=i.querySelectorAll('select[name="examenes_'.concat(e,'_periodicidad[]"]')),a=i.querySelectorAll('input[name="examenes_'.concat(e,'_justificacion[]"]')),o=[];return n.forEach((function(e,n){var i,r;e.value.trim()&&o.push({nombre:e.value.trim(),periodicidad:(null===(i=t[n])||void 0===i||null===(i=i.value)||void 0===i?void 0:i.trim())||"",justificacion:(null===(r=a[n])||void 0===r||null===(r=r.value)||void 0===r?void 0:r.trim())||""})})),o})("ingreso"),examenes_periodicos:c("periodicos"),examenes_retiro:c("retiro"),epp:l("epp"),aptitudes:l("aptitudes"),condiciones_incompatibles:l("condiciones_incompatibles"),justificacion_modificacion:r},console.log("[MultiRol] Guardando cargo:",d),e.prev=10,e.next=13,fetch("".concat(yt,"/medico/empresas/").concat(t,"/cargos/").concat(a),{method:"PUT",headers:{Authorization:"Bearer ".concat(wt.token),"Content-Type":"application/json"},body:JSON.stringify(d)});case 13:return p=e.sent,e.next=16,p.json();case 16:if(m=e.sent,p.ok){e.next=19;break}throw new Error(m.message||"Error al guardar");case 19:Ia("Cargo actualizado correctamente","success"),n.close(),fa(t),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(10),console.error("[MultiRol] Error guardando cargo:",e.t0),Ia(e.t0.message||"Error al guardar cambios","error");case 28:case"end":return e.stop()}}),e,null,[[10,24]])}))),qa.apply(this,arguments)}function Ha(e){if(!e)return"";var n=document.createElement("div");return n.textContent=e,n.innerHTML}function Ua(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Fa(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ua(Object(t),!0).forEach((function(n){(0,a.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ua(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var $a={currentPage:"home",companyId:null,companyName:"",user:null,isLoading:!1,data:{summary:null,alerts:null,conditions:null,risks:null,examenes:null,cargos:null,matriz:null}},Ga="#sidebar",Va="#sidebar-toggle",Wa="#sidebar-overlay",Ja="#mobile-menu-toggle",Xa=".sidebar-nav__item",Za=".dashboard-page",Ka=function(){return l((function e(){r(this,e),this.pages=new Map,this.currentPage=null,this.init()}),[{key:"init",value:function(){var e=this;document.querySelectorAll(Za).forEach((function(n){var t=n.dataset.page;e.pages.set(t,n)})),this.bindNavEvents(),this.bindSidebarEvents();var n=window.location.hash.replace("#","")||"home";this.navigateTo(n)}},{key:"bindNavEvents",value:function(){var e=this;document.querySelectorAll(Xa).forEach((function(n){n.addEventListener("click",(function(t){t.preventDefault();var a=n.dataset.page;a&&e.navigateTo(a)}))})),document.querySelectorAll("[data-navigate]").forEach((function(n){n.addEventListener("click",(function(t){t.preventDefault();var a=n.dataset.navigate;a&&e.navigateTo(a)}))})),window.addEventListener("popstate",(function(){var n=window.location.hash.replace("#","")||"home";e.navigateTo(n,!1)}))}},{key:"bindSidebarEvents",value:function(){var e=document.querySelector(Ga),n=document.querySelector(Va),t=document.querySelector(Wa),a=document.querySelector(Ja);n&&n.addEventListener("click",(function(){e.classList.toggle("collapsed"),document.querySelector(".dashboard-main").classList.toggle("sidebar-collapsed")})),a&&a.addEventListener("click",(function(){e.classList.toggle("open"),t.classList.toggle("visible")})),t&&t.addEventListener("click",(function(){e.classList.remove("open"),t.classList.remove("visible")}))}},{key:"navigateTo",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.pages.has(e)||(console.warn('Page "'.concat(e,'" not found')),e="home"),this.pages.forEach((function(e,n){e.style.display="none"}));var t=this.pages.get(e);t&&(t.style.display="block"),document.querySelectorAll(Xa).forEach((function(n){n.classList.remove("active"),n.dataset.page===e&&n.classList.add("active")})),this.currentPage=e,$a.currentPage=e,n&&window.history.pushState({page:e},"","#".concat(e));var a=document.querySelector(Ga),o=document.querySelector(Wa);a&&a.classList.remove("open"),o&&o.classList.remove("visible"),this.loadPageData(e),window.lucide&&window.lucide.createIcons(),console.log("Navigated to: ".concat(e))}},{key:"loadPageData",value:(e=(0,i.A)(u().mark((function e(n){var t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={home:Ya,inteligencia:ro,"mapa-org":co,cargos:uo,examenes:mo,matriz:bo,estadisticas:wo,sve:Eo,psicosocial:Ao,documentos:So,profesiograma:Po,config:Mo,"panel-medico":Lo},!window.multiRolPageHandlers||!window.multiRolPageHandlers[n]){e.next=11;break}return e.prev=2,e.next=5,window.multiRolPageHandlers[n]();case 5:return e.abrupt("return");case 8:e.prev=8,e.t0=e.catch(2),console.error("Error loading multi-rol page ".concat(n,":"),e.t0);case 11:if(!(a=t[n])){e.next=21;break}return e.prev=13,e.next=16,a();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(13),console.error("Error loading page ".concat(n,":"),e.t1);case 21:case"end":return e.stop()}}),e,null,[[2,8],[13,18]])}))),function(n){return e.apply(this,arguments)})}]);var e}();function Ya(){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading Dashboard Home..."),e.prev=1,eo(),e.next=5,to();case 5:(n=e.sent)&&oo(n),io("donut-cumplimiento",87),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Error loading dashboard home:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function eo(){var e=new Date,n=document.getElementById("last-update"),t=document.getElementById("next-update");if(n&&(n.textContent="Hoy ".concat(no(e))),t){var a=new Date(e.getTime()+216e5);t.textContent="Hoy ".concat(no(a))}}function no(e){return e.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!0}).toUpperCase()}function to(){return ao.apply(this,arguments)}function ao(){return(ao=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{cumplimiento:87,trabajadores:{total:53,alDia:45,alertas:8},alertas:{total:8,vencidos:3,proximos:5},examenes:{vencidos:3,proximos:5},riesgos:{nivelV:8,nivelIV:15,total:34},condiciones:{hipoacusia:15,trend:3},sve:3,peligros:122});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oo(e){zo("cumplimiento-value",e.cumplimiento),zo("total-trabajadores",e.trabajadores.total),zo("trabajadores-aldia",e.trabajadores.alDia),zo("trabajadores-alertas",e.trabajadores.alertas),zo("total-alertas",e.alertas.total),zo("alertas-vencidos",e.alertas.vencidos),zo("alertas-proximos",e.alertas.proximos),zo("hipoacusia-percent","".concat(e.condiciones.hipoacusia,"%")),zo("condition-trend-text","+".concat(e.condiciones.trend,"% vs trimestre")),zo("examenes-vencidos",e.examenes.vencidos),zo("examenes-proximos",e.examenes.proximos),zo("riesgos-v",e.riesgos.nivelV),zo("riesgos-iv",e.riesgos.nivelIV),zo("riesgos-total",e.riesgos.total),zo("stat-cumplimiento","".concat(e.cumplimiento,"%")),zo("stat-examenes-dia",e.trabajadores.alDia),zo("stat-total-trabajadores",e.trabajadores.total),zo("stat-sve-activos",e.sve),zo("stat-peligros",e.peligros),zo("insight-pattern-text","Aumento 15% deterioro auditivo en soldadores últimos 6 meses"),zo("insight-recommendation-text","Auditoría uso EPP + medir ruido")}function io(e,n){var t=document.getElementById(e);if(t){var a=160,o=2*Math.PI*74,i=o-n/100*o;t.innerHTML='\n        <svg width="'.concat(a,'" height="').concat(a,'" viewBox="0 0 ').concat(a," ").concat(a,'">\n            \x3c!-- Background circle --\x3e\n            <circle\n                cx="').concat(80,'"\n                cy="').concat(80,'"\n                r="').concat(74,'"\n                fill="none"\n                stroke="#e5e7eb"\n                stroke-width="').concat(12,'"\n            />\n            \x3c!-- Progress circle --\x3e\n            <circle\n                cx="').concat(80,'"\n                cy="').concat(80,'"\n                r="').concat(74,'"\n                fill="none"\n                stroke="#5dc4af"\n                stroke-width="').concat(12,'"\n                stroke-linecap="round"\n                stroke-dasharray="').concat(o,'"\n                stroke-dashoffset="').concat(i,'"\n                transform="rotate(-90 ').concat(80," ").concat(80,')"\n                style="transition: stroke-dashoffset 0.5s ease;"\n            />\n            \x3c!-- Center text --\x3e\n            <text\n                x="').concat(80,'"\n                y="').concat(80,'"\n                text-anchor="middle"\n                dominant-baseline="middle"\n                font-family="Poppins, sans-serif"\n                font-size="36"\n                font-weight="700"\n                fill="#383d47"\n            >').concat(n,"%</text>\n        </svg>\n    ")}}function ro(){return so.apply(this,arguments)}function so(){return(so=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Intelligence Page..."),Ro("inteligencia-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="brain"></i>\n            </div>\n            <h3 class="empty-state__title">Inteligencia de Salud</h3>\n            <p class="empty-state__description">Aún no hay datos disponibles. Complete el wizard de riesgos para generar análisis de salud.</p>\n            <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Iniciar Wizard</a>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function co(){return lo.apply(this,arguments)}function lo(){return(lo=(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Org Map Page..."),(n=document.getElementById("org-chart-canvas"))&&(n.innerHTML='\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="network"></i>\n                </div>\n                <h3 class="empty-state__title">Mapa Organizacional</h3>\n                <p class="empty-state__description">Aún no hay datos disponibles. Agregue cargos para visualizar la estructura organizacional.</p>\n            </div>\n        ',window.lucide&&window.lucide.createIcons());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function uo(){return po.apply(this,arguments)}function po(){return po=(0,i.A)(u().mark((function e(){var n,t,a,o,i,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔵 [CARGOS] ========== Loading Cargos Page =========="),Ro("cargos-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <div class="skeleton skeleton--circle" style="width:64px;height:64px;"></div>\n            </div>\n            <h3 class="empty-state__title">Cargando cargos...</h3>\n        </div>\n    '),e.next=4,qo();case 4:if(n=e.sent,console.log("🔵 [CARGOS] API result:",n),n&&n.success){e.next=11;break}return console.log("🟡 [CARGOS] No cargos found from API"),Ro("cargos-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="users"></i>\n                </div>\n                <h3 class="empty-state__title">Gestión de Cargos</h3>\n                <p class="empty-state__description">Aún no hay cargos registrados. Complete el wizard para agregar cargos a la empresa.</p>\n                <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Agregar Cargos</a>\n            </div>\n        '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 11:if(e.prev=11,t=n.cargos||[],console.log("🔵 [CARGOS] Processing cargos from API:",t.length),0!==t.length){e.next=18;break}return Ro("cargos-content",'\n                <div class="empty-state">\n                    <div class="empty-state__icon">\n                        <i data-lucide="users"></i>\n                    </div>\n                    <h3 class="empty-state__title">Sin Cargos</h3>\n                    <p class="empty-state__description">No hay cargos configurados. Agregue cargos en el wizard.</p>\n                    <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Agregar Cargos</a>\n                </div>\n            '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 18:a=t.map((function(e,n){var t=e.riesgosCount||0,a=e.num_trabajadores||0,o=e.nrNivelMaximo||"I",i=e.togglesActivos||[],r=i.map((function(e){return'<span class="badge badge--warning"><i data-lucide="'.concat({Alturas:"mountain",Alimentos:"utensils",Vehiculo:"car","Espacios Conf.":"box"}[e]||"alert-triangle",'" style="width:12px;height:12px;"></i> ').concat(e,"</span>")})).join(""),s={I:"success",II:"info",III:"warning",IV:"danger",V:"danger"}[o]||"muted";return'\n                <div class="card">\n                    <div class="card__header">\n                        <h3 class="card__title">'.concat(e.nombre_cargo||"Cargo "+(n+1),'</h3>\n                        <div class="card__badges">\n                            <span class="badge badge--').concat(t>0?"primary":"muted",'">').concat(t," riesgo").concat(1!==t?"s":"","</span>\n                            ").concat(t>0?'<span class="badge badge--'.concat(s,'">NR ').concat(o,"</span>"):"",'\n                        </div>\n                    </div>\n                    <div class="card__body">\n                        <div class="cargo-info">\n                            <div class="cargo-info__row">\n                                <i data-lucide="map-pin" class="text-muted"></i>\n                                <span>').concat(e.area||"Sin área"," / ").concat(e.zona||"Sin zona",'</span>\n                            </div>\n                            <div class="cargo-info__row">\n                                <i data-lucide="users" class="text-muted"></i>\n                                <span>').concat(a," persona").concat(1!==a?"s":"","</span>\n                            </div>\n                            ").concat(i.length>0?'\n                                <div class="cargo-info__conditions mt-2">\n                                    '.concat(r,"\n                                </div>\n                            "):"",'\n                        </div>\n                    </div>\n                    <div class="card__footer">\n                        <button class="btn btn--sm btn--ghost btn-view-cargo" data-cargo-id="').concat(e.id,"\" data-cargo='").concat(JSON.stringify(e).replace(/'/g,"&#39;"),'\'>\n                            <i data-lucide="eye"></i> Ver detalles\n                        </button>\n                        <button class="btn btn--sm btn--outline btn-edit-cargo" data-cargo-id="').concat(e.id,"\" data-cargo='").concat(JSON.stringify(e).replace(/'/g,"&#39;"),'\'>\n                            <i data-lucide="edit-2"></i> Editar\n                        </button>\n                    </div>\n                </div>\n            ')})).join(""),o=t.reduce((function(e,n){return e+(n.num_trabajadores||0)}),0),i=t.filter((function(e){var n;return null===(n=e.togglesActivos)||void 0===n?void 0:n.includes("Alturas")})).length,t.filter((function(e){var n;return null===(n=e.togglesActivos)||void 0===n?void 0:n.includes("Espacios Conf.")})).length,r=t.reduce((function(e,n){return e+(n.riesgosCount||0)}),0),Ro("cargos-content",'\n            <div class="dashboard-grid dashboard-grid--cols-4 mb-6">\n                <div class="card card--stat">\n                    <div class="stat-value">'.concat(t.length,'</div>\n                    <div class="stat-label">Total Cargos</div>\n                </div>\n                <div class="card card--stat">\n                    <div class="stat-value">').concat(o,'</div>\n                    <div class="stat-label">Total Personas</div>\n                </div>\n                <div class="card card--stat">\n                    <div class="stat-value">').concat(r,'</div>\n                    <div class="stat-label">Total Riesgos</div>\n                </div>\n                <div class="card card--stat card--warning">\n                    <div class="stat-value stat-value--warning">').concat(i,'</div>\n                    <div class="stat-label">Trabajo en Alturas</div>\n                </div>\n            </div>\n            <div class="dashboard-grid dashboard-grid--cols-3">\n                ').concat(a,'\n            </div>\n            <div class="text-center mt-6">\n                <button class="btn btn--primary btn-nuevo-cargo-inline">\n                    <i data-lucide="plus"></i> Agregar Cargo\n                </button>\n            </div>\n        ')),window.lucide&&window.lucide.createIcons(),Ko(),e.next=33;break;case 28:e.prev=28,e.t0=e.catch(11),console.error("Error loading cargos:",e.t0),Ro("cargos-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="alert-circle"></i>\n                </div>\n                <h3 class="empty-state__title">Error</h3>\n                <p class="empty-state__description">Hubo un error al cargar los cargos.</p>\n            </div>\n        '),window.lucide&&window.lucide.createIcons();case 33:case"end":return e.stop()}}),e,null,[[11,28]])}))),po.apply(this,arguments)}function mo(){return go.apply(this,arguments)}function go(){return(go=(0,i.A)(u().mark((function e(){var n,t,a,o,i,r,s,c,l,d,p,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("🔵 [EXAMENES] ========== Loading Examenes Page (SPRINT 8) =========="),(n=document.getElementById("examenes-table-body"))&&(n.innerHTML='\n            <tr>\n                <td colspan="7" class="table-empty">\n                    <div class="empty-state empty-state--inline">\n                        <div class="loading-spinner-inline"></div>\n                        <span>Cargando paquetes de exámenes...</span>\n                    </div>\n                </td>\n            </tr>\n        '),t=localStorage.getItem("empresaId"),a=localStorage.getItem("authToken"),t&&a){e.next=15;break}return console.log("🟡 [EXAMENES] No empresaId or authToken"),zo("examenes-stat-vencidos","0"),zo("examenes-stat-proximos","0"),zo("examenes-stat-aldia","0"),zo("examenes-stat-agendar","0"),zo("examenes-showing","Mostrando 0 de 0"),n&&(n.innerHTML='\n                <tr>\n                    <td colspan="7" class="table-empty">\n                        <div class="empty-state empty-state--inline">\n                            <i data-lucide="log-in"></i>\n                            <span>Inicie sesión para ver los exámenes médicos</span>\n                        </div>\n                    </td>\n                </tr>\n            '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 15:return e.prev=15,e.next=18,fetch("/api/examenes/tabla/".concat(t),{headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"}});case 18:if((r=e.sent).ok){e.next=21;break}throw new Error("Error ".concat(r.status,": ").concat(r.statusText));case 21:return e.next=23,r.json();case 23:if(s=e.sent,console.log("🔵 [EXAMENES] API result:",s),s.success&&s.filas&&0!==s.filas.length){e.next=34;break}return zo("examenes-stat-vencidos","0"),zo("examenes-stat-proximos","0"),zo("examenes-stat-aldia","0"),zo("examenes-stat-agendar","0"),zo("examenes-showing","Mostrando 0 cargos"),n&&(n.innerHTML='\n                    <tr>\n                        <td colspan="7" class="table-empty">\n                            <div class="empty-state empty-state--inline">\n                                <i data-lucide="clipboard-list"></i>\n                                <span>Complete el wizard y genere el profesiograma para ver los paquetes de exámenes</span>\n                            </div>\n                        </td>\n                    </tr>\n                '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 34:c=s.filas,l=s.cargos,d=s.resumen,console.log("🔵 [EXAMENES] Cargos:",c.length,"Total trabajadores:",d.totalTrabajadores),console.log("🔵 [EXAMENES] Sample fila:",c[0]?{cargo:c[0].cargoNombre,area:c[0].area,paquete:c[0].paqueteNombre,trabajadores:null===(o=c[0].trabajadores)||void 0===o?void 0:o.length,examenesIngreso:null===(i=c[0].examenesIngreso)||void 0===i?void 0:i.length}:"No filas"),zo("examenes-stat-vencidos",(d.vencidos||0).toString()),zo("examenes-stat-proximos",(d.proximos||0).toString()),zo("examenes-stat-aldia",(d.alDia||0).toString()),zo("examenes-stat-agendar",(d.porAgendar||0).toString()),zo("examenes-showing","".concat(c.length," cargos · ").concat(d.totalTrabajadores," trabajadores")),(p=document.getElementById("filter-cargo"))&&l&&(p.innerHTML='<option value="">Cargo: Todos</option>',l.forEach((function(e){p.innerHTML+='<option value="'.concat(e.nombre,'">').concat(e.nombre,"</option>")}))),m=c.map((function(e){var n="cargo-row-".concat(e.cargoId),t="cargo-detail-".concat(e.cargoId),a='\n                <svg class="paquete-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <polyline points="6 9 12 15 18 9"></polyline>\n                </svg>\n            ',o={por_agendar:"warning",agendado:"info",completado:"success",vencido:"danger"}[e.estado]||"muted",i=function(e,n){return e&&0!==e.length?e.map((function(e){return'\n                    <div class="examen-item">\n                        <span class="badge badge--'.concat("ingreso"===n?"primary":"periodico"===n?"info":"muted",' badge--xs">').concat(e.codigo,'</span>\n                        <span class="examen-item-nombre">').concat(e.nombre,"</span>\n                        ").concat(e.periodicidad?'<span class="examen-item-periodo">('.concat(e.periodicidad,")</span>"):"","\n                    </div>\n                ")})).join(""):'<span class="text-muted">No aplica</span>'};return'\n                <tr id="'.concat(n,'" class="cargo-row" data-cargo-id="').concat(e.cargoId,'">\n                    <td>\n                        <input type="checkbox" class="cargo-checkbox" id="chk-cargo-').concat(e.cargoId,'" name="cargo-').concat(e.cargoId,'" data-cargo-id="').concat(e.cargoId,'" aria-label="Seleccionar cargo ').concat(e.cargoNombre,'" />\n                    </td>\n                    <td>\n                        <button type="button" class="cargo-toggle" data-target="').concat(t,'" aria-expanded="false" aria-controls="').concat(t,'">\n                            ').concat(a,'\n                            <strong class="cargo-nombre">').concat(e.cargoNombre,'</strong>\n                        </button>\n                    </td>\n                    <td>\n                        <span class="area-badge">').concat(e.area,'</span>\n                    </td>\n                        <td>\n                        <div class="paquete-cell">\n                            <span class="paquete-nombre-text">').concat(e.paqueteNombre,'</span>\n                            <span class="badge badge--muted badge--xs">').concat(e.numExamenes,' exámenes</span>\n                            </div>\n                        </td>\n                        <td>\n                        <div class="trabajadores-count">\n                            <span class="count-number">').concat(e.numTrabajadores,'</span>\n                            <span class="count-label">trabajadores</span>\n                        </div>\n                        </td>\n                    <td>\n                        <span class="badge badge--').concat(o,'">').concat(e.estadoLabel,'</span>\n                    </td>\n                        <td>\n                        <button \n                            type="button"\n                            class="btn btn--outline btn--sm cargo-expand-btn"\n                            data-target="').concat(t,'"\n                            title="Ver trabajadores y exámenes">\n                            <span>Ver detalle</span>\n                            ').concat(a,"\n                            </button>\n                        </td>\n                    </tr>\n            ")+'\n                <tr id="'.concat(t,'" class="cargo-detail-row" style="display: none;">\n                    <td colspan="7">\n                        <div class="cargo-detail">\n                            \x3c!-- Sección Trabajadores --\x3e\n                            <div class="cargo-detail-section cargo-detail-section--trabajadores">\n                                <h4 class="cargo-detail-section-title">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>\n                                        <circle cx="9" cy="7" r="4"></circle>\n                                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>\n                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n                                    </svg>\n                                    Trabajadores (').concat(e.numTrabajadores,')\n                                </h4>\n                                <div class="trabajadores-list">\n                                    ').concat(e.trabajadores&&0!==e.trabajadores.length?e.trabajadores.map((function(n){return'\n                    <div class="trabajador-item" data-trabajador-id="'.concat(n.id,'">\n                        <div class="trabajador-info">\n                            <span class="trabajador-numero">#').concat(n.numero,'</span>\n                            <div class="trabajador-nombre-grupo">\n                                <span class="trabajador-nombre-inner">').concat(n.nombre||"Trabajador ".concat(n.numero),"</span>\n                                ").concat(n.cedula?'<span class="trabajador-cedula text-muted">CC: '.concat(n.cedula,"</span>"):"",'\n                            </div>\n                            <span class="badge badge--').concat("por_agendar"===n.estado?"warning":"agendado"===n.estado?"info":"success",' badge--xs">').concat(n.estadoLabel,'</span>\n                        </div>\n                        <button\n                            type="button"\n                            class="btn btn--sm btn--primary btn--agendar-trabajador"\n                            title="Agendar exámenes para ').concat(n.nombre||"Trabajador ".concat(n.numero),'"\n                            data-trabajador-id="').concat(n.id,'"\n                            data-trabajador-numero="').concat(n.numero,'"\n                            data-trabajador-nombre="').concat(n.nombre||"Trabajador ".concat(n.numero),'"\n                            data-trabajador-cedula="').concat(n.cedula||"",'"\n                            data-cargo="').concat(e.cargoNombre,'"\n                            data-paquete="').concat(e.paqueteNombre,"\"\n                            data-examenes-ingreso='").concat(JSON.stringify(e.examenesIngreso||[]),"'\n                            data-examenes-periodicos='").concat(JSON.stringify(e.examenesPeriodicos||[]),"'\n                            data-examenes-retiro='").concat(JSON.stringify(e.examenesRetiro||[]),"'>\n                            ").concat('\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>\n                    <line x1="16" y1="2" x2="16" y2="6"></line>\n                    <line x1="8" y1="2" x2="8" y2="6"></line>\n                    <line x1="3" y1="10" x2="21" y2="10"></line>\n                </svg>\n            ',"\n                            <span>Agendar</span>\n                        </button>\n                    </div>\n                ")})).join(""):'<p class="text-muted">No hay trabajadores asignados</p>','\n                                </div>\n                            </div>\n\n                            \x3c!-- Sección Exámenes del Paquete --\x3e\n                            <div class="cargo-detail-section cargo-detail-section--examenes">\n                                <h4 class="cargo-detail-section-title">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>\n                                        <polyline points="14 2 14 8 20 8"></polyline>\n                                        <line x1="16" y1="13" x2="8" y2="13"></line>\n                                        <line x1="16" y1="17" x2="8" y2="17"></line>\n                                        <line x1="10" y1="9" x2="8" y2="9"></line>\n                                    </svg>\n                                    Exámenes del ').concat(e.paqueteNombre,'\n                                </h4>\n                                <div class="paquete-detail-grid">\n                                    <div class="paquete-section paquete-section--ingreso">\n                                        <h5 class="paquete-section-title">\n                                            <span class="badge badge--primary">Ingreso</span>\n                                            Pre-ocupacionales\n                                        </h5>\n                                        <div class="paquete-examenes-list">\n                                            ').concat(i(e.examenesIngreso,"ingreso"),'\n                                        </div>\n                                    </div>\n                                    <div class="paquete-section paquete-section--periodico">\n                                        <h5 class="paquete-section-title">\n                                            <span class="badge badge--info">Periódicos</span>\n                                            Ocupacionales\n                                        </h5>\n                                        <div class="paquete-examenes-list">\n                                            ').concat(i(e.examenesPeriodicos,"periodico"),'\n                                        </div>\n                                    </div>\n                                    <div class="paquete-section paquete-section--retiro">\n                                        <h5 class="paquete-section-title">\n                                            <span class="badge badge--muted">Retiro</span>\n                                            Post-ocupacionales\n                                        </h5>\n                                        <div class="paquete-examenes-list">\n                                            ').concat(i(e.examenesRetiro,"retiro"),"\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            </div>\n                        </td>\n                    </tr>\n                ")})).join(""),n&&(n.innerHTML=m,console.log("🔵 [EXAMENES] Table rendered with",c.length,"cargo rows")),vo(),console.log("🔵 [EXAMENES] Cargo toggle listeners configured"),ho(),console.log("🔵 [EXAMENES] Agendar trabajador listeners configured"),window.lucide&&window.lucide.createIcons(),e.next=62;break;case 53:e.prev=53,e.t0=e.catch(15),console.error("Error loading examenes:",e.t0),zo("examenes-stat-vencidos","0"),zo("examenes-stat-proximos","0"),zo("examenes-stat-aldia","0"),zo("examenes-stat-agendar","0"),n&&(n.innerHTML='\n                <tr>\n                    <td colspan="7" class="table-empty">\n                        <div class="empty-state empty-state--inline">\n                            <i data-lucide="alert-circle"></i>\n                            <span>Error al cargar los exámenes: '.concat(e.t0.message,"</span>\n                        </div>\n                    </td>\n                </tr>\n            ")),window.lucide&&window.lucide.createIcons();case 62:case"end":return e.stop()}}),e,null,[[15,53]])})))).apply(this,arguments)}function vo(){var e=document.querySelectorAll(".cargo-toggle");console.log("🔵 [SETUP] Found",e.length,"cargo toggle buttons"),e.forEach((function(e){e.addEventListener("click",(function(n){n.preventDefault(),console.log("🔵 [TOGGLE] Cargo toggle clicked:",e.dataset.target),fo(e.dataset.target,e)}))})),document.querySelectorAll(".cargo-expand-btn").forEach((function(e){e.addEventListener("click",(function(n){n.preventDefault();var t=e.closest("tr").querySelector(".cargo-toggle");fo(e.dataset.target,t)}))}))}function fo(e,n){var t=document.getElementById(e),a="true"===(null==n?void 0:n.getAttribute("aria-expanded"));t&&(a?(t.style.display="none",null==n||n.setAttribute("aria-expanded","false"),null==n||n.classList.remove("cargo-toggle--expanded")):(t.style.display="table-row",null==n||n.setAttribute("aria-expanded","true"),null==n||n.classList.add("cargo-toggle--expanded")))}function ho(){var e=document.querySelectorAll(".btn--agendar-trabajador");console.log("🔵 [SETUP] Found",e.length,"agendar trabajador buttons"),e.forEach((function(e){e.addEventListener("click",(function(n){n.preventDefault(),n.stopPropagation(),console.log("🟢 [CLICK] Agendar trabajador button clicked");var t=e.dataset.trabajadorNombre,a=e.dataset.cargo,r=e.dataset.paquete,s=[],c=[],l=[];try{s=JSON.parse(e.dataset.examenesIngreso||"[]"),c=JSON.parse(e.dataset.examenesPeriodicos||"[]"),l=JSON.parse(e.dataset.examenesRetiro||"[]")}catch(e){console.error("🔴 [EXAMENES] Error parsing examenes:",e)}console.log("🔵 [EXAMENES] Agendar button clicked for:",t,"cargo:",a),function(e){console.log("🟢 [MODAL] showAgendarModal called with datos:",e);var n=e.trabajador,t=e.cargo,a=e.paquete,r=e.examenesIngreso,s=e.examenesPeriodicos,c=e.examenesRetiro,l=s.length>0?Math.min.apply(Math,(0,o.A)(s.map((function(e){return e.periodicidadMeses||12})))):12,d=new Date,p=new Date(d);p.setDate(p.getDate()+7);var m=new Date(p);m.setMonth(m.getMonth()+l);var g=function(e){return e.toISOString().split("T")[0]},v=function(e){return e.toLocaleDateString("es-CO",{day:"numeric",month:"long",year:"numeric"})},f="",h="";try{var b=JSON.parse(localStorage.getItem("genesys_empresa")||"{}");f=b.nombre_legal||b.razon_social||b.nombre||"";var y=JSON.parse(localStorage.getItem("genesys_user")||"{}");h=y.nombre||y.full_name||""}catch(e){}var x=function(e,n,t){return e&&0!==e.length?e.map((function(e,a){return'\n            <label class="checkbox-item" for="examen-'.concat(n,"-").concat(t,"-").concat(a,'">\n                <input type="checkbox" \n                       id="examen-').concat(n,"-").concat(t,"-").concat(a,'" \n                       name="examen-').concat(n,'[]" \n                       value="').concat(e.codigo,'"\n                       data-nombre="').concat(e.nombre,'"\n                       data-periodicidad="').concat(e.periodicidadMeses||12,'"\n                       class="examen-check examen-check--').concat(n,'">\n                <span class="checkbox-label">\n                    <span class="badge badge--').concat("ingreso"===n?"primary":"periodico"===n?"info":"muted",' badge--xs">').concat(e.codigo,"</span>\n                    ").concat(e.nombre,"\n                </span>\n            </label>\n        ")})).join(""):'<p class="text-muted">No hay exámenes en esta categoría</p>'},w='\n        <div class="modal-overlay modal--agendar" id="modal-agendar-examen">\n            <div class="modal--agendar-content">\n                <div class="modal__header">\n                    <h2 class="modal__title">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>\n                            <line x1="16" y1="2" x2="16" y2="6"></line>\n                            <line x1="8" y1="2" x2="8" y2="6"></line>\n                            <line x1="3" y1="10" x2="21" y2="10"></line>\n                        </svg>\n                        Orden de Servicios - '.concat(a,'\n                    </h2>\n                    <button type="button" class="modal__close" id="close-agendar-modal" aria-label="Cerrar">&times;</button>\n                </div>\n                <form id="form-agendar-examen" class="modal__body">\n                    <div class="agendar-form">\n                        \x3c!-- Sección: Tipo de Examen (primero para activar checkboxes) --\x3e\n                        <div class="form-section form-section--tipo">\n                            <h4 class="form-section-title">🩺 Tipo de Examen</h4>\n                            <div class="tipo-examen-grid">\n                                <label class="tipo-examen-option" for="tipo-examen-ingreso">\n                                    <input type="radio" name="tipoExamen" id="tipo-examen-ingreso" value="Ingreso">\n                                    <span class="tipo-examen-card tipo-examen-card--ingreso">\n                                        <span class="tipo-icon">📋</span>\n                                        <span class="tipo-label">Ingreso</span>\n                                        <span class="tipo-desc">Pre-ocupacional</span>\n                                    </span>\n                                </label>\n                                <label class="tipo-examen-option" for="tipo-examen-periodico">\n                                    <input type="radio" name="tipoExamen" id="tipo-examen-periodico" value="Periódico" checked>\n                                    <span class="tipo-examen-card tipo-examen-card--periodico">\n                                        <span class="tipo-icon">🔄</span>\n                                        <span class="tipo-label">Periódico</span>\n                                        <span class="tipo-desc">Ocupacional</span>\n                                    </span>\n                                </label>\n                                <label class="tipo-examen-option" for="tipo-examen-retiro">\n                                    <input type="radio" name="tipoExamen" id="tipo-examen-retiro" value="Retiro">\n                                    <span class="tipo-examen-card tipo-examen-card--retiro">\n                                        <span class="tipo-icon">📤</span>\n                                        <span class="tipo-label">Retiro</span>\n                                        <span class="tipo-desc">Post-ocupacional</span>\n                                    </span>\n                                </label>\n                                <label class="tipo-examen-option" for="tipo-examen-post-incapacidad">\n                                    <input type="radio" name="tipoExamen" id="tipo-examen-post-incapacidad" value="Post Incapacidad">\n                                    <span class="tipo-examen-card tipo-examen-card--post-incapacidad">\n                                        <span class="tipo-icon">🏥</span>\n                                        <span class="tipo-label">Post Incapacidad</span>\n                                        <span class="tipo-desc">Después de incapacidad</span>\n                                    </span>\n                                </label>\n                                <label class="tipo-examen-option" for="tipo-examen-control">\n                                    <input type="radio" name="tipoExamen" id="tipo-examen-control" value="Control">\n                                    <span class="tipo-examen-card tipo-examen-card--control">\n                                        <span class="tipo-icon">🔍</span>\n                                        <span class="tipo-label">Control</span>\n                                        <span class="tipo-desc">Seguimiento</span>\n                                    </span>\n                                </label>\n                            </div>\n                        </div>\n\n                        \x3c!-- Sección: Exámenes del Paquete --\x3e\n                        <div class="form-section form-section--examenes">\n                            <h4 class="form-section-title">📦 Exámenes del Paquete</h4>\n                            <p class="form-hint mb-2">Los exámenes se seleccionan automáticamente según el tipo de examen elegido</p>\n                            \n                            <div class="examenes-grupos">\n                                <div class="examenes-grupo examenes-grupo--ingreso" id="grupo-ingreso">\n                                    <h5 class="examenes-grupo-title">\n                                        <span class="badge badge--primary">Ingreso</span>\n                                        Pre-ocupacionales\n                                    </h5>\n                                    <div class="examenes-checkboxes">\n                                        ').concat(x(r,"ingreso",0),'\n                                    </div>\n                                </div>\n                                <div class="examenes-grupo examenes-grupo--periodico" id="grupo-periodico">\n                                    <h5 class="examenes-grupo-title">\n                                        <span class="badge badge--info">Periódicos</span>\n                                        Ocupacionales\n                                    </h5>\n                                    <div class="examenes-checkboxes">\n                                        ').concat(x(s,"periodico",0),'\n                                    </div>\n                                </div>\n                                <div class="examenes-grupo examenes-grupo--retiro" id="grupo-retiro">\n                                    <h5 class="examenes-grupo-title">\n                                        <span class="badge badge--muted">Retiro</span>\n                                        Post-ocupacionales\n                                    </h5>\n                                    <div class="examenes-checkboxes">\n                                        ').concat(x(c,"retiro",0),'\n                                    </div>\n                                </div>\n                                <div class="examenes-grupo examenes-grupo--post-incapacidad" id="grupo-post-incapacidad">\n                                    <h5 class="examenes-grupo-title">\n                                        <span class="badge badge--warning">Post Incapacidad</span>\n                                        Después de Incapacidad\n                                    </h5>\n                                    <p class="form-hint mb-2 text-sm">\n                                        Seleccione los exámenes necesarios. Generalmente solo se requiere el EMO.\n                                    </p>\n                                    <div class="examenes-checkboxes">\n                                        <label class="examen-checkbox">\n                                            <input type="checkbox" class="examen-check examen-check--post-incapacidad"\n                                                   value="AUDIOMETRIA" data-nombre="AUDIOMETRIA" data-periodicidad="12">\n                                            <span class="examen-label">\n                                                <span class="examen-nombre">Audiometría</span>\n                                                <span class="examen-badge badge badge--sm badge--outline">Opcional</span>\n                                            </span>\n                                        </label>\n                                        <label class="examen-checkbox">\n                                            <input type="checkbox" class="examen-check examen-check--post-incapacidad"\n                                                   value="OPTOMETRÍA" data-nombre="OPTOMETRÍA" data-periodicidad="12">\n                                            <span class="examen-label">\n                                                <span class="examen-nombre">Optometría</span>\n                                                <span class="examen-badge badge badge--sm badge--outline">Opcional</span>\n                                            </span>\n                                        </label>\n                                        <label class="examen-checkbox examen-checkbox--destacado">\n                                            <input type="checkbox" class="examen-check examen-check--post-incapacidad"\n                                                   value="EMOA" data-nombre="EXAMEN MEDICO CON ENFASIS OSTEOMUSCULAR" data-periodicidad="12" checked>\n                                            <span class="examen-label">\n                                                <span class="examen-nombre">Examen Médico Osteomuscular (EMO)</span>\n                                                <span class="examen-badge badge badge--sm badge--primary">Recomendado</span>\n                                            </span>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="examenes-grupo examenes-grupo--control" id="grupo-control">\n                                    <h5 class="examenes-grupo-title">\n                                        <span class="badge badge--secondary">Control</span>\n                                        Seguimiento Médico\n                                    </h5>\n                                    <p class="form-hint mb-2 text-sm">\n                                        Seleccione los exámenes necesarios. Generalmente solo se requiere el EMO.\n                                    </p>\n                                    <div class="examenes-checkboxes">\n                                        <label class="examen-checkbox">\n                                            <input type="checkbox" class="examen-check examen-check--control"\n                                                   value="AUDIOMETRIA" data-nombre="AUDIOMETRIA" data-periodicidad="12">\n                                            <span class="examen-label">\n                                                <span class="examen-nombre">Audiometría</span>\n                                                <span class="examen-badge badge badge--sm badge--outline">Opcional</span>\n                                            </span>\n                                        </label>\n                                        <label class="examen-checkbox">\n                                            <input type="checkbox" class="examen-check examen-check--control"\n                                                   value="OPTOMETRÍA" data-nombre="OPTOMETRÍA" data-periodicidad="12">\n                                            <span class="examen-label">\n                                                <span class="examen-nombre">Optometría</span>\n                                                <span class="examen-badge badge badge--sm badge--outline">Opcional</span>\n                                            </span>\n                                        </label>\n                                        <label class="examen-checkbox examen-checkbox--destacado">\n                                            <input type="checkbox" class="examen-check examen-check--control"\n                                                   value="EMOA" data-nombre="EXAMEN MEDICO CON ENFASIS OSTEOMUSCULAR" data-periodicidad="12" checked>\n                                            <span class="examen-label">\n                                                <span class="examen-nombre">Examen Médico Osteomuscular (EMO)</span>\n                                                <span class="examen-badge badge badge--sm badge--primary">Recomendado</span>\n                                            </span>\n                                        </label>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Sección: Datos del Examen --\x3e\n                        <div class="form-section">\n                            <h4 class="form-section-title">📅 Datos de la Cita</h4>\n                            <div class="form-row">\n                                <div class="form-group">\n                                    <label class="form-label" for="agendar-fecha">Fecha del Examen *</label>\n                                    <input type="date" class="form-input" id="agendar-fecha" name="fechaExamen"\n                                           value="').concat(g(p),'" \n                                           min="').concat(g(d),'" required>\n                                </div>\n                                <div class="form-group">\n                                    <label class="form-label" for="agendar-ciudad">Ciudad *</label>\n                                    <select class="form-input" id="agendar-ciudad" name="ciudad" required>\n                                        <option value="">Seleccione ciudad</option>\n                                        <option value="Bogotá">Bogotá</option>\n                                        <option value="Medellín">Medellín</option>\n                                        <option value="Cali">Cali</option>\n                                        <option value="Barranquilla">Barranquilla</option>\n                                        <option value="Cartagena">Cartagena</option>\n                                        <option value="Bucaramanga">Bucaramanga</option>\n                                        <option value="Pereira">Pereira</option>\n                                        <option value="Manizales">Manizales</option>\n                                        <option value="Santa Marta">Santa Marta</option>\n                                        <option value="Ibagué">Ibagué</option>\n                                        <option value="Cúcuta">Cúcuta</option>\n                                        <option value="Villavicencio">Villavicencio</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div class="form-row">\n                                <div class="form-group">\n                                    <label class="form-label" for="agendar-empresa">Empresa</label>\n                                    <input type="text" class="form-input" id="agendar-empresa" name="empresa" \n                                           value="').concat(f,'" readonly>\n                                </div>\n                                <div class="form-group">\n                                    <label class="form-label" for="agendar-autoriza">Autorizado por</label>\n                                    <input type="text" class="form-input" id="agendar-autoriza" name="autoriza"\n                                           value="').concat(h,'" placeholder="Nombre y cargo">\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Sección: Datos del Trabajador --\x3e\n                        <div class="form-section">\n                            <h4 class="form-section-title">👤 Información del Trabajador</h4>\n                            <div class="form-group">\n                                <label class="form-label" for="agendar-nombre">Nombres y Apellidos Completos *</label>\n                                <input type="text" class="form-input" id="agendar-nombre" name="nombreTrabajador"\n                                       placeholder="Ingrese el nombre completo del trabajador" required>\n                                <span class="form-hint">Se registrará como "').concat(n,'"</span>\n                            </div>\n                            <div class="form-row">\n                                <div class="form-group">\n                                    <label class="form-label" for="agendar-tipo-id">Tipo de Identificación *</label>\n                                    <select class="form-input" id="agendar-tipo-id" name="tipoIdentificacion" required>\n                                        <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>\n                                        <option value="Cédula de Extranjería">Cédula de Extranjería</option>\n                                        <option value="Pasaporte">Pasaporte</option>\n                                        <option value="PPT">PPT</option>\n                                    </select>\n                                </div>\n                                <div class="form-group">\n                                    <label class="form-label" for="agendar-num-id">No. Identificación *</label>\n                                    <input type="text" class="form-input" id="agendar-num-id" name="numeroIdentificacion"\n                                           placeholder="Número de documento" required>\n                                </div>\n                            </div>\n                            <div class="form-row">\n                                <div class="form-group">\n                                    <label class="form-label" for="agendar-edad">Edad</label>\n                                    <input type="number" class="form-input" id="agendar-edad" name="edad"\n                                           placeholder="Años" min="18" max="100">\n                                </div>\n                                <div class="form-group">\n                                    <label class="form-label" for="agendar-cargo">Cargo *</label>\n                                    <input type="text" class="form-input" id="agendar-cargo" name="cargo" \n                                           value="').concat(t,'" readonly>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Sección: Información Asistencial Adicional --\x3e\n                        <div class="form-section">\n                            <h4 class="form-section-title">🏥 Información Adicional</h4>\n                            <div class="form-group">\n                                <label class="form-label" for="agendar-enfasis">Énfasis *</label>\n                                <select class="form-input" id="agendar-enfasis" name="enfasis" required>\n                                    <option value="Medico con énfasis Osteomuscular">Osteomuscular</option>\n                                    <option value="Medico con énfasis en alturas">Alturas</option>\n                                    <option value="Medico con énfasis manipulación de Alimentos">Manipulación de Alimentos</option>\n                                    <option value="Medico con énfasis en espacios confinados">Espacios Confinados</option>\n                                    <option value="Medico con énfasis en alturas y trabajo con tensión">Alturas y Trabajo con Tensión</option>\n                                </select>\n                            </div>\n\n                            <div class="form-group">\n                                <label class="form-label">Fecha de Vencimiento (calculada)</label>\n                                <div class="vencimiento-calculado">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <circle cx="12" cy="12" r="10"></circle>\n                                        <line x1="12" y1="8" x2="12" y2="12"></line>\n                                        <line x1="12" y1="16" x2="12.01" y2="16"></line>\n                                    </svg>\n                                    <span id="agendar-vencimiento">').concat(v(m),'</span>\n                                    <span class="periodicidad-hint">(Periodicidad: ').concat(l,' meses)</span>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Observaciones --\x3e\n                        <div class="form-group">\n                            <label class="form-label" for="agendar-observaciones">Observaciones</label>\n                            <textarea class="form-input form-textarea" id="agendar-observaciones" name="observaciones"\n                                      placeholder="Notas adicionales para el agendamiento..."></textarea>\n                        </div>\n                    </div>\n                </form>\n                <div class="modal__footer">\n                    <button type="button" class="btn btn--outline" id="btn-cancelar-agendar">Cancelar</button>\n                    <button type="submit" form="form-agendar-examen" class="btn btn--primary" id="btn-confirmar-agendar">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <polyline points="20 6 9 17 4 12"></polyline>\n                        </svg>\n                        Confirmar Agendamiento\n                    </button>\n                </div>\n            </div>\n        </div>\n    '),_=document.getElementById("modal-agendar-examen");_&&_.remove();document.body.insertAdjacentHTML("beforeend",w),console.log("🟢 [MODAL] Modal HTML inserted into DOM");var E=document.getElementById("modal-agendar-examen");if(!E)return void console.error("🔴 [MODAL] Modal element not found after insertion");console.log("🟢 [MODAL] Modal element found:",E),console.log("🟢 [MODAL] Modal display style:",window.getComputedStyle(E).display),console.log("🟢 [MODAL] Modal visibility:",window.getComputedStyle(E).visibility),console.log("🟢 [MODAL] Modal z-index:",window.getComputedStyle(E).zIndex);var k=E.querySelector(".modal--agendar-content");console.log("🟢 [MODAL] Modal content element:",k),k?(console.log("🟢 [MODAL] Content display:",window.getComputedStyle(k).display),console.log("🟢 [MODAL] Content visibility:",window.getComputedStyle(k).visibility),console.log("🟢 [MODAL] Content position:",window.getComputedStyle(k).position),console.log("🟢 [MODAL] Content width:",window.getComputedStyle(k).width),console.log("🟢 [MODAL] Content height:",window.getComputedStyle(k).height),console.log("🟢 [MODAL] Content opacity:",window.getComputedStyle(k).opacity)):console.error("🔴 [MODAL] Modal content element NOT FOUND");var A=document.getElementById("form-agendar-examen"),C=document.getElementById("close-agendar-modal"),S=document.getElementById("btn-cancelar-agendar"),I=document.getElementById("agendar-fecha"),M=document.getElementById("agendar-vencimiento"),O=document.querySelectorAll('input[name="tipoExamen"]'),L=function(){E.classList.add("modal-closing"),setTimeout((function(){return E.remove()}),200)};setTimeout((function(){C.addEventListener("click",L),S.addEventListener("click",L),E.addEventListener("click",(function(e){e.target===E&&L()})),console.log("🟢 [MODAL] Close listeners configured")}),100);var N=function(e){var n;if(document.querySelectorAll(".examen-check").forEach((function(e){return e.checked=!1})),document.querySelectorAll(".examenes-grupo").forEach((function(e){return e.classList.remove("examenes-grupo--active")})),"Ingreso"===e)document.querySelectorAll(".examen-check--ingreso").forEach((function(e){return e.checked=!0})),null===(n=document.getElementById("grupo-ingreso"))||void 0===n||n.classList.add("examenes-grupo--active");else if("Periódico"===e){var t;document.querySelectorAll(".examen-check--periodico").forEach((function(e){return e.checked=!0})),null===(t=document.getElementById("grupo-periodico"))||void 0===t||t.classList.add("examenes-grupo--active")}else if("Retiro"===e){var a;document.querySelectorAll(".examen-check--retiro").forEach((function(e){return e.checked=!0})),null===(a=document.getElementById("grupo-retiro"))||void 0===a||a.classList.add("examenes-grupo--active")}else if("Post Incapacidad"===e){var o;null===(o=document.getElementById("grupo-post-incapacidad"))||void 0===o||o.classList.add("examenes-grupo--active")}else if("Control"===e){var i;null===(i=document.getElementById("grupo-control"))||void 0===i||i.classList.add("examenes-grupo--active")}};N("Periódico"),O.forEach((function(e){e.addEventListener("change",(function(e){N(e.target.value)}))})),I.addEventListener("change",(function(){var e=new Date(I.value),n=new Date(e);n.setMonth(n.getMonth()+l),M.textContent=v(n)})),A.addEventListener("submit",function(){var e=(0,i.A)(u().mark((function e(n){var o,i,r,s,c,d,p,m,g,f,h,b,y,x,w,_,E,k,C,S,I,M,O,N,P,T;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),o=new FormData(A),i=o.get("nombreTrabajador"),r=o.get("fechaExamen"),s=o.get("ciudad"),c=o.get("empresa"),d=o.get("autoriza"),p=o.get("tipoIdentificacion"),m=o.get("numeroIdentificacion"),g=o.get("edad"),f=o.get("tipoExamen"),h=o.get("enfasis"),b=o.get("observaciones"),y=[],document.querySelectorAll(".examen-check:checked").forEach((function(e){y.push({codigo:e.value,nombre:e.dataset.nombre,periodicidad:e.dataset.periodicidad})})),i){e.next=19;break}return Yo("Por favor ingrese el nombre del trabajador","warning"),document.getElementById("agendar-nombre").focus(),e.abrupt("return");case 19:if(s){e.next=23;break}return Yo("Por favor seleccione la ciudad","warning"),document.getElementById("agendar-ciudad").focus(),e.abrupt("return");case 23:if(m){e.next=27;break}return Yo("Por favor ingrese el número de identificación","warning"),document.getElementById("agendar-num-id").focus(),e.abrupt("return");case 27:if(0!==y.length){e.next=30;break}return Yo("Seleccione al menos un examen","warning"),e.abrupt("return");case 30:if(x=new Date(r),(w=new Date(x)).setMonth(w.getMonth()+l),_=y.map((function(e){return e.nombre})).join(", "),y.filter((function(e){return["AUD","VIS","OPT","ESP","EKG"].includes(e.codigo)})).map((function(e){return e.nombre})),y.filter((function(e){return["HEM","GLI","PERF","COP","BUN","CRE","URIN","ALC","DRUG"].includes(e.codigo)})).map((function(e){return e.nombre})),E={fechaExamen:"1656075478",empresa:"957130716",autoriza:"1003236985",nombres:"1005623235",tipoId:"743443629",numId:"1523351078",edad:"646266221",cargo:"855690085",ciudad:"24748360",tipoExamen:"1232570560",enfasis:"1584979165",paraclinicos:"1437167858",laboratorio:"325014457",psicologia:"578780852",observaciones:"1704057399"},(k=new URL("https://docs.google.com/forms/d/".concat("1zbMzgwUSIgcgicZ9ah8TnLutFsjWNx5RROd2CBpJ4Ow","/viewform"))).searchParams.append("usp","pp_url"),console.log("🔵 [MODAL] Opening Google Form with URL:",k.toString()),r&&k.searchParams.append("entry.".concat(E.fechaExamen),r),c&&k.searchParams.append("entry.".concat(E.empresa),c),d&&k.searchParams.append("entry.".concat(E.autoriza),d),i&&k.searchParams.append("entry.".concat(E.nombres),i),p&&k.searchParams.append("entry.".concat(E.tipoId),p),m&&k.searchParams.append("entry.".concat(E.numId),m),g&&k.searchParams.append("entry.".concat(E.edad),g),k.searchParams.append("entry.".concat(E.cargo),t),s&&k.searchParams.append("entry.".concat(E.ciudad),s),f&&k.searchParams.append("entry.".concat(E.tipoExamen),f),h&&k.searchParams.append("entry.".concat(E.enfasis),h),C="".concat(b||"","\n\n[Paquete: ").concat(a,"]\nExámenes: ").concat(_,"\nPeriodicidad: ").concat(l," meses\nVencimiento: ").concat(v(w)),k.searchParams.append("entry.".concat(E.observaciones),C.trim()),S=localStorage.getItem("empresaId"),I=localStorage.getItem("authToken"),S&&I){e.next=59;break}return Yo("Error: No se encontró información de autenticación","error"),e.abrupt("return");case 59:return M=document.getElementById("btn-confirmar-agendar"),O=M.innerHTML,e.prev=61,M.disabled=!0,M.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="spinner"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg> Guardando...',e.next=66,fetch("/api/agendamiento/empresa/".concat(S,"/batch"),{method:"POST",headers:{Authorization:"Bearer ".concat(I),"Content-Type":"application/json"},body:JSON.stringify({trabajadorNombre:i,cargoNombre:t,fechaExamen:r,examenes:y.map((function(e){return{codigo:e.codigo,nombre:e.nombre,periodicidadMeses:parseInt(e.periodicidad)||l}})),datosAdicionales:{tipoExamen:f,enfasis:h,ciudad:s,tipoId:p,numId:m,edad:g},observaciones:b})});case 66:return N=e.sent,e.next=69,N.json();case 69:if(!(P=e.sent).success){e.next=76;break}L(),null!==(T=P.googleSheetsSync)&&void 0!==T&&T.success?Yo("✅ ".concat(P.agendamientosCreados," exámenes agendados y sincronizados con Google Sheets"),"success"):Yo("✅ ".concat(P.agendamientosCreados," exámenes agendados correctamente"),"success"),setTimeout((function(){return mo()}),1e3),e.next=77;break;case 76:throw new Error(P.message||"Error al guardar agendamientos");case 77:e.next=84;break;case 79:e.prev=79,e.t0=e.catch(61),console.error("🔴 [MODAL] Error al guardar agendamiento:",e.t0),Yo("Error: ".concat(e.t0.message),"error"),M&&(M.disabled=!1,M.innerHTML=O);case 84:case"end":return e.stop()}}),e,null,[[61,79]])})));return function(n){return e.apply(this,arguments)}}())}({trabajador:t,cargo:a,paquete:r,examenesIngreso:s,examenesPeriodicos:c,examenesRetiro:l})}))}))}function bo(){return yo.apply(this,arguments)}function yo(){return(yo=(0,i.A)(u().mark((function e(){var n,t,a,o,i,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔵 [MATRIZ] ========== Loading Matriz Page =========="),e.next=3,Uo();case 3:if(n=e.sent,console.log("🔵 [MATRIZ] API result:",n),zo("matriz-fecha",(new Date).toLocaleDateString("es-CO")),t=localStorage.getItem("genesys_empresa"),a="Sin asignar",t)try{o=JSON.parse(t),a=o.nombre_legal||o.razon_social||o.nombre||"Sin asignar"}catch(e){}if(zo("matriz-responsable",a),n&&n.success){e.next=14;break}return(i=document.getElementById("matriz-dashboard-container"))&&(i.innerHTML='\n                <div class="matriz-empty-state">\n                    <div class="matriz-empty-state__icon">\n                        <i data-lucide="layout-grid"></i>\n                    </div>\n                    <h3 class="matriz-empty-state__title">Matriz de Riesgos GTC-45</h3>\n                    <p class="matriz-empty-state__description">\n                        Aún no hay peligros identificados. Complete el wizard para generar la matriz de riesgos.\n                    </p>\n                    <a href="/pages/wizard_riesgos.html" class="btn btn--primary">\n                        <i data-lucide="plus"></i>\n                        Crear Matriz\n                    </a>\n                </div>\n            ',window.lucide&&window.lucide.createIcons()),e.abrupt("return");case 14:return e.prev=14,r=new Be("matriz-dashboard-container"),e.next=18,r.init(n);case 18:console.log("🟢 [MATRIZ] Component initialized successfully"),xo(n.documento),e.next=27;break;case 22:e.prev=22,e.t0=e.catch(14),console.error("🔴 [MATRIZ] Error initializing component:",e.t0),(s=document.getElementById("matriz-dashboard-container"))&&(s.innerHTML='\n                <div class="matriz-empty-state">\n                    <div class="matriz-empty-state__icon">\n                        <i data-lucide="alert-circle"></i>\n                    </div>\n                    <h3 class="matriz-empty-state__title">Error al cargar</h3>\n                    <p class="matriz-empty-state__description">\n                        Hubo un error al cargar los datos de la matriz. Intente recargar la página.\n                    </p>\n                </div>\n            ',window.lucide&&window.lucide.createIcons());case 27:case"end":return e.stop()}}),e,null,[[14,22]])})))).apply(this,arguments)}function xo(e){var n=document.getElementById("btn-export-matriz-excel");if(n){var t=n.cloneNode(!0);n.parentNode.replaceChild(t,n),e&&e.excelUrl?t.addEventListener("click",(function(){var n=document.createElement("a");n.href=e.excelUrl,n.download=e.excelUrl.split("/").pop()||"Matriz_GTC45.xlsx",n.target="_blank",document.body.appendChild(n),n.click(),n.remove()})):t.style.display="none"}}function wo(){return _o.apply(this,arguments)}function _o(){return(_o=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Estadisticas Page..."),Ro("estadisticas-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="bar-chart-3"></i>\n            </div>\n            <h3 class="empty-state__title">Perfil Sociodemográfico</h3>\n            <p class="empty-state__description">Aún no hay datos disponibles. El perfil se generará automáticamente con los datos de trabajadores.</p>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Eo(){return ko.apply(this,arguments)}function ko(){return(ko=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading SVE Page..."),Ro("sve-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="activity"></i>\n            </div>\n            <h3 class="empty-state__title">Sistema de Vigilancia Epidemiológica</h3>\n            <p class="empty-state__description">Aún no hay SVE configurados. Se generarán automáticamente basados en los riesgos identificados.</p>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ao(){return Co.apply(this,arguments)}function Co(){return(Co=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Psicosocial Page..."),Ro("psicosocial-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="flask-conical"></i>\n            </div>\n            <h3 class="empty-state__title">Batería de Riesgo Psicosocial</h3>\n            <p class="empty-state__description">Aún no hay baterías aplicadas. Configure la empresa para comenzar la evaluación psicosocial.</p>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function So(){return Io.apply(this,arguments)}function Io(){return(Io=(0,i.A)(u().mark((function e(){var t,a,o,i,r,s,c,l,d,p,m,g,v,f,h,b;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("🔵 [DOCUMENTOS] ========== Loading Documentos Page =========="),t=localStorage.getItem("genesys_empresa"),a=jo(),console.log("🔵 [DOCUMENTOS] wizardData:",a?"found":"not found"),o=[],!t){e.next=23;break}if(e.prev=6,!(i=JSON.parse(t)).id){e.next=18;break}return r=localStorage.getItem("authToken")||localStorage.getItem("genesys_token"),e.next=12,fetch("/api/documentos/empresa/".concat(i.id),{headers:r?{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}:{"Content-Type":"application/json"}});case 12:if(!(s=e.sent).ok){e.next=18;break}return e.next=16,s.json();case 16:(c=e.sent).success&&c.documents&&(o=c.documents);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),console.warn("Error fetching documents from API:",e.t0);case 23:if(!(l=localStorage.getItem("genesys_pending_document_token"))||0!==o.length){e.next=39;break}return e.prev=25,e.next=28,fetch("/api/documentos/status/".concat(l));case 28:if(!(d=e.sent).ok){e.next=34;break}return e.next=32,d.json();case 32:(p=e.sent).success&&o.push({token_acceso:l,estado:p.status,preview_urls:p.urls||{},metadata:p.metadata||{},created_at:(new Date).toISOString()});case 34:e.next=39;break;case 36:e.prev=36,e.t1=e.catch(25),console.warn("Error fetching pending document:",e.t1);case 39:if(0!==o.length||!a){e.next=50;break}if(m=a.formData||{},g=m.cargos||[],console.log("🔵 [DOCUMENTOS] Wizard cargos:",g.length),!(g.length>0)){e.next=50;break}return v=0,f=0,g.forEach((function(e){var n;v+=(null===(n=e.ges)||void 0===n?void 0:n.length)||0,f+=e.numPersonas||0})),Ro("documentos-content",'\n                <div class="alert-banner alert-banner--info mb-6">\n                    <i data-lucide="info"></i>\n                    <span>\n                        <strong>'.concat(m.nombreEmpresa||"Sin nombre","</strong> · NIT: ").concat(m.nit||"N/A"," ·\n                        ").concat(g.length," cargo(s), ").concat(f," trabajadores, ").concat(v,' riesgos identificados\n                    </span>\n                </div>\n\n                <div class="dashboard-section mb-6">\n                    <h2 class="dashboard-section__title">Documentos Disponibles para Generar</h2>\n                    <div class="dashboard-grid dashboard-grid--cols-4">\n                        <div class="card">\n                            <div class="card__body text-center">\n                                <i data-lucide="file-spreadsheet" style="width:48px;height:48px;color:#10b981;margin-bottom:16px;"></i>\n                                <h3 class="card__title">Matriz GTC-45</h3>\n                                <p class="text-muted text-sm mb-4">Excel con ').concat(v,' peligros identificados</p>\n                                <span class="badge badge--success">Listo para generar</span>\n                            </div>\n                        </div>\n                        <div class="card">\n                            <div class="card__body text-center">\n                                <i data-lucide="file-text" style="width:48px;height:48px;color:#5dc4af;margin-bottom:16px;"></i>\n                                <h3 class="card__title">Profesiograma</h3>\n                                <p class="text-muted text-sm mb-4">PDF para ').concat(g.length,' cargo(s)</p>\n                                <span class="badge badge--success">Listo para generar</span>\n                            </div>\n                        </div>\n                        <div class="card">\n                            <div class="card__body text-center">\n                                <i data-lucide="user-check" style="width:48px;height:48px;color:#f59e0b;margin-bottom:16px;"></i>\n                                <h3 class="card__title">Perfil de Cargo</h3>\n                                <p class="text-muted text-sm mb-4">Requisitos por cargo</p>\n                                <span class="badge badge--success">Listo para generar</span>\n                            </div>\n                        </div>\n                        <div class="card">\n                            <div class="card__body text-center">\n                                <i data-lucide="receipt" style="width:48px;height:48px;color:#6366f1;margin-bottom:16px;"></i>\n                                <h3 class="card__title">Cotización</h3>\n                                <p class="text-muted text-sm mb-4">Presupuesto de exámenes</p>\n                                <span class="badge badge--success">Listo para generar</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="dashboard-section mb-6">\n                    <h2 class="dashboard-section__title">Resumen de Cargos</h2>\n                    <div class="table-container">\n                        <table class="data-table">\n                            <thead>\n                                <tr>\n                                    <th>Cargo</th>\n                                    <th>Área</th>\n                                    <th>Zona</th>\n                                    <th>Trabajadores</th>\n                                    <th>Riesgos GES</th>\n                                    <th>Especial</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ').concat(g.map((function(e){var n;return"\n                                    <tr>\n                                        <td><strong>".concat(e.nombre||"Sin nombre","</strong></td>\n                                        <td>").concat(e.area||"N/A","</td>\n                                        <td>").concat(e.zona||"N/A","</td>\n                                        <td>").concat(e.numPersonas||0,'</td>\n                                        <td><span class="badge badge--primary">').concat((null===(n=e.ges)||void 0===n?void 0:n.length)||0,"</span></td>\n                                        <td>\n                                            ").concat(e.trabajaAlturas?'<span class="badge badge--warning" title="Trabajo en alturas">🪜</span>':"","\n                                            ").concat(e.manipulaAlimentos?'<span class="badge badge--info" title="Manipula alimentos">🍽️</span>':"","\n                                            ").concat(e.conduceVehiculo?'<span class="badge badge--secondary" title="Conduce vehículo">🚗</span>':"","\n                                            ").concat(e.trabajaEspaciosConfinados?'<span class="badge badge--danger" title="Espacios confinados">⚠️</span>':"","\n                                            ").concat(e.trabajaAlturas||e.manipulaAlimentos||e.conduceVehiculo||e.trabajaEspaciosConfinados?"":"-","\n                                        </td>\n                                    </tr>\n                                ")})).join(""),'\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n\n                <div class="text-center mt-6">\n                    <a href="/pages/wizard_riesgos.html" class="btn btn--primary btn--lg">\n                        <i data-lucide="zap"></i>\n                        Ir al Wizard para Generar Documentos\n                    </a>\n                </div>\n            ')),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 50:o.length>0?(h={matriz:{icon:"file-spreadsheet",label:"Matriz GTC-45",color:"#10b981"},profesiograma:{icon:"file-text",label:"Profesiograma",color:"#5dc4af"},perfil:{icon:"user-check",label:"Perfil de Cargo",color:"#f59e0b"},cotizacion:{icon:"receipt",label:"Cotización",color:"#6366f1"}},b=o.map((function(e){var t=e.preview_urls||{},a=e.metadata||{},o=new Date(e.created_at).toLocaleDateString("es-CO"),i="pagado"===e.estado?"Pagado":"completado"===e.estado?"Completado":"Pendiente",r="pagado"===e.estado?"success":"completado"===e.estado?"primary":"warning",s=Object.entries(t).filter((function(e){return"thumbnails"!==n(e,1)[0]})).map((function(e){var t=n(e,2),a=t[0],o=t[1],i=h[a]||{icon:"file",label:a,color:"#6b7280"};return'\n                    <div class="card card--document">\n                        <div class="card__body">\n                            <div class="document-icon" style="color:'.concat(i.color,';">\n                                <i data-lucide="').concat(i.icon,'"></i>\n                            </div>\n                            <div class="document-info">\n                                <h4>').concat(i.label,'</h4>\n                                <span class="text-xs text-muted">').concat("matriz"===a?"Excel":"PDF",'</span>\n                            </div>\n                            <a href="').concat(o,'" target="_blank" class="btn btn--sm btn--primary" download>\n                                <i data-lucide="download"></i>\n                            </a>\n                        </div>\n                    </div>\n                ')})).join("");return'\n                <div class="card mb-4">\n                    <div class="card__header">\n                        <div>\n                            <h3 class="card__title">'.concat(a.nombreEmpresa||"Empresa",'</h3>\n                            <span class="text-sm text-muted">Generado: ').concat(o," · ").concat(a.numCargos||0,' cargos</span>\n                        </div>\n                        <span class="badge badge--').concat(r,'">').concat(i,'</span>\n                    </div>\n                    <div class="card__body">\n                        <div class="dashboard-grid dashboard-grid--cols-4">\n                            ').concat(s||'<p class="text-muted">Sin documentos disponibles</p>',"\n                        </div>\n                    </div>\n                </div>\n            ")})).join(""),Ro("documentos-content",'\n            <div class="dashboard-section">\n                <h2 class="dashboard-section__title">Documentos Generados</h2>\n                '.concat(b,'\n            </div>\n            <div class="text-center mt-6">\n                <a href="/pages/wizard_riesgos.html" class="btn btn--outline">\n                    <i data-lucide="plus"></i>\n                    Generar Nuevos Documentos\n                </a>\n            </div>\n        '))):Ro("documentos-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="folder-open"></i>\n                </div>\n                <h3 class="empty-state__title">Centro de Documentos</h3>\n                <p class="empty-state__description">Aún no hay documentos generados. Complete el wizard para generar profesiogramas, matrices y más.</p>\n                <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Generar Documentos</a>\n            </div>\n        '),window.lucide&&window.lucide.createIcons();case 52:case"end":return e.stop()}}),e,null,[[6,20],[25,36]])})))).apply(this,arguments)}function Mo(){return Oo.apply(this,arguments)}function Oo(){return(Oo=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Config Page..."),Ro("config-content",'\n        <div class="card">\n            <div class="card__header">\n                <h3 class="card__title">Configuración de Empresa</h3>\n            </div>\n            <div class="card__body">\n                <p class="text-muted">La configuración se habilitará cuando la empresa esté registrada en el sistema.</p>\n            </div>\n        </div>\n    ');case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lo(){return No.apply(this,arguments)}function No(){return(No=(0,i.A)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loading Panel Medico Page..."),zo("medico-info","Sin médico asignado"),Ro("panel-medico-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <i data-lucide="stethoscope"></i>\n            </div>\n            <h3 class="empty-state__title">Panel Médico Ocupacional</h3>\n            <p class="empty-state__description">Este panel es exclusivo para médicos ocupacionales. Contacte al administrador para obtener acceso.</p>\n        </div>\n    '),window.lucide&&window.lucide.createIcons();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Po(){return To.apply(this,arguments)}function To(){return To=(0,i.A)(u().mark((function e(){var t,a,o,i,r,s,c,l,d,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔵 [PROFESIOGRAMA] ========== Loading Profesiograma Page =========="),Ro("profesiograma-content",'\n        <div class="empty-state">\n            <div class="empty-state__icon">\n                <div class="skeleton skeleton--circle" style="width:64px;height:64px;"></div>\n            </div>\n            <h3 class="empty-state__title">Cargando profesiograma...</h3>\n        </div>\n    '),e.next=4,qo();case 4:if(t=e.sent,console.log("🔵 [PROFESIOGRAMA] API result:",t),t&&t.success){e.next=10;break}return Ro("profesiograma-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="file-text"></i>\n                </div>\n                <h3 class="empty-state__title">Sin Profesiograma</h3>\n                <p class="empty-state__description">Aún no has generado un profesiograma. Usa el asistente para crear uno.</p>\n                <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Crear Profesiograma</a>\n            </div>\n        '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 10:if(e.prev=10,o=t.cargos||[],console.log("🔵 [PROFESIOGRAMA] Processing cargos from API:",o.length),0!==o.length){e.next=18;break}return console.log("🟡 [PROFESIOGRAMA] No cargos found"),Ro("profesiograma-content",'\n                <div class="empty-state">\n                    <div class="empty-state__icon">\n                        <i data-lucide="file-text"></i>\n                    </div>\n                    <h3 class="empty-state__title">Sin Cargos Configurados</h3>\n                    <p class="empty-state__description">No hay cargos en el profesiograma. Completa el wizard para agregar cargos.</p>\n                    <a href="/pages/wizard_riesgos.html" class="btn btn--primary">Ir al Wizard</a>\n                </div>\n            '),window.lucide&&window.lucide.createIcons(),e.abrupt("return");case 18:if(i=localStorage.getItem("genesys_empresa"),r={nombre:"Empresa",nit:"--"},s=(null===(a=o[0])||void 0===a?void 0:a.documento_id)||null,i)try{c=JSON.parse(i),r={nombre:c.nombre_legal||c.razon_social||c.nombre||"Empresa",nit:c.nit||"--"}}catch(e){}l=o.map((function(e,t){var a=e.riesgosCount||0,o=e.togglesActivos||[],i=e.nrNivelMaximo||"I",r=e.conteoNiveles||{},s=e.examenesMedicos||[];console.log("🔬 [CARGO ".concat(t+1,'] "').concat(e.nombre_cargo,'":'),{riesgosCount:a,examenesMedicosCount:s.length,examenesMedicos:s});var c={I:"success",II:"info",III:"warning",IV:"danger",V:"danger"}[i]||"muted",l=o.map((function(e){return{Alturas:{icon:"mountain",label:"Alturas"},Alimentos:{icon:"utensils",label:"Alimentos"},Vehiculo:{icon:"car",label:"Conducción"},"Espacios Conf.":{icon:"box",label:"Esp. Confinados"}}[e]||{icon:"alert-triangle",label:e}})),d=Object.entries(r).filter((function(e){return n(e,2)[1]>0})).map((function(e){var t=n(e,2),a=t[0],o=t[1];return'<span class="badge badge--'.concat({I:"success",II:"info",III:"warning",IV:"danger",V:"danger"}[a]||"muted",'">').concat(o," NR-").concat(a,"</span>")})).join(" "),u=s.length>0?s.map((function(e){return'\n                    <div class="exam-item">\n                        <div class="exam-item__header">\n                            <span class="exam-item__name">'.concat(e.nombre,'</span>\n                            <span class="badge badge--').concat(1===e.prioridad?"danger":"info",' badge--sm">').concat(e.tipo,'</span>\n                        </div>\n                        <div class="exam-item__footer">\n                            <span class="exam-item__periodicidad">\n                                <i data-lucide="calendar" style="width:12px;height:12px;"></i>\n                                ').concat(e.periodicidad,"\n                            </span>\n                        </div>\n                    </div>\n                ")})).join(""):'<p class="text-muted text-sm">No hay exámenes médicos asignados para este cargo.</p>';return'\n                <div class="card card--profesiograma">\n                    <div class="card__header">\n                        <div>\n                            <h3 class="card__title">'.concat(e.nombre_cargo||"Cargo "+(t+1),'</h3>\n                            <span class="text-sm text-muted">').concat(e.area||"Sin área"," · ").concat(e.zona||"Sin zona"," · ").concat(e.num_trabajadores||0,' persona(s)</span>\n                        </div>\n                        <div class="card__badges">\n                            <span class="badge badge--').concat(a>0?"primary":"muted",'">').concat(a," Riesgos</span>\n                            ").concat(a>0?'<span class="badge badge--'.concat(c,'">NR Max: ').concat(i,"</span>"):"",'\n                        </div>\n                    </div>\n                    <div class="card__body">\n                        ').concat(l.length>0?'\n                            <div class="profesiograma-section mb-4">\n                                <p class="profesiograma-section__title">\n                                    <i data-lucide="alert-triangle" style="width:16px;height:16px;color:#f59e0b;"></i>\n                                    Condiciones Especiales\n                                </p>\n                                <div class="flex gap-2 flex-wrap">\n                                    '.concat(l.map((function(e){return'<span class="badge badge--warning"><i data-lucide="'.concat(e.icon,'" style="width:12px;height:12px;"></i> ').concat(e.label,"</span>")})).join(""),"\n                                </div>\n                            </div>\n                        "):"","\n\n                        ").concat(a>0?'\n                            <div class="profesiograma-section mb-4">\n                                <p class="profesiograma-section__title">\n                                    <i data-lucide="shield-alert" style="width:16px;height:16px;color:#ef4444;"></i>\n                                    Distribución de Riesgos\n                                </p>\n                                <div class="flex gap-2 flex-wrap">\n                                    '.concat(d||'<span class="badge badge--muted">Sin clasificar</span>',"\n                                </div>\n                            </div>\n                        "):"",'\n\n                        <div class="profesiograma-section">\n                            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">\n                                <p class="profesiograma-section__title" style="margin-bottom:0;">\n                                    <i data-lucide="stethoscope" style="width:16px;height:16px;color:#10b981;"></i>\n                                    Exámenes Médicos Requeridos\n                                    ').concat(s.length>0?'<span class="badge badge--sm badge--success" style="margin-left:8px;">'.concat(s.length,"</span>"):"","\n                                </p>\n                                ").concat(s.length>0?'\n                                    <button class="btn btn--outline btn--sm" style="padding:4px 12px;font-size:12px;" onclick="alert(\'Función de descarga en desarrollo\')">\n                                        <i data-lucide="download" style="width:12px;height:12px;"></i>\n                                        Descargar Excel\n                                    </button>\n                                ':"",'\n                            </div>\n                            <div class="exams-grid">\n                                ').concat(u,"\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ")})).join(""),d=o.reduce((function(e,n){return e+(n.num_trabajadores||0)}),0),p=o.reduce((function(e,n){return e+(n.riesgosCount||0)}),0),Ro("profesiograma-content",'\n            <div class="dashboard-grid dashboard-grid--cols-4 mb-6">\n                <div class="card card--stat">\n                    <div class="stat-value">'.concat(o.length,'</div>\n                    <div class="stat-label">Cargos</div>\n                </div>\n                <div class="card card--stat">\n                    <div class="stat-value">').concat(d,'</div>\n                    <div class="stat-label">Trabajadores</div>\n                </div>\n                <div class="card card--stat">\n                    <div class="stat-value">').concat(p,'</div>\n                    <div class="stat-label">Riesgos Identificados</div>\n                </div>\n                <div class="card card--stat card--highlight">\n                    <div class="stat-value stat-value--primary">').concat(t.total||o.length,'</div>\n                    <div class="stat-label">Total BD</div>\n                </div>\n            </div>\n\n            <div class="card card--company mb-6">\n                <div class="card__body" style="display:flex;align-items:center;gap:24px;">\n                    <div class="company-logo" style="width:64px;height:64px;background:#5dc4af;border-radius:12px;display:flex;align-items:center;justify-content:center;">\n                        <i data-lucide="building-2" style="width:32px;height:32px;color:#fff;"></i>\n                    </div>\n                    <div>\n                        <h2 style="margin:0 0 4px;">').concat(r.nombre,'</h2>\n                        <p class="text-muted" style="margin:0;">NIT: ').concat(r.nit,'</p>\n                    </div>\n                </div>\n            </div>\n\n            <div class="dashboard-section">\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">\n                    <h2 class="dashboard-section__title" style="margin: 0;">Protocolo de Vigilancia por Cargo</h2>\n                    <div>\n                        <a href="/pages/wizard_riesgos.html" class="btn btn--outline mr-3">\n                            <i data-lucide="edit"></i> Editar en Wizard\n                        </a>\n                        <a href="/pages/profesiograma_view.html').concat(s?"?documento_id="+s:"",'" class="btn btn--primary">\n                            <i data-lucide="eye"></i> Ver Profesiograma Completo\n                        </a>\n                    </div>\n                </div>\n                <div class="dashboard-grid dashboard-grid--cols-2">\n                    ').concat(l,"\n                </div>\n            </div>\n        ")),window.lucide&&window.lucide.createIcons(),e.next=34;break;case 29:e.prev=29,e.t0=e.catch(10),console.error("Error loading profesiograma:",e.t0),Ro("profesiograma-content",'\n            <div class="empty-state">\n                <div class="empty-state__icon">\n                    <i data-lucide="alert-circle"></i>\n                </div>\n                <h3 class="empty-state__title">Error al cargar</h3>\n                <p class="empty-state__description">Hubo un error al cargar los datos del profesiograma.</p>\n            </div>\n        '),window.lucide&&window.lucide.createIcons();case 34:case"end":return e.stop()}}),e,null,[[10,29]])}))),To.apply(this,arguments)}function Ro(e,n){console.log("🟢 [showPageContent] containerId:",e);var t=document.getElementById(e);console.log("🟢 [showPageContent] container found:",!!t),t?(t.innerHTML=n,console.log("🟢 [showPageContent] HTML set, length:",n.length),console.log("🟢 [showPageContent] First 200 chars:",n.substring(0,200))):(console.error("🔴 [showPageContent] Container NOT FOUND:",e),console.error("🔴 [showPageContent] Available elements with IDs:",Array.from(document.querySelectorAll("[id]")).map((function(e){return e.id})).join(", ")))}function jo(){var e=localStorage.getItem("genesys_wizard_state");if(!e)return console.warn("🟡 [getWizardData] No wizard state in localStorage"),null;try{var n=JSON.parse(e);return console.log("🟢 [getWizardData] Successfully parsed wizard state"),n}catch(e){return console.error("🔴 [getWizardData] Error parsing:",e),null}}function zo(e,n){var t=document.getElementById(e);t&&(t.textContent=n)}function Do(){var e=localStorage.getItem("authToken")||localStorage.getItem("genesys_token");return{"Content-Type":"application/json",Authorization:e?"Bearer ".concat(e):""}}function Bo(){var e=localStorage.getItem("genesys_empresa");if(e)try{var n=JSON.parse(e);return console.log("🔵 [API] Empresa ID:",n.id),n.id}catch(e){console.error("🔴 [API] Error parsing empresa:",e)}return null}function qo(){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,i.A)(u().mark((function e(){var n,t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Bo()){e.next=4;break}return console.warn("🟡 [API] No empresa ID, cannot fetch cargos"),e.abrupt("return",null);case 4:return e.prev=4,console.log("🔵 [API] Fetching cargos for empresa:",n),e.next=8,fetch("/api/cargos/empresa/".concat(n),{headers:Do()});case 8:if((t=e.sent).ok){e.next=12;break}return console.error("🔴 [API] Error fetching cargos:",t.status),e.abrupt("return",null);case 12:return e.next=14,t.json();case 14:return a=e.sent,console.log("🟢 [API] Cargos fetched:",a),$a.data.cargos=a.cargos||[],$a.companyId=n,e.abrupt("return",a);case 21:return e.prev=21,e.t0=e.catch(4),console.error("🔴 [API] Error fetching cargos:",e.t0),e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,null,[[4,21]])})))).apply(this,arguments)}function Uo(){return Fo.apply(this,arguments)}function Fo(){return(Fo=(0,i.A)(u().mark((function e(){var n,t,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Bo()){e.next=4;break}return console.warn("🟡 [API] No empresa ID, cannot fetch matriz"),e.abrupt("return",null);case 4:return e.prev=4,console.log("🔵 [API] Fetching matriz for empresa:",n),e.next=8,fetch("/api/cargos/matriz-gtc45/".concat(n),{headers:Do()});case 8:if((t=e.sent).ok){e.next=12;break}return console.error("🔴 [API] Error fetching matriz:",t.status),e.abrupt("return",null);case 12:return e.next=14,t.json();case 14:return a=e.sent,console.log("🟢 [API] Matriz fetched:",a),$a.data.matriz=a,e.abrupt("return",a);case 20:return e.prev=20,e.t0=e.catch(4),console.error("🔴 [API] Error fetching matriz:",e.t0),e.abrupt("return",null);case 24:case"end":return e.stop()}}),e,null,[[4,20]])})))).apply(this,arguments)}function $o(){var e=document.getElementById("user-menu"),n=document.getElementById("user-dropdown"),t=document.getElementById("btn-logout");e&&n&&(e.addEventListener("click",(function(t){t.stopPropagation(),n.classList.toggle("open"),e.classList.toggle("open")})),document.addEventListener("click",(function(t){e.contains(t.target)||(n.classList.remove("open"),e.classList.remove("open"))})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&(n.classList.remove("open"),e.classList.remove("open"))}))),t&&t.addEventListener("click",(function(e){e.preventDefault(),Go()}));var a=document.getElementById("sidebar-logout");a&&a.addEventListener("click",(function(e){e.preventDefault(),Go()})),function(){var e=document.getElementById("user-avatar"),n=document.getElementById("user-name"),t=document.getElementById("user-email"),a=localStorage.getItem("genesys_user")||localStorage.getItem("userData"),o=localStorage.getItem("genesys_empresa");if(a)try{var i=JSON.parse(a);if(e&&i.nombre){var r=i.nombre.split(" ").map((function(e){return e[0]})).slice(0,2).join("").toUpperCase();e.textContent=r}n&&i.nombre&&(n.textContent=i.nombre),t&&i.email&&(t.textContent=i.email)}catch(e){console.warn("Error parsing user data:",e)}else if(o)try{var s=JSON.parse(o);if(e&&s.razon_social){var c=s.razon_social.split(" ").map((function(e){return e[0]})).slice(0,2).join("").toUpperCase();e.textContent=c}n&&s.razon_social&&(n.textContent=s.razon_social),t&&s.email&&(t.textContent=s.email)}catch(e){console.warn("Error parsing empresa data:",e)}else e&&(e.textContent="US"),n&&(n.textContent="Usuario"),t&&(t.textContent="usuario@empresa.com")}()}function Go(){localStorage.removeItem("genesys_token"),localStorage.removeItem("genesys_user"),localStorage.removeItem("genesys_empresa"),localStorage.removeItem("genesys_auth_type"),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),sessionStorage.clear(),window.location.href="/pages/login.html"}function Vo(){return Wo.apply(this,arguments)}function Wo(){return Wo=(0,i.A)(u().mark((function e(){var n,t,a,o,r,s,c,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[Dashboard] Loading company data..."),n=function(){var e=(0,i.A)(u().mark((function e(n){var t,a,o,i,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n||localStorage.getItem("empresaId"),a=localStorage.getItem("authToken"),!t||!a){e.next=21;break}return e.prev=3,e.next=6,fetch("/api/documentos/empresa/".concat(t),{headers:{Authorization:"Bearer ".concat(a)}});case 6:if(!(o=e.sent).ok){e.next=16;break}return e.next=10,o.json();case 10:if(!((i=e.sent).success&&i.documents&&i.documents.length>0)){e.next=16;break}return console.log("[Dashboard] Enriched data from API with",i.documents.length,"documents"),r=i.documents[0],s=r.metadata||{},e.abrupt("return",{sector:s.sector,actividad_economica:s.actividadEconomica,responsable:s.nombreResponsable,nombre_responsable:r.nombre_responsable,numCargos:s.numCargos});case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),console.warn("[Dashboard] Error enriching from API:",e.t0);case 21:return e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(n){return e.apply(this,arguments)}}(),t=Bo(),console.log("[Dashboard] Logged-in empresa ID:",t),!(a=localStorage.getItem("genesys_empresa"))){e.next=23;break}return e.prev=6,o=JSON.parse(a),console.log("[Dashboard] Found empresa from login:",o),e.next=11,n();case 11:if(!(r=e.sent)){e.next=16;break}return Jo((s=Fa(Fa({},o),{},{sector:r.sector||o.sector||"-",actividad_economica:r.actividad_economica||o.actividad_economica||"-",responsable:r.responsable||r.nombre_responsable||o.responsable||"-",numCargos:r.numCargos||0})).nombre_legal||s.razon_social,s),e.abrupt("return",s);case 16:return Jo(o.nombre_legal||o.razon_social||o.nombre,o),e.abrupt("return",o);case 20:e.prev=20,e.t0=e.catch(6),console.warn("[Dashboard] Error parsing genesys_empresa:",e.t0);case 23:if(!(c=localStorage.getItem("genesys_user"))){e.next=36;break}if(e.prev=25,!(l=JSON.parse(c)).empresa){e.next=31;break}return console.log("[Dashboard] Found empresa from user data:",l.empresa),Jo(l.empresa.nombre||l.empresa.razon_social,l.empresa),e.abrupt("return",l.empresa);case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(25),console.warn("[Dashboard] Error parsing genesys_user:",e.t1);case 36:return console.log("[Dashboard] No company data found"),zo("company-name","Sin empresa"),e.abrupt("return",null);case 39:case"end":return e.stop()}}),e,null,[[6,20],[25,33]])}))),Wo.apply(this,arguments)}function Jo(e,n){if(zo("company-name",e||"Sin empresa"),zo("company-sector",(null==n?void 0:n.sector)||"-"),zo("company-activity",(null==n?void 0:n.actividad_economica)||"-"),zo("company-nit",(null==n?void 0:n.nit)||"-"),zo("responsable-name",(null==n?void 0:n.responsable)||(null==n?void 0:n.nombre_responsable)||"-"),$a.companyName=e,$a.companyId=(null==n?void 0:n.id)||null,null!=n&&n.cargos&&Array.isArray(n.cargos)){var t=n.cargos.length,a=n.cargos.reduce((function(e,n){return e+(n.numPersonas||n.numTrabajadores||0)}),0);zo("stat-total-trabajadores",a.toString());var o=0;n.cargos.forEach((function(e){e.ges&&Array.isArray(e.ges)&&(o+=e.ges.length),e.gesSeleccionados&&Array.isArray(e.gesSeleccionados)&&(o+=e.gesSeleccionados.length)})),zo("stat-peligros",o.toString()),console.log("[Dashboard] Company stats - Cargos: ".concat(t,", Trabajadores: ").concat(a,", GES: ").concat(o))}}function Xo(){console.log("[CargoWizard] Opening create wizard...");var e,n=Bo(),t=ze({mode:"create",empresaId:n,onSave:(e=(0,i.A)(u().mark((function e(t){var a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[CargoWizard] Saving new cargo:",t),e.prev=1,e.next=4,fetch("/api/cargos",{method:"POST",headers:Do(),body:JSON.stringify(Fa(Fa({},t),{},{empresa_id:n}))});case 4:if((a=e.sent).ok){e.next=7;break}throw new Error("Error al crear el cargo");case 7:return e.next=9,a.json();case 9:return o=e.sent,console.log("[CargoWizard] Cargo created:",o),e.next=13,uo();case 13:Yo("Cargo creado exitosamente","success"),e.next=21;break;case 16:throw e.prev=16,e.t0=e.catch(1),console.error("[CargoWizard] Error saving cargo:",e.t0),Yo("Error al crear el cargo: "+e.t0.message,"error"),e.t0;case 21:case"end":return e.stop()}}),e,null,[[1,16]])}))),function(n){return e.apply(this,arguments)}),onCancel:function(){console.log("[CargoWizard] Create wizard cancelled")}});t.show()}function Zo(e,n){console.log("[CargoWizard] Opening edit wizard for cargo:",e,n);var t,a=Bo(),o=ze({mode:"edit",cargoId:e,cargoData:n,empresaId:a,onSave:(t=(0,i.A)(u().mark((function n(t){var o,i,r;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("[CargoWizard] Saving edited cargo:",t),n.prev=1,t.pendingApprovals&&t.pendingApprovals.length>0&&(console.log("[CargoWizard] Cargo has pending approvals:",t.pendingApprovals),t.estado_aprobacion="pendiente"),n.next=5,fetch("/api/cargos/".concat(e),{method:"PUT",headers:Do(),body:JSON.stringify(Fa(Fa({},t),{},{empresa_id:a}))});case 5:if((i=n.sent).ok){n.next=8;break}throw new Error("Error al actualizar el cargo");case 8:return n.next=10,i.json();case 10:return r=n.sent,console.log("[CargoWizard] Cargo updated:",r),n.next=14,uo();case 14:(null===(o=t.pendingApprovals)||void 0===o?void 0:o.length)>0?Yo("Cargo actualizado. Algunos cambios están pendientes de aprobación.","warning"):Yo("Cargo actualizado exitosamente","success"),n.next=23;break;case 18:throw n.prev=18,n.t0=n.catch(1),console.error("[CargoWizard] Error updating cargo:",n.t0),Yo("Error al actualizar el cargo: "+n.t0.message,"error"),n.t0;case 23:case"end":return n.stop()}}),n,null,[[1,18]])}))),function(e){return t.apply(this,arguments)}),onCancel:function(){console.log("[CargoWizard] Edit wizard cancelled")}});o.show()}function Ko(){var e=document.getElementById("btn-nuevo-cargo");e&&e.addEventListener("click",(function(e){e.preventDefault(),Xo()}));var t=document.querySelector(".btn-nuevo-cargo-inline");t&&t.addEventListener("click",(function(e){e.preventDefault(),Xo()})),document.querySelectorAll(".btn-edit-cargo").forEach((function(e){e.addEventListener("click",(function(n){n.preventDefault();var t=e.dataset.cargoId,a={};try{var o=e.dataset.cargo;o&&(a=JSON.parse(o.replace(/&#39;/g,"'")))}catch(e){console.error("[CargoWizard] Error parsing cargo data:",e)}Zo(t,a)}))})),document.querySelectorAll(".btn-view-cargo").forEach((function(e){e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation();var a={};try{var o=e.dataset.cargo;o&&(a=JSON.parse(o.replace(/&#39;/g,"'")))}catch(e){console.error("[CargoDetails] Error parsing cargo data:",e)}!function(e){var t=document.querySelector(".cargo-details-popup");t&&t.remove();var a=e.togglesActivos||[],o=e.nrNivelMaximo||"N/A",i="muted";"I"===o?i="success":"II"===o?i="info":"III"===o?i="warning":"IV"===o?i="danger":"V"===o&&(i="critical");var r=e.gesSeleccionados||[],s=r.reduce((function(e,n){var t=n.riesgo||n.categoria||"Otros";return e[t]||(e[t]=[]),e[t].push(n),e}),{}),c="";c=Object.keys(s).length>0?Object.entries(s).map((function(e){var t=n(e,2),a=t[0],o=t[1];return'\n            <div class="ges-category">\n                <div class="ges-category__header">'.concat(a,'</div>\n                <ul class="ges-category__list">\n                    ').concat(o.map((function(e){var n,t,a,o=e.niveles||{},i=(null===(n=o.deficiencia)||void 0===n?void 0:n.value)||o.deficiencia||"-",r=(null===(t=o.exposicion)||void 0===t?void 0:t.value)||o.exposicion||"-",s=(null===(a=o.consecuencia)||void 0===a?void 0:a.value)||o.consecuencia||"-";return'<li>\n                            <span class="ges-name">'.concat(e.ges||e.nombre||"Sin nombre",'</span>\n                            <span class="ges-niveles">ND:').concat(i," NE:").concat(r," NC:").concat(s,"</span>\n                        </li>")})).join(""),"\n                </ul>\n            </div>\n        ")})).join(""):'<p class="text-muted">Sin riesgos asignados</p>';var l=e.examenesMedicos||[],d="";d=l.length>0?'\n            <ul class="examenes-list">\n                '.concat(l.map((function(e){return'\n                    <li>\n                        <span class="examen-codigo">'.concat(e.codigo,'</span>\n                        <span class="examen-nombre">').concat(e.nombre,"</span>\n                    </li>\n                ")})).join(""),"\n            </ul>\n        "):'<p class="text-muted">Sin exámenes asignados</p>';var u=e.conteoNiveles||{},p='\n        <div class="niveles-grid">\n            '.concat(["V","IV","III","II","I"].map((function(e){return'\n                <div class="nivel-item nivel-item--'.concat(e.toLowerCase(),'">\n                    <span class="nivel-label">NR ').concat(e,'</span>\n                    <span class="nivel-count">').concat(u[e]||0,"</span>\n                </div>\n            ")})).join(""),"\n        </div>\n    "),m=document.createElement("div");m.className="cargo-details-popup",m.innerHTML='\n        <div class="cargo-details-overlay"></div>\n        <div class="cargo-details-modal">\n            <div class="cargo-details-modal__header">\n                <h2 class="cargo-details-modal__title">\n                    <i data-lucide="briefcase"></i>\n                    '.concat(e.nombre_cargo||"Sin nombre",'\n                </h2>\n                <button class="cargo-details-modal__close" aria-label="Cerrar">\n                    <i data-lucide="x"></i>\n                </button>\n            </div>\n            <div class="cargo-details-modal__body">\n                \x3c!-- Info básica --\x3e\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="info"></i> Información General\n                    </h3>\n                    <div class="details-grid">\n                        <div class="detail-item">\n                            <span class="detail-label">Área</span>\n                            <span class="detail-value">').concat(e.area||"Sin área",'</span>\n                        </div>\n                        <div class="detail-item">\n                            <span class="detail-label">Zona</span>\n                            <span class="detail-value">').concat(e.zona||"Sin zona",'</span>\n                        </div>\n                        <div class="detail-item">\n                            <span class="detail-label">Personas</span>\n                            <span class="detail-value">').concat(e.num_trabajadores||0,'</span>\n                        </div>\n                        <div class="detail-item">\n                            <span class="detail-label">NR Máximo</span>\n                            <span class="detail-value">\n                                <span class="badge badge--').concat(i,'">').concat(e.nrMaximo||"N/A"," (").concat(o,")</span>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Descripción --\x3e\n                ").concat(e.descripcion_tareas?'\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="file-text"></i> Descripción de Tareas\n                    </h3>\n                    <p class="descripcion-text">'.concat(e.descripcion_tareas,"</p>\n                </div>\n                "):"","\n\n                \x3c!-- Condiciones especiales --\x3e\n                ").concat(a.length>0?'\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="alert-triangle"></i> Condiciones Especiales\n                    </h3>\n                    <div class="toggles-badges">\n                        '.concat(a.map((function(e){return'\n                            <span class="badge badge--attention">'.concat(e,"</span>\n                        ")})).join(""),"\n                    </div>\n                </div>\n                "):"",'\n\n                \x3c!-- Distribución de riesgos --\x3e\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="bar-chart-3"></i> Distribución de Riesgos por NR\n                    </h3>\n                    ').concat(p,'\n                </div>\n\n                \x3c!-- Riesgos GES --\x3e\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="shield-alert"></i> Riesgos Identificados (').concat(r.length,')\n                    </h3>\n                    <div class="ges-list">\n                        ').concat(c,'\n                    </div>\n                </div>\n\n                \x3c!-- Exámenes médicos --\x3e\n                <div class="details-section">\n                    <h3 class="details-section__title">\n                        <i data-lucide="stethoscope"></i> Exámenes Médicos (').concat(l.length,")\n                    </h3>\n                    ").concat(d,'\n                </div>\n            </div>\n            <div class="cargo-details-modal__footer">\n                <button class="btn btn--outline btn-close-popup">Cerrar</button>\n                <button class="btn btn--primary btn-edit-from-popup" data-cargo-id="').concat(e.id,'">\n                    <i data-lucide="edit-2"></i> Editar Cargo\n                </button>\n            </div>\n        </div>\n    '),document.body.appendChild(m),window.lucide&&window.lucide.createIcons();requestAnimationFrame((function(){m.classList.add("show")}));var g=function(){m.classList.remove("show"),setTimeout((function(){return m.remove()}),300)};m.querySelector(".cargo-details-overlay").addEventListener("click",g),m.querySelector(".cargo-details-modal__close").addEventListener("click",g),m.querySelector(".btn-close-popup").addEventListener("click",g),m.querySelector(".btn-edit-from-popup").addEventListener("click",(function(){g(),Zo(e.id,e)}));var v=function(e){"Escape"===e.key&&(g(),document.removeEventListener("keydown",v))};document.addEventListener("keydown",v)}(a)}))})),console.log("[CargoWizard] Events bound successfully")}function Yo(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=document.createElement("div");t.className="notification notification--".concat(n),t.innerHTML='\n        <i data-lucide="'.concat("success"===n?"check-circle":"error"===n?"alert-circle":"warning"===n?"alert-triangle":"info",'"></i>\n        <span>').concat(e,"</span>\n    "),document.body.appendChild(t),window.lucide&&window.lucide.createIcons(),setTimeout((function(){t.classList.add("show")}),10),setTimeout((function(){t.classList.remove("show"),setTimeout((function(){t.remove()}),300)}),4e3)}function Qo(){var e=function(){var e=localStorage.getItem("genesys_user");if(e)try{var n=JSON.parse(e).rol;if("admin_genesys"===n||"medico_ocupacional"===n)return console.log("[Paywall] Usuario es",n,"- Paywall deshabilitado"),!1}catch(e){console.warn("[Paywall] Error leyendo rol del usuario:",e)}return!0},n=function(){return"paid"===localStorage.getItem("genesys_payment_status")},t=document.getElementById("paywall-btn-pay");t&&t.addEventListener("click",(0,i.A)(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[Paywall] Pay button clicked"),(n=document.getElementById("paywall-overlay"))&&(n.style.display="none"),Yo("Contáctenos para procesar su pago y desbloquear todos los documentos","info"),setTimeout((function(){var e=encodeURIComponent("Hola, quiero pagar por los documentos del dashboard");window.open("https://wa.me/".concat("573102877240","?text=").concat(e),"_blank")}),1500);case 5:case"end":return e.stop()}}),e)}))));var a=document.getElementById("paywall-download-cotizacion");a&&a.addEventListener("click",(0,i.A)(u().mark((function e(){var n,t,a,o,i,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.disabled=!0,console.log("[Paywall] Downloading cotización..."),e.prev=2,n=localStorage.getItem("empresaId"),t=localStorage.getItem("authToken"),n&&t){e.next=7;break}throw new Error("No se encontró información de sesión");case 7:return e.next=9,fetch("/api/documentos/empresa/".concat(n),{headers:{Authorization:"Bearer ".concat(t)}});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error al obtener documentos");case 12:return e.next=14,a.json();case 14:if(!((o=e.sent).documents&&o.documents.length>0)){e.next=26;break}if(r=o.documents[0],!(s=null===(i=r.preview_urls)||void 0===i?void 0:i.cotizacion)){e.next=23;break}window.open(s,"_blank"),Yo("Cotización descargada exitosamente","success"),e.next=24;break;case 23:throw new Error("Cotización no disponible");case 24:e.next=27;break;case 26:throw new Error("No hay documentos disponibles");case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(2),console.error("[Paywall] Error downloading cotización:",e.t0),Yo(e.t0.message||"Error al descargar la cotización","error");case 33:this.disabled=!1;case 34:case"end":return e.stop()}}),e,this,[[2,29]])}))));var o=document.getElementById("paywall-download-perfil");o&&o.addEventListener("click",(0,i.A)(u().mark((function e(){var n,t,a,o,i,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.disabled=!0,console.log("[Paywall] Downloading perfil..."),e.prev=2,n=localStorage.getItem("empresaId"),t=localStorage.getItem("authToken"),n&&t){e.next=7;break}throw new Error("No se encontró información de sesión");case 7:return e.next=9,fetch("/api/documentos/empresa/".concat(n),{headers:{Authorization:"Bearer ".concat(t)}});case 9:if((a=e.sent).ok){e.next=12;break}throw new Error("Error al obtener documentos");case 12:return e.next=14,a.json();case 14:if(!((o=e.sent).documents&&o.documents.length>0)){e.next=26;break}if(r=o.documents[0],!(s=null===(i=r.preview_urls)||void 0===i?void 0:i.perfil)){e.next=23;break}window.open(s,"_blank"),Yo("Perfil de Cargo descargado exitosamente","success"),e.next=24;break;case 23:throw new Error("Perfil de cargo no disponible");case 24:e.next=27;break;case 26:throw new Error("No hay documentos disponibles");case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(2),console.error("[Paywall] Error downloading perfil:",e.t0),Yo(e.t0.message||"Error al descargar el perfil","error");case 33:this.disabled=!1;case 34:case"end":return e.stop()}}),e,this,[[2,29]])})))),e()?n()?console.log("[Paywall] User has paid. No paywall will be shown."):(console.log("[Paywall] User has not paid. Timer starting (8s)..."),setTimeout((function(){!n()&&e()&&function(){var e=document.getElementById("paywall-overlay");if(e){var n=0;if($a.data.cargos&&$a.data.cargos.length>0)n=$a.data.cargos.length,console.log("[Paywall] Using cargo count from DashboardState:",n);else try{var t=localStorage.getItem("genesys_empresa");t&&(n=JSON.parse(t).numCargos||0,console.log("[Paywall] Using cargo count from genesys_empresa:",n))}catch(e){console.warn("[Paywall] Error reading cargo count:",e)}var a=3e4*n,o=document.getElementById("paywall-cargo-count");o&&(o.textContent=n.toString());var i=document.getElementById("paywall-total");i&&(i.textContent="$"+a.toLocaleString("es-CO")),e.style.display="flex",window.lucide&&window.lucide.createIcons(),console.log("[Paywall] Modal shown - Cargos:",n,"Total:","$"+a.toLocaleString("es-CO"))}}()}),8e3)):console.log("[Paywall] Paywall deshabilitado para este rol.")}document.addEventListener("DOMContentLoaded",(0,i.A)(u().mark((function e(){var n,t,a,o,i,r,s,c,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("🚀 Dashboard Premium initializing..."),!(n=localStorage.getItem("user")||sessionStorage.getItem("user"))){e.next=15;break}if(e.prev=3,"admin_genesys"!==(t=JSON.parse(n)).rol&&"medico_ocupacional"!==t.rol){e.next=10;break}return console.log("[Dashboard] Detectado rol especial:",t.rol),e.next=9,_t();case 9:return e.abrupt("return");case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.warn("[Dashboard] Error parsing user:",e.t0);case 15:if(console.log("🔍 [DEBUG] Checking localStorage..."),a=localStorage.getItem("genesys_wizard_state"),console.log("🔍 [DEBUG] genesys_wizard_state exists:",!!a),a)try{l=JSON.parse(a),console.log("🔍 [DEBUG] Parsed wizard state:",{currentStep:l.currentStep,hasFormData:!!l.formData,nombreEmpresa:(null===(o=l.formData)||void 0===o?void 0:o.nombreEmpresa)||"N/A",nit:(null===(i=l.formData)||void 0===i?void 0:i.nit)||"N/A",cargosCount:(null===(r=l.formData)||void 0===r||null===(r=r.cargos)||void 0===r?void 0:r.length)||0,firstCargo:(null===(s=l.formData)||void 0===s||null===(s=s.cargos)||void 0===s?void 0:s[0])||"No cargos"}),(null===(c=l.formData)||void 0===c||null===(c=c.cargos)||void 0===c?void 0:c.length)>0&&l.formData.cargos.forEach((function(e,n){var t;console.log("🔍 [DEBUG] Cargo ".concat(n,":"),{nombre:e.nombre,area:e.area,zona:e.zona,numPersonas:e.numPersonas,gesCount:(null===(t=e.ges)||void 0===t?void 0:t.length)||0,toggles:{trabajaAlturas:e.trabajaAlturas,manipulaAlimentos:e.manipulaAlimentos,conduceVehiculo:e.conduceVehiculo,trabajaEspaciosConfinados:e.trabajaEspaciosConfinados}})}))}catch(e){console.error("🔴 [DEBUG] Error parsing wizard state:",e)}else console.warn("🟡 [DEBUG] No wizard state found in localStorage. Keys available:",Object.keys(localStorage));return console.log("🔍 [DEBUG] Checking DOM containers..."),["cargos-content","matriz-critical-content","profesiograma-content","documentos-content","examenes-table-body"].forEach((function(e){var n=document.getElementById(e);console.log('🔍 [DEBUG] Container "'.concat(e,'":'),n?"FOUND":"NOT FOUND")})),new Ka,$o(),e.next=26,Vo();case 26:if(!(d=Bo())){e.next=31;break}return console.log("[Dashboard] Pre-loading cargos for empresa:",d),e.next=31,qo();case 31:document.addEventListener("keydown",(function(e){if((e.metaKey||e.ctrlKey)&&"k"===e.key){e.preventDefault();var n=document.getElementById("global-search");n&&n.focus()}})),console.log("✅ Dashboard Premium ready");case 33:case"end":return e.stop()}}),e,null,[[3,12]])})))),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Qo):Qo(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){console.log("🎭 Inicializando sistema multi-rol..."),_t()})):(console.log("🎭 Inicializando sistema multi-rol..."),_t()),console.log("✅ Dashboard Premium initialized")})()})();